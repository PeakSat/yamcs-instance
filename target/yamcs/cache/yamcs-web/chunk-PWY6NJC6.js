import{b as ft,d as vt,e as be,f as we}from"./chunk-FTOGDGWN.js";import{$d as Ce,Aa as s,Ba as x,Bb as Bt,Bd as ve,C as K,Ca as A,Db as ot,Eb as rt,Ed as ut,F as M,Fc as Zt,Ga as E,Gb as jt,Gc as te,Hc as ee,Hd as ye,Ia as Q,Ib as H,J as kt,Jb as st,K as C,L as g,La as y,Ma as _,Na as it,Nb as lt,P as k,Qb as ct,Re as F,Sc as ie,Tc as ne,Uc as ae,Ue as J,Ve as I,Wc as oe,We as ht,X as c,Xc as re,Xe as Ae,Y as v,Yb as Ut,Yd as P,Ye as Te,Zc as se,_a as L,_b as j,_c as le,_d as _e,a as At,aa as u,ad as ce,b as Tt,bc as qt,bd as me,be as ge,ca as d,db as Lt,dd as pe,e as w,ea as B,fc as mt,ga as h,ha as Z,ia as tt,ib as nt,ic as Gt,id as de,ja as et,jd as ue,ka as r,kd as he,la as o,ma as f,mb as Ot,mc as pt,na as V,nb as Pt,oa as $,ob as Ft,oc as Ht,p as Et,pb as at,pc as zt,qa as b,qb as Vt,qc as Wt,ra as S,rc as Yt,sa as p,sc as dt,tc as Qt,te as U,uc as Jt,vb as $t,vc as Kt,vd as fe,ve as Se,wa as z,wb as Nt,wc as Xt,we as xe,x as It,xa as W,ya as Y,yd as O,z as Dt,za as N,zb as Rt}from"./chunk-YLFXKKOP.js";function Ne(t,e){if(t&1&&(s(0),y(1,"deltaWith")),t&2){let a=p();A(" (",it(1,1,a.stop,a.start),") ")}}function Re(t,e){if(t&1&&(r(0,"dt"),s(1),o(),r(2,"dd"),s(3),o()),t&2){let a=e.$implicit;c(),A("\xA0\xA0",a.key,""),c(2),x(a.value)}}function Be(t,e){if(t&1&&(r(0,"div",0)(1,"dl",1)(2,"dt"),s(3,"Activity ID"),o(),r(4,"dd"),s(5),o(),r(6,"dt"),s(7,"Status"),o(),r(8,"dd"),s(9),o(),r(10,"dt"),s(11,"Started"),o(),r(12,"dd"),s(13),y(14,"datetime"),o(),r(15,"dt"),s(16,"Finished"),o(),r(17,"dd"),s(18),y(19,"datetime"),u(20,Ne,2,4),o(),r(21,"dt"),s(22,"User"),o(),r(23,"dd"),s(24),o()(),r(25,"div",2),f(26,"mat-divider"),o(),r(27,"dl",3)(28,"dt"),s(29,"Activity type"),o(),r(30,"dd"),s(31),o(),r(32,"dt"),s(33,"Arguments"),o(),f(34,"dd"),tt(35,Re,4,2,null,null,Z),y(37,"keyvalue"),o()()),t&2){let a,i=e;c(5),x(i.id),c(4),x(i.status),c(4),x(_(14,7,i.start)),c(5),A(" ",(a=_(19,9,i.stop))!==null&&a!==void 0?a:"-"," "),c(2),h(i.stop?20:-1),c(4),x(i.startedBy),c(7),x(i.type),c(4),et(_(37,11,i.args))}}var Me=(()=>{let e=class e{constructor(i,n){this.yamcs=i,this.messageService=n,this.activityId=k.required(),this.activity$=new w(null)}ngOnInit(){let{yamcs:i}=this;i.yamcsClient.getActivity(i.instance,this.activityId()).then(n=>{this.activity$.next(n)}).catch(n=>this.messageService.showError(n))}};e.\u0275fac=function(n){return new(n||e)(v(F),v(P))},e.\u0275cmp=M({type:e,selectors:[["ng-component"]],inputs:{activityId:[1,"activityId"]},standalone:!0,features:[E],decls:2,vars:3,consts:[[1,"panel-content"],[1,"dl-horizontal","no-lead"],[1,"section-divider"],[1,"dl-horizontal"]],template:function(n,l){if(n&1&&(u(0,Be,38,13,"div",0),y(1,"async")),n&2){let m;h((m=_(1,1,l.activity$))?0:-1,m)}},dependencies:[I,L,Lt,zt,U,Se],encapsulation:2,changeDetection:0});let t=e;return t})();var Ct=(()=>{let e=class e{constructor(i,n,l){this.dialogRef=i,this.data=l,this.form=n.group({failureReason:["",[Bt.required]]})}async submit(){this.dialogRef.close({failureReason:this.form.value.failureReason})}};e.\u0275fac=function(n){return new(n||e)(v(Wt),v(Ut),v(Yt))},e.\u0275cmp=M({type:e,selectors:[["app-set-failed-dialog"]],standalone:!0,features:[E],decls:13,vars:4,consts:[["filename",""],["mat-dialog-title",""],[1,"ya-form",3,"formGroup"],["type","text","formControlName","failureReason"],["align","end"],["mat-dialog-close","",1,"ya-button"],[1,"ya-button","primary",3,"click","disabled"]],template:function(n,l){if(n&1){let m=b();r(0,"h2",1),s(1,"Set failed"),o(),r(2,"mat-dialog-content")(3,"form",2)(4,"label"),s(5," Failure reason "),f(6,"input",3,0),o()()(),r(8,"mat-dialog-actions",4)(9,"button",5),s(10,"CANCEL"),o(),r(11,"button",6),S("click",function(){return C(m),g(l.submit())}),s(12,"SUBMIT"),o()()}if(n&2){let m;c(3),d("formGroup",l.form),c(),B("invalid",(m=l.form.get("name"))==null?null:m.invalid),c(7),d("disabled",!l.form.valid)}},dependencies:[I,st,Rt,ot,rt,lt,ct,Qt,Jt,Xt,Kt],encapsulation:2,changeDetection:0});let t=e;return t})();var Ie=(()=>{let e=class e{constructor(){this.synchronizer=K(J),this.elapsed$=new w(0)}ngOnChanges(){this.syncSubscription?.unsubscribe(),this.activity&&(this.updateState(),this.activity.stop||(this.syncSubscription=this.synchronizer.sync(()=>this.updateState())))}updateState(){if(!this.activity.start)return;let i=new Date(this.activity.start);if(this.activity.stop){let n=new Date(this.activity.stop);this.elapsed$.next(this.millisBetween(i,n))}else{let n=this.millisBetween(i,new Date);this.elapsed$.next(n)}}millisBetween(i,n){return n.getTime()-i.getTime()}ngOnDestroy(){this.syncSubscription?.unsubscribe()}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=M({type:e,selectors:[["app-activity-duration"]],inputs:{activity:"activity"},standalone:!0,features:[kt,E],decls:3,vars:5,template:function(n,l){n&1&&(s(0),y(1,"async"),y(2,"duration")),n&2&&x(_(2,3,_(1,1,l.elapsed$)))},dependencies:[I,L,xe],encapsulation:2,changeDetection:0});let t=e;return t})();function qe(t,e){if(t&1&&(r(0,"mat-icon",0),s(1," check_circle "),o()),t&2){let a=p();d("matTooltip",a.status)}}function Ge(t,e){if(t&1&&(r(0,"mat-icon",1),s(1," cached "),o()),t&2){let a=p();d("matTooltip",a.status)}}function He(t,e){if(t&1&&(r(0,"mat-icon",2),s(1," highlight_off "),o()),t&2){let a=p();d("matTooltip",a.status)}}function ze(t,e){if(t&1&&(r(0,"mat-icon",3),s(1," cached "),o()),t&2){let a=p();d("matTooltip",a.status)}}function We(t,e){if(t&1&&(r(0,"mat-icon",4),s(1," stop_circle "),o()),t&2){let a=p();d("matTooltip",a.status)}}function Ye(t,e){if(t&1&&u(0,qe,2,1,"mat-icon",0)(1,Ge,2,1,"mat-icon",1)(2,He,2,1,"mat-icon",2)(3,ze,2,1,"mat-icon",3)(4,We,2,1,"mat-icon",4),t&2){let a=e;h(a.status==="SUCCESSFUL"?0:-1),c(),h(a.status==="RUNNING"?1:-1),c(),h(a.status==="FAILED"?2:-1),c(),h(a.status==="CANCELLED"&&!a.stop?3:-1),c(),h(a.status==="CANCELLED"&&a.stop?4:-1)}}var De=(()=>{let e=class e{constructor(){this.activity=k.required()}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=M({type:e,selectors:[["app-activity-icon"]],inputs:{activity:[1,"activity"]},standalone:!0,features:[E],decls:1,vars:1,consts:[[1,"success",3,"matTooltip"],[1,"spin",3,"matTooltip"],[1,"alert",3,"matTooltip"],[1,"warning","spin",3,"matTooltip"],[1,"down",3,"matTooltip"]],template:function(n,l){if(n&1&&u(0,Ye,5,5),n&2){let m;h((m=l.activity())?0:-1,m)}},dependencies:[I,j,pt],encapsulation:2,changeDetection:0});let t=e;return t})();var gt=class{constructor(e){this.watermarkObserver=e,this.dirty=!1,this.archiveActivities=[],this.bufferSize=500,this.bufferWatermark=400,this.pointer=0,this.alreadyWarned=!1,this.realtimeBuffer=Array(this.bufferSize).fill(void 0)}addArchiveData(e){this.archiveActivities=this.archiveActivities.concat(e),this.dirty=!0}addRealtimeActivity(e){this.pointer<this.bufferSize&&(this.realtimeBuffer[this.pointer]=e,this.pointer>=this.bufferWatermark&&this.watermarkObserver&&!this.alreadyWarned&&(this.alreadyWarned=!0,this.watermarkObserver()),this.pointer=this.pointer+1),this.dirty=!0}reset(){this.archiveActivities=[],this.realtimeBuffer.fill(void 0),this.pointer=0,this.alreadyWarned=!1,this.dirty=!0}snapshot(){let e=this.archiveActivities;return this.realtimeBuffer.map(a=>{if(!a)return;let i=e.findIndex(n=>n.id==a.id);i===-1?e.push(a):e[i]=a}),e.sort((a,i)=>{let n=-a.start.localeCompare(i.start);return n!==0?n:i.seq-a.seq}),e}compact(e){let a=this.snapshot();a.length=Math.min(e,a.length),this.reset(),this.archiveActivities=a,this.dirty=!0}};var St=class extends $t{constructor(e,a){super(),this.yamcs=e,this.pageSize=100,this.blockHasMore=!1,this.activities$=new w([]),this.loading$=new w(!1),this.streaming$=new w(!1),this.syncSubscription=a.sync(()=>{this.buffer.dirty&&!this.loading$.getValue()&&(this.emitActivities(),this.buffer.dirty=!1)}),this.buffer=new gt(()=>{this.blockHasMore=!0,this.buffer.compact(500)})}connect(e){return this.activities$}emitActivities(){let e=this.buffer.snapshot();this.activities$.next(e)}loadActivities(e){return this.loading$.next(!0),Promise.all([this.loadPage(Tt(At({},e),{limit:this.pageSize}))]).then(a=>{let i=a[0];return this.loading$.next(!1),this.buffer.reset(),this.blockHasMore=!1,this.buffer.addArchiveData(i),this.emitActivities(),i})}hasMore(){return!!this.continuationToken&&!this.blockHasMore}loadPage(e){return this.options=e,this.yamcs.yamcsClient.getActivities(this.yamcs.instance,e).then(a=>(this.continuationToken=a.continuationToken,a.activities||[]))}loadMoreData(e){this.continuationToken&&this.loadPage(Tt(At({},e),{next:this.continuationToken,limit:this.pageSize})).then(a=>{this.buffer.addArchiveData(a)})}startStreaming(){this.streaming$.next(!0),this.realtimeSubscription=this.yamcs.yamcsClient.createActivitySubscription({instance:this.yamcs.instance},e=>{!this.loading$.getValue()&&this.matchesFilter(e)&&this.buffer.addRealtimeActivity(e)})}matchesFilter(e){return!(this.options&&(this.options.type&&e.type!==this.options.type||this.options.status&&e.status!==this.options.status||this.options.q&&(!e.detail||e.detail.indexOf(this.options.q)===-1)))}stopStreaming(){this.realtimeSubscription?.cancel(),this.streaming$.next(!1)}disconnect(e){this.stopStreaming(),this.syncSubscription?.unsubscribe(),this.activities$.complete(),this.loading$.complete(),this.streaming$.complete()}};var Ze=["intervalSelect"],ti=t=>({c:t});function ei(t,e){if(t&1){let a=b();r(0,"button",36),S("click",function(){C(a);let n=p();return g(n.cancelSelectedActivities())}),r(1,"mat-icon"),s(2,"cancel"),o(),s(3," Cancel "),o()}if(t&2){let a=p();d("disabled",!a.isGroupCancelEnabled())}}function ii(t,e){if(t&1){let a=b();f(0,"ya-date-time-input",37)(1,"ya-date-time-input",38),r(2,"button",35),S("click",function(){C(a);let n=p();return g(n.applyCustomDates())}),s(3," Apply "),o()}if(t&2){let a=p();c(2),d("disabled",a.filterForm.invalid)}}function ni(t,e){if(t&1){let a=b();r(0,"button",39),S("click",function(){C(a);let n=p();return g(n.jumpToNow())}),s(1,"Jump to now"),o()}}function ai(t,e){t&1&&f(0,"ya-dots")}function oi(t,e){if(t&1&&(r(0,"span"),s(1," Showing activities from "),r(2,"b"),s(3,"the last hour"),o(),s(4," ending at "),r(5,"b"),s(6),y(7,"datetime"),o(),s(8," (Mission Time) "),o()),t&2){let a=p();c(6),x(_(7,1,a.validStop))}}function ri(t,e){if(t&1&&(r(0,"span"),s(1," Showing activities from "),r(2,"b"),s(3,"the last 6 hours"),o(),s(4," ending at "),r(5,"b"),s(6),y(7,"datetime"),o(),s(8," (Mission Time) "),o()),t&2){let a=p();c(6),x(_(7,1,a.validStop))}}function si(t,e){if(t&1&&(r(0,"span"),s(1," Showing activities from "),r(2,"b"),s(3,"the last 24 hours"),o(),s(4," ending at "),r(5,"b"),s(6),y(7,"datetime"),o(),s(8," (Mission Time) "),o()),t&2){let a=p();c(6),x(_(7,1,a.validStop))}}function li(t,e){t&1&&(r(0,"span"),s(1," Showing activities from "),r(2,"b"),s(3,"all time"),o()())}function ci(t,e){if(t&1&&(r(0,"span"),s(1," Showing activities from "),r(2,"b"),s(3),y(4,"datetime"),o(),s(5," to "),r(6,"b"),s(7),y(8,"datetime"),o(),s(9," (Mission Time) "),o()),t&2){let a=p();c(3),x(_(4,2,a.validStart)),c(4),x(_(8,4,a.validStop))}}function mi(t,e){if(t&1){let a=b();r(0,"th",40)(1,"input",41),S("change",function(n){C(a);let l=p();return g(n?l.masterToggle():null)}),o()()}if(t&2){let a=p();c(),d("checked",a.selection.hasValue()&&a.isAllSelected())}}function pi(t,e){if(t&1){let a=b();r(0,"td",42)(1,"input",43),S("click",function(n){return C(a),g(n.stopPropagation())})("change",function(n){let l=C(a).$implicit,m=p();return g(n?m.selection.toggle(l):null)}),o()()}if(t&2){let a=e.$implicit,i=p();c(),d("checked",i.selection.isSelected(a))}}function di(t,e){t&1&&f(0,"th",44)}function ui(t,e){if(t&1&&(r(0,"td",45),f(1,"app-activity-icon",46),o()),t&2){let a=e.$implicit;c(),d("activity",a)}}function hi(t,e){t&1&&(r(0,"th",47),s(1,"Id"),o())}function fi(t,e){if(t&1&&(r(0,"td",48)(1,"a",49),s(2),o()()),t&2){let a=e.$implicit,i=p();c(),d("routerLink",a.id)("matTooltip",a.id)("queryParams",Q(4,ti,i.yamcs.context)),c(),A(" ",a.id.substring(0,8)," ")}}function vi(t,e){t&1&&(r(0,"th",47),s(1,"Start"),o())}function yi(t,e){if(t&1&&(r(0,"td",50),s(1),y(2,"datetime"),o()),t&2){let a=e.$implicit;c(),A(" ",_(2,1,a.start)," ")}}function _i(t,e){t&1&&(r(0,"th",47),s(1,"Type"),o())}function Ci(t,e){if(t&1&&(r(0,"td",50),s(1),o()),t&2){let a=e.$implicit;c(),A(" ",a.type," ")}}function gi(t,e){t&1&&(r(0,"th",47),s(1,"Detail"),o())}function Si(t,e){if(t&1&&(r(0,"td",50),s(1),o()),t&2){let a=e.$implicit;c(),A(" ",a.detail||"-"," ")}}function xi(t,e){t&1&&(r(0,"th",47),s(1,"Duration"),o())}function bi(t,e){if(t&1&&f(0,"app-activity-duration",46),t&2){let a=p().$implicit;d("activity",a)}}function Ai(t,e){t&1&&s(0," - ")}function Ti(t,e){if(t&1&&(r(0,"td",50),u(1,bi,1,1,"app-activity-duration",46)(2,Ai,1,0),o()),t&2){let a=e.$implicit;c(),h(a.start?1:2)}}function wi(t,e){t&1&&f(0,"th",51)}function Mi(t,e){if(t&1){let a=b();r(0,"ya-more")(1,"button",53),S("click",function(){C(a);let n=p().$implicit,l=p();return g(l.cancelActivity(n))}),s(2," Cancel "),o()()}if(t&2){let a=p().$implicit,i=p();c(),d("disabled",a.stop!==void 0||!i.mayControlActivities())}}function Ei(t,e){t&1&&(r(0,"span",52),s(1),o()),t&2&&(c(),A(" ",e," "))}function Ii(t,e){if(t&1){let a=b();r(0,"button",39),S("click",function(){C(a);let n=p().$implicit,l=p();return g(l.setSuccessful(n))}),r(1,"mat-icon"),s(2,"thumb_up"),o(),s(3," Set successful "),o(),s(4," \xA0 "),r(5,"button",39),S("click",function(){C(a);let n=p().$implicit,l=p();return g(l.setFailed(n))}),r(6,"mat-icon"),s(7,"thumb_down"),o(),s(8," Set failed "),o()}}function Di(t,e){if(t&1&&(r(0,"td",50),u(1,Mi,3,1,"ya-more")(2,Ei,2,1,"span",52)(3,Ii,9,0),o()),t&2){let a,i=e.$implicit,n=p();c(),h(n.mayControlActivities()?1:-1),c(),h((a=i.failureReason)?2:-1,a),c(),h(i.type==="MANUAL"&&i.status==="RUNNING"&&n.mayControlActivities()?3:-1)}}function ki(t,e){t&1&&f(0,"tr",54)}function Li(t,e){if(t&1){let a=b();r(0,"tr",55),S("click",function(){let n=C(a).$implicit,l=p();return g(l.toggleOne(n))}),o()}if(t&2){let a=e.$implicit,i=p();B("selected",i.selection.isSelected(a))}}var xt="NO_LIMIT",ke=(()=>{let e=class e{constructor(i,n,l,m,D,R,X,Ve){this.yamcs=i,this.authService=n,this.router=l,this.route=m,this.messageService=X,this.dialog=Ve,this.filterForm=new jt({status:new H([]),filter:new H,type:new H([]),interval:new H(xt),customStart:new H(null),customStop:new H(null)}),this.columns=[{id:"select",label:"",alwaysVisible:!0},{id:"status",label:"Status",alwaysVisible:!0},{id:"id",label:"Id",alwaysVisible:!0},{id:"start",label:"Start",visible:!0},{id:"type",label:"Type",visible:!0},{id:"detail",label:"Detail",visible:!0},{id:"duration",label:"Duration",visible:!0},{id:"actions",label:"",alwaysVisible:!0}],this.typeOptions$=new w([{id:"MANUAL",label:"Manual",icon:"emoji_people"}]),this.statusOptions$=new w([{id:"RUNNING",label:"Running",icon:"cached"},{id:"SUCCESSFUL",label:"Successful",icon:"check_circle"},{id:"CANCELLED",label:"Cancelled",icon:"stop_circle"},{id:"FAILED",label:"Failed",icon:"highlight_off"}]),this.intervalOptions=[{id:"PT1H",label:"Last hour"},{id:"PT6H",label:"Last 6 hours"},{id:"P1D",label:"Last 24 hours"},{id:"NO_LIMIT",label:"No limit"},{id:"CUSTOM",label:"Custom",group:!0}],this.status=[],this.type=[],this.selection=new Nt(!0,[]),this.tableTrackerFn=(T,G)=>G.id,D.setTitle("Activities"),i.yamcsClient.getExecutors(i.instance).then(T=>{for(let G of T)this.typeOptions$.next([...this.typeOptions$.value,{id:G.type,label:G.displayName,icon:G.icon||"new_label"}])}).catch(T=>this.messageService.showError(T)),this.dataSource=new St(i,R),this.dataSource.startStreaming(),this.initializeOptions(),this.loadData(),this.filterForm.get("filter").valueChanges.pipe(Et(400)).forEach(T=>{this.filter=T,this.loadData()}),this.filterForm.get("status").valueChanges.forEach(T=>{this.status=T,this.loadData()}),this.filterForm.get("type").valueChanges.forEach(T=>{this.type=T,this.loadData()}),this.filterForm.get("interval").valueChanges.forEach(T=>{if(T==="CUSTOM"){let G=this.validStart||this.yamcs.getMissionTime(),$e=this.validStop||this.yamcs.getMissionTime();this.filterForm.get("customStart").setValue(O.toISOString(G)),this.filterForm.get("customStop").setValue(O.toISOString($e))}else T==="NO_LIMIT"?(this.validStart=null,this.validStop=null,this.appliedInterval=T,this.loadData()):(this.validStop=i.getMissionTime(),this.validStart=O.subtractDuration(this.validStop,T),this.appliedInterval=T,this.loadData())})}initializeOptions(){let i=this.route.snapshot.queryParamMap;if(i.has("filter")&&(this.filter=i.get("filter")||"",this.filterForm.get("filter").setValue(this.filter)),i.has("status")&&(this.type=i.getAll("status"),this.filterForm.get("status").setValue(this.status)),i.has("type")&&(this.type=i.getAll("type"),this.filterForm.get("type").setValue(this.type)),i.has("interval"))if(this.appliedInterval=i.get("interval"),this.filterForm.get("interval").setValue(this.appliedInterval),this.appliedInterval==="CUSTOM"){let n=i.get("customStart");this.filterForm.get("customStart").setValue(n),this.validStart=O.toDate(n);let l=i.get("customStop");this.filterForm.get("customStop").setValue(l),this.validStop=O.toDate(l)}else this.appliedInterval==="NO_LIMIT"?(this.validStart=null,this.validStop=null):(this.validStop=this.yamcs.getMissionTime(),this.validStart=O.subtractDuration(this.validStop,this.appliedInterval));else this.appliedInterval=xt,this.validStop=null,this.validStart=null}jumpToNow(){let i=this.filterForm.value.interval;i==="NO_LIMIT"?this.filterForm.get("interval").setValue(xt):i==="CUSTOM"?this.filterForm.get("interval").setValue(xt):(this.validStop=this.yamcs.getMissionTime(),this.validStart=O.subtractDuration(this.validStop,i),this.loadData())}applyCustomDates(){this.validStart=O.toDate(this.filterForm.value.customStart),this.validStop=O.toDate(this.filterForm.value.customStop),this.appliedInterval="CUSTOM",this.loadData()}loadData(){this.updateURL();let i={};this.validStart&&(i.start=this.validStart.toISOString()),this.validStop&&(i.stop=this.validStop.toISOString()),this.filter&&(i.q=this.filter),this.status.length&&(i.status=this.status),this.type.length&&(i.type=this.type),this.dataSource.loadActivities(i).catch(n=>this.messageService.showError(n))}loadMoreData(){let i={};this.validStart&&(i.start=this.validStart.toISOString()),this.status&&(i.status=this.status),this.filter&&(i.q=this.filter),this.dataSource.loadMoreData(i)}updateURL(){this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParams:{filter:this.filter||null,status:this.type.length?this.status:null,type:this.type.length?this.type:null,interval:this.appliedInterval,customStart:this.appliedInterval==="CUSTOM"?this.filterForm.value.customStart:null,customStop:this.appliedInterval==="CUSTOM"?this.filterForm.value.customStop:null},queryParamsHandling:"merge"})}mayControlActivities(){return this.authService.getUser().hasSystemPrivilege("ControlActivities")}isAllSelected(){return!1}masterToggle(){}toggleOne(i){(!this.selection.isSelected(i)||this.selection.selected.length>1)&&this.selection.clear(),this.selection.toggle(i)}isGroupCancelEnabled(){for(let i of this.selection.selected)if(!i.stop)return!0;return!1}cancelSelectedActivities(){for(let i of this.selection.selected)i.stop,this.cancelActivity(i)}cancelActivity(i){this.yamcs.yamcsClient.cancelActivity(this.yamcs.instance,i.id).catch(n=>this.messageService.showError(n))}setSuccessful(i){this.yamcs.yamcsClient.completeManualActivity(this.yamcs.instance,i.id).catch(n=>this.messageService.showError(n))}setFailed(i){this.dialog.open(Ct,{width:"400px",data:{activity:i}}).afterClosed().subscribe(n=>{n&&this.yamcs.yamcsClient.completeManualActivity(this.yamcs.instance,i.id,{failureReason:n.failureReason}).catch(l=>this.messageService.showError(l))})}};e.\u0275fac=function(n){return new(n||e)(v(F),v(ht),v(Ft),v(Ot),v(nt),v(J),v(P),v(dt))},e.\u0275cmp=M({type:e,selectors:[["ng-component"]],viewQuery:function(n,l){if(n&1&&z(Ze,5),n&2){let m;W(m=Y())&&(l.intervalSelect=m.first)}},standalone:!0,features:[E],decls:61,vars:25,consts:[["columnChooser",""],["intervalSelect",""],["mat-button","","color","primary",3,"disabled"],[1,"panel-content"],[3,"formGroup"],[1,"filter-bar"],["formControlName","filter","placeholder","Filter by text search"],["preferenceKey","activities",3,"columns"],["formControlName","status","emptyOption","Any status",3,"options"],["formControlName","type","emptyOption","Any type",3,"options"],["icon","access_time","formControlName","interval",3,"options"],[1,"ya-button"],[1,"table-status"],["mat-table","",1,"ya-data-table","expand",3,"dataSource","trackBy"],["cdkColumnDef","select"],["mat-header-cell","","class","checkbox",4,"cdkHeaderCellDef"],["mat-cell","","class","checkbox",4,"cdkCellDef"],["matColumnDef","status"],["mat-header-cell","","class","status",4,"matHeaderCellDef"],["mat-cell","","class","status",4,"matCellDef"],["matColumnDef","id"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","","class","mono",4,"matCellDef"],["matColumnDef","start"],["mat-cell","",4,"matCellDef"],["cdkColumnDef","type"],["mat-header-cell","",4,"cdkHeaderCellDef"],["mat-cell","",4,"cdkCellDef"],["cdkColumnDef","detail"],["cdkColumnDef","duration"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"selected","click",4,"matRowDef","matRowDefColumns"],[2,"flex","1 1 auto"],[1,"ya-button",3,"click","disabled"],["mat-button","","color","primary",3,"click","disabled"],["formControlName","customStart"],["formControlName","customStop"],[1,"ya-button",3,"click"],["mat-header-cell","",1,"checkbox"],["type","checkbox",3,"change","checked"],["mat-cell","",1,"checkbox"],["type","checkbox",3,"click","change","checked"],["mat-header-cell","",1,"status"],["mat-cell","",1,"status"],[3,"activity"],["mat-header-cell",""],["mat-cell","",1,"mono"],[3,"routerLink","matTooltip","queryParams"],["mat-cell",""],["mat-header-cell","",1,"expand"],[1,"alert"],["mat-menu-item","",3,"click","disabled"],["mat-header-row",""],["mat-row","",3,"click"]],template:function(n,l){if(n&1){let m=b();r(0,"app-instance-page")(1,"app-instance-toolbar"),s(2," Activities \xA0\xA0\xA0 "),u(3,ei,4,1,"button",2),o(),r(4,"div",3)(5,"form",4)(6,"div",5),f(7,"ya-search-filter",6)(8,"ya-column-chooser",7,0),o(),r(10,"div",5),f(11,"ya-multi-select",8),y(12,"async"),f(13,"ya-multi-select",9),y(14,"async"),f(15,"ya-select",10,1),u(17,ii,4,1)(18,ni,2,0,"button",11)(19,ai,1,0,"ya-dots"),y(20,"async"),o()(),r(21,"div",12),u(22,oi,9,3,"span")(23,ri,9,3,"span")(24,si,9,3,"span")(25,li,4,0,"span")(26,ci,10,6,"span"),o(),r(27,"table",13),V(28,14),u(29,mi,2,1,"th",15)(30,pi,2,1,"td",16),$(),V(31,17),u(32,di,1,0,"th",18)(33,ui,2,1,"td",19),$(),V(34,20),u(35,hi,2,0,"th",21)(36,fi,3,6,"td",22),$(),V(37,23),u(38,vi,2,0,"th",21)(39,yi,3,3,"td",24),$(),V(40,25),u(41,_i,2,0,"th",26)(42,Ci,2,1,"td",27),$(),V(43,28),u(44,gi,2,0,"th",26)(45,Si,2,1,"td",27),$(),V(46,29),u(47,xi,2,0,"th",26)(48,Ti,3,1,"td",27),$(),V(49,30),u(50,wi,1,0,"th",31)(51,Di,4,3,"td",24),$(),u(52,ki,1,0,"tr",32),y(53,"async"),u(54,Li,1,2,"tr",33),y(55,"async"),o(),r(56,"mat-toolbar"),f(57,"span",34),r(58,"button",35),S("click",function(){return C(m),g(l.loadMoreData())}),s(59," Load More "),o(),f(60,"span",34),o()()()}if(n&2){let m,D=N(9);c(3),h(l.mayControlActivities()?3:-1),c(2),d("formGroup",l.filterForm),c(3),d("columns",l.columns),c(3),d("options",_(12,15,l.statusOptions$)),c(2),d("options",_(14,17,l.typeOptions$)),c(2),d("options",l.intervalOptions),c(2),h(l.filterForm.value.interval==="CUSTOM"?17:-1),c(),h(l.filterForm.value.interval!=="CUSTOM"?18:-1),c(),h(_(20,19,l.dataSource.loading$)?19:-1),c(3),h((m=l.appliedInterval)==="PT1H"?22:m==="PT6H"?23:m==="P1D"?24:m==="NO_LIMIT"?25:m==="CUSTOM"?26:-1),c(5),d("dataSource",l.dataSource)("trackBy",l.tableTrackerFn),c(25),d("matHeaderRowDef",_(53,21,D.displayedColumns$)),c(2),d("matRowDefColumns",_(55,23,D.displayedColumns$)),c(4),d("disabled",!l.dataSource.hasMore())}},dependencies:[Ie,De,vt,ft,I,L,st,ot,rt,lt,ct,at,Zt,te,ee,mt,j,qt,ie,ae,le,oe,ne,ce,re,se,me,pe,Ht,pt,fe,ve,ut,_e,Ce,ge,ye,U],styles:[".table-status[_ngcontent-%COMP%]{background-color:var(--y-background-color);height:24px;line-height:24px;font-size:12px;padding-left:6px}.table-status[_ngcontent-%COMP%]   .message-zone[_ngcontent-%COMP%]{float:right;height:24px;line-height:24px;font-size:12px;padding-right:6px}"],changeDetection:0});let t=e;return t})();var bt=(()=>{let e=class e{constructor(){this.yamcs=K(F),this.messageService=K(P),this.activity$=new w(null)}connect(i){let{yamcs:n}=this,l=!1;this.activitySubscription?.cancel(),this.activitySubscription=n.yamcsClient.createActivitySubscription({instance:n.instance},m=>{l&&m.id===i&&this.activity$.next(m)}),n.yamcsClient.getActivity(n.instance,i).then(m=>{this.activity$.next(m),l=!0}).catch(m=>this.messageService.showError(m))}disconnect(){this.activitySubscription?.cancel(),this.activitySubscription=void 0}};e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=Dt({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();var Oi=["logContainer"],Pi=["top"],Fi=["bottom"];function Vi(t,e){if(t&1&&(r(0,"tr")(1,"td",10),s(2),o(),r(3,"td",11),s(4),y(5,"datetime"),o(),r(6,"td",12),s(7),o()()),t&2){let a=e.$implicit,i=e.$index;B("activity",a.source==="ACTIVITY")("service",a.source==="SERVICE")("WARNING",a.level==="WARNING")("ERROR",a.level==="ERROR"),c(2),x(i+1),c(2),A(" [",it(5,11,a.time,!1),"] "),c(3),x(a.message)}}function $i(t,e){t&1&&(r(0,"tr")(1,"td",13),f(2,"ya-dots"),o()())}function Ni(t,e){t&1&&u(0,$i,3,0,"tr"),t&2&&h(e.stop?-1:0)}var Oe=(()=>{let e=class e{constructor(i,n,l,m){this.yamcs=i,this.messageService=n,this.syncService=l,this.activityId=k.required(),this.archivedLogs=[],this.realtimeLogs=[],this.logs$=new w([]),this.dirty$=new w(!1),this.activity$=m.activity$}ngOnInit(){let{yamcs:i}=this;this.activityLogSubscription=i.yamcsClient.createActivityLogSubscription({instance:i.instance,activity:this.activityId()},n=>{for(let l of this.archivedLogs)if(n.time===l.time&&n.level===l.level&&n.message===l.message&&n.source===l.source)return;this.realtimeLogs.push(n),this.dirty$.next(!0)}),i.yamcsClient.getActivityLog(i.instance,this.activityId()).then(n=>{this.archivedLogs=n.filter(l=>{for(let m of this.realtimeLogs)if(l.time===m.time&&l.level===m.level&&l.message===m.message&&l.source===m.source)return!1;return!0}),this.emitLogs()}).catch(n=>this.messageService.showError(n)),this.syncSubscription=this.syncService.syncFast(()=>{this.dirty$.value&&(this.emitLogs(),this.dirty$.next(!1))})}emitLogs(){if(this.logs$.next([...this.archivedLogs,...this.realtimeLogs]),this.logContainer){let{nativeElement:i}=this.logContainer;Math.abs(i.scrollHeight-i.clientHeight-i.scrollTop)<=1&&setTimeout(()=>{this.bottomAnchor.nativeElement.scrollIntoView()})}}ngOnDestroy(){this.activityLogSubscription?.cancel(),this.syncSubscription?.unsubscribe()}};e.\u0275fac=function(n){return new(n||e)(v(F),v(P),v(J),v(bt))},e.\u0275cmp=M({type:e,selectors:[["ng-component"]],viewQuery:function(n,l){if(n&1&&(z(Oi,5),z(Pi,5),z(Fi,5)),n&2){let m;W(m=Y())&&(l.logContainer=m.first),W(m=Y())&&(l.topAnchor=m.first),W(m=Y())&&(l.bottomAnchor=m.first)}},inputs:{activityId:[1,"activityId"]},standalone:!0,features:[E],decls:21,vars:5,consts:[["logContainer",""],["top",""],["bottom",""],[1,"log-actions"],[1,"ya-button",3,"click"],[1,"log-container"],[1,"top"],[1,"logs","mono",2,"width","100%"],[3,"activity","service","WARNING","ERROR"],[1,"bottom"],["width","1",2,"text-align","right"],["width","1",1,"time",2,"white-space","nowrap"],[1,"message"],["colspan","3"]],template:function(n,l){if(n&1){let m=b();r(0,"div",3)(1,"button",4),S("click",function(){C(m);let R=N(12);return g(R.scrollIntoView())}),r(2,"mat-icon"),s(3,"vertical_align_top"),o(),s(4," Jump to top "),o(),r(5,"button",4),S("click",function(){C(m);let R=N(20);return g(R.scrollIntoView())}),r(6,"mat-icon"),s(7,"vertical_align_bottom"),o(),s(8," Jump to bottom "),o()(),r(9,"div",5,0),f(11,"div",6,1),r(13,"table",7),tt(14,Vi,8,14,"tr",8,Z),y(16,"async"),u(17,Ni,1,1),y(18,"async"),o(),f(19,"div",9,2),o()}if(n&2){let m;c(14),et(_(16,1,l.logs$)),c(3),h((m=_(18,3,l.activity$))?17:-1,m)}},dependencies:[I,L,j,ut,U],styles:[".log-container[_ngcontent-%COMP%]{border-top:1px solid rgba(0,0,0,.12);position:absolute;inset:48px 0 0;overflow:auto;padding-left:12px}.log-actions[_ngcontent-%COMP%]{height:24px;margin:12px;display:flex}.log-actions[_ngcontent-%COMP%]   .ya-button[_ngcontent-%COMP%]{margin-right:7px}.extra-bar-container[_ngcontent-%COMP%]{padding:12px;border-bottom:1.1px solid rgba(0,0,0,.08)}.extra-bar[_ngcontent-%COMP%]{height:24px;line-height:24px}.separator[_ngcontent-%COMP%]{border-right:1px solid rgba(0,0,0,.12)}table.logs[_ngcontent-%COMP%]{line-height:12px}table.logs[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-size:12px;color:#000000a7;vertical-align:top}table.logs[_ngcontent-%COMP%]   td.time[_ngcontent-%COMP%]{opacity:.8}table.logs[_ngcontent-%COMP%]   tr.service[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-weight:700}table.logs[_ngcontent-%COMP%]   td.message[_ngcontent-%COMP%]{white-space:pre-wrap}.top[_ngcontent-%COMP%], .bottom[_ngcontent-%COMP%]{visibility:hidden;line-height:0}"],changeDetection:0});let t=e;return t})();function Ri(t,e){if(t&1&&(r(0,"span",1),s(1),o()),t&2){let a=e;B("successful",a.status==="SUCCESSFUL")("running",a.status==="RUNNING")("failed",a.status==="FAILED")("cancelled",a.status==="CANCELLED"),c(),A(" ",a.status," ")}}var Pe=(()=>{let e=class e{constructor(){this.activity=k.required()}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=M({type:e,selectors:[["app-activity-status"]],inputs:{activity:[1,"activity"]},standalone:!0,features:[E],decls:1,vars:1,consts:[[1,"status",3,"successful","running","failed","cancelled"],[1,"status"]],template:function(n,l){if(n&1&&u(0,Ri,2,9,"span",0),n&2){let m;h((m=l.activity())?0:-1,m)}},dependencies:[I],styles:[".status[_ngcontent-%COMP%]{padding:4px;border-radius:2px}.status.successful[_ngcontent-%COMP%]{background:#28a745;color:#fff}.status.failed[_ngcontent-%COMP%]{background:#dc3545;color:#fff}.status.running[_ngcontent-%COMP%], .status.cancelled[_ngcontent-%COMP%]{background:#eee;color:#333}"],changeDetection:0});let t=e;return t})();var Mt=t=>({c:t});function Bi(t,e){if(t&1){let a=b();r(0,"button",16),S("click",function(){C(a);let n=p(),l=p();return g(l.setSuccessful(n))}),r(1,"mat-icon"),s(2,"thumb_up"),o(),s(3," Set successful "),o(),r(4,"button",16),S("click",function(){C(a);let n=p(),l=p();return g(l.setFailed(n))}),r(5,"mat-icon"),s(6,"thumb_down"),o(),s(7," Set failed "),o()}}function ji(t,e){if(t&1){let a=b();r(0,"button",17),S("click",function(){C(a);let n=p(),l=p();return g(l.cancelActivity(n))}),r(1,"mat-icon"),s(2,"cancel"),o(),s(3," Cancel "),o()}if(t&2){let a=p();d("disabled",!!a.stop)}}function Ui(t,e){if(t&1&&(r(0,"app-instance-page")(1,"app-instance-toolbar")(2,"a",4)(3,"mat-icon"),s(4,"arrow_back"),o()(),s(5," Activity details \xA0\xA0\xA0 "),u(6,Bi,8,0)(7,ji,4,1,"button",5),o(),r(8,"div",6)(9,"div",7)(10,"span",8),s(11),o(),f(12,"br"),r(13,"span",9),s(14),o(),f(15,"br"),r(16,"span",9),s(17),y(18,"datetime"),o(),f(19,"br"),o(),r(20,"div",10),f(21,"app-activity-status",11),o()(),r(22,"nav",12,0)(24,"a",13,1),s(26," Activity Log "),o(),r(27,"a",14,2),s(29," Details "),o()(),r(30,"div",15)(31,"mat-tab-nav-panel",null,3),f(33,"router-outlet"),o()()()),t&2){let a=e,i=N(25),n=N(28),l=N(32),m=p();c(2),d("queryParams",Q(15,Mt,m.yamcs.context)),c(4),h(a.type==="MANUAL"&&a.status==="RUNNING"&&m.mayControlActivities()?6:-1),c(),h(m.mayControlActivities()?7:-1),c(4),x(a.detail),c(3),A("ID: ",a.id,""),c(3),A("Started ",_(18,13,a.start),""),c(4),d("activity",a),c(),d("mat-stretch-tabs",!1)("tabPanel",l),c(2),d("active",i.isActive)("queryParams",Q(17,Mt,m.yamcs.context)),c(3),d("active",n.isActive)("queryParams",Q(19,Mt,m.yamcs.context))}}var Fe=(()=>{let e=class e{constructor(i,n,l,m,D,R){this.yamcs=n,this.messageService=l,this.authService=m,this.dialog=D,this.activityService=R,this.activityId=k.required(),this.activity$=R.activity$.pipe(It(X=>{X&&i.setTitle(X.detail)}))}ngOnInit(){this.activityService.connect(this.activityId())}mayControlActivities(){return this.authService.getUser().hasSystemPrivilege("ControlActivities")}setSuccessful(i){this.yamcs.yamcsClient.completeManualActivity(this.yamcs.instance,i.id).catch(n=>this.messageService.showError(n))}setFailed(i){this.dialog.open(Ct,{width:"400px",data:{activity:i}}).afterClosed().subscribe(n=>{n&&this.yamcs.yamcsClient.completeManualActivity(this.yamcs.instance,i.id,{failureReason:n.failureReason}).catch(l=>this.messageService.showError(l))})}cancelActivity(i){this.yamcs.yamcsClient.cancelActivity(this.yamcs.instance,i.id).catch(n=>this.messageService.showError(n))}ngOnDestroy(){this.activityService.disconnect()}};e.\u0275fac=function(n){return new(n||e)(v(nt),v(F),v(P),v(ht),v(dt),v(bt))},e.\u0275cmp=M({type:e,selectors:[["ng-component"]],inputs:{activityId:[1,"activityId"]},standalone:!0,features:[E],decls:2,vars:3,consts:[["tabs",""],["rla","routerLinkActive"],["rlb","routerLinkActive"],["tabPanel",""],["mat-icon-button","","routerLink","..","color","primary",3,"queryParams"],["mat-button","","color","primary",3,"disabled"],[1,"activity-header"],[1,"activity-header-left"],[1,"title"],[1,"subtitle"],[1,"activity-header-right"],[3,"activity"],["mat-tab-nav-bar","",1,"secondary",3,"mat-stretch-tabs","tabPanel"],["mat-tab-link","","routerLink","log","routerLinkActive","",3,"active","queryParams"],["mat-tab-link","","routerLink","details","routerLinkActive","",3,"active","queryParams"],[1,"tab-content-wrapper"],["mat-button","","color","primary",3,"click"],["mat-button","","color","primary",3,"click","disabled"]],template:function(n,l){if(n&1&&(u(0,Ui,34,21,"app-instance-page"),y(1,"async")),n&2){let m;h((m=_(1,1,l.activity$))?0:-1,m)}},dependencies:[Pe,vt,ft,I,L,Pt,at,Vt,mt,Gt,j,de,he,ue,U],styles:[".activity-header[_ngcontent-%COMP%]{height:100px;border-bottom:1px solid rgba(0,0,0,.1);display:flex}.activity-header-left[_ngcontent-%COMP%]{flex:1 1 auto;align-self:center;margin-left:24px;margin-right:24px}.activity-header-left[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-size:larger}.activity-header-left[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{font-size:smaller;color:gray}.activity-header-right[_ngcontent-%COMP%]{flex:1 1 auto;align-self:center;text-align:right;margin-left:24px;margin-right:24px}.tab-content-wrapper[_ngcontent-%COMP%]{position:absolute;inset:137px 0 0;overflow:auto}.tab-content-wrapper.noscroll[_ngcontent-%COMP%]{overflow:hidden}"],changeDetection:0});let t=e;return t})();var ha=[{path:"",canActivate:[Ae,be],canActivateChild:[Te],runGuardsAndResolvers:"always",component:we,children:[{path:"",pathMatch:"full",component:ke},{path:":activityId",component:Fe,children:[{path:"",pathMatch:"full",redirectTo:"log"},{path:"log",component:Oe},{path:"details",component:Me}]}]}];export{ha as ROUTES};
