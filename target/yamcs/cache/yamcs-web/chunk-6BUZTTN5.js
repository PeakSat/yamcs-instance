import{d as E,e as L}from"./chunk-ISJZ4IJQ.js";import{F as y,Ga as H,J as x,Va as z,W as m,Y as v,e as p,ld as c,ma as C,ra as S,wa as b,xa as M,ya as R}from"./chunk-YLFXKKOP.js";var d=0,u=class{constructor(s){this.lines=[],this.bitlength=s.length*8;for(let o=0;o<s.length;o+=16)this.lines.push(new w(this,o,s.substring(o,o+16)))}},w=class{constructor(s,o,t){this.model=s,this.chars=t,this.hexComponents=[],this.asciiComponents=[],this.wordCount=0,this.id="p"+d++,this.range=new c(o*8,t.length*8),this.charCountHex=this.lpad(o.toString(16),4);for(let e=0;e<t.length;e+=2){let i=e+2>=t.length;this.addWord(t.substring(e,e+2),i)}if(t.length<16){let e={id:"p"+d++,type:"filler",content:" ".repeat(16-t.length),bitpos:this.range.stop,trailing:!0};this.asciiComponents.push(e);let i="";for(let h=0;h<32-2*(t.length%16);h++)h!==0&&(2*t.length+h)%4===0?i+="  ":i+=" ";i+=" ",e={id:"p"+d++,type:"filler",content:i,bitpos:this.range.stop,trailing:!0},this.hexComponents.push(e)}}get hexLengthInChars(){let s=0;for(let o of this.hexComponents)o.type==="word"?s+=o.nibbles.length:o.type==="filler"&&!o.trailing&&(s+=o.content.length);return s}get asciiLengthInChars(){let s=0;for(let o of this.asciiComponents)o.type==="word"?s+=o.chars.length:o.type==="filler"&&!o.trailing&&(s+=o.content.length);return s}lpad(s,o){return s.length>=o?s:new Array(o-s.length+1).join("0")+s}addWord(s,o){let t="",e="";for(let r=0;r<s.length;r++)t+=this.charToHex(s[r]),e+=this.charToAscii(s[r]);let i=this.range.start+this.wordCount*16,h=t.split(""),n=[];for(let r=0;r<h.length;r++){let f={id:"p"+d++,range:new c(i+r*4,4),content:h[r]};n.push(f)}if(this.hexComponents.push({id:"p"+d++,type:"word",nibbles:n,range:new c(i,4*n.length)}),s.length===2){let r={id:"p"+d++,type:"filler",content:" ",bitpos:i+16,trailing:o};this.hexComponents.push(r)}let l=e.split(""),a=[];for(let r=0;r<l.length;r++){let f={id:"p"+d++,range:new c(i+r*8,8),content:l[r]};a.push(f)}this.asciiComponents.push({id:"p"+d++,type:"word",chars:a,bitpos:i}),this.wordCount++}charToHex(s){let t=s.charCodeAt(0).toString(16);return t.length===2?t:"0"+t}charToAscii(s){let o=s.charCodeAt(0);return 32<=o&&o<=126?s:"."}};var W=["canvasEl"],_=(()=>{let s=class s{constructor(t){this.fontSize=10,this.highlighted$=new p(null),this.selection$=new p(null),this.dirty=!0;let e=`url(${t}media/RobotoMono-Regular.woff2)`;this.fontPreloaded$=new Promise(i=>{new FontFace("Roboto Mono",e).load().then(()=>i(!0)).catch(()=>i(!1))})}ngAfterViewInit(){this.fontPreloaded$.then(()=>this.initCanvas())}get highlight(){return this._highlight}set highlight(t){this._highlight=t,(t||null)!==this.highlighted$.value&&this.highlighted$.next(t||null)}get selection(){return this._selection}set selection(t){this._selection=t,(t||null)!==this.selection$.value&&this.selection$.next(t||null)}initCanvas(){let t=this.canvasEl.nativeElement,e=t.getContext("2d");e.font=`${this.fontSize}px 'Roboto Mono', monospace`,this.charWidth=e.measureText("0").width,this.g=new L(t),new E(this.g.canvas,this.g.hitCanvas),this.mediaQueryListEventListener=()=>{this.dirty=!0,this.mediaQueryList=matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`),this.mediaQueryList.addEventListener("change",this.mediaQueryListEventListener,{once:!0})},this.mediaQueryListEventListener(),this.animationFrameRequest=window.requestAnimationFrame(()=>this.step())}ngOnChanges(){let t=window.atob(this.base64String??"");this.model=new u(t),this.highlight=void 0,this.selection=void 0,this.pressStart=void 0,this.dirty=!0}setHighlight(t){t?this.highlight=t:this.highlight=void 0,this.dirty=!0}setSelection(t){t?this.selection=t:this.selection=void 0,this.dirty=!0}onMouseUp(){this.pressStart=void 0}onMouseOut(){this.highlight=void 0}step(){if(this.animationFrameRequest=window.requestAnimationFrame(()=>this.step()),!this.dirty)return;let t=Math.ceil(this.charWidth*63);this.g.resize(t,this.fontSize*this.model.lines.length),this.g.ctx.clearRect(0,0,this.g.canvas.width,this.g.canvas.height),this.g.clearHitCanvas();let e=0;for(let i of this.model.lines)this.drawCharcount(i,e),this.drawHex(i,e),this.drawAscii(i,e),e+=this.fontSize;this.dirty=!1}drawCharcount(t,e){let i=t.charCountHex+": ";this.g.addHitRegion({id:t.id,mouseDown:()=>{this.pressStart=t.range,this.selection=t.range,this.dirty=!0},mouseEnter:()=>{this.highlight=t.range,this.dirty=!0},mouseLeave:()=>{this.highlight=void 0,this.dirty=!0},mouseMove:h=>{if(h&&this.pressStart){let n=this.pressStart.join(t.range);this.selection=n,this.dirty=!0}}}).addRect(0,e,this.charWidth*i.length,this.fontSize),this.g.fillText({x:0,y:e,baseline:"top",align:"left",font:`${this.fontSize}px 'Roboto Mono', monospace`,color:"#777777",text:i})}drawHex(t,e){let i=this.charWidth*(t.charCountHex+": ").length;for(let h=0;h<t.hexComponents.length;h++){let n=t.hexComponents[h];if(n.type==="word"){this.g.addHitRegion({id:n.id,mouseDown:()=>{this.pressStart=n.range,this.selection=n.range,this.dirty=!0},mouseEnter:()=>{this.highlight=n.range,this.dirty=!0},mouseLeave:()=>{this.highlight=void 0,this.dirty=!0},mouseMove:l=>{if(l&&this.pressStart){let a=this.pressStart.join(n.range);this.selection=a,this.dirty=!0}}}).addRect(i,e,n.nibbles.length*this.charWidth,this.fontSize);for(let l of n.nibbles){let a,r="#000000";!this.pressStart&&this.highlight&&this.highlight.overlaps(l.range)?a="lightgrey":this.selection&&this.selection.overlaps(l.range)&&(a="#009e87",r="#ffffff"),a&&this.g.fillRect({x:Math.floor(i),y:Math.floor(e),width:Math.ceil(this.charWidth),height:this.fontSize,fill:a}),this.g.fillText({x:i,y:e,baseline:"top",align:"left",font:`${this.fontSize}px 'Roboto Mono', monospace`,color:r,text:l.content}),i+=this.charWidth}}else if(n.type==="filler"){this.g.addHitRegion({id:n.id,mouseDown:()=>{this.pressStart=new c(n.bitpos,0)},mouseMove:a=>{if(a&&this.pressStart){let r=this.pressStart.joinBit(n.bitpos);this.selection=r,this.dirty=!0}}}).addRect(i,e,n.content.length*this.charWidth,this.fontSize);let l;!this.pressStart&&this.highlight&&this.highlight.containsBitExclusive(n.bitpos)?l="lightgrey":this.selection&&this.selection.containsBitExclusive(n.bitpos)&&(l="#009e87"),l&&h!==t.hexComponents.length-1&&this.g.fillRect({x:Math.floor(i),y:Math.floor(e),width:Math.ceil(this.charWidth*n.content.length),height:this.fontSize,fill:l}),i+=n.content.length*this.charWidth}}}drawAscii(t,e){let i=47*this.charWidth;for(let h of t.asciiComponents)if(h.type==="word")for(let n of h.chars){this.g.addHitRegion({id:h.id,mouseDown:()=>{this.pressStart=n.range,this.selection=n.range,this.dirty=!0},mouseEnter:()=>{this.highlight=n.range,this.dirty=!0},mouseLeave:()=>{this.highlight=void 0,this.dirty=!0},mouseMove:r=>{if(r&&this.pressStart){let f=this.pressStart.join(n.range);this.selection=f,this.dirty=!0}}}).addRect(i,e,this.charWidth,this.fontSize);let l,a="#777";!this.pressStart&&this.highlight&&this.highlight.overlaps(n.range)?l="lightgrey":this.selection&&this.selection.overlaps(n.range)&&(l="#009e87",a="#ffffff"),l&&this.g.fillRect({x:Math.floor(i),y:Math.floor(e),width:Math.ceil(this.charWidth),height:this.fontSize,fill:l}),this.g.fillText({x:i,y:e,baseline:"top",align:"left",font:`${this.fontSize}px 'Roboto Mono', monospace`,color:a,text:n.content}),i+=this.charWidth}else h.type==="filler"&&this.g.addHitRegion({id:h.id,mouseDown:()=>{this.pressStart=new c(h.bitpos,0)},mouseMove:n=>{if(n&&this.pressStart){let l=this.pressStart.joinBit(h.bitpos);this.selection=l,this.dirty=!0}}}).addRect(i,e,h.content.length*this.charWidth,this.fontSize)}ngOnDestroy(){this.mediaQueryList?.removeEventListener("change",this.mediaQueryListEventListener),this.animationFrameRequest&&window.cancelAnimationFrame(this.animationFrameRequest)}};s.\u0275fac=function(e){return new(e||s)(v(z))},s.\u0275cmp=y({type:s,selectors:[["app-hex"]],viewQuery:function(e,i){if(e&1&&b(W,5),e&2){let h;M(h=R())&&(i.canvasEl=h.first)}},hostBindings:function(e,i){e&1&&S("mouseup",function(){return i.onMouseUp()},!1,m)("mouseout",function(){return i.onMouseOut()},!1,m)},inputs:{base64String:"base64String",fontSize:"fontSize"},standalone:!0,features:[x,H],decls:2,vars:0,consts:[["canvasEl",""],["width","200","height","200"]],template:function(e,i){e&1&&C(0,"canvas",1,0)},styles:["*[_ngcontent-%COMP%]{user-select:none;-moz-user-select:none;-khtml-user-select:none;-webkit-user-select:none}"],changeDetection:0});let g=s;return g})();export{_ as a};
