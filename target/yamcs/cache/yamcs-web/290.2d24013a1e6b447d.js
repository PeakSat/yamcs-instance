"use strict";(self.webpackChunkwebapp=self.webpackChunkwebapp||[]).push([[290],{5290:(N,h,n)=>{n.r(h),n.d(h,{ProceduresModule:()=>I});var y=n(4421),u=n(1896),T=n(664),g=n(1293),Z=n(9295),s=n(6223),S=n(5619),t=n(5879),c=n(7700),r=n(6516);let A=(()=>{class a{constructor(e,i){this.dialogRef=e,this.form=i.group({executionTime:["",[s.kI.required]],tags:[[],[]]})}schedule(){this.dialogRef.close(this.form.value)}static#t=this.\u0275fac=function(i){return new(i||a)(t.Y36(c.so),t.Y36(s.QS))};static#i=this.\u0275cmp=t.Xpm({type:a,selectors:[["app-schedule-script-dialog"]],decls:26,vars:3,consts:[["mat-dialog-title",""],[1,"mat-typography"],[1,"hint"],[1,"ya-form",3,"formGroup"],[1,"label"],["formControlName","executionTime",3,"showMillis"],[1,"half-break"],["dialogTitle","Timeline Tags"],["formControlName","tags"],["align","end"],[2,"flex","1 1 auto"],["mat-dialog-close","",1,"ya-button"],[1,"ya-button","primary",3,"disabled","click"]],template:function(i,o){1&i&&(t.TgZ(0,"h2",0),t._uU(1,"Run later"),t.qZA(),t.TgZ(2,"mat-dialog-content",1)(3,"div",2)(4,"p"),t._uU(5," This script will be submitted to the Yamcs Timeline, for execution at a later time. "),t.qZA()(),t.TgZ(6,"form",3)(7,"div",4),t._uU(8," Execution time"),t._UZ(9,"br")(10,"ya-date-time-input",5),t.qZA(),t._UZ(11,"hr",6),t.TgZ(12,"div",4),t._uU(13," Timeline tags "),t.TgZ(14,"span",2),t._uU(15,"(optional)"),t.qZA(),t.TgZ(16,"ya-help",7),t._uU(17," Tags allow to categorise items per band. Bands only show items for which one of the tags is matching. "),t.qZA(),t._UZ(18,"br")(19,"ya-tag-select",8),t.qZA()()(),t.TgZ(20,"mat-dialog-actions",9),t._UZ(21,"div",10),t.TgZ(22,"button",11),t._uU(23,"CANCEL"),t.qZA(),t.TgZ(24,"button",12),t.NdJ("click",function(){return o.schedule()}),t._uU(25," SCHEDULE "),t.qZA()()),2&i&&(t.xp6(6),t.Q6J("formGroup",o.form),t.xp6(4),t.Q6J("showMillis",!0),t.xp6(14),t.Q6J("disabled",!o.form.valid))},dependencies:[s._Y,s.JJ,s.JL,s.sg,s.u,c.ZT,c.uh,c.xY,c.H8,r.t,r.IR,r.PX],encapsulation:2,changeDetection:0})}return a})();var U=n(6593),b=n(5394),d=n(6814),p=n(7988),x=n(1274),C=n(2755),J=n(1237);function R(a,F){if(1&a){const e=t.EpF();t.ynx(0),t._uU(1," \xa0 "),t._UZ(2,"ya-icon-action",10),t.TgZ(3,"mat-menu",11,12)(5,"button",13),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.runScript())}),t._uU(6," Run now "),t.qZA(),t.TgZ(7,"button",13),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.openScheduleScriptDialog())}),t._uU(8," Run later... "),t.qZA()(),t.BQk()}if(2&a){const e=t.MAs(4),i=t.oxw();t.xp6(2),t.Q6J("matMenuTriggerFor",i.form.valid?e:null)("padding",!1)("disabled",!i.form.valid),t.xp6(1),t.Q6J("overlapTrigger",!1)}}const P=function(a){return{c:a}};const Y=[{path:"",canActivate:[g.r,T._],canActivateChild:[g.q],runGuardsAndResolvers:"always",component:Z.K,children:[{path:"script",pathMatch:"full",component:(()=>{class a{constructor(e,i,o,l,M,D,Q){this.yamcs=o,this.messageService=l,this.authService=M,this.router=D,this.dialog=Q,this.scriptOptions$=new S.X([]),e.setTitle("Run a script"),this.form=i.group({script:["",[s.kI.required]],args:[""]}),o.yamcsClient.getActivityScripts(this.yamcs.instance).then(m=>{for(const v of m.scripts||[])this.scriptOptions$.next([...this.scriptOptions$.value,{id:v,label:v}])}).catch(m=>l.showError(m))}runScript(){const e=this.createActivityDefinition();this.yamcs.yamcsClient.startActivity(this.yamcs.instance,e).then(i=>this.router.navigateByUrl(`/activities/${i.id}?c=${this.yamcs.context}`)).catch(i=>this.messageService.showError(i))}showSchedule(){return-1!==(this.yamcs.connectionInfo$.value?.instance?.capabilities||[]).indexOf("activities")&&this.authService.getUser().hasSystemPrivilege("ControlActivities")}openScheduleScriptDialog(){this.dialog.open(A,{width:"600px"}).afterClosed().subscribe(e=>{if(e){const o={type:"ACTIVITY",duration:"0s",name:this.form.value.script,start:e.executionTime,tags:e.tags,activityDefinition:this.createActivityDefinition()};this.yamcs.yamcsClient.createTimelineItem(this.yamcs.instance,o).then(()=>{this.messageService.showInfo("Script scheduled"),this.router.navigateByUrl(`/activities?c=${this.yamcs.context}`)}).catch(l=>this.messageService.showError(l))}})}createActivityDefinition(){const e=this.form.value,i={type:"SCRIPT",args:{processor:this.yamcs.instance||null,script:e.script}};return e.args&&(i.args.args=e.args),i}static#t=this.\u0275fac=function(i){return new(i||a)(t.Y36(U.Dx),t.Y36(s.QS),t.Y36(r.C8),t.Y36(r.ez),t.Y36(b.e),t.Y36(u.F0),t.Y36(c.uw))};static#i=this.\u0275cmp=t.Xpm({type:a,selectors:[["ng-component"]],decls:25,vars:9,consts:[[1,"form-content","ya-form"],["novalidate","","autocomplete","off",3,"formGroup"],[1,"label"],[1,"hint"],["formControlName","script",3,"options"],["type","text","formControlName","args"],["routerLink","../..",1,"ya-button",3,"queryParams"],[2,"flex","1 1 auto"],["type","submit",1,"ya-button","primary",3,"disabled","click"],[4,"ngIf"],["icon","arrow_drop_down",2,"line-height","12px",3,"matMenuTriggerFor","padding","disabled"],[1,"ya-menu",3,"overlapTrigger"],["sendMenu","matMenu"],["mat-menu-item","",3,"click"]],template:function(i,o){1&i&&(t.TgZ(0,"app-instance-page")(1,"app-instance-toolbar"),t._uU(2," Run a script "),t.qZA(),t.TgZ(3,"div",0)(4,"form",1)(5,"div",2),t._uU(6," Script "),t.TgZ(7,"span",3),t._uU(8,"(required)"),t.qZA(),t._UZ(9,"br")(10,"ya-select",4),t.ALo(11,"async"),t.qZA(),t._UZ(12,"br"),t.TgZ(13,"div",2),t._uU(14," Script arguments "),t._UZ(15,"input",5),t.qZA()(),t.TgZ(16,"p"),t._uU(17,"\xa0"),t.qZA(),t.TgZ(18,"mat-toolbar")(19,"button",6),t._uU(20,"Cancel"),t.qZA(),t._UZ(21,"span",7),t.TgZ(22,"button",8),t.NdJ("click",function(){return o.runScript()}),t._uU(23," Run "),t.qZA(),t.YNc(24,R,9,4,"ng-container",9),t.qZA()()()),2&i&&(t.xp6(4),t.Q6J("formGroup",o.form),t.xp6(6),t.Q6J("options",t.lcZ(11,5,o.scriptOptions$)),t.xp6(9),t.Q6J("queryParams",t.VKq(7,P,o.yamcs.context)),t.xp6(3),t.Q6J("disabled",!o.form.valid),t.xp6(2),t.Q6J("ngIf",o.showSchedule()))},dependencies:[d.O5,s._Y,s.Fj,s.JJ,s.JL,s.sg,s.u,u.rH,p.VK,p.OP,p.p6,x.Ye,r.J5,r.Hr,C.a,J.k,d.Ov],encapsulation:2,changeDetection:0})}return a})()}]}];let w=(()=>{class a{static#t=this.\u0275fac=function(i){return new(i||a)};static#i=this.\u0275mod=t.oAB({type:a});static#e=this.\u0275inj=t.cJS({imports:[u.Bz.forChild(Y),u.Bz]})}return a})(),I=(()=>{class a{static#t=this.\u0275fac=function(i){return new(i||a)};static#i=this.\u0275mod=t.oAB({type:a});static#e=this.\u0275inj=t.cJS({imports:[y.m,w]})}return a})()}}]);