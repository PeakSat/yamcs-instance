import{a as he}from"./chunk-TLUJWQOT.js";import{a as ct,b as ot,c as pe,o as _e,v as ue,w as Ce}from"./chunk-XGAHVREP.js";import{a as fe}from"./chunk-EFG5VZTT.js";import{b as nt,d as at,e as me,f as de}from"./chunk-FTOGDGWN.js";import{Aa as r,Ba as x,Ca as g,Db as vt,Eb as Tt,F as P,Fe as ne,Ga as I,Gb as bt,Ge as ae,Ha as Y,Hd as Ht,Ia as D,Ib as st,Ja as V,Jb as Et,Jd as Ut,Je as oe,K as S,Ke as it,L as v,La as C,Le as re,Ma as f,Mb as At,Mc as X,Md as Gt,Na as Q,Nb as wt,Oa as ut,Od as Qt,P as O,Qb as Dt,Qd as Wt,Re as $,Sc as kt,Tc as It,Uc as qt,Vd as Kt,Ve as q,Wc as Mt,Wd as Jt,We as le,X as l,Xc as $t,Xd as Xt,Xe as se,Y as y,Yd as Z,Ye as ce,Zc as Ft,_a as M,_b as B,_c as Nt,aa as d,ad as Lt,bd as Ot,be as Zt,ca as u,dd as Vt,e as T,ea as _t,eb as ht,fb as Ct,ga as p,ha as b,he as te,ia as E,ib as W,id as Bt,ja as A,jd as Rt,je as ee,ka as o,kb as ft,kd as zt,la as n,le as tt,ma as h,mb as K,na as N,nb as xt,oa as L,ob as J,pb as F,pc as Pt,qa as k,qb as gt,ra as w,sa as c,sd as jt,td as Yt,te as et,vb as yt,wa as R,wb as St,xa as z,ya as j,za as G,ze as ie}from"./chunk-YLFXKKOP.js";var rt=class extends yt{constructor(i){super(),this.yamcs=i,this.items$=new T([]),this.totalSize$=new T(0),this.loading$=new T(!1)}connect(){return this.items$}loadAlgorithms(i){return this.loading$.next(!0),this.yamcs.yamcsClient.getAlgorithms(this.yamcs.instance,i).then(e=>{this.loading$.next(!1),this.totalSize$.next(e.totalSize);let a=[];for(let m of e.systems||[])a.push({name:m.qualifiedName,system:m});for(let m of e.algorithms||[])a.push({name:m.qualifiedName,algorithm:m});this.items$.next(a)})}disconnect(){this.items$.complete(),this.totalSize$.complete(),this.loading$.complete()}};var ke=["top"],ge=t=>({c:t}),Ie=()=>["/algorithms"],qe=(t,i)=>({c:t,system:i});function Me(t,i){if(t&1&&h(0,"ya-breadcrumb",10),t&2){let e=i.$implicit;u("link",e.route)("queryParams",e.queryParams)("label",e.name)}}function $e(t,i){if(t&1&&(o(0,"div",4)(1,"ya-breadcrumb-trail"),h(2,"ya-breadcrumb",9),E(3,Me,1,3,"ya-breadcrumb",10,b),n()()),t&2){let e=c(),a=c();l(2),u("queryParams",D(1,ge,a.yamcs.context)),l(),A(e)}}function Fe(t,i){t&1&&d(0,$e,5,3,"div",4),t&2&&p(i.length?0:-1)}function Ne(t,i){t&1&&(o(0,"th",24),r(1,"Name"),n())}function Le(t,i){if(t&1&&(o(0,"mat-icon",26),r(1,"folder"),n(),o(2,"a",27),r(3),C(4,"filename"),n()),t&2){let e=c().$implicit,a=c(2);l(2),u("routerLink",Y(5,Ie))("queryParams",V(6,qe,a.yamcs.context,e.name)),l(),g("",f(4,3,e.name),"/ ")}}function Oe(t,i){if(t&1&&h(0,"ya-highlight",28),t&2){let e=c(2).$implicit,a=c(2);u("text",e.algorithm.qualifiedName)("term",a.filterForm.value.filter)}}function Ve(t,i){if(t&1&&(h(0,"ya-highlight",28),C(1,"slice")),t&2){let e=c(2).$implicit,a=c(2);u("text",Q(1,2,e.algorithm.qualifiedName,a.system.length+1))("term",a.filterForm.value.filter)}}function Be(t,i){if(t&1&&(o(0,"mat-icon",26),r(1,"transform"),n(),o(2,"a",27),d(3,Oe,1,2,"ya-highlight",28)(4,Ve,2,5,"ya-highlight",28),n()),t&2){let e=c().$implicit,a=c(2);l(2),u("routerLink","/algorithms"+e.algorithm.qualifiedName)("queryParams",D(4,ge,a.yamcs.context)),l(),p(a.system?-1:3),l(),p(a.system?4:-1)}}function Re(t,i){if(t&1&&(o(0,"td",25),d(1,Le,5,9)(2,Be,5,6),n()),t&2){let e=i.$implicit;l(),p(e.system?1:-1),l(),p(e.algorithm?2:-1)}}function ze(t,i){t&1&&(o(0,"th",24),r(1,"Type"),n())}function je(t,i){if(t&1&&(o(0,"td",29),r(1),n()),t&2){let e=i.$implicit;l(),x((e.algorithm==null?null:e.algorithm.type)||"-")}}function Ye(t,i){t&1&&(o(0,"th",24),r(1,"Language"),n())}function He(t,i){if(t&1&&(o(0,"td",29),r(1),n()),t&2){let e=i.$implicit;l(),x((e.algorithm==null?null:e.algorithm.language)||"-")}}function Ue(t,i){t&1&&(o(0,"th",24),r(1,"Scope"),n())}function Ge(t,i){if(t&1&&(o(0,"td",29),r(1),n()),t&2){let e=i.$implicit;l(),x((e.algorithm==null?null:e.algorithm.scope)||"-")}}function Qe(t,i){t&1&&(o(0,"th",24),r(1,"Description"),n())}function We(t,i){if(t&1&&r(0),t&2){let e=c().$implicit;g(" ",e.system.shortDescription||"-"," ")}}function Ke(t,i){if(t&1&&r(0),t&2){let e=c().$implicit;g(" ",e.algorithm.shortDescription||"-"," ")}}function Je(t,i){if(t&1&&(o(0,"td",30),d(1,We,1,1)(2,Ke,1,1),n()),t&2){let e=i.$implicit;l(),p(e.system?1:-1),l(),p(e.algorithm?2:-1)}}function Xe(t,i){t&1&&h(0,"th",31)}function Ze(t,i){t&1&&h(0,"td",29)}function ti(t,i){t&1&&h(0,"tr",32)}function ei(t,i){if(t&1&&h(0,"tr",33),t&2){let e=i.$implicit,a=c(2);_t("selected",a.selection.isSelected(e))}}function ii(t,i){if(t&1&&(o(0,"table",7),N(1,11),d(2,Ne,2,0,"th",12)(3,Re,3,2,"td",13),L(),N(4,14),d(5,ze,2,0,"th",12)(6,je,2,1,"td",15),L(),N(7,16),d(8,Ye,2,0,"th",12)(9,He,2,1,"td",15),L(),N(10,17),d(11,Ue,2,0,"th",12)(12,Ge,2,1,"td",15),L(),N(13,18),d(14,Qe,2,0,"th",12)(15,Je,3,2,"td",19),L(),N(16,20),d(17,Xe,1,0,"th",21)(18,Ze,1,0,"td",15),L(),d(19,ti,1,0,"tr",22)(20,ei,1,2,"tr",23),n()),t&2){let e=c();u("dataSource",e.dataSource),l(19),u("matHeaderRowDef",e.displayedColumns),l(),u("matRowDefColumns",e.displayedColumns)}}function ni(t,i){if(t&1&&(o(0,"div",2),r(1," The Mission Database for "),o(2,"i"),r(3),n(),r(4," does not define any algorithms. "),n()),t&2){let e=c();l(3),x(e.yamcs.instance)}}var ye=(()=>{let i=class i{constructor(a,m,s,_){this.yamcs=a,this.route=s,this.router=_,this.filterForm=new bt({filter:new st,scope:new st("ANY")}),this.shortName=!1,this.pageSize=100,this.system=null,this.breadcrumb$=new T([]),this.displayedColumns=["name","type","language","scope","shortDescription","actions"],this.scopeOptions=[{id:"ANY",label:"Any scope"},{id:"GLOBAL",label:"Global"},{id:"COMMAND_VERIFICATION",label:"Command Verification"},{id:"CONTAINER_PROCESSING",label:"Container Processing"}],this.selection=new St(!1),m.setTitle("Algorithms"),this.dataSource=new rt(a)}ngAfterViewInit(){let a=this.route.snapshot.queryParamMap;a.has("filter")&&(this.filter=a.get("filter")||"",this.filterForm.get("filter").setValue(this.filter)),a.has("scope")&&(this.scope=a.get("scope"),this.filterForm.get("scope").setValue(this.scope)),this.filterForm.get("filter").valueChanges.subscribe(m=>{this.paginator.pageIndex=0,this.filter=m,this.updateDataSource()}),this.filterForm.get("scope").valueChanges.forEach(m=>{this.scope=m!=="ANY"?m:null,this.updateDataSource()}),this.changeSystem(this.route.snapshot.queryParamMap),this.queryParamMapSubscription=this.route.queryParamMap.subscribe(m=>{m.get("system")!==this.system&&this.changeSystem(m)}),this.paginator.page.subscribe(()=>{this.updateDataSource(),this.top.nativeElement.scrollIntoView()})}changeSystem(a){this.system=a.get("system"),this.updateBrowsePath(),a.has("page")?this.paginator.pageIndex=Number(a.get("page")):this.paginator.pageIndex=0,this.updateDataSource()}updateDataSource(){this.updateURL();let a={system:this.system||"/",pos:this.paginator.pageIndex*this.pageSize,limit:this.pageSize};this.filter&&(a.q=this.filter),this.scope&&(a.scope=this.scope),this.dataSource.loadAlgorithms(a).then(()=>{this.selection.clear(),this.updateBrowsePath()})}updateURL(){this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParams:{page:this.paginator.pageIndex||null,filter:this.filter||null,scope:this.scope||null,system:this.system||null},queryParamsHandling:"merge"})}updateBrowsePath(){let a=[],m="";if(this.system)for(let s of this.system.slice(1).split("/"))m+="/"+s,a.push({name:s,route:"/algorithms",queryParams:{system:m,c:this.yamcs.context}});this.breadcrumb$.next(a)}selectNext(){let a=this.dataSource.items$.value,m=0;if(this.selection.hasValue()){let s=this.selection.selected[0];a.indexOf(s)!==-1&&(m=Math.min(a.indexOf(s)+1,a.length-1))}this.selection.select(a[m])}selectPrevious(){let a=this.dataSource.items$.value,m=0;if(this.selection.hasValue()){let s=this.selection.selected[0];a.indexOf(s)!==-1&&(m=Math.max(a.indexOf(s)-1,0))}this.selection.select(a[m])}applySelection(){if(this.selection.hasValue()){let a=this.selection.selected[0];this.dataSource.items$.value.indexOf(a)!==-1&&this.router.navigate(["/algorithms"+a.algorithm?.qualifiedName],{queryParams:{c:this.yamcs.context}})}}ngOnDestroy(){this.queryParamMapSubscription?.unsubscribe(),this.dataSource.disconnect()}};i.\u0275fac=function(m){return new(m||i)(y($),y(W),y(K),y(J))},i.\u0275cmp=P({type:i,selectors:[["ng-component"]],viewQuery:function(m,s){if(m&1&&(R(ke,7),R(X,7)),m&2){let _;z(_=j())&&(s.top=_.first),z(_=j())&&(s.paginator=_.first)}},standalone:!0,features:[I],decls:17,vars:13,consts:[["top",""],["empty",""],[1,"panel-content"],[3,"formGroup"],[1,"filter-bar"],["placeholder","Search by name","icon","search",3,"onArrowDown","onArrowUp","onEnter","formControl"],["formControlName","scope",3,"options"],["mat-table","",1,"ya-data-table","expand",3,"dataSource"],[3,"pageSize","hidePageSize","showFirstLastButtons","length"],["link","/algorithms","icon","account_tree",3,"queryParams"],[3,"link","queryParams","label"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","","class","primary-td",4,"matCellDef"],["matColumnDef","type"],["mat-cell","",4,"matCellDef"],["matColumnDef","language"],["matColumnDef","scope"],["matColumnDef","shortDescription"],["mat-cell","","class","wrap200",4,"matCellDef"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"selected",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell","",1,"primary-td"],[1,"icon12",2,"vertical-align","middle"],[3,"routerLink","queryParams"],[3,"text","term"],["mat-cell",""],["mat-cell","",1,"wrap200"],["mat-header-cell","",1,"expand"],["mat-header-row",""],["mat-row",""]],template:function(m,s){if(m&1){let _=k();o(0,"app-instance-page")(1,"app-instance-toolbar"),r(2," Algorithms "),n(),h(3,"span",null,0),o(5,"div",2)(6,"form",3),d(7,Fe,1,1),C(8,"async"),o(9,"div",4)(10,"ya-search-filter",5),w("onArrowDown",function(){return S(_),v(s.selectNext())})("onArrowUp",function(){return S(_),v(s.selectPrevious())})("onEnter",function(){return S(_),v(s.applySelection())}),n(),h(11,"ya-select",6),n()(),d(12,ii,21,3,"table",7),h(13,"mat-paginator",8),C(14,"async"),n(),d(15,ni,5,1,"ng-template",null,1,ut),n()}if(m&2){let _;l(6),u("formGroup",s.filterForm),l(),p((_=f(8,9,s.breadcrumb$))?7:-1,_),l(3),u("formControl",s.filterForm.controls.filter),l(),u("options",s.scopeOptions),l(),p(s.dataSource?12:-1),l(),u("pageSize",s.pageSize)("hidePageSize",!0)("showFirstLastButtons",!0)("length",f(14,11,s.dataSource.totalSize$))}},dependencies:[at,nt,q,M,Ct,Et,vt,Tt,At,wt,Dt,F,B,X,kt,qt,Nt,Mt,It,Lt,$t,Ft,Ot,Vt,Yt,jt,Wt,Zt,Ht,ie],styles:[".primary-td[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{margin-right:7px}"],changeDetection:0});let t=i;return t})();function ai(t,i){if(t&1&&h(0,"ya-led",0),t&2){let e=c();u("color",e.onColor)("fade",!1)("width",e.size)("height",e.size)}}function oi(t,i){if(t&1&&h(0,"ya-led",1),t&2){let e=c();u("fade",!1)("width",e.size)("height",e.size)}}var Se=(()=>{let i=class i{constructor(){this.size=14,this.onColor=Kt,this.offColor=Jt}};i.\u0275fac=function(m){return new(m||i)},i.\u0275cmp=P({type:i,selectors:[["app-algorithm-status"]],inputs:{status:"status",size:"size"},standalone:!0,features:[I],decls:2,vars:2,consts:[[3,"color","fade","width","height"],["color","red",3,"fade","width","height"]],template:function(m,s){m&1&&d(0,ai,1,4,"ya-led",0)(1,oi,1,3,"ya-led",1),m&2&&(p(s.status.errorMessage?-1:0),l(),p(s.status.errorMessage?1:-1))},dependencies:[q,Xt],styles:["[_nghost-%COMP%]{line-height:0;font-size:0}"],changeDetection:0});let t=i;return t})();var ri=["text"],li=(t,i)=>({c:t,system:i}),mi=t=>["/mdb/parameters/",t],mt=t=>({c:t});function si(t,i){if(t&1&&(o(0,"a",2),r(1),n()),t&2){let e=i,a=c();u("queryParams",V(2,li,a.yamcs.context,e)),l(),g(" ",e," ")}}function ci(t,i){if(t&1&&(o(0,"dt"),r(1),n(),o(2,"dd"),r(3),n()),t&2){let e=i.$implicit;l(),x(e.namespace),l(2),x(e.name)}}function di(t,i){if(t&1&&(o(0,"dt"),r(1,"Description"),n(),o(2,"dd"),h(3,"app-markdown",5),n()),t&2){let e=c();l(3),u("text",e.algorithm.longDescription)}}function pi(t,i){if(t&1&&(o(0,"dt"),r(1,"Description"),n(),o(2,"dd"),r(3),n()),t&2){let e=c();l(3),g(" ",e.algorithm.shortDescription||"-"," ")}}function _i(t,i){if(t&1&&r(0),t&2){let e=c(2);g(" ",e.status.errorMessage," ")}}function ui(t,i){t&1&&r(0," OK ")}function hi(t,i){if(t&1&&(o(0,"span"),r(1),C(2,"nanosDuration"),n()),t&2){let e=c(2);l(),g(" ",f(2,1,e.status.execTimeNs/e.status.runCount)," ")}}function Ci(t,i){t&1&&(o(0,"span"),r(1,"-"),n())}function fi(t,i){if(t&1&&(h(0,"mat-divider"),o(1,"dl",3)(2,"dt"),r(3,"Status"),n(),o(4,"dd",6),h(5,"app-algorithm-status",7),r(6," \xA0 "),d(7,_i,1,1)(8,ui,1,0),n(),o(9,"dt"),r(10,"Run count"),n(),o(11,"dd"),r(12),C(13,"number"),n(),o(14,"dt"),r(15,"Total run time"),n(),o(16,"dd"),r(17),C(18,"nanosDuration"),n(),o(19,"dt"),r(20,"Average run time"),n(),o(21,"dd"),d(22,hi,3,3,"span")(23,Ci,2,0,"span"),n(),o(24,"dt"),r(25,"Last run"),n(),o(26,"dd"),r(27),C(28,"datetime"),n()()),t&2){let e=c();l(5),u("status",e.status),l(2),p(e.status.errorMessage?7:8),l(5),x(f(13,6,e.status.runCount)||"-"),l(5),g(" ",f(18,8,e.status.execTimeNs)||"-"," "),l(5),p(e.status.runCount?22:23),l(5),x(f(28,10,e.status.lastRun)||"-")}}function xi(t,i){t&1&&(o(0,"ya-help"),r(1," You may override the MDB algorithm text. Such a change is scoped to the current processor only and will not persist across server restarts. "),n())}function gi(t,i){t&1&&(o(0,"span",8),r(1,"MDB Override"),n())}function yi(t,i){if(t&1){let e=k();o(0,"div",9)(1,"button",11),C(2,"async"),w("click",function(){S(e);let m=c(2);return v(m.saveTextChanges())}),o(3,"mat-icon"),r(4,"save"),n(),r(5," Save "),n(),o(6,"button",12),C(7,"async"),w("click",function(){S(e);let m=c(2);return v(m.revertText())}),o(8,"mat-icon"),r(9,"undo"),n(),r(10," Restore MDB text "),n()()}if(t&2){let e,a=c(2);l(),u("disabled",!f(2,2,a.dirty$)),l(5),u("disabled",!((e=f(7,4,a.overrides$))!=null&&e.textOverride))}}function Si(t,i){if(t&1&&(h(0,"mat-divider"),o(1,"dl",3)(2,"dt"),r(3," Text "),d(4,xi,2,0,"ya-help"),h(5,"br"),d(6,gi,2,0,"span",8),C(7,"async"),n(),o(8,"dd"),d(9,yi,11,6,"div",9),h(10,"div",10,0),n()()),t&2){let e,a=c();l(4),p(a.isChangeMissionDatabaseEnabled()?4:-1),l(2),p((e=f(7,3,a.overrides$))!=null&&e.textOverride?6:-1),l(3),p(a.isChangeMissionDatabaseEnabled()?9:-1)}}function vi(t,i){if(t&1&&(o(0,"td"),r(1,"Operand"),n(),o(2,"td"),r(3),n()),t&2){let e=c().$implicit;l(3),x(e.value)}}function Ti(t,i){if(t&1&&(o(0,"td"),r(1,"Operator"),n(),o(2,"td"),r(3),n()),t&2){let e=c().$implicit;l(3),x(e.operator)}}function bi(t,i){t&1&&(o(0,"td"),r(1,"Operand"),n(),o(2,"td"),r(3,"this"),n())}function Ei(t,i){if(t&1&&(o(0,"td"),r(1,"Operand"),n(),o(2,"td")(3,"a",13),r(4),n()()),t&2){let e=c().$implicit,a=c(2);l(3),u("routerLink",D(3,mi,e.parameter.qualifiedName))("queryParams",D(5,mt,a.yamcs.context)),l(),g(" ",e.parameter.qualifiedName," ")}}function Ai(t,i){if(t&1&&(o(0,"tr"),d(1,vi,4,1)(2,Ti,4,1)(3,bi,4,0)(4,Ei,5,7),n()),t&2){let e,a=i.$implicit;l(),p((e=a.type)==="VALUE_OPERAND"?1:e==="OPERATOR"?2:e==="THIS_PARAMETER_OPERAND"?3:e==="PARAMETER"?4:-1)}}function wi(t,i){if(t&1&&(h(0,"mat-divider"),o(1,"dl",3)(2,"dt"),r(3,"Postfix Expression"),n(),o(4,"dd")(5,"table",4)(6,"tr")(7,"th"),r(8,"Type"),n(),o(9,"th"),r(10,"Value"),n()(),E(11,Ai,5,1,"tr",null,b),n()()()),t&2){let e=c();l(11),A(e.algorithm.mathElements)}}function Di(t,i){if(t&1&&(o(0,"tr")(1,"td"),r(2),n(),o(3,"td")(4,"a",14),r(5),n()(),o(6,"td",15),r(7),n(),o(8,"td",15),r(9),n()()),t&2){let e=i.$implicit,a=c(2);l(2),x(e.inputName||"-"),l(2),u("routerLink","/telemetry/parameters"+e.parameter.qualifiedName)("queryParams",D(6,mt,a.yamcs.context)),l(),g(" ",e.parameter.qualifiedName," "),l(2),g(" ",e.parameterInstance," "),l(2),g(" ",e.mandatory?"Yes":"No"," ")}}function Pi(t,i){if(t&1&&(o(0,"table",4)(1,"tr")(2,"th"),r(3,"Input name"),n(),o(4,"th"),r(5,"Parameter"),n(),o(6,"th"),r(7,"Instance"),n(),o(8,"th"),r(9,"Mandatory"),n()(),E(10,Di,10,8,"tr",null,b),n()),t&2){let e=c();l(10),A(e.algorithm.inputParameter)}}function ki(t,i){t&1&&(o(0,"span"),r(1,"-"),n())}function Ii(t,i){if(t&1&&(o(0,"tr")(1,"td"),r(2),n(),o(3,"td")(4,"a",14),r(5),n()()()),t&2){let e=i.$implicit,a=c(2);l(2),x(e.outputName||"-"),l(2),u("routerLink","/telemetry/parameters"+e.parameter.qualifiedName)("queryParams",D(4,mt,a.yamcs.context)),l(),g(" ",e.parameter.qualifiedName," ")}}function qi(t,i){if(t&1&&(o(0,"table",4)(1,"tr")(2,"th"),r(3,"Output name"),n(),o(4,"th"),r(5,"Parameter"),n()(),E(6,Ii,6,6,"tr",null,b),n()),t&2){let e=c();l(6),A(e.algorithm.outputParameter)}}function Mi(t,i){t&1&&(o(0,"span"),r(1,"-"),n())}function $i(t,i){if(t&1&&(o(0,"tr")(1,"td"),r(2,"OnParameterUpdate"),n(),o(3,"td")(4,"a",14),r(5),n()()()),t&2){let e=i.$implicit,a=c();l(4),u("routerLink","/telemetry/parameters"+e.qualifiedName)("queryParams",D(3,mt,a.yamcs.context)),l(),g(" ",e.qualifiedName," ")}}function Fi(t,i){if(t&1&&(o(0,"tr")(1,"td"),r(2,"OnPeriodicRate"),n(),o(3,"td"),r(4),n()()),t&2){let e=c();l(4),g("",e.algorithm.onPeriodicRate," ms")}}var ve=(()=>{let i=class i{constructor(a,m,s){this.yamcs=a,this.messageService=m,this.authService=s,this.overrides$=new T(null),this.dirty$=new T(!1)}ngAfterViewInit(){this.algorithm.text&&(this.initializeEditor(),this.refreshOverrides())}isChangeMissionDatabaseEnabled(){return this.authService.getUser().hasSystemPrivilege("ChangeMissionDatabase")}initializeEditor(){let a=[Ce,pe.of([_e])];this.isChangeMissionDatabaseEnabled()?a.push(ot.updateListener.of(_=>{_.docChanged&&this.dirty$.next(!0)})):a.push(ct.readOnly.of(!0));let m=ot.theme({"&":{height:"300px",fontSize:"12px"},".cm-scroller":{overflow:"auto",fontFamily:"'Roboto Mono', monospace"}},{dark:!1});switch(a.push(m),this.algorithm.language.toLowerCase()){case"javascript":a.push(ue());break;case"python":a.push(he());break;default:console.warn(`Unexpected language ${this.algorithm.language}`)}let s=ct.create({doc:this.algorithm.text,extensions:a});this.editorView=new ot({state:s,parent:this.textContainer.nativeElement})}refreshOverrides(){let a=this.algorithm.qualifiedName,m=this.yamcs.instance,s=this.yamcs.processor;this.yamcs.yamcsClient.getAlgorithmOverrides(m,s,a).then(_=>{this.overrides$.next(_),_.textOverride?this.updateEditorValue(_.textOverride.text):this.updateEditorValue(this.algorithm.text)}).catch(_=>this.messageService.showError(_))}updateEditorValue(a){this.editorView.dispatch({changes:{from:0,to:this.editorView.state.doc.length,insert:a}}),this.dirty$.next(!1)}saveTextChanges(){let a=this.editorView.state.doc.toString(),m=this.yamcs.instance,s=this.yamcs.processor;this.yamcs.yamcsClient.updateAlgorithmText(m,s,this.algorithm.qualifiedName,a).then(()=>this.refreshOverrides()).catch(_=>this.messageService.showError(_))}revertText(){let a=this.yamcs.instance,m=this.yamcs.processor;this.yamcs.yamcsClient.revertAlgorithmText(a,m,this.algorithm.qualifiedName).then(()=>this.refreshOverrides()).catch(s=>this.messageService.showError(s))}};i.\u0275fac=function(m){return new(m||i)(y($),y(Z),y(le))},i.\u0275cmp=P({type:i,selectors:[["app-algorithm-detail"]],viewQuery:function(m,s){if(m&1&&R(ri,5),m&2){let _;z(_=j())&&(s.textContainer=_.first)}},inputs:{algorithm:"algorithm",status:"status"},standalone:!0,features:[I],decls:60,vars:16,consts:[["text",""],[1,"dl-horizontal","no-lead"],["routerLink","/algorithms",1,"ya-link",3,"queryParams"],[1,"dl-horizontal"],["yaDataTable",""],[3,"text"],[2,"display","flex","align-items","center"],[3,"status"],[1,"override-annotation"],[2,"padding-bottom","5px"],[1,"algorithm-text"],[1,"ya-button",2,"margin-right","5px",3,"click","disabled"],[1,"ya-button",3,"click","disabled"],[1,"ya-link",3,"routerLink","queryParams"],[3,"routerLink","queryParams"],[2,"text-align","center"]],template:function(m,s){if(m&1&&(o(0,"dl",1)(1,"dt"),r(2,"Algorithm"),n(),o(3,"dd"),r(4),C(5,"shortName"),n(),o(6,"dt"),r(7,"System"),n(),o(8,"dd"),d(9,si,2,5,"a",2),C(10,"spaceSystemName"),n(),E(11,ci,4,2,null,null,b),d(13,di,4,1)(14,pi,4,1),n(),h(15,"mat-divider"),o(16,"dl",3)(17,"dt"),r(18,"Scope"),n(),o(19,"dd"),r(20),n(),o(21,"dt"),r(22,"Type"),n(),o(23,"dd"),r(24),n(),o(25,"dt"),r(26,"Language"),n(),o(27,"dd"),r(28),n()(),d(29,fi,29,12)(30,Si,12,5)(31,wi,13,0),h(32,"mat-divider"),o(33,"dl",3)(34,"dt"),r(35,"Input parameters"),n(),o(36,"dd"),d(37,Pi,12,0,"table",4)(38,ki,2,0,"span"),n()(),h(39,"mat-divider"),o(40,"dl",3)(41,"dt"),r(42,"Output parameters"),n(),o(43,"dd"),d(44,qi,8,0,"table",4)(45,Mi,2,0,"span"),n()(),h(46,"mat-divider"),o(47,"dl",3)(48,"dt"),r(49,"Triggers"),n(),o(50,"dd")(51,"table",4)(52,"tr")(53,"th"),r(54,"Type"),n(),o(55,"th"),r(56,"Value"),n()(),E(57,$i,6,5,"tr",null,b),d(59,Fi,5,1,"tr"),n()()()),m&2){let _;l(4),x(f(5,12,s.algorithm.qualifiedName)),l(5),p((_=f(10,14,s.algorithm.qualifiedName))?9:-1,_),l(2),A(s.algorithm.alias),l(2),p(s.algorithm.longDescription?13:14),l(7),x(s.algorithm.scope||"-"),l(4),x(s.algorithm.type||"-"),l(4),x(s.algorithm.language||"-"),l(),p(s.status&&s.algorithm.scope==="GLOBAL"?29:-1),l(),p(s.algorithm.text?30:-1),l(),p(s.algorithm.mathElements?31:-1),l(6),p(s.algorithm.inputParameter?37:38),l(7),p(s.algorithm.outputParameter?44:45),l(13),A(s.algorithm.onParameterUpdate),l(2),p(s.algorithm.onPeriodicRate?59:-1)}},dependencies:[Se,fe,q,M,ht,F,tt,B,Pt,Qt,et,ne,it,re],styles:["code[_ngcontent-%COMP%]{display:block;background-color:#fafafa;padding:1em;font-size:10px;border:1px solid #d3d3d3;white-space:pre}.algorithm-text[_ngcontent-%COMP%]{border:1px solid rgba(0,0,0,.12)}.override-annotation[_ngcontent-%COMP%]{font-style:italic;font-weight:300}"],changeDetection:0});let t=i;return t})();function Ni(t,i){if(t&1&&(h(0,"app-algorithm-detail",1),C(1,"async")),t&2){let e=c();u("algorithm",i)("status",f(1,2,e.status$))}}var Te=(()=>{let i=class i{constructor(a){this.yamcs=a,this.qualifiedName=O.required({alias:"algorithm"}),this.status$=new T(null)}ngOnInit(){let a=this.yamcs.instance;this.algorithm$=this.yamcs.yamcsClient.getAlgorithm(a,this.qualifiedName()),this.yamcs.processor&&(this.algorithmStatusSubscription=this.yamcs.yamcsClient.createAlgorithmStatusSubscription({instance:this.yamcs.instance,processor:this.yamcs.processor,name:this.qualifiedName()},m=>this.status$.next(m)))}ngOnDestroy(){this.algorithmStatusSubscription?.cancel()}};i.\u0275fac=function(m){return new(m||i)(y($))},i.\u0275cmp=P({type:i,selectors:[["ng-component"]],inputs:{qualifiedName:[1,"algorithm","qualifiedName"]},standalone:!0,features:[I],decls:3,vars:3,consts:[[1,"panel-content"],[3,"algorithm","status"]],template:function(m,s){if(m&1&&(o(0,"div",0),d(1,Ni,2,4,"app-algorithm-detail",1),C(2,"async"),n()),m&2){let _;l(),p((_=f(2,1,s.algorithm$))?1:-1,_)}},dependencies:[ve,q,M],encapsulation:2,changeDetection:0});let t=i;return t})();var be=()=>[],Ee=t=>({c:t});function Li(t,i){if(t&1){let e=k();h(0,"span",5),o(1,"ya-text-action",6),w("click",function(){S(e);let m=c(4);return v(m.switchToSection("runs"))}),r(2," Runs "),n(),r(3," \xA0\xA0 "),o(4,"ya-text-action",7),w("click",function(){S(e);let m=c(4);return v(m.switchToSection("logs"))}),r(5," Logs "),n()}if(t&2){let e=i;l(),u("active",e==="runs"),l(3),u("active",e==="logs")}}function Oi(t,i){t&1&&(o(0,"mat-icon",10),r(1,"check_circle"),n())}function Vi(t,i){t&1&&(o(0,"mat-icon",11),r(1,"error"),n())}function Bi(t,i){t&1&&h(0,"br")}function Ri(t,i){if(t&1&&(o(0,"a",14),r(1),n(),r(2,": "),h(3,"ya-value",15),d(4,Bi,1,0,"br")),t&2){let e=i.$implicit,a=i.$index,m=i.$count,s=c(8);u("routerLink","/telemetry/parameters"+e.id.name)("queryParams",D(5,Ee,s.yamcs.context)),l(),g(" ",e.id.name,""),l(2),u("value",e.engValue),l(),p(a!==m-1?4:-1)}}function zi(t,i){t&1&&r(0," - ")}function ji(t,i){t&1&&h(0,"br")}function Yi(t,i){if(t&1&&(o(0,"a",14),r(1),n(),r(2,": "),h(3,"ya-value",15),d(4,ji,1,0,"br")),t&2){let e=i.$implicit,a=i.$index,m=i.$count,s=c(8);u("routerLink","/telemetry/parameters"+e.id.name)("queryParams",D(5,Ee,s.yamcs.context)),l(),g(" ",e.id.name,""),l(2),u("value",e.engValue),l(),p(a!==m-1?4:-1)}}function Hi(t,i){t&1&&r(0," - ")}function Ui(t,i){if(t&1&&(o(0,"tr")(1,"td",9),d(2,Oi,2,0,"mat-icon",10)(3,Vi,2,0,"mat-icon",11),n(),o(4,"td",12),r(5),C(6,"datetime"),n(),o(7,"td",13),E(8,Ri,5,7,null,null,b),d(10,zi,1,0),n(),o(11,"td",13),E(12,Yi,5,7,null,null,b),d(14,Hi,1,0),n(),o(15,"td",12),r(16),C(17,"nvl"),n(),o(18,"td",12),r(19),n(),h(20,"td"),n()),t&2){let e=i.$implicit;l(2),p(e.error?-1:2),l(),p(e.error?3:-1),l(2),x(f(6,7,e.time)),l(3),A(e.inputs||Y(12,be)),l(2),p(e.inputs!=null&&e.inputs.length?-1:10),l(2),A(e.outputs||Y(13,be)),l(2),p(e.outputs!=null&&e.outputs.length?-1:14),l(2),x(Q(17,9,e.returnValue,"-")),l(3),x(e.error||"-")}}function Gi(t,i){if(t&1&&(o(0,"table",8)(1,"tr"),h(2,"th",9),o(3,"th"),r(4,"Started"),n(),o(5,"th"),r(6,"Inputs"),n(),o(7,"th"),r(8,"Outputs"),n(),o(9,"th"),r(10,"Return value"),n(),o(11,"th"),r(12,"Error"),n(),h(13,"th"),n(),E(14,Ui,21,14,"tr",null,b),n()),t&2){let e=c();l(14),A(e.runs)}}function Qi(t,i){if(t&1){let e=k();o(0,"ya-empty-message")(1,"p"),r(2,"Tracing has started."),n(),o(3,"p"),r(4,"This page does "),o(5,"strong"),r(6,"not"),n(),r(7," update automatically."),n(),o(8,"p"),r(9," Hit refresh, or check back at a later time when you think there should be trace entries. "),n(),o(10,"p")(11,"button",16),w("click",function(){S(e);let m=c(6);return v(m.refreshData())}),r(12,"Refresh"),n()()()}}function Wi(t,i){if(t&1&&d(0,Gi,16,0,"table",8)(1,Qi,13,0,"ya-empty-message"),t&2){let e=i;p(e.runs!=null&&e.runs.length?0:1)}}function Ki(t,i){if(t&1){let e=k();o(0,"ya-empty-message")(1,"p"),r(2,"Tracing has started."),n(),o(3,"p"),r(4,"This page does "),o(5,"strong"),r(6,"not"),n(),r(7," update automatically."),n(),o(8,"p"),r(9," Hit refresh, or check back at a later time when you think there should be trace entries. "),n(),o(10,"p")(11,"button",16),w("click",function(){S(e);let m=c(5);return v(m.refreshData())}),r(12,"Refresh"),n()()()}}function Ji(t,i){if(t&1&&(d(0,Wi,2,1),C(1,"async"),d(2,Ki,13,0,"ya-empty-message")),t&2){let e,a=c(4);p((e=f(1,1,a.trace$))?0:2,e)}}function Xi(t,i){if(t&1&&(o(0,"tr")(1,"td",18),r(2),C(3,"datetime"),n(),o(4,"td",19),r(5),n()()),t&2){let e=i.$implicit;l(2),g(" [",f(3,2,e.time),"] "),l(3),x(e.msg)}}function Zi(t,i){if(t&1&&(o(0,"table",17),E(1,Xi,6,4,"tr",null,b),n()),t&2){let e=c();l(),A(e.logs)}}function tn(t,i){if(t&1){let e=k();o(0,"ya-empty-message")(1,"p"),r(2,"Tracing has started."),n(),o(3,"p"),r(4,"This page does "),o(5,"strong"),r(6,"not"),n(),r(7," update automatically."),n(),o(8,"p"),r(9," Hit refresh, or check back at a later time when you think there should be trace entries. "),n(),o(10,"p")(11,"button",16),w("click",function(){S(e);let m=c(6);return v(m.refreshData())}),r(12,"Refresh"),n()()()}}function en(t,i){if(t&1&&d(0,Zi,3,0,"table",17)(1,tn,13,0,"ya-empty-message"),t&2){let e=i;p(e.logs!=null&&e.logs.length?0:1)}}function nn(t,i){if(t&1){let e=k();o(0,"ya-empty-message")(1,"p"),r(2,"Tracing has started."),n(),o(3,"p"),r(4,"This page does "),o(5,"strong"),r(6,"not"),n(),r(7," update automatically."),n(),o(8,"p"),r(9," Hit refresh, or check back at a later time when you think there should be trace entries. "),n(),o(10,"p")(11,"button",16),w("click",function(){S(e);let m=c(5);return v(m.refreshData())}),r(12,"Refresh"),n()()()}}function an(t,i){if(t&1&&(d(0,en,2,1),C(1,"async"),d(2,nn,13,0,"ya-empty-message")),t&2){let e,a=c(4);p((e=f(1,1,a.trace$))?0:2,e)}}function on(t,i){if(t&1){let e=k();o(0,"div",1)(1,"div",2)(2,"button",3),w("click",function(){S(e);let m=c(3);return v(m.stopTrace())}),r(3,"Stop trace"),n(),r(4,"\xA0 "),o(5,"button",3),w("click",function(){S(e);let m=c(3);return v(m.refreshData())}),r(6,"Refresh"),n(),r(7,"\xA0 "),d(8,Li,6,2),C(9,"async"),n()(),o(10,"div",4),d(11,Ji,3,3),C(12,"async"),d(13,an,3,3),C(14,"async"),n()}if(t&2){let e,a=c(3);l(8),p((e=f(9,3,a.section$))?8:-1,e),l(3),p(f(12,5,a.section$)==="runs"?11:-1),l(2),p(f(14,7,a.section$)==="logs"?13:-1)}}function rn(t,i){if(t&1){let e=k();o(0,"ya-empty-message",0)(1,"p"),r(2,"The trace tool captures runs, inputs, outputs and log messages of this algorithm."),n(),o(3,"p")(4,"button",16),w("click",function(){S(e);let m=c(3);return v(m.startTrace())}),r(5,"Start trace"),n()()()}}function ln(t,i){t&1&&d(0,on,15,9)(1,rn,6,0,"ya-empty-message",0),t&2&&p(i.traceEnabled?0:1)}function mn(t,i){if(t&1&&(d(0,ln,2,1),C(1,"async")),t&2){let e,a=c();p((e=f(1,1,a.status$))?0:-1,e)}}var Ae=(()=>{let i=class i{constructor(a,m,s,_){this.route=a,this.router=m,this.yamcs=s,this.messageService=_,this.qualifiedName=O.required({alias:"algorithm"}),this.status$=new T(null),this.trace$=new T(null),this.section$=new T("runs")}ngOnInit(){this.algorithm$=this.yamcs.yamcsClient.getAlgorithm(this.yamcs.instance,this.qualifiedName()),this.refreshData()}ngAfterViewInit(){let a=this.route.snapshot.queryParamMap;a.has("section")&&this.switchToSection(a.get("section"))}switchToSection(a){this.section$.next(a),this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParams:{section:a},queryParamsHandling:"merge"})}refreshData(){this.yamcs.processor?(this.yamcs.yamcsClient.getAlgorithmStatus(this.yamcs.instance,this.yamcs.processor,this.qualifiedName()).then(a=>{this.status$.next(a)}).catch(a=>{this.messageService.showError(a)}),this.yamcs.yamcsClient.getAlgorithmTrace(this.yamcs.instance,this.yamcs.processor,this.qualifiedName()).then(a=>{this.trace$.next(a)}).catch(a=>{this.messageService.showError(a)})):(this.status$.next(null),this.trace$.next(null))}startTrace(){this.yamcs.yamcsClient.startAlgorithmTrace(this.yamcs.instance,this.yamcs.processor,this.qualifiedName()).then(()=>{this.refreshData()}).catch(a=>this.messageService.showError(a))}stopTrace(){this.yamcs.yamcsClient.stopAlgorithmTrace(this.yamcs.instance,this.yamcs.processor,this.qualifiedName()).then(()=>{this.refreshData(),this.switchToSection("runs"),this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParams:{section:null},queryParamsHandling:"merge"})}).catch(a=>this.messageService.showError(a))}};i.\u0275fac=function(m){return new(m||i)(y(K),y(J),y($),y(Z))},i.\u0275cmp=P({type:i,selectors:[["ng-component"]],inputs:{qualifiedName:[1,"algorithm","qualifiedName"]},standalone:!0,features:[I],decls:2,vars:3,consts:[["headerTitle","Trace"],[1,"extra-bar-container"],[1,"extra-bar"],[1,"ya-button",3,"click"],[1,"panel-content"],[1,"separator",2,"margin-left","10px","margin-right","10px"],["icon","directions_run",3,"click","active"],["icon","menu_book",3,"click","active"],["yaDataTable","",1,"expand"],[1,"status"],[1,"success"],[1,"alert"],[2,"width","200px"],[2,"width","400px"],[1,"secundary",3,"routerLink","queryParams"],[3,"value"],[1,"ya-button","primary",3,"click"],[1,"logs","mono",2,"width","100%"],["width","1",1,"time",2,"white-space","nowrap"],[1,"msg",2,"white-space","pre"]],template:function(m,s){if(m&1&&(d(0,mn,2,3),C(1,"async")),m&2){let _;p((_=f(1,1,s.algorithm$))?0:-1,_)}},dependencies:[q,M,F,tt,B,Ut,Gt,ee,et,ae],styles:[".extra-bar-container[_ngcontent-%COMP%]{padding:12px;border-bottom:1.1px solid rgba(0,0,0,.08)}.extra-bar[_ngcontent-%COMP%]{height:24px;line-height:24px}.separator[_ngcontent-%COMP%]{border-right:1px solid rgba(0,0,0,.12)}table.logs[_ngcontent-%COMP%]{line-height:12px}table.logs[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-size:12px;color:#000000a7}table.logs[_ngcontent-%COMP%]   td.time[_ngcontent-%COMP%]{color:#00000059}"],changeDetection:0});let t=i;return t})();var we=t=>({c:t}),sn=(t,i)=>({c:t,system:i});function cn(t,i){if(t&1&&(o(0,"a",9),r(1),n()),t&2){let e=c().$implicit,a=c(2);u("queryParams",V(2,sn,a.yamcs.context,e.path)),l(),x(e.name)}}function dn(t,i){if(t&1&&(d(0,cn,2,5,"a",9),r(1," / ")),t&2){let e=i.$index;p(e!==0?0:-1)}}function pn(t,i){if(t&1&&(o(0,"app-instance-page")(1,"app-instance-toolbar"),E(2,dn,2,1,null,null,b),C(4,"parents"),o(5,"span"),r(6),C(7,"shortName"),n(),h(8,"ya-title-copy",4),n(),o(9,"nav",5,0)(11,"a",6,1),r(13," Summary "),n(),o(14,"a",7,2),r(16," Trace "),n()(),o(17,"div",8)(18,"mat-tab-nav-panel",null,3),h(20,"router-outlet"),n()()()),t&2){let e=i,a=G(12),m=G(15),s=G(19),_=c();l(2),A(f(4,9,e.qualifiedName)),l(4),x(f(7,11,e.qualifiedName)),l(2),u("text",e.qualifiedName),l(),u("mat-stretch-tabs",!1)("tabPanel",s),l(2),u("active",a.isActive)("queryParams",D(13,we,_.yamcs.context)),l(3),u("active",m.isActive)("queryParams",D(15,we,_.yamcs.context))("disabled",e.scope!=="GLOBAL")}}var De=(()=>{let i=class i{constructor(a,m){this.yamcs=a,this.title=m,this.qualifiedName=O.required({alias:"algorithm"})}ngOnInit(){this.algorithm$=this.yamcs.yamcsClient.getAlgorithm(this.yamcs.instance,this.qualifiedName()),this.algorithm$.then(a=>{this.title.setTitle(a.name)})}};i.\u0275fac=function(m){return new(m||i)(y($),y(W))},i.\u0275cmp=P({type:i,selectors:[["ng-component"]],inputs:{qualifiedName:[1,"algorithm","qualifiedName"]},standalone:!0,features:[I],decls:2,vars:3,consts:[["tabs",""],["rla","routerLinkActive"],["rlb","routerLinkActive"],["tabPanel",""],[3,"text"],["mat-tab-nav-bar","",1,"secondary",3,"mat-stretch-tabs","tabPanel"],["mat-tab-link","","routerLink","-/summary","routerLinkActive","",3,"active","queryParams"],["mat-tab-link","","routerLink","-/trace","routerLinkActive","",3,"active","queryParams","disabled"],[1,"tab-content-wrapper"],["routerLink","/algorithms",1,"ya-link","ya-header-link",3,"queryParams"]],template:function(m,s){if(m&1&&(d(0,pn,21,17,"app-instance-page"),C(1,"async")),m&2){let _;p((_=f(1,1,s.algorithm$))?0:-1,_)}},dependencies:[at,nt,q,M,xt,F,gt,Bt,zt,Rt,te,oe,it],styles:[".tab-content-wrapper[_ngcontent-%COMP%]{position:absolute;inset:37px 0 0;overflow:auto}.tab-content-wrapper.noscroll[_ngcontent-%COMP%]{overflow:hidden}"],changeDetection:0});let t=i;return t})();var _n=t=>{let i=t,e=t.findIndex(m=>m.path==="-");e!==-1&&(i=t.slice(0,e));let a="/"+i.map(m=>m.path).join("/");return{consumed:i,posParams:{algorithm:new ft(a,{})}}},ga=[{path:"",canActivate:[se,me],canActivateChild:[ce],runGuardsAndResolvers:"always",component:de,children:[{path:"",pathMatch:"full",component:ye},{matcher:_n,component:De,children:[{path:"",pathMatch:"full",redirectTo:"-/summary"},{path:"-/summary",component:Te},{path:"-/trace",component:Ae}]}]}];export{ga as ROUTES};
