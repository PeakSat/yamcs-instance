import{b as jt,d as Ut,e as zt,f as qt}from"./chunk-FTOGDGWN.js";import{Aa as c,Ae as oe,Ba as R,Bb as Ve,Ca as g,Da as Te,Db as st,Eb as ct,F as M,Fa as Fe,Fc as he,Ga as $,Gc as ke,Ha as k,Hc as Ce,Ia as J,Ic as Oe,J as fe,Ja as we,Jb as mt,Jc as xe,Jd as It,K as v,L as T,La as u,Ma as _,Md as Rt,Me as At,Na as Ae,Nb as dt,Qb as pt,R as ve,Rb as ft,Re as A,Sa as Ee,Sb as ut,Sc as te,Tb as _t,Tc as Ft,Uc as wt,Ue as re,V as Xe,Ve as B,Wc as Et,We as Vt,X as l,Xa as _e,Xc as ge,Xe as Ht,Y as x,Ya as Ze,Yb as ht,Yd as Me,Ye as Wt,Zc as ie,_a as N,_b as ee,_c as Dt,_d as Lt,a as Be,aa as p,ab as et,ad as Pt,ae as $e,b as qe,ba as ue,bc as Pe,bd as ye,ca as f,da as Je,dc as Ct,dd as ne,e as b,ea as Y,ec as xt,ed as L,fc as gt,ga as C,ha as j,i as Ge,ia as U,ib as tt,id as kt,ja as z,jd as Ot,ka as s,kd as Mt,la as r,ma as P,mb as Z,na as F,nb as it,oa as w,ob as nt,pb as at,qa as E,qb as ot,qc as yt,ra as S,rc as St,s as Ye,sa as d,sc as vt,sd as $t,tc as Tt,td as Nt,te as ae,u as Ke,ud as Bt,v as Qe,wa as Ie,xa as Re,xb as De,xc as bt,y as be,ya as Le,yb as rt,za as X,zb as lt,ze as Ne}from"./chunk-YLFXKKOP.js";var oi=()=>["detail"];function ri(t,a){t&1&&(s(0,"th",24),c(1,"Started"),r())}function li(t,a){if(t&1&&(s(0,"td",25),c(1),u(2,"datetime"),r()),t&2){let i=a.$implicit;l(),g(" ",_(2,1,i.transfer.startTime)," ")}}function si(t,a){t&1&&(s(0,"th",26),c(1,"Local entity"),r())}function ci(t,a){if(t&1&&(s(0,"td",25),c(1),r()),t&2){let i,e=a.$implicit;l(),g(" ",(i=(i=e.transfer.localEntity==null?null:e.transfer.localEntity.name)!==null&&i!==void 0?i:e.transfer.localEntity==null?null:e.transfer.localEntity.id)!==null&&i!==void 0?i:"-"," ")}}function mi(t,a){t&1&&(s(0,"th",24),c(1,"Local file"),r())}function di(t,a){if(t&1&&(s(0,"span"),c(1),u(2,"storageUrl"),r()),t&2){let i=d().$implicit;l(),R(Ae(2,1,i.transfer.objectName,i.transfer.bucket)||"-")}}function pi(t,a){if(t&1&&(s(0,"a",27),c(1),u(2,"storageUrl"),r()),t&2){let i=d().$implicit;f("href",i.objectUrl,Xe),l(),R(Ae(2,2,i.transfer.objectName,i.transfer.bucket)||"-")}}function fi(t,a){if(t&1&&(s(0,"td",25),p(1,di,3,4,"span")(2,pi,3,5,"a",27),r()),t&2){let i=a.$implicit;l(),C(i.transfer.direction==="DOWNLOAD"&&i.transfer.state!=="COMPLETED"||!i.objectUrl?1:2)}}function ui(t,a){t&1&&(s(0,"th",28),c(1,"Direction"),r())}function _i(t,a){t&1&&c(0," \u27F5 ")}function hi(t,a){t&1&&c(0," \u27F6 ")}function Ci(t,a){if(t&1&&(s(0,"td",29),p(1,_i,1,0)(2,hi,1,0),r()),t&2){let i=a.$implicit;l(),C(i.transfer.direction==="DOWNLOAD"?1:-1),l(),C(i.transfer.direction==="UPLOAD"?2:-1)}}function xi(t,a){t&1&&(s(0,"th",26),c(1,"Remote entity"),r())}function gi(t,a){if(t&1&&(s(0,"td",25),c(1),r()),t&2){let i,e=a.$implicit;l(),g(" ",(i=(i=e.transfer.remoteEntity==null?null:e.transfer.remoteEntity.name)!==null&&i!==void 0?i:e.transfer.remoteEntity==null?null:e.transfer.remoteEntity.id)!==null&&i!==void 0?i:"-"," ")}}function yi(t,a){t&1&&(s(0,"th",24),c(1,"Remote file"),r())}function Si(t,a){if(t&1&&(s(0,"td",25),c(1),r()),t&2){let i=a.$implicit;l(),R(i.transfer.remotePath||"-")}}function vi(t,a){t&1&&(s(0,"th",30),c(1,"Size"),r())}function Ti(t,a){if(t&1&&(s(0,"td",25),c(1),u(2,"formatBytes"),r()),t&2){let i,e=a.$implicit;l(),R((i=_(2,1,e.transfer.totalSize))!==null&&i!==void 0?i:"-")}}function bi(t,a){t&1&&(s(0,"th",31),c(1,"Status"),r())}function Fi(t,a){t&1&&(c(0),u(1,"titlecase")),t&2&&g(" ",_(1,1,a)||"-"," ")}function wi(t,a){if(t&1&&(s(0,"td",25),p(1,Fi,2,3),u(2,"async"),r()),t&2){let i,e=a.$implicit;l(),C((i=_(2,1,e.state$))?1:-1,i)}}function Ei(t,a){t&1&&(s(0,"th",30),c(1,"Transferred"),r())}function Di(t,a){if(t&1&&(s(0,"td",25),c(1),u(2,"formatBytes"),r()),t&2){let i,e=a.$implicit;l(),g(" ",(i=_(2,1,e.transfer.sizeTransferred))!==null&&i!==void 0?i:"-"," ")}}function Pi(t,a){t&1&&(s(0,"th",31),c(1,"Transfer type"),r())}function ki(t,a){if(t&1&&(s(0,"td",25),c(1),r()),t&2){let i=a.$implicit;l(),R(i.transfer.transferType||"-")}}function Oi(t,a){t&1&&P(0,"th",32)}function Mi(t,a){if(t&1){let i=E();s(0,"ya-text-action",37),S("click",function(){v(i);let n=d(3).$implicit,o=d();return T(o.pauseTransfer(n))}),c(1,"PAUSE"),r()}}function $i(t,a){if(t&1){let i=E();s(0,"ya-text-action",38),S("click",function(){v(i);let n=d(3).$implicit,o=d();return T(o.resumeTransfer(n))}),c(1,"RESUME"),r()}}function Ni(t,a){if(t&1){let i=E();p(0,Mi,2,0,"ya-text-action",34)(1,$i,2,0,"ya-text-action",35),s(2,"ya-text-action",36),S("click",function(){v(i);let n=d(2).$implicit,o=d();return T(o.cancelTransfer(n))}),c(3,"CANCEL"),r()}if(t&2){let i=a;C(i==="RUNNING"?0:-1),l(),C(i==="PAUSED"?1:-1)}}function Bi(t,a){if(t&1&&(p(0,Ni,4,2,"ya-text-action",33),u(1,"async")),t&2){let i,e=d().$implicit;C((i=_(1,1,e.state$))?0:-1,i)}}function Ii(t,a){if(t&1&&(s(0,"td",25),p(1,Bi,2,3),r()),t&2){let i=d();l(),C(i.showActions?1:-1)}}function Ri(t,a){if(t&1&&P(0,"ya-progress",40),t&2){let i=d(),e=d(2);f("value",e.transferPercent(i))("total",1)}}function Li(t,a){if(t&1&&(s(0,"span",41),c(1),r()),t&2){let i=d();l(),g(" ",i.failureReason," ")}}function Ai(t,a){if(t&1&&(s(0,"div",39),p(1,Ri,1,2,"ya-progress",40),s(2,"span"),c(3),u(4,"formatBytes"),r(),p(5,Li,2,1,"span",41),r()),t&2){let i=a;l(),C(i.state==="RUNNING"||i.state==="PAUSED"||i.state==="CANCELLING"?1:-1),l(2),R(_(4,3,i.sizeTransferred)),l(2),C(i.failureReason?5:-1)}}function Vi(t,a){if(t&1&&(s(0,"td",25),u(1,"async"),p(2,Ai,6,5,"div",39),u(3,"async"),r()),t&2){let i,e=a.$implicit,n=d();ue("colspan",_(1,2,n.displayedColumns$).length),l(2),C((i=_(3,4,e.transfer$))?2:-1,i)}}function ji(t,a){t&1&&P(0,"tr",42)}function Ui(t,a){if(t&1&&P(0,"tr",43),t&2){let i=a.$implicit;Y("nodetail",i.transfer.state==="COMPLETED")}}function zi(t,a){t&1&&P(0,"tr",44)}var Se=(()=>{let a=class a{constructor(e,n){this.yamcs=e,this.messageService=n,this.extraColumns=[],this.defaultColumns=["startTime","localEntity","localFile","direction","remoteEntity","remoteFile","size","status"],this.displayedColumns$=new b(this.defaultColumns),this.isIncomplete=(o,m)=>m.transfer.state!=="COMPLETED",this.dataSource=new L,this.showActions=!1}ngOnChanges(){this.displayedColumns$.next([...this.defaultColumns,...this.extraColumns,"actions"])}transferPercent(e){return e.totalSize!=0?e.sizeTransferred/e.totalSize:0}pauseTransfer(e){let n=e.transfer.id;this.yamcs.yamcsClient.pauseFileTransfer(this.yamcs.instance,this.serviceName,n).catch(o=>{this.messageService.showError(o)})}resumeTransfer(e){let n=e.transfer.id;this.yamcs.yamcsClient.resumeFileTransfer(this.yamcs.instance,this.serviceName,n).catch(o=>{this.messageService.showError(o)})}cancelTransfer(e){let n=e.transfer.id;this.yamcs.yamcsClient.cancelFileTransfer(this.yamcs.instance,this.serviceName,n).catch(o=>{this.messageService.showError(o)})}};a.\u0275fac=function(n){return new(n||a)(x(A),x(Me))},a.\u0275cmp=M({type:a,selectors:[["app-file-transfer-table"]],inputs:{extraColumns:"extraColumns",serviceName:"serviceName",dataSource:"dataSource",showActions:"showActions"},standalone:!0,features:[fe,$],decls:41,vars:10,consts:[["mat-table","","multiTemplateDataRows","",1,"ya-data-table","expand",3,"dataSource"],["matColumnDef","startTime"],["mat-header-cell","","style","width: 200px",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","localEntity"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","localFile"],["matColumnDef","direction"],["mat-header-cell","","width","1",4,"matHeaderCellDef"],["mat-cell","","style","text-align: center",4,"matCellDef"],["matColumnDef","remoteEntity"],["matColumnDef","remoteFile"],["matColumnDef","size"],["mat-header-cell","","style","width: 70px",4,"matHeaderCellDef"],["matColumnDef","status"],["mat-header-cell","","style","width: 100px",4,"matHeaderCellDef"],["matColumnDef","transferred"],["matColumnDef","transferType"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["matColumnDef","detail"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","","class","item-row",3,"nodetail",4,"matRowDef","matRowDefColumns"],["mat-row","","class","item-detail",4,"matRowDef","matRowDefColumns","matRowDefWhen"],["mat-header-cell","",2,"width","200px"],["mat-cell",""],["mat-header-cell",""],["download","",3,"href"],["mat-header-cell","","width","1"],["mat-cell","",2,"text-align","center"],["mat-header-cell","",2,"width","70px"],["mat-header-cell","",2,"width","100px"],["mat-header-cell","",1,"expand"],["icon","not_interested"],["icon","pause_circle_outline"],["icon","play_circle_outline"],["icon","not_interested",3,"click"],["icon","pause_circle_outline",3,"click"],["icon","play_circle_outline",3,"click"],[1,"detail-layout"],["width","200px",3,"value","total"],[1,"error"],["mat-header-row",""],["mat-row","",1,"item-row"],["mat-row","",1,"item-detail"]],template:function(n,o){n&1&&(s(0,"table",0),F(1,1),p(2,ri,2,0,"th",2)(3,li,3,3,"td",3),w(),F(4,4),p(5,si,2,0,"th",5)(6,ci,2,1,"td",3),w(),F(7,6),p(8,mi,2,0,"th",2)(9,fi,3,1,"td",3),w(),F(10,7),p(11,ui,2,0,"th",8)(12,Ci,3,2,"td",9),w(),F(13,10),p(14,xi,2,0,"th",5)(15,gi,2,1,"td",3),w(),F(16,11),p(17,yi,2,0,"th",2)(18,Si,2,1,"td",3),w(),F(19,12),p(20,vi,2,0,"th",13)(21,Ti,3,3,"td",3),w(),F(22,14),p(23,bi,2,0,"th",15)(24,wi,3,3,"td",3),w(),F(25,16),p(26,Ei,2,0,"th",13)(27,Di,3,3,"td",3),w(),F(28,17),p(29,Pi,2,0,"th",15)(30,ki,2,1,"td",3),w(),F(31,18),p(32,Oi,1,0,"th",19)(33,Ii,2,1,"td",3),w(),F(34,20),p(35,Vi,4,6,"td",3),w(),p(36,ji,1,0,"tr",21),u(37,"async"),p(38,Ui,1,2,"tr",22),u(39,"async"),p(40,zi,1,0,"tr",23),r()),n&2&&(f("dataSource",o.dataSource),l(36),f("matHeaderRowDef",_(37,5,o.displayedColumns$)),l(2),f("matRowDefColumns",_(39,7,o.displayedColumns$)),l(2),f("matRowDefColumns",k(9,oi))("matRowDefWhen",o.isIncomplete))},dependencies:[B,N,et,te,wt,Dt,Et,Ft,Pt,ge,ie,ye,ne,$e,Rt,ae,oe,At],styles:["tr.item-row[_ngcontent-%COMP%]:not(.nodetail)   td[_ngcontent-%COMP%]{border-bottom-width:0}tr.item-detail[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding-left:40px!important}.detail-layout[_ngcontent-%COMP%]{display:flex;align-items:center}.detail-layout[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin-left:20px}.error[_ngcontent-%COMP%]{color:#dc143c}"],changeDetection:0});let t=a;return t})();var le=class{constructor(a,i){this.transfer=a,this.objectUrl=i,this.originalTransfer$=new b(a),this.transfer$=this.originalTransfer$.pipe(Ke(500),Qe(a)),this.state$=this.originalTransfer$.pipe(Ge(e=>e.state),Ye())}updateTransfer(a){this.transfer=a,this.originalTransfer$.next(a)}};var Hi=()=>["transferType"],Wi=()=>[],Gt=(()=>{let a=class a{constructor(e,n,o){this.yamcs=e,this.serviceName$=new b(null),this.dataSource=new L,this.transfersById=new Map,this.dirty=!1,this.hasTransferType=!1,this.hasTransferType=history.state.hasTransferType,this.storageClient=e.createStorageClient(),this.queryParamSubscription=n.queryParamMap.subscribe(m=>{let h=m.get("service");this.serviceName$.next(h),this.switchService(h)}),this.syncSubscription=o.sync(()=>{if(this.dirty){let m=[...this.transfersById.values()];m.sort((h,D)=>this.compareTransfers(h.transfer,D.transfer)),this.dataSource.data=m,this.dirty=!1}})}compareTransfers(e,n){let o=e.creationTime||e.startTime||"";return(n.creationTime||n.startTime||"").localeCompare(o)}switchService(e){this.dirty=!1,this.transfersById.clear(),this.dataSource.data=[],this.transferSubscription&&this.transferSubscription.cancel(),e&&(this.transferSubscription=this.yamcs.yamcsClient.createTransferSubscription({instance:this.yamcs.instance,serviceName:e},n=>{switch(n.state){case"FAILED":this.setOrUpdate(n);break}this.dirty=!0}))}setOrUpdate(e){let n=this.transfersById.get(e.id);if(n)n.updateTransfer(e);else{let o=e.objectName?this.storageClient.getObjectURL(e.bucket,e.objectName):"";n=new le(e,o),this.transfersById.set(e.id,n)}}ngOnDestroy(){this.syncSubscription?.unsubscribe(),this.queryParamSubscription?.unsubscribe(),this.transferSubscription?.cancel()}};a.\u0275fac=function(n){return new(n||a)(x(A),x(Z),x(re))},a.\u0275cmp=M({type:a,selectors:[["app-failed-transfers-tab"]],standalone:!0,features:[$],decls:3,vars:7,consts:[[1,"panel-content"],[3,"serviceName","dataSource","extraColumns"]],template:function(n,o){n&1&&(s(0,"div",0),P(1,"app-file-transfer-table",1),u(2,"async"),r()),n&2&&(l(),f("serviceName",_(2,3,o.serviceName$))("dataSource",o.dataSource)("extraColumns",o.hasTransferType?k(5,Hi):k(6,Wi)))},dependencies:[B,N,Se],encapsulation:2,changeDetection:0});let t=a;return t})();var qi=()=>["parent"];function Gi(t,a){t&1&&(s(0,"th",14),c(1,"Name"),r())}function Yi(t,a){if(t&1&&(s(0,"mat-icon",16),c(1,"folder"),r(),c(2),u(3,"filename")),t&2){let i=d().$implicit;l(2),g(" ",_(3,1,i.name)," ")}}function Ki(t,a){if(t&1&&(s(0,"mat-icon",16),c(1,"description"),r(),s(2,"span",17),c(3),u(4,"filename"),r()),t&2){let i=d().$implicit,e=d(2);l(2),f("ngClass",e.foldersOnly?"disabled":""),l(),R(_(4,2,i.name))}}function Qi(t,a){if(t&1&&(s(0,"td",15),p(1,Yi,4,3)(2,Ki,5,4),r()),t&2){let i=a.$implicit;l(),C(i.folder?1:2)}}function Xi(t,a){t&1&&(s(0,"th",18),c(1,"Date modified"),r())}function Ji(t,a){if(t&1&&(s(0,"td",15)(1,"span",17),c(2),u(3,"datetime"),r()()),t&2){let i=a.$implicit,e=d(2);l(),f("ngClass",!i.folder&&e.foldersOnly?"disabled":""),l(),g(" ",_(3,2,i.modified)||"-"," ")}}function Zi(t,a){t&1&&(s(0,"th",19),c(1,"Size"),r())}function en(t,a){if(t&1&&(s(0,"td",15)(1,"span",17),c(2),u(3,"formatBytes"),r()()),t&2){let i=a.$implicit,e=d(2);l(),f("ngClass",!i.folder&&e.foldersOnly?"disabled":""),l(),g(" ",_(3,2,i.size)||"-"," ")}}function tn(t,a){if(t&1&&(s(0,"td",20)(1,"mat-icon",21),c(2," description "),r(),c(3," .. "),r()),t&2){let i=d(2);ue("colspan",i.displayedColumns.length)}}function nn(t,a){if(t&1){let i=E();s(0,"tr",22),S("click",function(){v(i);let n=d(2);return T(n.clearSelection())}),r()}}function an(t,a){if(t&1){let i=E();s(0,"tr",23),u(1,"async"),S("click",function(){v(i);let n=d(2);return T(n.selectParent())}),r()}if(t&2){let i=d(2);Y("hide",!_(1,2,i.currentPrefix$))}}function on(t,a){if(t&1){let i=E();s(0,"tr",24),S("click",function(n){let o=v(i).$implicit,m=d(2);return T(m.selectFile(n,o))}),r()}if(t&2){let i=a.$implicit,e=d(2);Y("selected",e.isSelected(i))}}function rn(t,a){if(t&1&&(s(0,"table",1),F(1,2),p(2,Gi,2,0,"th",3)(3,Qi,3,1,"td",4),w(),F(4,5),p(5,Xi,2,0,"th",6)(6,Ji,4,4,"td",4),w(),F(7,7),p(8,Zi,2,0,"th",8)(9,en,4,4,"td",4),w(),F(10,9),p(11,tn,4,1,"td",10),w(),p(12,nn,1,0,"tr",11)(13,an,2,4,"tr",12)(14,on,1,2,"tr",13),r()),t&2){let i=d();Y("no-frame",i.noFrame)("no-select",i.noSelect),f("dataSource",i.dataSource),l(12),f("cdkHeaderRowDef",i.displayedColumns),l(),f("cdkHeaderRowDef",k(8,qi)),l(),f("cdkRowDefColumns",i.displayedColumns)}}var Kt=(()=>{let a=class a{constructor(e,n){this.changeDetection=n,this.noFrame=!1,this.noSelect=!1,this.allowFolderSelection=!1,this.prefixChange=new ve,this.displayedColumns=["name","size","modified"],this.dataSource=new L([]),this.currentPrefix$=new b(null),this.selectedFileNames=new Set,this.onChange=o=>{},this.onTouched=()=>{},this.storageClient=e.createStorageClient()}ngOnChanges(){this.bucket&&this.loadCurrentFolder()}changePrefix(e){this.loadCurrentFolder(e)}loadCurrentFolder(e){let n={delimiter:"/"};e&&(n.prefix=e),this.storageClient.listObjects(this.bucket.name,n).then(o=>{this.changedir(o);let m=e||null;m!==this.currentPrefix$.value&&(this.currentPrefix$.next(m),this.prefixChange.emit(m))})}changedir(e){this.selectedFileNames.clear(),this.updateFileNames();let n=[];for(let o of e.prefixes||[])n.push({folder:!0,name:o});for(let o of e.objects||[])o.name.endsWith("/")||n.push({folder:!1,name:o.name,modified:o.created,size:o.size,objectUrl:this.storageClient.getObjectURL(this.bucket.name,o.name)});this.dataSource.data=n,this.changeDetection.detectChanges()}selectFile(e,n){if(n.folder)this.allowFolderSelection&&e.ctrlKey&&e.shiftKey?this.flipRowSelection(n):this.loadCurrentFolder(n.name);else if(!this.foldersOnly){if(this.isMultiSelect&&e.ctrlKey)this.flipRowSelection(n);else if(this.isMultiSelect&&e.shiftKey)if(this.selectedFileNames.size==0||!this.lastSelected||this.lastSelected.name===n.name)this.flipRowSelection(n);else{let o=!1;for(let m of this.dataSource.data)(m.name===n.name||m.name===this.lastSelected.name)&&(o=!o),o&&this.selectedFileNames.add(m.name);this.selectedFileNames.add(n.name)}else this.selectedFileNames.size==1&&this.selectedFileNames.has(n.name)?this.selectedFileNames.clear():(this.selectedFileNames.clear(),this.selectedFileNames.add(n.name));this.selectedFileNames.has(n.name)&&(this.lastSelected=n)}this.updateFileNames()}flipRowSelection(e){this.selectedFileNames.has(e.name)?this.selectedFileNames.delete(e.name):this.selectedFileNames.add(e.name)}updateFileNames(){this.onChange(Array.from(this.selectedFileNames).join("|"))}isSelected(e){return this.selectedFileNames.has(e.name)}selectParent(){let e=this.currentPrefix$.value;if(e){let n=e.slice(0,-1),o=n.lastIndexOf("/");if(o){let m=n.substring(0,o+1);this.selectedFileNames.clear(),this.updateFileNames(),this.loadCurrentFolder(m)}}}writeValue(e){this.path=e}clearSelection(){this.selectedFileNames.clear(),this.updateFileNames(),this.changeDetection.detectChanges()}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouched=e}ngOnDestroy(){this.selectionSubscription&&this.selectionSubscription.unsubscribe()}};a.\u0275fac=function(n){return new(n||a)(x(A),x(Ee))},a.\u0275cmp=M({type:a,selectors:[["app-object-selector"]],inputs:{bucket:"bucket",isMultiSelect:"isMultiSelect",foldersOnly:"foldersOnly",noFrame:"noFrame",path:"path",noSelect:"noSelect",allowFolderSelection:"allowFolderSelection"},outputs:{prefixChange:"prefixChange"},standalone:!0,features:[Fe([{provide:De,useExisting:be(()=>a),multi:!0}]),fe,$],decls:1,vars:1,consts:[["mat-table","",1,"ya-data-table","expand",3,"dataSource","no-frame","no-select"],["mat-table","",1,"ya-data-table","expand",3,"dataSource"],["cdkColumnDef","name"],["mat-header-cell","","style","width: 400px",4,"cdkHeaderCellDef"],["mat-cell","",4,"cdkCellDef"],["cdkColumnDef","modified"],["mat-header-cell","","style","width: 200px",4,"cdkHeaderCellDef"],["cdkColumnDef","size"],["mat-header-cell","","style","width: 70px",4,"cdkHeaderCellDef"],["cdkColumnDef","parent"],["mat-header-cell","",4,"cdkHeaderCellDef"],["mat-header-row","",3,"click",4,"cdkHeaderRowDef"],["mat-row","","class","parent-row",3,"hide","click",4,"cdkHeaderRowDef"],["mat-row","",3,"selected","click",4,"cdkRowDef","cdkRowDefColumns"],["mat-header-cell","",2,"width","400px"],["mat-cell",""],[1,"icon12",2,"vertical-align","middle"],[3,"ngClass"],["mat-header-cell","",2,"width","200px"],["mat-header-cell","",2,"width","70px"],["mat-header-cell",""],[1,"icon12",2,"vertical-align","middle","visibility","hidden"],["mat-header-row","",3,"click"],["mat-row","",1,"parent-row",3,"click"],["mat-row","",3,"click"]],template:function(n,o){n&1&&p(0,rn,15,9,"table",0),n&2&&C(o.dataSource?0:-1)},dependencies:[B,_e,N,xe,he,ke,Ce,Oe,ee,te,ge,ie,ye,ne,ae,Ne,oe],styles:["table[_ngcontent-%COMP%]{cursor:pointer}.folder[_ngcontent-%COMP%]:hover{text-decoration:underline}  .parent-row td{font-size:12px;line-height:16px;color:#000000a7;padding:7px 8px 8px 0;border-bottom:1px solid rgba(0,0,0,.12)}.hide[_ngcontent-%COMP%]{display:none}.disabled[_ngcontent-%COMP%]{color:#d3d3d3}.no-select[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}"],changeDetection:0});let t=a;return t})();var sn=()=>["parent"];function cn(t,a){t&1&&P(0,"th",18)}function mn(t,a){if(t&1&&(s(0,"mat-icon"),c(1," check "),r()),t&2){let i=d().$implicit;Je("visibility",i.checked?"visible":"hidden")}}function dn(t,a){if(t&1){let i=E();s(0,"button",22),S("click",function(){let n=v(i).$implicit,o=d().$implicit,m=d(2);return T(m.runFileAction(o.name,n))}),p(1,mn,2,2,"mat-icon",23),c(2),r()}if(t&2){let i=a.$implicit;f("disabled",!i.enabled),l(),C(i.style==="CHECK_BOX"?1:-1),l(),g(" ",i.label," ")}}function pn(t,a){if(t&1&&(s(0,"td",19)(1,"ya-more",20),U(2,dn,3,3,"button",21,j),r()()),t&2){let i=d(2);l(),f("padding",!1),l(),z(i.fileActions)}}function fn(t,a){t&1&&(s(0,"th",24),c(1,"Name"),r())}function un(t,a){if(t&1&&(s(0,"mat-icon",26),c(1,"folder"),r(),c(2),u(3,"filename")),t&2){let i,e=d().$implicit;l(2),g(" ",(i=e.displayName)!==null&&i!==void 0?i:_(3,1,e.name),"/ ")}}function _n(t,a){if(t&1&&(s(0,"mat-icon",26),c(1,"description"),r(),s(2,"span",27),c(3),u(4,"filename"),r()),t&2){let i,e=d().$implicit,n=d(2);l(2),f("ngClass",n.foldersOnly?"disabled":""),l(),g(" ",(i=e.displayName)!==null&&i!==void 0?i:_(4,2,e.name)," ")}}function hn(t,a){if(t&1&&(s(0,"td",25),p(1,un,4,3)(2,_n,5,4),r()),t&2){let i=a.$implicit;l(),C(i.folder?1:2)}}function Cn(t,a){t&1&&(s(0,"th",28),c(1,"Date modified"),r())}function xn(t,a){if(t&1&&(s(0,"td",25)(1,"span",27),c(2),u(3,"datetime"),r()()),t&2){let i=a.$implicit,e=d(2);l(),f("ngClass",!i.folder&&e.foldersOnly?"disabled":""),l(),g(" ",_(3,2,i.modified)||"-"," ")}}function gn(t,a){t&1&&(s(0,"th",29),c(1,"Size"),r())}function yn(t,a){if(t&1&&(s(0,"td",25)(1,"span",27),c(2),u(3,"formatBytes"),r()()),t&2){let i=a.$implicit,e=d(2);l(),f("ngClass",!i.folder&&e.foldersOnly?"disabled":""),l(),g(" ",_(3,2,i.size)||"-"," ")}}function Sn(t,a){if(t&1&&(s(0,"td",30),u(1,"async"),s(2,"mat-icon",31),c(3," description "),r(),c(4," .. "),r()),t&2){let i,e=d(2);ue("colspan",(i=_(1,1,e.displayedColumns$))==null?null:i.length)}}function vn(t,a){if(t&1&&(s(0,"th",33),c(1),r()),t&2){let i=d().$implicit;l(),R(i.label)}}function Tn(t,a){if(t&1&&c(0),t&2){let i,e=d().$implicit,n=d().$implicit;g(" ",(i=e.extra[n.id])!==null&&i!==void 0?i:"-"," ")}}function bn(t,a){t&1&&c(0," - ")}function Fn(t,a){if(t&1&&(s(0,"td",25),p(1,Tn,1,1)(2,bn,1,0),r()),t&2){let i=a.$implicit;l(),C(i.extra?1:2)}}function wn(t,a){if(t&1&&(F(0,14),p(1,vn,2,1,"th",32)(2,Fn,3,1,"td",7),w()),t&2){let i=a.$implicit;f("cdkColumnDef",i.id)}}function En(t,a){if(t&1){let i=E();s(0,"tr",34),S("click",function(){v(i);let n=d(2);return T(n.clearSelection())}),r()}}function Dn(t,a){if(t&1){let i=E();s(0,"tr",35),u(1,"async"),S("click",function(){v(i);let n=d(2);return T(n.selectParent())}),r()}if(t&2){let i=d(2);Y("hide",!_(1,2,i.currentPrefix$))}}function Pn(t,a){if(t&1){let i=E();s(0,"tr",36),S("click",function(n){let o=v(i).$implicit,m=d(2);return T(m.selectFile(n,o))}),r()}if(t&2){let i=a.$implicit,e=d(2);Y("selected",e.isSelected(i))}}function kn(t,a){if(t&1&&(s(0,"table",1),F(1,2),p(2,cn,1,0,"th",3)(3,pn,4,1,"td",4),w(),F(4,5),p(5,fn,2,0,"th",6)(6,hn,3,1,"td",7),w(),F(7,8),p(8,Cn,2,0,"th",9)(9,xn,4,4,"td",7),w(),F(10,10),p(11,gn,2,0,"th",11)(12,yn,4,4,"td",7),w(),F(13,12),p(14,Sn,5,3,"td",13),w(),U(15,wn,3,1,"ng-container",14,j),u(17,"async"),p(18,En,1,0,"tr",15),u(19,"async"),p(20,Dn,2,4,"tr",16)(21,Pn,1,2,"tr",17),u(22,"async"),r()),t&2){let i=d();Y("no-select",i.noSelect),f("dataSource",i.dataSource),l(15),z(_(17,6,i.extraColumns$)),l(3),f("cdkHeaderRowDef",_(19,8,i.displayedColumns$)),l(2),f("cdkHeaderRowDef",k(12,sn)),l(),f("cdkRowDefColumns",_(22,10,i.displayedColumns$))}}var Qt=(()=>{let a=class a{constructor(e){this.changeDetection=e,this.noSelect=!1,this.allowFolderSelection=!1,this.fileListExtraColumns=[],this.fileActions=[],this.prefixChange=new ve,this.onAction=new ve,this.displayedColumns$=new b(["name","size","modified"]),this.extraColumns$=new b([]),this.dataSource=new L([]),this.currentPrefix$=new b(null),this.selectedFileNames=new Set,this.onChange=n=>{},this.onTouched=()=>{}}ngOnChanges(){this.loadCurrentFolder();let e=[];this.fileActions.length&&e.push("actions"),e.push("name");for(let n of this.fileListExtraColumns)e.push(n.id);e.push("size"),e.push("modified"),this.extraColumns$.next(this.fileListExtraColumns),this.displayedColumns$.next(e)}changePrefix(e){this.loadCurrentFolder(e)}loadCurrentFolder(e){if((e||null)!==this.currentPrefix$.value){let o={files:[],destination:"",remotePath:"",listTime:""};this.setFolderContent(e,o)}}setFolderContent(e,n){this.changeDir(n);let o=e||null;o!==this.currentPrefix$.value&&(this.currentPrefix$.next(o),this.prefixChange.emit(o))}changeDir(e){this.selectedFileNames.clear(),this.updateFileNames();let n=[],o=e.remotePath?e.remotePath+"/":"";for(let m of e.files||[]){let h=o+m.name;n.push({folder:m.isDirectory,name:h,displayName:m.displayName??m.name,modified:m.modified,size:m.size,extra:m.extra||{}})}this.dataSource.data=n,this.changeDetection.detectChanges()}selectFile(e,n){if(n.folder)this.allowFolderSelection&&e.ctrlKey&&e.shiftKey?this.flipRowSelection(n):this.loadCurrentFolder(n.name);else if(!this.foldersOnly){if(this.isMultiSelect&&e.ctrlKey)this.flipRowSelection(n);else if(this.isMultiSelect&&e.shiftKey)if(this.selectedFileNames.size==0||!this.lastSelected||this.lastSelected.name===n.name)this.flipRowSelection(n);else{let o=!1;for(let m of this.dataSource.data)(m.name===n.name||m.name===this.lastSelected.name)&&(o=!o),o&&this.selectedFileNames.add(m.name);this.selectedFileNames.add(n.name)}else this.selectedFileNames.size==1&&this.selectedFileNames.has(n.name)?this.selectedFileNames.clear():(this.selectedFileNames.clear(),this.selectedFileNames.add(n.name));this.selectedFileNames.has(n.name)&&(this.lastSelected=n)}this.updateFileNames()}flipRowSelection(e){this.selectedFileNames.has(e.name)?this.selectedFileNames.delete(e.name):this.selectedFileNames.add(e.name)}updateFileNames(){this.onChange(Array.from(this.selectedFileNames).join("|"))}runFileAction(e,n){this.onAction.emit({file:e,action:n})}isSelected(e){return this.selectedFileNames.has(e.name)}selectParent(){let e=this.currentPrefix$.value;if(e){let n=e.slice(0,-1),o=n.lastIndexOf("/"),m=o!=-1?n.substring(0,o+1):void 0;this.selectedFileNames.clear(),this.updateFileNames(),this.loadCurrentFolder(m)}}clearSelection(){this.selectedFileNames.clear(),this.updateFileNames(),this.changeDetection.detectChanges()}writeValue(e){this.path=e}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouched=e}ngOnDestroy(){this.selectionSubscription?.unsubscribe()}};a.\u0275fac=function(n){return new(n||a)(x(Ee))},a.\u0275cmp=M({type:a,selectors:[["app-remote-file-selector"]],inputs:{isMultiSelect:"isMultiSelect",foldersOnly:"foldersOnly",path:"path",noSelect:"noSelect",allowFolderSelection:"allowFolderSelection",fileListExtraColumns:"fileListExtraColumns",fileActions:"fileActions"},outputs:{prefixChange:"prefixChange",onAction:"onAction"},standalone:!0,features:[Fe([{provide:De,useExisting:be(()=>a),multi:!0}]),fe,$],decls:1,vars:1,consts:[["mat-table","",1,"ya-data-table","expand","no-frame",3,"dataSource","no-select"],["mat-table","",1,"ya-data-table","expand","no-frame",3,"dataSource"],["cdkColumnDef","actions"],["mat-header-cell","","class","status","width","1",4,"cdkHeaderCellDef"],["mat-cell","","class","status",4,"cdkCellDef"],["cdkColumnDef","name"],["mat-header-cell","","style","width: 400px",4,"cdkHeaderCellDef"],["mat-cell","",4,"cdkCellDef"],["cdkColumnDef","modified"],["mat-header-cell","","style","width: 200px",4,"cdkHeaderCellDef"],["cdkColumnDef","size"],["mat-header-cell","","style","width: 70px",4,"cdkHeaderCellDef"],["cdkColumnDef","parent"],["mat-header-cell","",4,"cdkHeaderCellDef"],[3,"cdkColumnDef"],["mat-header-row","",3,"click",4,"cdkHeaderRowDef"],["mat-row","","class","parent-row",3,"hide","click",4,"cdkHeaderRowDef"],["mat-row","",3,"selected","click",4,"cdkRowDef","cdkRowDefColumns"],["mat-header-cell","","width","1",1,"status"],["mat-cell","",1,"status"],[3,"padding"],["mat-menu-item","",3,"disabled"],["mat-menu-item","",3,"click","disabled"],[3,"visibility"],["mat-header-cell","",2,"width","400px"],["mat-cell",""],[1,"icon12",2,"vertical-align","middle"],[3,"ngClass"],["mat-header-cell","",2,"width","200px"],["mat-header-cell","",2,"width","70px"],["mat-header-cell",""],[1,"icon12",2,"vertical-align","middle","visibility","hidden"],["mat-header-cell","","width","1",4,"cdkHeaderCellDef"],["mat-header-cell","","width","1"],["mat-header-row","",3,"click"],["mat-row","",1,"parent-row",3,"click"],["mat-row","",3,"click"]],template:function(n,o){n&1&&p(0,kn,23,13,"table",0),n&2&&C(o.dataSource?0:-1)},dependencies:[B,_e,N,xe,he,ke,Ce,Oe,ee,Pe,te,ge,ie,ye,ne,Lt,ae,Ne,oe],styles:["table[_ngcontent-%COMP%]{cursor:pointer}.folder[_ngcontent-%COMP%]:hover{text-decoration:underline}  .parent-row td{font-size:12px;line-height:16px;color:#000000a7;padding:7px 8px 8px 0;border-bottom:1px solid rgba(0,0,0,.12)}.hide[_ngcontent-%COMP%]{display:none}.disabled[_ngcontent-%COMP%]{color:#d3d3d3}.no-select[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}td.status[_ngcontent-%COMP%]{padding:0;padding-left:0!important;padding-right:0!important}.ya-data-table[_ngcontent-%COMP%]   td.status[_ngcontent-%COMP%] + td[_ngcontent-%COMP%], .ya-data-table[_ngcontent-%COMP%]   th.status[_ngcontent-%COMP%] + th[_ngcontent-%COMP%]{padding-left:2px!important}"],changeDetection:0});let t=a;return t})();var Mn=["objectSelector"],$n=["remoteSelector"],Jt=()=>({visibility:"hidden"}),Zt=t=>({"no-filelist":t}),Nn=t=>({selected:t}),Xt=()=>[];function Bn(t,a){if(t&1&&(s(0,"span"),c(1),u(2,"formatBytes"),u(3,"formatBytes"),r()),t&2){let i=d().$implicit;l(),Te(" ",_(2,2,i.size),"/",_(3,4,i.maxSize)," ")}}function In(t,a){if(t&1&&P(0,"ya-progress",32),t&2){let i=d().$implicit;f("value",i.size)("total",i.maxSize)}}function Rn(t,a){if(t&1&&(s(0,"td",30),u(1,"formatBytes"),s(2,"span")(3,"mat-icon",31),c(4,"shopping_basket"),r(),c(5),r(),p(6,Bn,4,6,"span")(7,In,1,2,"ya-progress",32),r()),t&2){let i=a.$implicit,e=d();f("title",_(1,4,i.maxSize-i.size)+" available"),l(5),g("\xA0 ",i.name,""),l(),C(e.showBucketSize$.value?6:-1),l(),C(e.showBucketSize$.value?7:-1)}}function Ln(t,a){if(t&1){let i=E();s(0,"tr",33),u(1,"async"),S("click",function(){let n=v(i).$implicit,o=d();return T(o.selectBucket(n))}),r()}if(t&2){let i=a.$implicit,e=d();f("ngClass",J(3,Nn,i===_(1,1,e.selectedBucket$)))}}function An(t,a){t&1&&(s(0,"div",14)(1,"div")(2,"label"),c(3,"Target bucket"),r(),c(4),r()()),t&2&&(l(4),g(" ",a.name," "))}function Vn(t,a){if(t&1&&(s(0,"option",17),c(1),r()),t&2){let i=a.$implicit;f("value",i.name),l(),Te("",i.name," [id=",i.id,"]")}}function jn(t,a){if(t&1){let i=E();s(0,"ya-breadcrumb",36),S("click",function(){let n=v(i).$implicit,o=d(2);return T(o.changeLocalPrefix(n.prefix))}),r()}if(t&2){let i=a.$implicit;f("label",i.name)("action",!0)}}function Un(t,a){if(t&1){let i=E();s(0,"ya-breadcrumb-trail",18)(1,"ya-breadcrumb",34),S("click",function(){v(i);let n=d();return T(n.changeLocalPrefix(""))}),r(),U(2,jn,1,2,"ya-breadcrumb",35,j),r()}t&2&&(f("showMargin",!1),l(),f("action",!0),l(),z(a))}function zn(t,a){if(t&1){let i=E();s(0,"app-object-selector",37,0),S("prefixChange",function(n){v(i);let o=d();return T(o.updateLocalBreadcrumb(n))}),r()}t&2&&f("bucket",a)("isMultiSelect",!0)("foldersOnly",!1)("noSelect",!0)("noFrame",!0)("allowFolderSelection",!0)}function Hn(t,a){if(t&1&&(s(0,"div")(1,"label"),c(2,"Local entity"),r(),c(3),r()),t&2){let i,e=d();l(3),g(" ",((i=e.form.get("localEntity"))==null?null:i.value)||"-"," ")}}function Wn(t,a){if(t&1){let i=E();s(0,"button",38),S("click",function(){v(i);let n=d();return T(n.startUpload())}),c(1," UPLOAD "),s(2,"mat-icon"),c(3,"chevron_right"),r()()}if(t&2){let i=d();f("disabled",!i.isUploadEnabled)}}function qn(t,a){if(t&1&&(s(0,"option",17),c(1),r()),t&2){let i=a.$implicit;f("value",i.name),l(),Te("",i.name," [id=",i.id,"]")}}function Gn(t,a){if(t&1){let i=E();s(0,"ya-breadcrumb",36),S("click",function(){let n=v(i).$implicit,o=d(3);return T(o.changeRemotePrefix(n.prefix))}),r()}if(t&2){let i=a.$implicit;f("label",i.name)("action",!0)}}function Yn(t,a){if(t&1){let i=E();s(0,"ya-breadcrumb-trail",18)(1,"ya-breadcrumb",34),S("click",function(){v(i);let n=d(2);return T(n.changeRemotePrefix(""))}),r(),U(2,Gn,1,2,"ya-breadcrumb",35,j),r()}t&2&&(f("showMargin",!1),l(),f("action",!0),l(),z(a))}function Kn(t,a){if(t&1){let i=E();s(0,"a",41),S("click",function(){v(i);let n=d(2);return T(n.requestFileList())}),s(1,"mat-icon"),c(2,"refresh"),r(),c(3),u(4,"async"),u(5,"datetime"),u(6,"async"),u(7,"async"),r()}if(t&2){let i=d(2);l(3),Te(" ",_(5,4,_(4,2,i.lastFileListTime$))," ",_(6,6,i.lastFileListState$)?"("+_(7,8,i.lastFileListState$)+")":""," ")}}function Qn(t,a){if(t&1&&(s(0,"div",24)(1,"label",7),c(2),s(3,"select",39),U(4,qn,2,3,"option",17,j),r()(),p(6,Yn,4,2,"ya-breadcrumb-trail",18),u(7,"async"),p(8,Kn,8,10,"a",40),r()),t&2){let i,e=d();f("ngClass",J(7,Zt,!e.service.capabilities.fileList)),l(2),g("Remote ",e.service.remoteEntities&&e.service.remoteEntities.length?"Entity":""," "),l(),f("ngStyle",!(e.service.remoteEntities&&e.service.remoteEntities.length)&&k(9,Jt)),l(),z(e.service.remoteEntities),l(2),C((i=_(7,5,e.remoteBreadcrumb$))?6:-1,i),l(2),C(e.service.capabilities.fileList?8:-1)}}function Xn(t,a){if(t&1){let i=E();s(0,"div",42),S("click",function(n){v(i);let o=X(2),m=d();return T(m.clearSelection(n,o))}),s(1,"app-remote-file-selector",43,1),S("prefixChange",function(n){v(i);let o=d();return T(o.updateRemoteBreadcrumb(n))})("onAction",function(n){v(i);let o=d();return T(o.onActionRequest(n))}),r()()}if(t&2){let i=d();l(),f("isMultiSelect",!0)("foldersOnly",!1)("noSelect",!0)("allowFolderSelection",!0)("fileListExtraColumns",i.service.capabilities.fileListExtraColumns||k(6,Xt))("fileActions",i.service.capabilities.fileActions||k(7,Xt))}}function Jn(t,a){if(t&1){let i=E();s(0,"button",38),S("click",function(){v(i);let n=d();return T(n.startDownload())}),s(1,"mat-icon"),c(2,"chevron_left"),r(),c(3," DOWNLOAD "),r()}if(t&2){let i=d();f("disabled",!i.isDownloadEnabled)}}function Zn(t,a){if(t&1&&P(0,"input",27),t&2){let i,e=d();f("value",(i=e.form.get("remoteFilenames"))==null?null:i.value)}}function ea(t,a){if(t&1&&(s(0,"div")(1,"label"),c(2,"Remote entity"),r(),c(3),r()),t&2){let i,e=d();l(3),g(" ",((i=e.form.get("remoteEntity"))==null?null:i.value)||"-"," ")}}function ta(t,a){if(t&1&&(s(0,"label",44),P(1,"input",48),c(2),r()),t&2){let i=d(),e=i.$implicit,n=i.$index,o=d();l(),f("formControlName",o.getControlName(e,n)),l(),g(" ",e.associatedText," ")}}function ia(t,a){if(t&1&&(s(0,"option",17),c(1,"Custom"),r()),t&2){let i=d(3);f("value",i.CUSTOM_OPTION_VALUE)}}function na(t,a){if(t&1&&(s(0,"option",17),c(1),r()),t&2){let i=a.$implicit;f("value",i.value),l(),g(" ",i.verboseName!=null?i.verboseName:i.value," ")}}function aa(t,a){if(t&1&&(s(0,"select",46),p(1,ia,2,1,"option",17),U(2,na,2,2,"option",17,j),r()),t&2){let i=d(),e=i.$implicit,n=i.$index,o=d();f("formControlName",o.getControlName(e,n)+o.DROPDOWN_SUFFIX),l(),C(e.allowCustomOption?1:-1),l(),z(e.values)}}function oa(t,a){if(t&1&&P(0,"input",47),t&2){let i=d(),e=i.$implicit,n=i.$index,o=d();f("formControlName",o.getControlName(e,n))("type",e.type==="DOUBLE"?"number":"text")("placeholder",e.associatedText||"")}}function ra(t,a){if(t&1&&(s(0,"div",29)(1,"label"),c(2),r(),p(3,ta,3,2,"label",44),s(4,"div",45),p(5,aa,4,2,"select",46)(6,oa,1,3,"input",47),r()()),t&2){let i,e=a.$implicit,n=a.$index,o=d();f("title",e.description||""),l(2),R(e.title||e.name),l(),C(e.type==="BOOLEAN"?3:-1),l(2),C((e.type==="DOUBLE"||e.type==="STRING")&&e.values?5:-1),l(),C((e.type==="DOUBLE"||e.type==="STRING")&&(e.allowCustomOption&&((i=o.form.get(o.getControlName(e,n)+o.DROPDOWN_SUFFIX))==null?null:i.value)===o.CUSTOM_OPTION_VALUE||!e.values)?6:-1)}}var ei=(()=>{let a=class a{set content(e){if(!this.objectSelector){if(!e)return;this.objectSelector=e}this.changeLocalPrefix(this.localDirectory$.value)}constructor(e,n,o,m,h,D,O){this.dialogRef=e,this.yamcs=n,this.messageService=m,this.preferenceStore=h,this.snackBar=D,this.data=O,this.isDownloadEnabled=!1,this.isUploadEnabled=!1,this.dataSource=new L,this.displayedColumns=["name"],this.prefPrefix="filetransfer.",this.selectedBucket$=new b(null),this.breadcrumb$=new b([]),this.remoteBreadcrumb$=new b([]),this.lastFileListTime$=new b(""),this.lastFileListState$=new b(void 0),this.optionsMapping=new Map,this.DROPDOWN_SUFFIX="_Dropdown",this.CUSTOM_OPTION_VALUE="_CUSTOM_OPTION_",this.service=O.service,this.prefPrefix+=this.service.name+".",this.showBucketSize$=this.addPreference$("showBucketSize",!1),this.localDirectory$=this.addPreference$("localDirectory","");let I=this.service.localEntities&&this.service.localEntities.length?this.service.localEntities[0].name:"",se=this.service.remoteEntities&&this.service.remoteEntities.length?this.service.remoteEntities[0].name:"",q=this.addPreference$("localEntity",I),V=this.addPreference$("remoteEntity",se);this.storageClient=n.createStorageClient(),this.storageClient.getBuckets().then(y=>{if(this.dataSource.data=y||[],y){let Q=this.addPreference$("selectedBucket",y[0].name),G=y.find(W=>W.name===Q.value);this.selectBucket(G||y[0])}}),this.fileListSubscription=this.yamcs.yamcsClient.createRemoteFileListSubscription({instance:this.yamcs.instance,serviceName:this.service.name},y=>{if(y.destination==this.form.get("remoteEntity").value){let Q=this.remoteSelector.currentPrefix$.value||"";y.remotePath==Q&&(this.remoteSelector.setFolderContent(Q,y),this.lastFileListTime$.next(y.listTime),this.lastFileListState$.next(y.state))}});let H={};this.service.transferOptions?.forEach((y,Q)=>{let G=this.getControlName(y,Q);if(this.optionsMapping.set(y,G),y.type==="BOOLEAN"){let W=this.addPreference$("options."+y.name,y.default?.toLowerCase()==="true");H[G]=[W.value,[]]}else{let W=this.addPreference$("options."+y.name,y.default||""),pe=y.values&&y.values.find(ai=>ai.value===W.value);H[G]=[pe==null?W.value:"",[]],H[G+this.DROPDOWN_SUFFIX]=[pe!=null?W.value:this.CUSTOM_OPTION_VALUE,[]]}}),this.form=o.group(Be({localFilenames:["",[]],remoteFilenames:["",[]],localEntity:[q.value,this.service.localEntities&&this.service.localEntities.length&&Ve.required],remoteEntity:[V.value,this.service.remoteEntities&&this.service.remoteEntities.length&&Ve.required]},H)),this.form.get("localFilenames")?.valueChanges.subscribe(y=>{this.updateButtonStates(y,this.form.get("remoteFilenames")?.value,this.form.get("remoteFilenames")?.value)}),this.form.get("remoteFilenames")?.valueChanges.subscribe(y=>{this.updateButtonStates(this.form.get("localFilenames")?.value,y,this.form.get("remoteFilenames")?.value)}),this.form.get("localEntity")?.valueChanges.subscribe(y=>{this.setPreferenceValue("localEntity",y)}),this.form.get("remoteEntity")?.valueChanges.subscribe(y=>{this.setPreferenceValue("remoteEntity",y),this.getFileList(y,"")}),this.form.valueChanges.subscribe(async y=>{this.optionsMapping.forEach((Q,G)=>{let W=this.form.get(Q+this.DROPDOWN_SUFFIX)?.value,pe=W==null||W===this.CUSTOM_OPTION_VALUE?this.form.get(Q)?.value:W;switch(G.type){case"BOOLEAN":this.setPreferenceValue("options."+G.name,String(pe)==="true");break;case"DOUBLE":case"STRING":this.setPreferenceValue("options."+G.name,pe??"")}})});let K=this.addPreference$("remoteDirectory","");this.getFileList(V.value,K.value||"")}getControlName(e,n){return"option"+n+e.name.replace(/\s/g,"")}selectBucket(e){this.selectedBucket$.next(e),this.setPreferenceValue("selectedBucket",e.name)}updateButtonStates(e,n,o){this.isDownloadEnabled=this.service.capabilities.download&&this.selectedBucket$.value&&n!=""&&this.form.valid,this.isUploadEnabled=this.service.capabilities.upload&&e!=""&&this.form.valid}getSelectedRemoteFolderPath(){let e=this.remoteBreadcrumb$.value;return e.length!=0?e[e.length-1].prefix+"/":""}getSelectedLocalFolderPath(){let e=this.breadcrumb$.value;return e.length!=0?e[e.length-1].prefix+"/":""}async startDownload(){return this.startTransfer(this.form.get("remoteEntity")?.value,this.form.get("localEntity")?.value,this.form.get("remoteFilenames")?.value,this.form.get("localFilenames")?.value,this.getSelectedRemoteFolderPath(),this.getSelectedLocalFolderPath(),"DOWNLOAD")}async startUpload(){return this.startTransfer(this.form.get("localEntity")?.value,this.form.get("remoteEntity")?.value,this.form.get("localFilenames")?.value,this.form.get("remoteFilenames")?.value,this.getSelectedLocalFolderPath(),this.getSelectedRemoteFolderPath(),"UPLOAD")}async startTransfer(e,n,o,m,h,D,O){let I=o.trim().split("|");if(!I[0])return;let se=I.map(H=>{let K;try{K=this.getTransferPaths(H,m,h,D,O)}catch(y){throw this.messageService.showError(y),y}return O=="DOWNLOAD"&&(K=K.reverse()),this.yamcs.yamcsClient.createFileTransfer(this.yamcs.instance,this.service.name,{direction:O,bucket:this.selectedBucket$.value.name,objectName:K[0],remotePath:K[1],source:e,destination:n,options:this.getTransferOptions()})}),q,V=0;for(let H of se)try{await H}catch(K){q=K,V++}q&&(V===1?this.messageService.showError(q):V===se.length?this.messageService.showError("Failed to start any of the selected transfers. See server log."):this.messageService.showError("Some of the transfers failed to start. See server log.")),this.dialogRef.close()}getTransferPaths(e,n,o,m,h){e=e.trim(),e=e.startsWith(o)?e.replace(o,""):e;let D=o+e,O=e;if(h==="UPLOAD"&&this.service.capabilities.remotePath||h==="DOWNLOAD"){if(n=n.trim(),n.includes("|"))throw console.error(`Cannot ${h.toLowerCase()} file "${D}" to multiple destination filenames: ${n}`),new Error(`Cannot ${h.toLowerCase()} file "${D}" to multiple destination filenames: ${n}`);let I=n.startsWith(m)?n.replace(m,""):n;O=m+(I||e)}return[D,O]}requestFileList(){let e=this.remoteSelector.currentPrefix$.value||"";this.yamcs.yamcsClient.requestFileList(this.yamcs.instance,this.service.name,{source:this.form.value.localEntity,destination:this.form.value.remoteEntity,remotePath:e,options:this.getTransferOptions()})}getFileList(e,n){this.service.capabilities.fileList&&this.yamcs.yamcsClient.getFileList(this.yamcs.instance,this.service.name,{source:this.form.value.localEntity,destination:e,remotePath:n,options:this.getTransferOptions()}).then(o=>{this.remoteSelector.setFolderContent(n,o),this.setPreferenceValue("remoteDirectory",n),this.lastFileListTime$.next(o.listTime),this.lastFileListState$.next(o.state)})}getTransferOptions(){return this.service.transferOptions?.reduce((e,n)=>{let o=this.optionsMapping.get(n);if(!o)return e;let m=this.form.get(o+this.DROPDOWN_SUFFIX)?.value,h=m==null||m===this.CUSTOM_OPTION_VALUE?this.form.get(o)?.value:m;return n.type==="BOOLEAN"&&typeof h!="boolean"?h=String(h).toLowerCase()==="true":n.type==="DOUBLE"&&typeof h!="number"?h=Number(h):n.type==="STRING"&&typeof h!="string"&&(h=String(h)),qe(Be({},e),{[n.name]:h})},{})}updateLocalBreadcrumb(e){if(!e){this.breadcrumb$.next([]),this.setPreferenceValue("localDirectory","");return}e.endsWith("/")&&(e=e.substring(0,e.length-1));let n=[],o=e.split("/");for(let m=0;m<o.length;m++)n.push({name:o[m],prefix:o.slice(0,m+1).join("/")});this.breadcrumb$.next(n),this.setPreferenceValue("localDirectory",e)}changeLocalPrefix(e){e&&(e=e+"/"),this.objectSelector.changePrefix(e)}updateRemoteBreadcrumb(e){if(!e){this.remoteBreadcrumb$.next([]),this.getFileList(this.form.value.remoteEntity,"");return}let n=e.endsWith("/")?e.slice(0,-1):e,o=[],m=n.split("/");for(let h=0;h<m.length;h++)o.push({name:m[h],prefix:m.slice(0,h+1).join("/")});this.remoteBreadcrumb$.next(o),this.getFileList(this.form.value.remoteEntity,e)}changeRemotePrefix(e){e&&(e=e+"/"),this.remoteSelector.changePrefix(e)}clearSelection(e,n){e.currentTarget===e.target&&n.clearSelection()}onActionRequest(e){this.snackBar.open(`Running '${e.action.label}' ...`,void 0,{horizontalPosition:"end"});let n=this.form.value.remoteEntity;this.yamcs.yamcsClient.runFileAction(this.yamcs.instance,this.service.name,{remoteEntity:n,file:e.file,action:e.action.id}).then(()=>{this.snackBar.open(`'${e.action.label}' successful`,void 0,{duration:3e3,horizontalPosition:"end"})}).catch(o=>{this.messageService.showError(o),this.snackBar.open(`'${e.action.label}' failed`,void 0,{duration:3e3,horizontalPosition:"end"})})}toggleBucketSize(){this.setPreferenceValue("showBucketSize",!this.showBucketSize$.value)}addPreference$(e,n){return this.preferenceStore.addPreference$(this.prefPrefix+e,n)}setPreferenceValue(e,n){this.preferenceStore.setValue(this.prefPrefix+e,n)}ngOnDestroy(){this.fileListSubscription?.cancel()}};a.\u0275fac=function(n){return new(n||a)(x(yt),x(A),x(ht),x(Me),x(Bt),x(bt),x(St))},a.\u0275cmp=M({type:a,selectors:[["app-transfer-file-dialog"]],viewQuery:function(n,o){if(n&1&&(Ie(Mn,5),Ie($n,5)),n&2){let m;Re(m=Le())&&(o.content=m.first),Re(m=Le())&&(o.remoteSelector=m.first)}},standalone:!0,features:[$],decls:44,vars:28,consts:[["objectSelector",""],["remoteSelector",""],[1,"transfer-files"],[1,"ya-form",3,"formGroup"],["mat-dialog-close","",1,"close-button","mat-button"],[1,"grid-container"],[1,"buckets-column","header"],[1,"table-caption"],[3,"click"],[1,"buckets-column","table-wrapper"],["mat-table","",1,"ya-data-table","no-frame",3,"dataSource"],["cdkColumnDef","name"],["mat-cell","",3,"title",4,"cdkCellDef"],["mat-row","",3,"ngClass","click",4,"cdkRowDef","cdkRowDefColumns"],[1,"buckets-column","footer"],[1,"local-column","header"],["formControlName","localEntity",3,"ngStyle"],[3,"value"],[3,"showMargin"],[1,"local-column","table-wrapper",3,"click","ngClass"],["formControlName","localFilenames",3,"bucket","isMultiSelect","foldersOnly","noSelect","noFrame","allowFolderSelection"],[1,"local-column","footer"],["type","text","formControlName","localFilenames","placeholder","Local filename",3,"value"],[1,"ya-button","primary",3,"disabled"],[1,"remote-column","header",3,"ngClass"],[1,"remote-column","table-wrapper"],[1,"remote-column","footer"],["type","text","formControlName","remoteFilenames","placeholder","Remote filename",3,"value"],[1,"options-footer"],[3,"title"],["mat-cell","",3,"title"],[2,"vertical-align","middle"],[3,"value","total"],["mat-row","",3,"click","ngClass"],["icon","account_tree",3,"click","action"],[3,"label","action"],[3,"click","label","action"],["formControlName","localFilenames",3,"prefixChange","bucket","isMultiSelect","foldersOnly","noSelect","noFrame","allowFolderSelection"],[1,"ya-button","primary",3,"click","disabled"],["formControlName","remoteEntity",3,"ngStyle"],["title","Refresh file list",1,"lastFileListTime","mat-button","mat-primary"],["title","Refresh file list",1,"lastFileListTime","mat-button","mat-primary",3,"click"],[1,"remote-column","table-wrapper",3,"click"],["formControlName","remoteFilenames",3,"prefixChange","onAction","isMultiSelect","foldersOnly","noSelect","allowFolderSelection","fileListExtraColumns","fileActions"],[1,"checkbox-label"],[2,"display","flex","column-gap","8px","flex-wrap","wrap"],[3,"formControlName"],[2,"width","120px",3,"formControlName","type","placeholder"],["type","checkbox",3,"formControlName"]],template:function(n,o){if(n&1&&(s(0,"div",2)(1,"form",3)(2,"h2")(3,"button",4)(4,"mat-icon"),c(5,"close"),r()(),c(6),r(),s(7,"div",5)(8,"div",6)(9,"label",7),c(10,"Buckets "),s(11,"a",8),S("click",function(){return o.toggleBucketSize()}),c(12),r()()(),s(13,"div",9)(14,"table",10),F(15,11),p(16,Rn,8,6,"td",12),w(),p(17,Ln,2,5,"tr",13),r()(),p(18,An,5,1,"div",14),u(19,"async"),s(20,"div",15)(21,"label",7),c(22),s(23,"select",16),U(24,Vn,2,3,"option",17,j),r()(),p(26,Un,4,2,"ya-breadcrumb-trail",18),u(27,"async"),r(),s(28,"div",19),S("click",function(h){return o.clearSelection(h,o.objectSelector)}),p(29,zn,2,6,"app-object-selector",20),u(30,"async"),r(),s(31,"div",21),p(32,Hn,4,1,"div"),P(33,"input",22),p(34,Wn,4,1,"button",23),r(),p(35,Qn,9,10,"div",24)(36,Xn,3,8,"div",25),s(37,"div",26),p(38,Jn,4,1,"button",23)(39,Zn,1,1,"input",27)(40,ea,4,1,"div"),r(),s(41,"div",28),U(42,ra,7,5,"div",29,j),r()()()()),n&2){let m,h,D,O;l(),f("formGroup",o.form),l(5),g(" New ",o.service.capabilities.download&&o.service.capabilities.upload?"Transfer":o.service.capabilities.upload?"Upload":"Download"," "),l(6),g("",o.showBucketSize$.value?"hide":"show"," size"),l(2),f("dataSource",o.dataSource),l(3),f("cdkRowDefColumns",o.displayedColumns),l(),C((m=_(19,19,o.selectedBucket$))?18:-1,m),l(4),g("Local ",o.service.localEntities&&o.service.localEntities.length?"Entity":""," "),l(),f("ngStyle",!(o.service.localEntities&&o.service.localEntities.length)&&k(25,Jt)),l(),z(o.service.localEntities),l(2),C((h=_(27,21,o.breadcrumb$))?26:-1,h),l(2),f("ngClass",J(26,Zt,!o.service.capabilities.fileList)),l(),C((D=_(30,23,o.selectedBucket$))?29:-1,D),l(3),C(o.service.localEntities&&o.service.localEntities.length?32:-1),l(),f("value",(O=o.form.get("localFilenames"))==null?null:O.value),l(),C(o.service.capabilities.upload?34:-1),l(),C(o.service.remoteEntities&&o.service.remoteEntities.length||o.service.capabilities.fileList?35:-1),l(),C(o.service.capabilities.fileList?36:-1),l(2),C(o.service.capabilities.download?38:-1),l(),C(o.service.capabilities.download||o.service.capabilities.remotePath?39:-1),l(),C(o.service.remoteEntities&&o.service.remoteEntities.length?40:-1),l(2),z(o.service.transferOptions)}},dependencies:[Kt,B,_e,Ze,N,mt,ut,_t,lt,rt,ft,st,ct,dt,pt,xe,he,Ce,Tt,ee,te,ie,ne,Nt,$t,$e,ae,oe,Qt],styles:[".mat-mdc-dialog-container{border-radius:0;position:relative}.transfer-files[_ngcontent-%COMP%]{height:100%}.close-button[_ngcontent-%COMP%]{float:right;padding:0;min-width:0;line-height:normal;vertical-align:bottom}.close-button[_ngcontent-%COMP%]:hover{opacity:70%;transform:scale(.95)}.ya-form[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column}.grid-container[_ngcontent-%COMP%]{display:grid;grid-auto-flow:column;grid-template-rows:[header] min-content [tables] auto [footer] min-content [options-footer] min-content;grid-template-columns:[buckets] 140px [local] auto [remote] auto;column-gap:8px;flex:1;min-height:0}.header[_ngcontent-%COMP%]{grid-row:header;position:relative;overflow:hidden}.table-wrapper[_ngcontent-%COMP%]{grid-row:tables;overflow:auto;border:1px solid #d3d3d3}.footer[_ngcontent-%COMP%]{grid-row:footer;margin-top:8px;display:flex;flex-wrap:wrap;align-items:flex-start;justify-content:stretch;gap:8px;height:fit-content}.options-footer[_ngcontent-%COMP%]{grid-row:options-footer;grid-column:local / span 2;margin-top:8px;display:flex;flex-wrap:wrap;align-items:flex-start;justify-content:stretch;gap:8px;height:fit-content}.buckets-column[_ngcontent-%COMP%]{grid-column:buckets}.local-column[_ngcontent-%COMP%]{grid-column:local}.remote-column[_ngcontent-%COMP%]{grid-column:remote}.buckets-column.header[_ngcontent-%COMP%] > label[_ngcontent-%COMP%]{position:absolute;bottom:0;line-height:24px}.buckets-column.header[_ngcontent-%COMP%] > label[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]{float:right;font-weight:initial;color:#707070;-webkit-user-select:none;user-select:none;cursor:pointer}.buckets-column.header[_ngcontent-%COMP%] > label[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]:hover{text-decoration:underline}.buckets-column[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{cursor:pointer;-webkit-user-select:none;user-select:none;display:flex;column-gap:10px;flex-wrap:wrap;justify-content:space-between}.local-column.table-wrapper.no-filelist[_ngcontent-%COMP%]{grid-column:local / span 2}.local-column.footer[_ngcontent-%COMP%]{flex-wrap:wrap-reverse;align-items:flex-end}.remote-column.header.no-filelist[_ngcontent-%COMP%] > ya-breadcrumb-trail[_ngcontent-%COMP%]{visibility:hidden}label.table-caption[_ngcontent-%COMP%]{margin:0;bottom:0}label.table-caption[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{display:inline-block;width:auto;margin:0 4px}ya-breadcrumb-trail[_ngcontent-%COMP%]{display:inline-block}.lastFileListTime[_ngcontent-%COMP%]{min-width:0;padding:0;font-size:12px;line-height:24px;float:right}.lastFileListTime[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{font-size:16px;width:16px;height:16px;vertical-align:sub}.lastFileListTime[_ngcontent-%COMP%]:hover   .mat-icon[_ngcontent-%COMP%]{transform:rotate(360deg);transition:transform .3s ease-in-out}.footer[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .options-footer[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .footer[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], .options-footer[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{margin:2px 0 0}.footer[_ngcontent-%COMP%] > button[_ngcontent-%COMP%], .footer[_ngcontent-%COMP%] > input[_ngcontent-%COMP%]{margin-top:7px;flex-shrink:1}.footer[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{flex-grow:1}.footer[_ngcontent-%COMP%] > input[_ngcontent-%COMP%]{flex-grow:5}table.ya-data-table[_ngcontent-%COMP%]{width:100%}.ya-data-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border:none}.checkbox-label[_ngcontent-%COMP%]{font-weight:unset;font-size:unset;letter-spacing:unset;line-height:unset;color:unset;text-transform:unset;cursor:unset;position:unset;display:inline-block;margin:3px 0 0;-webkit-user-select:none;user-select:none}.checkbox-label[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin:0 3px 0 4px}"]});let t=a;return t})();var He=(t,a)=>({c:t,service:a}),We=t=>({hasTransferType:t});function la(t,a){if(t&1){let i=E();s(0,"button",9),S("click",function(){let n=v(i).$implicit,o=d(2);return T(o.switchService(n))}),c(1),r()}if(t&2){let i=a.$implicit;l(),g(" ",i.name," ")}}function sa(t,a){if(t&1&&(s(0,"button",6),c(1),u(2,"async"),r(),s(3,"mat-menu",7,0),U(5,la,2,1,"button",8,j),r()),t&2){let i,e=X(4),n=d();f("matMenuTriggerFor",e),l(),g(" ",((i=_(2,2,n.service$))==null?null:i.name)||"select service"," \u25BE "),l(4),z(a)}}function ca(t,a){if(t&1){let i=E();s(0,"button",11),S("click",function(){v(i);let n=d(),o=d();return T(o.downloadFile(n))}),s(1,"mat-icon"),c(2),r(),c(3),r()}if(t&2){let i=d();l(2),R(i.capabilities.download&&i.capabilities.upload?"cloud":i.capabilities.upload?"cloud_upload":"cloud_download"),l(),g(" New ",i.capabilities.download&&i.capabilities.upload?"transfer":i.capabilities.upload?"upload":"download"," ")}}function ma(t,a){if(t&1&&p(0,ca,4,2,"button",10),t&2){let i=a,e=d();C(e.mayControlFileTransfers()&&(i.capabilities.download||i.capabilities.upload)?0:-1)}}function da(t,a){t&1&&c(0),t&2&&g(" (",a,") ")}function pa(t,a){t&1&&c(0),t&2&&g(" (",a,") ")}function fa(t,a){t&1&&c(0),t&2&&g(" (",a,") ")}function ua(t,a){if(t&1&&(s(0,"nav",12)(1,"a",13,1),c(3," ONGOING "),p(4,da,1,1),u(5,"async"),r(),s(6,"a",14,2),c(8," FAILED "),p(9,pa,1,1),u(10,"async"),r(),s(11,"a",15,3),c(13," SUCCESSFUL "),p(14,fa,1,1),u(15,"async"),r()(),s(16,"div",16)(17,"mat-tab-nav-panel",null,4),P(19,"router-outlet"),r()()),t&2){let i,e,n,o=a,m=X(2),h=X(7),D=X(12),O=X(18),I=d();f("mat-stretch-tabs",!1)("tabPanel",O),l(),f("queryParams",we(20,He,I.yamcs.context,o.name))("active",m.isActive)("state",J(23,We,o.capabilities.hasTransferType)),l(3),C((i=_(5,14,I.ongoingCount$))?4:-1,i),l(2),f("queryParams",we(25,He,I.yamcs.context,o.name))("active",h.isActive)("state",J(28,We,o.capabilities.hasTransferType)),l(3),C((e=_(10,16,I.failedCount$))?9:-1,e),l(2),f("queryParams",we(30,He,I.yamcs.context,o.name))("active",D.isActive)("state",J(33,We,o.capabilities.hasTransferType)),l(3),C((n=_(15,18,I.successfulCount$))?14:-1,n)}}function _a(t,a){t&1&&(s(0,"ya-empty-message",5)(1,"p"),c(2,"This instance has no file transfer services configured."),r()())}var ti=(()=>{let a=class a{constructor(e,n,o,m,h,D,O){this.yamcs=e,this.dialog=o,this.route=m,this.router=h,this.authService=O,this.services$=new b([]),this.service$=new b(null),this.ongoingTransfersById=new Map,this.failedTransfersById=new Map,this.successfulTransfersById=new Map,this.ongoingCount$=new b(0),this.failedCount$=new b(0),this.successfulCount$=new b(0),this.dirty=!1,n.setTitle("File transfer");let se=m.snapshot.queryParamMap.get("service");e.yamcsClient.getFileTransferServices(e.instance).then(q=>{this.services$.next(q.services);let V=null;for(let H of q.services)if(se===H.name){V=H;break}!V&&!se&&(V=q.services.length?q.services[0]:null),V&&this.switchService(V)}),this.syncSubscription=D.sync(()=>{this.dirty&&(this.ongoingCount$.next(this.ongoingTransfersById.size),this.failedCount$.next(this.failedTransfersById.size),this.successfulCount$.next(this.successfulTransfersById.size))})}switchService(e){this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParams:{service:e?.name||null},queryParamsHandling:"merge",state:{hasTransferType:e?.capabilities.hasTransferType}}),this.ongoingCount$.next(0),this.failedCount$.next(0),this.successfulCount$.next(0),this.ongoingTransfersById.clear(),this.failedTransfersById.clear(),this.successfulTransfersById.clear(),this.transferSubscription&&this.transferSubscription.cancel(),this.service$.next(e),e&&(this.transferSubscription=this.yamcs.yamcsClient.createTransferSubscription({instance:this.yamcs.instance,serviceName:e.name},n=>{switch(n.state){case"RUNNING":case"PAUSED":case"CANCELLING":case"QUEUED":this.ongoingTransfersById.set(n.id,n);break;case"FAILED":this.ongoingTransfersById.delete(n.id),this.failedTransfersById.set(n.id,n);break;case"COMPLETED":this.ongoingTransfersById.delete(n.id),this.successfulTransfersById.set(n.id,n);break}this.dirty=!0}))}downloadFile(e){let n=this.dialog.open(ei,{width:"70%",height:"100%",autoFocus:!1,position:{right:"0"},panelClass:"dialog-full-size",data:{service:e}})}mayControlFileTransfers(){return this.authService.getUser().hasSystemPrivilege("ControlFileTransfers")}ngOnDestroy(){this.syncSubscription?.unsubscribe(),this.transferSubscription?.cancel()}};a.\u0275fac=function(n){return new(n||a)(x(A),x(tt),x(vt),x(Z),x(nt),x(re),x(Vt))},a.\u0275cmp=M({type:a,selectors:[["ng-component"]],standalone:!0,features:[$],decls:11,vars:12,consts:[["serviceMenu","matMenu"],["rla","routerLinkActive"],["rlb","routerLinkActive"],["rlc","routerLinkActive"],["tabPanel",""],["headerTitle","File Transfer"],["mat-button","",3,"matMenuTriggerFor"],[1,"ya-menu"],["mat-menu-item",""],["mat-menu-item","",3,"click"],["mat-button","","color","primary"],["mat-button","","color","primary",3,"click"],["mat-tab-nav-bar","",1,"secondary",3,"mat-stretch-tabs","tabPanel"],["mat-tab-link","","routerLink","./ongoing-transfers","routerLinkActive","",3,"queryParams","active","state"],["mat-tab-link","","routerLink","./failed-transfers","routerLinkActive","",3,"queryParams","active","state"],["mat-tab-link","","routerLink","./successful-transfers","routerLinkActive","",3,"queryParams","active","state"],[1,"outlet-wrapper"]],template:function(n,o){if(n&1&&(s(0,"app-instance-page")(1,"app-instance-toolbar"),c(2," File transfer \xA0\xA0\xA0\xA0 "),p(3,sa,7,4),u(4,"async"),p(5,ma,1,1),u(6,"async"),r(),p(7,ua,20,35),u(8,"async"),p(9,_a,3,0,"ya-empty-message",5),u(10,"async"),r()),n&2){let m,h,D;l(3),C((m=_(4,4,o.services$))?3:-1,m),l(2),C((h=_(6,6,o.service$))?5:-1,h),l(2),C((D=_(8,8,o.service$))?7:-1,D),l(2),C(_(10,10,o.services$).length?-1:9)}},dependencies:[Ut,jt,B,N,it,at,ot,gt,ee,Ct,Pe,xt,kt,Mt,Ot,It],styles:[".outlet-wrapper[_ngcontent-%COMP%]{overflow:auto;position:absolute;inset:49px 0 0}"],changeDetection:0});let t=a;return t})();var ha=()=>["transferType"],Ca=()=>[],ii=(()=>{let a=class a{constructor(e,n,o){this.yamcs=e,this.serviceName$=new b(null),this.dataSource=new L,this.transfersById=new Map,this.dirty=!1,this.hasTransferType=!1,this.hasTransferType=history.state.hasTransferType,this.storageClient=e.createStorageClient(),this.queryParamSubscription=n.queryParamMap.subscribe(m=>{let h=m.get("service");this.serviceName$.next(h),this.switchService(h)}),this.syncSubscription=o.sync(()=>{if(this.dirty){let m=[...this.transfersById.values()];m.sort((h,D)=>this.compareTransfers(h.transfer,D.transfer)),this.dataSource.data=m,this.dirty=!1}})}compareTransfers(e,n){if(e.state!=n.state){if(e.state=="RUNNING")return-1;if(n.state=="RUNNING")return 1}let o=e.creationTime||e.startTime||"";return(n.creationTime||n.startTime||"").localeCompare(o)}switchService(e){this.dirty=!1,this.transfersById.clear(),this.dataSource.data=[],this.transferSubscription&&this.transferSubscription.cancel(),e&&(this.transferSubscription=this.yamcs.yamcsClient.createTransferSubscription({instance:this.yamcs.instance,serviceName:e},n=>{switch(n.state){case"RUNNING":case"PAUSED":case"CANCELLING":case"QUEUED":this.setOrUpdate(n);break;case"FAILED":case"COMPLETED":this.transfersById.delete(n.id);break}this.dirty=!0}))}setOrUpdate(e){let n=this.transfersById.get(e.id);if(n)n.updateTransfer(e);else{let o=e.objectName?this.storageClient.getObjectURL(e.bucket,e.objectName):"";n=new le(e,o),this.transfersById.set(e.id,n)}}ngOnDestroy(){this.syncSubscription?.unsubscribe(),this.queryParamSubscription?.unsubscribe(),this.transferSubscription?.cancel()}};a.\u0275fac=function(n){return new(n||a)(x(A),x(Z),x(re))},a.\u0275cmp=M({type:a,selectors:[["ng-component"]],standalone:!0,features:[$],decls:3,vars:8,consts:[[1,"panel-content"],[3,"serviceName","dataSource","showActions","extraColumns"]],template:function(n,o){n&1&&(s(0,"div",0),P(1,"app-file-transfer-table",1),u(2,"async"),r()),n&2&&(l(),f("serviceName",_(2,4,o.serviceName$))("dataSource",o.dataSource)("showActions",!0)("extraColumns",o.hasTransferType?k(6,ha):k(7,Ca)))},dependencies:[B,N,Se],encapsulation:2,changeDetection:0});let t=a;return t})();var xa=()=>["transferType"],ga=()=>[],ni=(()=>{let a=class a{constructor(e,n,o){this.yamcs=e,this.serviceName$=new b(null),this.dataSource=new L,this.transfersById=new Map,this.dirty=!1,this.hasTransferType=!1,this.hasTransferType=history.state.hasTransferType,this.storageClient=e.createStorageClient(),this.queryParamSubscription=n.queryParamMap.subscribe(m=>{let h=m.get("service");this.serviceName$.next(h),this.switchService(h)}),this.syncSubscription=o.sync(()=>{if(this.dirty){let m=[...this.transfersById.values()];m.sort((h,D)=>this.compareTransfers(h.transfer,D.transfer)),this.dataSource.data=m,this.dirty=!1}})}compareTransfers(e,n){let o=e.creationTime||e.startTime||"";return(n.creationTime||n.startTime||"").localeCompare(o)}switchService(e){this.dirty=!1,this.transfersById.clear(),this.dataSource.data=[],this.transferSubscription&&this.transferSubscription.cancel(),e&&(this.transferSubscription=this.yamcs.yamcsClient.createTransferSubscription({instance:this.yamcs.instance,serviceName:e},n=>{switch(n.state){case"COMPLETED":this.setOrUpdate(n);break}this.dirty=!0}))}setOrUpdate(e){let n=this.transfersById.get(e.id);if(n)n.updateTransfer(e);else{let o=e.objectName?this.storageClient.getObjectURL(e.bucket,e.objectName):"";n=new le(e,o),this.transfersById.set(e.id,n)}}ngOnDestroy(){this.syncSubscription?.unsubscribe(),this.queryParamSubscription?.unsubscribe(),this.transferSubscription?.cancel()}};a.\u0275fac=function(n){return new(n||a)(x(A),x(Z),x(re))},a.\u0275cmp=M({type:a,selectors:[["app-successful-transfers-tab"]],standalone:!0,features:[$],decls:3,vars:7,consts:[[1,"panel-content"],[3,"serviceName","dataSource","extraColumns"]],template:function(n,o){n&1&&(s(0,"div",0),P(1,"app-file-transfer-table",1),u(2,"async"),r()),n&2&&(l(),f("serviceName",_(2,3,o.serviceName$))("dataSource",o.dataSource)("extraColumns",o.hasTransferType?k(5,xa):k(6,ga)))},dependencies:[B,N,Se],encapsulation:2,changeDetection:0});let t=a;return t})();var Vo=[{path:"",canActivate:[Ht,zt],canActivateChild:[Wt],runGuardsAndResolvers:"always",component:qt,children:[{path:"",component:ti,children:[{path:"",pathMatch:"full",redirectTo:"ongoing-transfers"},{path:"ongoing-transfers",component:ii},{path:"failed-transfers",component:Gt},{path:"successful-transfers",component:ni}]}]}];export{Vo as ROUTES};
