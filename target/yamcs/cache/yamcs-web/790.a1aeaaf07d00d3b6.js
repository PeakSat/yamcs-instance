"use strict";(self.webpackChunkwebapp=self.webpackChunkwebapp||[]).push([[790],{4790:(_i,M,o)=>{o.r(M),o.d(M,{FileTransferModule:()=>di});var G=o(4421),v=o(1896),H=o(664),Q=o(1293),X=o(9295),m=o(9538),d=o(5619),K=o(6321),V=o(4829),W=o(9360),ee=o(2420),B=o(8251),ie=o(1687);var ae=o(7921),se=o(7398),re=o(3997);class D{constructor(s,t){this.transfer=s,this.objectUrl=t,this.originalTransfer$=new d.X(s),this.transfer$=this.originalTransfer$.pipe(function ne(i,s=K.z){return function te(i){return(0,W.e)((s,t)=>{let n=!1,a=null;s.subscribe((0,B.x)(t,r=>{n=!0,a=r})),(0,V.Xf)(i).subscribe((0,B.x)(t,()=>{if(n){n=!1;const r=a;a=null,t.next(r)}},ee.Z))})}((0,ie.F)(i,s))}(500),(0,ae.O)(s)),this.state$=this.originalTransfer$.pipe((0,se.U)(n=>n.state),(0,re.x)())}updateTransfer(s){this.transfer=s,this.originalTransfer$.next(s)}}var e=o(5879),u=o(6516),_=o(6814);function le(i,s){1&i&&(e.TgZ(0,"th",24),e._uU(1,"Started"),e.qZA())}function ce(i,s){if(1&i&&(e.TgZ(0,"td",25),e._uU(1),e.ALo(2,"datetime"),e.qZA()),2&i){const t=s.$implicit;e.xp6(1),e.hij(" ",e.lcZ(2,1,t.transfer.startTime)," ")}}function oe(i,s){1&i&&(e.TgZ(0,"th",26),e._uU(1,"Local entity"),e.qZA())}function ue(i,s){if(1&i&&(e.TgZ(0,"td",25),e._uU(1),e.qZA()),2&i){const t=s.$implicit;let n;e.xp6(1),e.hij(" ",null!==(n=null!==(n=null==t.transfer.localEntity?null:t.transfer.localEntity.name)&&void 0!==n?n:null==t.transfer.localEntity?null:t.transfer.localEntity.id)&&void 0!==n?n:"-"," ")}}function fe(i,s){1&i&&(e.TgZ(0,"th",24),e._uU(1,"Local file"),e.qZA())}function me(i,s){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"storageUrl"),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.Oqu(e.xi3(2,1,t.transfer.objectName,t.transfer.bucket)||"-")}}function de(i,s){if(1&i&&(e.TgZ(0,"a",29),e._uU(1),e.ALo(2,"storageUrl"),e.qZA()),2&i){const t=e.oxw().$implicit;e.Q6J("href",t.objectUrl,e.LSH),e.xp6(1),e.Oqu(e.xi3(2,2,t.transfer.objectName,t.transfer.bucket)||"-")}}function _e(i,s){if(1&i&&(e.TgZ(0,"td",25),e.YNc(1,me,3,4,"span",27),e.YNc(2,de,3,5,"ng-template",null,28,e.W1O),e.qZA()),2&i){const t=s.$implicit,n=e.MAs(3);e.xp6(1),e.Q6J("ngIf","DOWNLOAD"===t.transfer.direction&&"COMPLETED"!==t.transfer.state||!t.objectUrl)("ngIfElse",n)}}function pe(i,s){1&i&&(e.TgZ(0,"th",30),e._uU(1,"Direction"),e.qZA())}function he(i,s){1&i&&(e.ynx(0),e._uU(1,"\u27f5"),e.BQk())}function ge(i,s){1&i&&(e.ynx(0),e._uU(1,"\u27f6"),e.BQk())}function Te(i,s){if(1&i&&(e.TgZ(0,"td",31),e.YNc(1,he,2,0,"ng-container",32),e.YNc(2,ge,2,0,"ng-container",32),e.qZA()),2&i){const t=s.$implicit;e.xp6(1),e.Q6J("ngIf","DOWNLOAD"===t.transfer.direction),e.xp6(1),e.Q6J("ngIf","UPLOAD"===t.transfer.direction)}}function xe(i,s){1&i&&(e.TgZ(0,"th",26),e._uU(1,"Remote entity"),e.qZA())}function ye(i,s){if(1&i&&(e.TgZ(0,"td",25),e._uU(1),e.qZA()),2&i){const t=s.$implicit;let n;e.xp6(1),e.hij(" ",null!==(n=null!==(n=null==t.transfer.remoteEntity?null:t.transfer.remoteEntity.name)&&void 0!==n?n:null==t.transfer.remoteEntity?null:t.transfer.remoteEntity.id)&&void 0!==n?n:"-"," ")}}function be(i,s){1&i&&(e.TgZ(0,"th",24),e._uU(1,"Remote file"),e.qZA())}function ve(i,s){if(1&i&&(e.TgZ(0,"td",25),e._uU(1),e.qZA()),2&i){const t=s.$implicit;e.xp6(1),e.Oqu(t.transfer.remotePath||"-")}}function Ce(i,s){1&i&&(e.TgZ(0,"th",33),e._uU(1,"Size"),e.qZA())}function Fe(i,s){if(1&i&&(e.TgZ(0,"td",25),e._uU(1),e.ALo(2,"formatBytes"),e.qZA()),2&i){const t=s.$implicit;let n;e.xp6(1),e.Oqu(null!==(n=e.lcZ(2,1,t.transfer.totalSize))&&void 0!==n?n:"-")}}function we(i,s){1&i&&(e.TgZ(0,"th",34),e._uU(1,"Status"),e.qZA())}function Se(i,s){if(1&i&&(e.ynx(0),e._uU(1),e.ALo(2,"titlecase"),e.BQk()),2&i){const t=s.ngIf;e.xp6(1),e.hij(" ",e.lcZ(2,1,t)||"-"," ")}}function Ze(i,s){if(1&i&&(e.TgZ(0,"td",25),e.YNc(1,Se,3,3,"ng-container",32),e.ALo(2,"async"),e.qZA()),2&i){const t=s.$implicit;e.xp6(1),e.Q6J("ngIf",e.lcZ(2,1,t.state$))}}function Ne(i,s){1&i&&(e.TgZ(0,"th",33),e._uU(1,"Transferred"),e.qZA())}function Oe(i,s){if(1&i&&(e.TgZ(0,"td",25),e._uU(1),e.ALo(2,"formatBytes"),e.qZA()),2&i){const t=s.$implicit;let n;e.xp6(1),e.Oqu(null!==(n=e.lcZ(2,1,t.transfer.sizeTransferred))&&void 0!==n?n:"-")}}function Ae(i,s){1&i&&(e.TgZ(0,"th",34),e._uU(1,"Transfer type"),e.qZA())}function Pe(i,s){if(1&i&&(e.TgZ(0,"td",25),e._uU(1),e.qZA()),2&i){const t=s.$implicit;e.xp6(1),e.Oqu(t.transfer.transferType||"-")}}function De(i,s){1&i&&e._UZ(0,"th",35)}function ke(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"ya-text-action",39),e.NdJ("click",function(){e.CHM(t);const a=e.oxw(3).$implicit,r=e.oxw();return e.KtG(r.pauseTransfer(a))}),e._uU(1,"PAUSE"),e.qZA()}}function Ue(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"ya-text-action",40),e.NdJ("click",function(){e.CHM(t);const a=e.oxw(3).$implicit,r=e.oxw();return e.KtG(r.resumeTransfer(a))}),e._uU(1,"RESUME"),e.qZA()}}function Ee(i,s){if(1&i){const t=e.EpF();e.ynx(0),e.YNc(1,ke,2,0,"ya-text-action",36),e.YNc(2,Ue,2,0,"ya-text-action",37),e.TgZ(3,"ya-text-action",38),e.NdJ("click",function(){e.CHM(t);const a=e.oxw(2).$implicit,r=e.oxw();return e.KtG(r.cancelTransfer(a))}),e._uU(4,"CANCEL"),e.qZA(),e.BQk()}if(2&i){const t=s.ngIf;e.xp6(1),e.Q6J("ngIf","RUNNING"===t),e.xp6(1),e.Q6J("ngIf","PAUSED"===t)}}function $e(i,s){if(1&i&&(e.ynx(0),e.YNc(1,Ee,5,2,"ng-container",32),e.ALo(2,"async"),e.BQk()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.Q6J("ngIf",e.lcZ(2,1,t.state$))}}function Ie(i,s){if(1&i&&(e.TgZ(0,"td",25),e.YNc(1,$e,3,3,"ng-container",32),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.showActions)}}function Le(i,s){if(1&i&&e._UZ(0,"ya-progress",45),2&i){const t=e.oxw().ngIf,n=e.oxw(2);e.Q6J("value",n.transferPercent(t))("total",1)}}function Me(i,s){if(1&i&&(e.TgZ(0,"span",46),e._uU(1),e.qZA()),2&i){const t=e.oxw().ngIf;e.xp6(1),e.hij(" ",t.failureReason," ")}}function Qe(i,s){if(1&i&&(e.TgZ(0,"div",42),e.YNc(1,Le,1,2,"ya-progress",43),e.TgZ(2,"span"),e._uU(3),e.ALo(4,"formatBytes"),e.qZA(),e.YNc(5,Me,2,1,"span",44),e.qZA()),2&i){const t=s.ngIf;e.xp6(1),e.Q6J("ngIf","RUNNING"===t.state||"PAUSED"===t.state||"CANCELLING"===t.state),e.xp6(2),e.Oqu(e.lcZ(4,3,t.sizeTransferred)),e.xp6(2),e.Q6J("ngIf",t.failureReason)}}function Be(i,s){if(1&i&&(e.TgZ(0,"td",25),e.ALo(1,"async"),e.YNc(2,Qe,6,5,"div",41),e.ALo(3,"async"),e.qZA()),2&i){const t=s.$implicit,n=e.oxw();e.uIk("colspan",e.lcZ(1,2,n.displayedColumns$).length),e.xp6(2),e.Q6J("ngIf",e.lcZ(3,4,t.transfer$))}}function Je(i,s){1&i&&e._UZ(0,"tr",47)}function qe(i,s){1&i&&e._UZ(0,"tr",48),2&i&&e.ekj("nodetail","COMPLETED"===s.$implicit.transfer.state)}function Ye(i,s){1&i&&e._UZ(0,"tr",49)}const Re=function(){return["detail"]};let k=(()=>{class i{constructor(t,n){this.yamcs=t,this.messageService=n,this.extraColumns=[],this.defaultColumns=["startTime","localEntity","localFile","direction","remoteEntity","remoteFile","size","status"],this.displayedColumns$=new d.X(this.defaultColumns),this.isIncomplete=(a,r)=>"COMPLETED"!==r.transfer.state,this.dataSource=new m.by,this.showActions=!1}ngOnChanges(){this.displayedColumns$.next([...this.defaultColumns,...this.extraColumns,"actions"])}transferPercent(t){return 0!=t.totalSize?t.sizeTransferred/t.totalSize:0}pauseTransfer(t){this.yamcs.yamcsClient.pauseFileTransfer(this.yamcs.instance,this.serviceName,t.transfer.id).catch(a=>{this.messageService.showError(a)})}resumeTransfer(t){this.yamcs.yamcsClient.resumeFileTransfer(this.yamcs.instance,this.serviceName,t.transfer.id).catch(a=>{this.messageService.showError(a)})}cancelTransfer(t){this.yamcs.yamcsClient.cancelFileTransfer(this.yamcs.instance,this.serviceName,t.transfer.id).catch(a=>{this.messageService.showError(a)})}static#e=this.\u0275fac=function(n){return new(n||i)(e.Y36(u.C8),e.Y36(u.ez))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["app-file-transfer-table"]],inputs:{extraColumns:"extraColumns",serviceName:"serviceName",dataSource:"dataSource",showActions:"showActions"},features:[e.TTD],decls:41,vars:10,consts:[["mat-table","","multiTemplateDataRows","",1,"ya-data-table","expand",3,"dataSource"],["matColumnDef","startTime"],["mat-header-cell","","style","width: 200px",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","localEntity"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","localFile"],["matColumnDef","direction"],["mat-header-cell","","width","1",4,"matHeaderCellDef"],["mat-cell","","style","text-align: center",4,"matCellDef"],["matColumnDef","remoteEntity"],["matColumnDef","remoteFile"],["matColumnDef","size"],["mat-header-cell","","style","width: 70px",4,"matHeaderCellDef"],["matColumnDef","status"],["mat-header-cell","","style","width: 100px",4,"matHeaderCellDef"],["matColumnDef","transferred"],["matColumnDef","transferType"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["matColumnDef","detail"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","","class","item-row",3,"nodetail",4,"matRowDef","matRowDefColumns"],["mat-row","","class","item-detail",4,"matRowDef","matRowDefColumns","matRowDefWhen"],["mat-header-cell","",2,"width","200px"],["mat-cell",""],["mat-header-cell",""],[4,"ngIf","ngIfElse"],["clickable",""],["download","",3,"href"],["mat-header-cell","","width","1"],["mat-cell","",2,"text-align","center"],[4,"ngIf"],["mat-header-cell","",2,"width","70px"],["mat-header-cell","",2,"width","100px"],["mat-header-cell","",1,"expand"],["icon","pause_circle_outline",3,"click",4,"ngIf"],["icon","play_circle_outline",3,"click",4,"ngIf"],["icon","not_interested",3,"click"],["icon","pause_circle_outline",3,"click"],["icon","play_circle_outline",3,"click"],["class","detail-layout",4,"ngIf"],[1,"detail-layout"],["width","200px",3,"value","total",4,"ngIf"],["class","error",4,"ngIf"],["width","200px",3,"value","total"],[1,"error"],["mat-header-row",""],["mat-row","",1,"item-row"],["mat-row","",1,"item-detail"]],template:function(n,a){1&n&&(e.TgZ(0,"table",0),e.ynx(1,1),e.YNc(2,le,2,0,"th",2),e.YNc(3,ce,3,3,"td",3),e.BQk(),e.ynx(4,4),e.YNc(5,oe,2,0,"th",5),e.YNc(6,ue,2,1,"td",3),e.BQk(),e.ynx(7,6),e.YNc(8,fe,2,0,"th",2),e.YNc(9,_e,4,2,"td",3),e.BQk(),e.ynx(10,7),e.YNc(11,pe,2,0,"th",8),e.YNc(12,Te,3,2,"td",9),e.BQk(),e.ynx(13,10),e.YNc(14,xe,2,0,"th",5),e.YNc(15,ye,2,1,"td",3),e.BQk(),e.ynx(16,11),e.YNc(17,be,2,0,"th",2),e.YNc(18,ve,2,1,"td",3),e.BQk(),e.ynx(19,12),e.YNc(20,Ce,2,0,"th",13),e.YNc(21,Fe,3,3,"td",3),e.BQk(),e.ynx(22,14),e.YNc(23,we,2,0,"th",15),e.YNc(24,Ze,3,3,"td",3),e.BQk(),e.ynx(25,16),e.YNc(26,Ne,2,0,"th",13),e.YNc(27,Oe,3,3,"td",3),e.BQk(),e.ynx(28,17),e.YNc(29,Ae,2,0,"th",15),e.YNc(30,Pe,2,1,"td",3),e.BQk(),e.ynx(31,18),e.YNc(32,De,1,0,"th",19),e.YNc(33,Ie,2,1,"td",3),e.BQk(),e.ynx(34,20),e.YNc(35,Be,4,6,"td",3),e.BQk(),e.YNc(36,Je,1,0,"tr",21),e.ALo(37,"async"),e.YNc(38,qe,1,2,"tr",22),e.ALo(39,"async"),e.YNc(40,Ye,1,0,"tr",23),e.qZA()),2&n&&(e.Q6J("dataSource",a.dataSource),e.xp6(36),e.Q6J("matHeaderRowDef",e.lcZ(37,5,a.displayedColumns$)),e.xp6(2),e.Q6J("matRowDefColumns",e.lcZ(39,7,a.displayedColumns$)),e.xp6(2),e.Q6J("matRowDefColumns",e.DdM(9,Re))("matRowDefWhen",a.isIncomplete))},dependencies:[_.O5,m.BZ,m.fO,m.as,m.w1,m.Dz,m.nj,m.ge,m.ev,m.XQ,m.Gk,u.t1,u.ll,_.Ov,_.rS,u.id,u.bP,u.hD],styles:["tr.item-row[_ngcontent-%COMP%]:not(.nodetail)   td[_ngcontent-%COMP%]{border-bottom-width:0}tr.item-detail[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding-left:40px!important}.detail-layout[_ngcontent-%COMP%]{display:flex;align-items:center}.detail-layout[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin-left:20px}.error[_ngcontent-%COMP%]{color:#dc143c}"],changeDetection:0})}return i})();const je=function(){return["transferType"]},ze=function(){return[]};let J=(()=>{class i{constructor(t,n,a){this.yamcs=t,this.serviceName$=new d.X(null),this.dataSource=new m.by,this.transfersById=new Map,this.dirty=!1,this.hasTransferType=!1,this.hasTransferType=history.state.hasTransferType,this.storageClient=t.createStorageClient(),this.queryParamSubscription=n.queryParamMap.subscribe(r=>{const l=r.get("service");this.serviceName$.next(l),this.switchService(l)}),this.syncSubscription=a.sync(()=>{if(this.dirty){const r=[...this.transfersById.values()];r.sort((l,f)=>this.compareTransfers(l.transfer,f.transfer)),this.dataSource.data=r,this.dirty=!1}})}compareTransfers(t,n){return(n.creationTime||n.startTime||"").localeCompare(t.creationTime||t.startTime||"")}switchService(t){this.dirty=!1,this.transfersById.clear(),this.dataSource.data=[],this.transferSubscription&&this.transferSubscription.cancel(),t&&(this.transferSubscription=this.yamcs.yamcsClient.createTransferSubscription({instance:this.yamcs.instance,serviceName:t},n=>{"FAILED"===n.state&&this.setOrUpdate(n),this.dirty=!0}))}setOrUpdate(t){let n=this.transfersById.get(t.id);if(n)n.updateTransfer(t);else{const a=t.objectName?this.storageClient.getObjectURL(t.bucket,t.objectName):"";n=new D(t,a),this.transfersById.set(t.id,n)}}ngOnDestroy(){this.syncSubscription&&this.syncSubscription.unsubscribe(),this.queryParamSubscription&&this.queryParamSubscription.unsubscribe(),this.transferSubscription&&this.transferSubscription.cancel()}static#e=this.\u0275fac=function(n){return new(n||i)(e.Y36(u.C8),e.Y36(v.gz),e.Y36(u.jF))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["app-failed-transfers-tab"]],decls:3,vars:7,consts:[[1,"panel-content"],[3,"serviceName","dataSource","extraColumns"]],template:function(n,a){1&n&&(e.TgZ(0,"div",0),e._UZ(1,"app-file-transfer-table",1),e.ALo(2,"async"),e.qZA()),2&n&&(e.xp6(1),e.Q6J("serviceName",e.lcZ(2,3,a.serviceName$))("dataSource",a.dataSource)("extraColumns",a.hasTransferType?e.DdM(5,je):e.DdM(6,ze)))},dependencies:[k,_.Ov],encapsulation:2,changeDetection:0})}return i})();var A=o(5861),g=o(6223),P=o(7700),w=o(4643),U=o(617),Ge=o(6757);function He(i,s){1&i&&(e.TgZ(0,"th",15),e._uU(1,"Name"),e.qZA())}function Xe(i,s){if(1&i&&(e.ynx(0),e.TgZ(1,"mat-icon",18),e._uU(2,"folder"),e.qZA(),e._uU(3),e.ALo(4,"filename"),e.BQk()),2&i){const t=e.oxw().$implicit;let n;e.xp6(3),e.hij(" ",null!==(n=t.displayName)&&void 0!==n?n:e.lcZ(4,1,t.name),"/ ")}}function Ke(i,s){if(1&i&&(e.ynx(0),e.TgZ(1,"mat-icon",18),e._uU(2,"description"),e.qZA(),e.TgZ(3,"span",19),e._uU(4),e.ALo(5,"filename"),e.qZA(),e.BQk()),2&i){const t=e.oxw().$implicit,n=e.oxw(2);let a;e.xp6(3),e.Q6J("ngClass",n.foldersOnly?"disabled":""),e.xp6(1),e.Oqu(null!==(a=t.displayName)&&void 0!==a?a:e.lcZ(5,2,t.name))}}function Ve(i,s){if(1&i&&(e.TgZ(0,"td",16),e.YNc(1,Xe,5,3,"ng-container",17),e.YNc(2,Ke,6,4,"ng-container",17),e.qZA()),2&i){const t=s.$implicit;e.xp6(1),e.Q6J("ngIf",t.folder),e.xp6(1),e.Q6J("ngIf",!t.folder)}}function We(i,s){1&i&&(e.TgZ(0,"th",20),e._uU(1,"Date modified"),e.qZA())}function et(i,s){if(1&i&&(e.TgZ(0,"td",16)(1,"span",19),e._uU(2),e.ALo(3,"datetime"),e.qZA()()),2&i){const t=s.$implicit,n=e.oxw(2);e.xp6(1),e.Q6J("ngClass",!t.folder&&n.foldersOnly?"disabled":""),e.xp6(1),e.Oqu(e.lcZ(3,2,t.modified)||"-")}}function tt(i,s){1&i&&(e.TgZ(0,"th",21),e._uU(1,"Size"),e.qZA())}function it(i,s){if(1&i&&(e.TgZ(0,"td",16)(1,"span",19),e._uU(2),e.ALo(3,"formatBytes"),e.qZA()()),2&i){const t=s.$implicit,n=e.oxw(2);e.xp6(1),e.Q6J("ngClass",!t.folder&&n.foldersOnly?"disabled":""),e.xp6(1),e.Oqu(e.lcZ(3,2,t.size)||"-")}}function nt(i,s){if(1&i&&(e.TgZ(0,"td",22),e.ALo(1,"async"),e.TgZ(2,"mat-icon",23),e._uU(3,"description"),e.qZA(),e._uU(4," .. "),e.qZA()),2&i){const t=e.oxw(2);let n;e.uIk("colspan",null==(n=e.lcZ(1,1,t.displayedColumns$))?null:n.length)}}function at(i,s){if(1&i&&(e.TgZ(0,"th",26),e._uU(1),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.Oqu(t.label)}}function st(i,s){if(1&i&&(e.ynx(0),e._uU(1),e.BQk()),2&i){const t=e.oxw().$implicit,n=e.oxw().$implicit;let a;e.xp6(1),e.hij(" ",null!==(a=t.extra[n.id])&&void 0!==a?a:"-"," ")}}function rt(i,s){1&i&&(e.ynx(0),e._uU(1,"-"),e.BQk())}function lt(i,s){if(1&i&&(e.TgZ(0,"td",16),e.YNc(1,st,2,1,"ng-container",17),e.YNc(2,rt,2,0,"ng-container",17),e.qZA()),2&i){const t=s.$implicit;e.xp6(1),e.Q6J("ngIf",t.extra),e.xp6(1),e.Q6J("ngIf",!t.extra)}}function ct(i,s){1&i&&(e.ynx(0,24),e.YNc(1,at,2,1,"th",25),e.YNc(2,lt,3,2,"td",4),e.BQk()),2&i&&e.Q6J("cdkColumnDef",s.$implicit.id)}function ot(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"tr",27),e.NdJ("click",function(){e.CHM(t);const a=e.oxw(2);return e.KtG(a.clearSelection())}),e.qZA()}}function ut(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"tr",28),e.NdJ("click",function(){e.CHM(t);const a=e.oxw(2);return e.KtG(a.selectParent())}),e.ALo(1,"async"),e.qZA()}if(2&i){const t=e.oxw(2);e.ekj("hide",!e.lcZ(1,2,t.currentPrefix$))}}function ft(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"tr",29),e.NdJ("click",function(a){const l=e.CHM(t).$implicit,f=e.oxw(2);return e.KtG(f.selectFile(a,l))}),e.qZA()}if(2&i){const t=s.$implicit,n=e.oxw(2);e.ekj("selected",n.isSelected(t))}}const mt=function(i){return{"no-select":i}},dt=function(){return["parent"]};function _t(i,s){if(1&i&&(e.TgZ(0,"table",1),e.ynx(1,2),e.YNc(2,He,2,0,"th",3),e.YNc(3,Ve,3,2,"td",4),e.BQk(),e.ynx(4,5),e.YNc(5,We,2,0,"th",6),e.YNc(6,et,4,4,"td",4),e.BQk(),e.ynx(7,7),e.YNc(8,tt,2,0,"th",8),e.YNc(9,it,4,4,"td",4),e.BQk(),e.ynx(10,9),e.YNc(11,nt,5,3,"td",10),e.BQk(),e.YNc(12,ct,3,1,"ng-container",11),e.ALo(13,"async"),e.YNc(14,ot,1,0,"tr",12),e.ALo(15,"async"),e.YNc(16,ut,2,4,"tr",13),e.YNc(17,ft,1,2,"tr",14),e.ALo(18,"async"),e.qZA()),2&i){const t=e.oxw();e.Q6J("dataSource",t.dataSource)("ngClass",e.VKq(12,mt,t.noSelect)),e.xp6(12),e.Q6J("ngForOf",e.lcZ(13,6,t.extraColumns$)),e.xp6(2),e.Q6J("cdkHeaderRowDef",e.lcZ(15,8,t.displayedColumns$)),e.xp6(2),e.Q6J("cdkHeaderRowDef",e.DdM(14,dt)),e.xp6(1),e.Q6J("cdkRowDefColumns",e.lcZ(18,10,t.displayedColumns$))}}let pt=(()=>{class i{constructor(t){this.changeDetection=t,this.noSelect=!1,this.allowFolderSelection=!1,this.fileListExtraColumns=[],this.prefixChange=new e.vpe,this.displayedColumns$=new d.X(["name","size","modified"]),this.extraColumns$=new d.X([]),this.dataSource=new m.by([]),this.currentPrefix$=new d.X(null),this.selectedFileNames=new Set,this.onChange=n=>{},this.onTouched=()=>{}}ngOnChanges(){this.loadCurrentFolder();const t=["name"];for(const n of this.fileListExtraColumns)t.push(n.id);t.push("size"),t.push("modified"),this.extraColumns$.next(this.fileListExtraColumns),this.displayedColumns$.next(t)}changePrefix(t){this.loadCurrentFolder(t)}loadCurrentFolder(t){(t||null)!==this.currentPrefix$.value&&this.setFolderContent(t,{files:[],destination:"",remotePath:"",listTime:""})}setFolderContent(t,n){this.changeDir(n);const a=t||null;a!==this.currentPrefix$.value&&(this.currentPrefix$.next(a),this.prefixChange.emit(a))}changeDir(t){this.selectedFileNames.clear(),this.updateFileNames();const n=[],a=t.remotePath?t.remotePath+"/":"";for(const r of t.files||[])n.push({folder:r.isDirectory,name:a+r.name,displayName:r.displayName??r.name,modified:r.modified,size:r.size,extra:r.extra||{}});this.dataSource.data=n,this.changeDetection.detectChanges()}selectFile(t,n){if(n.folder)this.allowFolderSelection&&t.ctrlKey&&t.shiftKey?this.flipRowSelection(n):this.loadCurrentFolder(n.name);else if(!this.foldersOnly){if(this.isMultiSelect&&t.ctrlKey)this.flipRowSelection(n);else if(this.isMultiSelect&&t.shiftKey)if(0!=this.selectedFileNames.size&&this.lastSelected&&this.lastSelected.name!==n.name){let a=!1;for(const r of this.dataSource.data)(r.name===n.name||r.name===this.lastSelected.name)&&(a=!a),a&&this.selectedFileNames.add(r.name);this.selectedFileNames.add(n.name)}else this.flipRowSelection(n);else 1==this.selectedFileNames.size&&this.selectedFileNames.has(n.name)?this.selectedFileNames.clear():(this.selectedFileNames.clear(),this.selectedFileNames.add(n.name));this.selectedFileNames.has(n.name)&&(this.lastSelected=n)}this.updateFileNames()}flipRowSelection(t){this.selectedFileNames.has(t.name)?this.selectedFileNames.delete(t.name):this.selectedFileNames.add(t.name)}updateFileNames(){this.onChange(Array.from(this.selectedFileNames).join("|"))}isSelected(t){return this.selectedFileNames.has(t.name)}selectParent(){const t=this.currentPrefix$.value;if(t){const n=t.slice(0,-1),a=n.lastIndexOf("/"),r=-1!=a?n.substring(0,a+1):void 0;this.selectedFileNames.clear(),this.updateFileNames(),this.loadCurrentFolder(r)}}clearSelection(){this.selectedFileNames.clear(),this.updateFileNames(),this.changeDetection.detectChanges()}writeValue(t){this.path=t}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouched=t}ngOnDestroy(){this.selectionSubscription?.unsubscribe()}static#e=this.\u0275fac=function(n){return new(n||i)(e.Y36(e.sBO))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["remote-file-selector"]],inputs:{isMultiSelect:"isMultiSelect",foldersOnly:"foldersOnly",path:"path",noSelect:"noSelect",allowFolderSelection:"allowFolderSelection",fileListExtraColumns:"fileListExtraColumns"},outputs:{prefixChange:"prefixChange"},features:[e._Bn([{provide:g.JU,useExisting:(0,e.Gpc)(()=>i),multi:!0}]),e.TTD],decls:1,vars:1,consts:[["mat-table","","class","ya-data-table","style","width: 100%",3,"dataSource","ngClass",4,"ngIf"],["mat-table","",1,"ya-data-table",2,"width","100%",3,"dataSource","ngClass"],["cdkColumnDef","name"],["mat-header-cell","","style","width: 400px",4,"cdkHeaderCellDef"],["mat-cell","",4,"cdkCellDef"],["cdkColumnDef","modified"],["mat-header-cell","","style","width: 200px",4,"cdkHeaderCellDef"],["cdkColumnDef","size"],["mat-header-cell","","style","width: 70px",4,"cdkHeaderCellDef"],["cdkColumnDef","parent"],["mat-header-cell","",4,"cdkHeaderCellDef"],[3,"cdkColumnDef",4,"ngFor","ngForOf"],["mat-header-row","",3,"click",4,"cdkHeaderRowDef"],["mat-row","","class","parent-row",3,"hide","click",4,"cdkHeaderRowDef"],["mat-row","",3,"selected","click",4,"cdkRowDef","cdkRowDefColumns"],["mat-header-cell","",2,"width","400px"],["mat-cell",""],[4,"ngIf"],[1,"icon12",2,"vertical-align","middle"],[3,"ngClass"],["mat-header-cell","",2,"width","200px"],["mat-header-cell","",2,"width","70px"],["mat-header-cell",""],[1,"icon12",2,"vertical-align","middle","visibility","hidden"],[3,"cdkColumnDef"],["mat-header-cell","","width","1",4,"cdkHeaderCellDef"],["mat-header-cell","","width","1"],["mat-header-row","",3,"click"],["mat-row","",1,"parent-row",3,"click"],["mat-row","",3,"click"]],template:function(n,a){1&n&&e.YNc(0,_t,19,15,"table",0),2&n&&e.Q6J("ngIf",a.dataSource)},dependencies:[_.mk,_.sg,_.O5,w.Sq,w.O_,w.D5,w.fo,w.s$,U.Hw,m.BZ,m.ge,m.ev,m.XQ,m.Gk,_.Ov,u.id,u.XB,u.bP],styles:["table[_ngcontent-%COMP%]{cursor:pointer}.folder[_ngcontent-%COMP%]:hover{text-decoration:underline}  .parent-row td{font-size:12px;line-height:16px;color:#000000a7;padding:7px 8px 8px 0;border-bottom:1px solid rgba(0,0,0,.12)}.hide[_ngcontent-%COMP%]{display:none}.disabled[_ngcontent-%COMP%]{color:#d3d3d3}.no-select[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}"],changeDetection:0})}return i})();const ht=["objectSelector"],gt=["remoteSelector"];function Tt(i,s){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"formatBytes"),e.ALo(3,"formatBytes"),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.AsE(" ",e.lcZ(2,2,t.size),"/",e.lcZ(3,4,t.maxSize)," ")}}function xt(i,s){if(1&i&&e._UZ(0,"ya-progress",31),2&i){const t=e.oxw().$implicit;e.Q6J("value",t.size)("total",t.maxSize)}}function yt(i,s){if(1&i&&(e.TgZ(0,"td",28),e.ALo(1,"formatBytes"),e.TgZ(2,"span")(3,"mat-icon",29),e._uU(4,"shopping_basket"),e.qZA(),e._uU(5),e.qZA(),e.YNc(6,Tt,4,6,"span",18),e.YNc(7,xt,1,2,"ya-progress",30),e.qZA()),2&i){const t=s.$implicit,n=e.oxw();e.Q6J("title",e.lcZ(1,4,t.maxSize-t.size)+" available"),e.xp6(5),e.hij("\xa0 ",t.name,""),e.xp6(1),e.Q6J("ngIf",n.showBucketSize$.value),e.xp6(1),e.Q6J("ngIf",n.showBucketSize$.value)}}const bt=function(i){return{selected:i}};function vt(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"tr",32),e.NdJ("click",function(){const r=e.CHM(t).$implicit,l=e.oxw();return e.KtG(l.selectBucket(r))}),e.ALo(1,"async"),e.qZA()}if(2&i){const t=s.$implicit,n=e.oxw();e.Q6J("ngClass",e.VKq(3,bt,t===e.lcZ(1,1,n.selectedBucket$)))}}function Ct(i,s){if(1&i&&(e.TgZ(0,"div",33)(1,"div")(2,"label"),e._uU(3,"Target bucket"),e.qZA(),e._uU(4),e.qZA()()),2&i){const t=s.ngIf;e.xp6(4),e.hij(" ",t.name," ")}}function Ft(i,s){if(1&i&&(e.TgZ(0,"option",34),e._uU(1),e.qZA()),2&i){const t=s.$implicit;e.Q6J("value",t.name),e.xp6(1),e.AsE("",t.name," [id=",t.id,"]")}}function wt(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"ya-breadcrumb",38),e.NdJ("click",function(){const r=e.CHM(t).$implicit,l=e.oxw(2);return e.KtG(l.changeLocalPrefix(r.prefix))}),e.qZA()}2&i&&e.Q6J("label",s.$implicit.name)("action",!0)}function St(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"ya-breadcrumb-trail",35)(1,"ya-breadcrumb",36),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.changeLocalPrefix(""))}),e.qZA(),e.YNc(2,wt,1,2,"ya-breadcrumb",37),e.qZA()}if(2&i){const t=s.ngIf;e.Q6J("showMargin",!1),e.xp6(1),e.Q6J("action",!0),e.xp6(1),e.Q6J("ngForOf",t)}}function Zt(i,s){if(1&i){const t=e.EpF();e.ynx(0),e.TgZ(1,"app-object-selector",39,40),e.NdJ("prefixChange",function(a){e.CHM(t);const r=e.oxw();return e.KtG(r.updateLocalBreadcrumb(a))}),e.qZA(),e.BQk()}if(2&i){const t=s.ngIf;e.xp6(1),e.Q6J("bucket",t)("isMultiSelect",!0)("foldersOnly",!1)("noSelect",!0)("allowFolderSelection",!0)}}function Nt(i,s){if(1&i&&(e.TgZ(0,"div")(1,"label"),e._uU(2,"Local entity"),e.qZA(),e._uU(3),e.qZA()),2&i){const t=e.oxw();let n;e.xp6(3),e.hij(" ",(null==(n=t.form.get("localEntity"))?null:n.value)||"-"," ")}}function Ot(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"button",41),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.startUpload())}),e._uU(1,"UPLOAD "),e.TgZ(2,"mat-icon"),e._uU(3,"chevron_right"),e.qZA()()}if(2&i){const t=e.oxw();e.Q6J("disabled",!t.isUploadEnabled)}}function At(i,s){if(1&i&&(e.TgZ(0,"option",34),e._uU(1),e.qZA()),2&i){const t=s.$implicit;e.Q6J("value",t.name),e.xp6(1),e.AsE("",t.name," [id=",t.id,"]")}}function Pt(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"ya-breadcrumb",38),e.NdJ("click",function(){const r=e.CHM(t).$implicit,l=e.oxw(3);return e.KtG(l.changeRemotePrefix(r.prefix))}),e.qZA()}2&i&&e.Q6J("label",s.$implicit.name)("action",!0)}function Dt(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"ya-breadcrumb-trail",35)(1,"ya-breadcrumb",36),e.NdJ("click",function(){e.CHM(t);const a=e.oxw(2);return e.KtG(a.changeRemotePrefix(""))}),e.qZA(),e.YNc(2,Pt,1,2,"ya-breadcrumb",37),e.qZA()}if(2&i){const t=s.ngIf;e.Q6J("showMargin",!1),e.xp6(1),e.Q6J("action",!0),e.xp6(1),e.Q6J("ngForOf",t)}}function kt(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"a",45),e.NdJ("click",function(){e.CHM(t);const a=e.oxw(2);return e.KtG(a.requestFileList())}),e.TgZ(1,"mat-icon"),e._uU(2,"refresh"),e.qZA(),e._uU(3),e.ALo(4,"datetime"),e.ALo(5,"async"),e.ALo(6,"async"),e.ALo(7,"async"),e.qZA()}if(2&i){const t=e.oxw(2);e.xp6(3),e.AsE(" ",e.lcZ(4,2,e.lcZ(5,4,t.lastFileListTime$))," ",e.lcZ(6,6,t.lastFileListState$)?"("+e.lcZ(7,8,t.lastFileListState$)+")":""," ")}}const q=function(i){return{"no-filelist":i}},Y=function(){return{visibility:"hidden"}};function Ut(i,s){if(1&i&&(e.TgZ(0,"div",42)(1,"label",5),e._uU(2),e.TgZ(3,"select",43),e.YNc(4,At,2,3,"option",15),e.qZA()(),e.YNc(5,Dt,3,3,"ya-breadcrumb-trail",16),e.ALo(6,"async"),e.YNc(7,kt,8,10,"a",44),e.qZA()),2&i){const t=e.oxw();e.Q6J("ngClass",e.VKq(8,q,!t.service.capabilities.fileList)),e.xp6(2),e.hij("Remote ",t.service.remoteEntities&&t.service.remoteEntities.length?"Entity":""," "),e.xp6(1),e.Q6J("ngStyle",!(t.service.remoteEntities&&t.service.remoteEntities.length)&&e.DdM(10,Y)),e.xp6(1),e.Q6J("ngForOf",t.service.remoteEntities),e.xp6(1),e.Q6J("ngIf",e.lcZ(6,6,t.remoteBreadcrumb$)),e.xp6(2),e.Q6J("ngIf",t.service.capabilities.fileList)}}const Et=function(){return[]};function $t(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"div",46),e.NdJ("click",function(a){e.CHM(t);const r=e.MAs(3),l=e.oxw();return e.KtG(l.clearSelection(a,r))}),e.ynx(1),e.TgZ(2,"remote-file-selector",47,48),e.NdJ("prefixChange",function(a){e.CHM(t);const r=e.oxw();return e.KtG(r.updateRemoteBreadcrumb(a))}),e.qZA(),e.BQk(),e.qZA()}if(2&i){const t=e.oxw();e.xp6(2),e.Q6J("isMultiSelect",!0)("foldersOnly",!1)("noSelect",!0)("allowFolderSelection",!0)("fileListExtraColumns",t.service.capabilities.fileListExtraColumns||e.DdM(5,Et))}}function It(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"button",41),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.startDownload())}),e.TgZ(1,"mat-icon"),e._uU(2,"chevron_left"),e.qZA(),e._uU(3," DOWNLOAD"),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("disabled",!t.isDownloadEnabled)}}function Lt(i,s){if(1&i&&e._UZ(0,"input",49),2&i){const t=e.oxw();let n;e.Q6J("value",null==(n=t.form.get("remoteFilenames"))?null:n.value)}}function Mt(i,s){if(1&i&&(e.TgZ(0,"div")(1,"label"),e._uU(2,"Remote entity"),e.qZA(),e._uU(3),e.qZA()),2&i){const t=e.oxw();let n;e.xp6(3),e.hij(" ",(null==(n=t.form.get("remoteEntity"))?null:n.value)||"-"," ")}}function Qt(i,s){if(1&i&&(e.TgZ(0,"label",55),e._UZ(1,"input",56),e._uU(2),e.qZA()),2&i){const t=e.oxw(),n=t.$implicit,a=t.index,r=e.oxw();e.xp6(1),e.Q6J("formControlName",r.getControlName(n,a)),e.xp6(1),e.hij(" ",n.associatedText," ")}}function Bt(i,s){if(1&i&&(e.TgZ(0,"option",34),e._uU(1,"Custom"),e.qZA()),2&i){const t=e.oxw(3);e.Q6J("value",t.CUSTOM_OPTION_VALUE)}}function Jt(i,s){if(1&i&&(e.TgZ(0,"option",34),e._uU(1),e.qZA()),2&i){const t=s.$implicit;e.Q6J("value",t.value),e.xp6(1),e.Oqu(null!=t.verboseName?t.verboseName:t.value)}}function qt(i,s){if(1&i&&(e.TgZ(0,"select",57),e.YNc(1,Bt,2,1,"option",58),e.YNc(2,Jt,2,2,"option",15),e.qZA()),2&i){const t=e.oxw(),n=t.$implicit,a=t.index,r=e.oxw();e.Q6J("formControlName",r.getControlName(n,a)+r.DROPDOWN_SUFFIX),e.xp6(1),e.Q6J("ngIf",n.allowCustomOption),e.xp6(1),e.Q6J("ngForOf",n.values)}}function Yt(i,s){if(1&i&&e._UZ(0,"input",59),2&i){const t=e.oxw(),n=t.$implicit,a=t.index,r=e.oxw();e.Q6J("formControlName",r.getControlName(n,a))("type","DOUBLE"===n.type?"number":"text")("placeholder",n.associatedText||"")}}function Rt(i,s){if(1&i&&(e.TgZ(0,"div",50)(1,"label"),e._uU(2),e.qZA(),e.YNc(3,Qt,3,2,"label",51),e.TgZ(4,"div",52),e.YNc(5,qt,3,3,"select",53),e.YNc(6,Yt,1,3,"input",54),e.qZA()()),2&i){const t=s.$implicit,n=s.index,a=e.oxw();let r;e.Q6J("title",t.description||""),e.xp6(2),e.Oqu(t.title||t.name),e.xp6(1),e.Q6J("ngIf","BOOLEAN"===t.type),e.xp6(2),e.Q6J("ngIf",("DOUBLE"===t.type||"STRING"===t.type)&&t.values),e.xp6(1),e.Q6J("ngIf",("DOUBLE"===t.type||"STRING"===t.type)&&(t.allowCustomOption&&(null==(r=a.form.get(a.getControlName(t,n)+a.DROPDOWN_SUFFIX))?null:r.value)===a.CUSTOM_OPTION_VALUE||!t.values))}}let jt=(()=>{class i{set content(t){if(!this.objectSelector){if(!t)return;this.objectSelector=t}this.changeLocalPrefix(this.localDirectory$.value)}constructor(t,n,a,r,l,f){var h=this;this.dialogRef=t,this.yamcs=n,this.messageService=r,this.preferenceStore=l,this.data=f,this.isDownloadEnabled=!1,this.isUploadEnabled=!1,this.dataSource=new m.by,this.displayedColumns=["name"],this.prefPrefix="filetransfer.",this.selectedBucket$=new d.X(null),this.breadcrumb$=new d.X([]),this.remoteBreadcrumb$=new d.X([]),this.lastFileListTime$=new d.X(""),this.lastFileListState$=new d.X(void 0),this.optionsMapping=new Map,this.DROPDOWN_SUFFIX="_Dropdown",this.CUSTOM_OPTION_VALUE="_CUSTOM_OPTION_",this.service=f.service,this.prefPrefix+=this.service.name+".",this.showBucketSize$=this.addPreference$("showBucketSize",!1),this.localDirectory$=this.addPreference$("localDirectory","");const S=this.service.remoteEntities&&this.service.remoteEntities.length?this.service.remoteEntities[0].name:"",C=this.addPreference$("localEntity",this.service.localEntities&&this.service.localEntities.length?this.service.localEntities[0].name:""),T=this.addPreference$("remoteEntity",S);this.storageClient=n.createStorageClient(),this.storageClient.getBuckets().then(c=>{if(this.dataSource.data=c||[],c){const y=this.addPreference$("selectedBucket",c[0].name),F=c.find(b=>b.name===y.value);this.selectBucket(F||c[0])}}),this.fileListSubscription=this.yamcs.yamcsClient.createRemoteFileListSubscription({instance:this.yamcs.instance,serviceName:this.service.name},c=>{if(c.destination==this.form.get("remoteEntity").value){const y=this.remoteSelector.currentPrefix$.value||"";c.remotePath==y&&(this.remoteSelector.setFolderContent(y,c),this.lastFileListTime$.next(c.listTime),this.lastFileListState$.next(c.state))}});let x={};this.service.transferOptions?.forEach((c,y)=>{let F=this.getControlName(c,y);if(this.optionsMapping.set(c,F),"BOOLEAN"===c.type){const b=this.addPreference$("options."+c.name,"true"===c.default?.toLowerCase());x[F]=[b.value,[]]}else{const b=this.addPreference$("options."+c.name,c.default||"");let Z=c.values&&c.values.find(O=>O.value===b.value);x[F]=[null==Z?b.value:"",[]],x[F+this.DROPDOWN_SUFFIX]=[null!=Z?b.value:this.CUSTOM_OPTION_VALUE,[]]}}),this.form=a.group({localFilenames:["",[]],remoteFilenames:["",[]],localEntity:[C.value,this.service.localEntities&&this.service.localEntities.length&&g.kI.required],remoteEntity:[T.value,this.service.remoteEntities&&this.service.remoteEntities.length&&g.kI.required],...x}),this.form.get("localFilenames")?.valueChanges.subscribe(c=>{this.updateButtonStates(c,this.form.get("remoteFilenames")?.value,this.form.get("remoteFilenames")?.value)}),this.form.get("remoteFilenames")?.valueChanges.subscribe(c=>{this.updateButtonStates(this.form.get("localFilenames")?.value,c,this.form.get("remoteFilenames")?.value)}),this.form.get("localEntity")?.valueChanges.subscribe(c=>{this.setPreferenceValue("localEntity",c)}),this.form.get("remoteEntity")?.valueChanges.subscribe(c=>{this.setPreferenceValue("remoteEntity",c),this.getFileList(c,"")}),this.form.valueChanges.subscribe(function(){var c=(0,A.Z)(function*(y){h.optionsMapping.forEach((F,b)=>{const Z=h.form.get(F+h.DROPDOWN_SUFFIX)?.value;let O=null==Z||Z===h.CUSTOM_OPTION_VALUE?h.form.get(F)?.value:Z;switch(b.type){case"BOOLEAN":h.setPreferenceValue("options."+b.name,"true"===String(O));break;case"DOUBLE":case"STRING":h.setPreferenceValue("options."+b.name,O??"")}})});return function(y){return c.apply(this,arguments)}}());const N=this.addPreference$("remoteDirectory","");this.getFileList(T.value,N.value||"")}getControlName(t,n){return"option"+n+t.name.replace(/\s/g,"")}selectBucket(t){this.selectedBucket$.next(t),this.setPreferenceValue("selectedBucket",t.name)}updateButtonStates(t,n,a){this.isDownloadEnabled=this.service.capabilities.download&&this.selectedBucket$.value&&""!=n&&this.form.valid,this.isUploadEnabled=this.service.capabilities.upload&&""!=t&&this.form.valid}getSelectedRemoteFolderPath(){const t=this.remoteBreadcrumb$.value;return 0!=t.length?t[t.length-1].prefix+"/":""}getSelectedLocalFolderPath(){const t=this.breadcrumb$.value;return 0!=t.length?t[t.length-1].prefix+"/":""}startDownload(){var t=this;return(0,A.Z)(function*(){return t.startTransfer(t.form.get("remoteEntity")?.value,t.form.get("localEntity")?.value,t.form.get("remoteFilenames")?.value,t.form.get("localFilenames")?.value,t.getSelectedRemoteFolderPath(),t.getSelectedLocalFolderPath(),"DOWNLOAD")})()}startUpload(){var t=this;return(0,A.Z)(function*(){return t.startTransfer(t.form.get("localEntity")?.value,t.form.get("remoteEntity")?.value,t.form.get("localFilenames")?.value,t.form.get("remoteFilenames")?.value,t.getSelectedLocalFolderPath(),t.getSelectedRemoteFolderPath(),"UPLOAD")})()}startTransfer(t,n,a,r,l,f,h){var p=this;return(0,A.Z)(function*(){const S=a.trim().split("|");if(!S[0])return;const C=S.map(N=>{let c;try{c=p.getTransferPaths(N,r,l,f,h)}catch(y){throw p.messageService.showError(y),y}return"DOWNLOAD"==h&&(c=c.reverse()),p.yamcs.yamcsClient.createFileTransfer(p.yamcs.instance,p.service.name,{direction:h,bucket:p.selectedBucket$.value.name,objectName:c[0],remotePath:c[1],source:t,destination:n,options:p.getTransferOptions()})});let T,x=0;for(const N of C)try{yield N}catch(c){T=c,x++}T&&p.messageService.showError(1===x?T:x===C.length?"Failed to start any of the selected transfers. See server log.":"Some of the transfers failed to start. See server log."),p.dialogRef.close()})()}getTransferPaths(t,n,a,r,l){const f=a+(t=(t=t.trim()).startsWith(a)?t.replace(a,""):t);let h=t;if("UPLOAD"===l&&this.service.capabilities.remotePath||"DOWNLOAD"===l){if((n=n.trim()).includes("|"))throw console.error(`Cannot ${l.toLowerCase()} file "${f}" to multiple destination filenames: ${n}`),new Error(`Cannot ${l.toLowerCase()} file "${f}" to multiple destination filenames: ${n}`);h=r+((n.startsWith(r)?n.replace(r,""):n)||t)}return[f,h]}requestFileList(){this.yamcs.yamcsClient.requestFileList(this.yamcs.instance,this.service.name,{source:this.form.value.localEntity,destination:this.form.value.remoteEntity,remotePath:this.remoteSelector.currentPrefix$.value||"",options:this.getTransferOptions()})}getFileList(t,n){this.service.capabilities.fileList&&this.yamcs.yamcsClient.getFileList(this.yamcs.instance,this.service.name,{source:this.form.value.localEntity,destination:t,remotePath:n,options:this.getTransferOptions()}).then(a=>{this.remoteSelector.setFolderContent(n,a),this.setPreferenceValue("remoteDirectory",n),this.lastFileListTime$.next(a.listTime),this.lastFileListState$.next(a.state)})}getTransferOptions(){return this.service.transferOptions?.reduce((t,n)=>{const a=this.optionsMapping.get(n);if(!a)return t;const r=this.form.get(a+this.DROPDOWN_SUFFIX)?.value;let l=null==r||r===this.CUSTOM_OPTION_VALUE?this.form.get(a)?.value:r;return"BOOLEAN"===n.type&&"boolean"!=typeof l?l="true"===String(l).toLowerCase():"DOUBLE"===n.type&&"number"!=typeof l?l=Number(l):"STRING"===n.type&&"string"!=typeof l&&(l=String(l)),{...t,[n.name]:l}},{})}updateLocalBreadcrumb(t){if(!t)return this.breadcrumb$.next([]),void this.setPreferenceValue("localDirectory","");t.endsWith("/")&&(t=t.substring(0,t.length-1));const n=[],a=t.split("/");for(let r=0;r<a.length;r++)n.push({name:a[r],prefix:a.slice(0,r+1).join("/")});this.breadcrumb$.next(n),this.setPreferenceValue("localDirectory",t)}changeLocalPrefix(t){t&&(t+="/"),this.objectSelector.changePrefix(t)}updateRemoteBreadcrumb(t){if(!t)return this.remoteBreadcrumb$.next([]),void this.getFileList(this.form.value.remoteEntity,"");const a=[],r=(t.endsWith("/")?t.slice(0,-1):t).split("/");for(let l=0;l<r.length;l++)a.push({name:r[l],prefix:r.slice(0,l+1).join("/")});this.remoteBreadcrumb$.next(a),this.getFileList(this.form.value.remoteEntity,t)}changeRemotePrefix(t){t&&(t+="/"),this.remoteSelector.changePrefix(t)}clearSelection(t,n){t.currentTarget===t.target&&n.clearSelection()}toggleBucketSize(){this.setPreferenceValue("showBucketSize",!this.showBucketSize$.value)}addPreference$(t,n){return this.preferenceStore.addPreference$(this.prefPrefix+t,n)}setPreferenceValue(t,n){this.preferenceStore.setValue(this.prefPrefix+t,n)}ngOnDestroy(){this.fileListSubscription&&this.fileListSubscription.cancel()}static#e=this.\u0275fac=function(n){return new(n||i)(e.Y36(P.so),e.Y36(u.C8),e.Y36(g.QS),e.Y36(u.ez),e.Y36(u.Vi),e.Y36(P.WI))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["app-download-file-dialog"]],viewQuery:function(n,a){if(1&n&&(e.Gf(ht,5),e.Gf(gt,5)),2&n){let r;e.iGM(r=e.CRH())&&(a.content=r.first),e.iGM(r=e.CRH())&&(a.remoteSelector=r.first)}},decls:42,vars:30,consts:[[1,"transfer-files","mat-typography"],[1,"ya-form",3,"formGroup"],["mat-dialog-close","",1,"close-button","mat-button"],[1,"grid-container"],[1,"buckets-column","header"],[1,"table-caption"],[3,"click"],[1,"buckets-column","table-wrapper"],["mat-table","",1,"ya-data-table",3,"dataSource"],["cdkColumnDef","name"],["mat-cell","",3,"title",4,"cdkCellDef"],["mat-row","",3,"ngClass","click",4,"cdkRowDef","cdkRowDefColumns"],["class","buckets-column footer",4,"ngIf"],[1,"local-column","header"],["formControlName","localEntity",3,"ngStyle"],[3,"value",4,"ngFor","ngForOf"],[3,"showMargin",4,"ngIf"],[1,"local-column","table-wrapper",3,"ngClass","click"],[4,"ngIf"],[1,"local-column","footer"],["type","text","formControlName","localFilenames","placeholder","Local filename",3,"value"],["class","ya-button primary",3,"disabled","click",4,"ngIf"],["class","remote-column header",3,"ngClass",4,"ngIf"],["class","remote-column table-wrapper",3,"click",4,"ngIf"],[1,"remote-column","footer"],["type","text","formControlName","remoteFilenames","placeholder","Remote filename",3,"value",4,"ngIf"],[1,"options-footer"],[3,"title",4,"ngFor","ngForOf"],["mat-cell","",3,"title"],[2,"vertical-align","middle"],[3,"value","total",4,"ngIf"],[3,"value","total"],["mat-row","",3,"ngClass","click"],[1,"buckets-column","footer"],[3,"value"],[3,"showMargin"],["icon","account_tree",3,"action","click"],[3,"label","action","click",4,"ngFor","ngForOf"],[3,"label","action","click"],["formControlName","localFilenames",3,"bucket","isMultiSelect","foldersOnly","noSelect","allowFolderSelection","prefixChange"],["objectSelector",""],[1,"ya-button","primary",3,"disabled","click"],[1,"remote-column","header",3,"ngClass"],["formControlName","remoteEntity",3,"ngStyle"],["class","lastFileListTime mat-button mat-primary","title","Refresh file list",3,"click",4,"ngIf"],["title","Refresh file list",1,"lastFileListTime","mat-button","mat-primary",3,"click"],[1,"remote-column","table-wrapper",3,"click"],["formControlName","remoteFilenames",3,"isMultiSelect","foldersOnly","noSelect","allowFolderSelection","fileListExtraColumns","prefixChange"],["remoteSelector",""],["type","text","formControlName","remoteFilenames","placeholder","Remote filename",3,"value"],[3,"title"],["class","checkbox-label",4,"ngIf"],[2,"display","flex","column-gap","8px","flex-wrap","wrap"],[3,"formControlName",4,"ngIf"],["style","width: 120px",3,"formControlName","type","placeholder",4,"ngIf"],[1,"checkbox-label"],["type","checkbox",3,"formControlName"],[3,"formControlName"],[3,"value",4,"ngIf"],[2,"width","120px",3,"formControlName","type","placeholder"]],template:function(n,a){if(1&n&&(e.TgZ(0,"div",0)(1,"form",1)(2,"h2")(3,"button",2)(4,"mat-icon"),e._uU(5,"close"),e.qZA()(),e._uU(6),e.qZA(),e.TgZ(7,"div",3)(8,"div",4)(9,"label",5),e._uU(10,"Buckets "),e.TgZ(11,"a",6),e.NdJ("click",function(){return a.toggleBucketSize()}),e._uU(12),e.qZA()()(),e.TgZ(13,"div",7)(14,"table",8),e.ynx(15,9),e.YNc(16,yt,8,6,"td",10),e.BQk(),e.YNc(17,vt,2,5,"tr",11),e.qZA()(),e.YNc(18,Ct,5,1,"div",12),e.ALo(19,"async"),e.TgZ(20,"div",13)(21,"label",5),e._uU(22),e.TgZ(23,"select",14),e.YNc(24,Ft,2,3,"option",15),e.qZA()(),e.YNc(25,St,3,3,"ya-breadcrumb-trail",16),e.ALo(26,"async"),e.qZA(),e.TgZ(27,"div",17),e.NdJ("click",function(l){return a.clearSelection(l,a.objectSelector)}),e.YNc(28,Zt,3,5,"ng-container",18),e.ALo(29,"async"),e.qZA(),e.TgZ(30,"div",19),e.YNc(31,Nt,4,1,"div",18),e._UZ(32,"input",20),e.YNc(33,Ot,4,1,"button",21),e.qZA(),e.YNc(34,Ut,8,11,"div",22),e.YNc(35,$t,4,6,"div",23),e.TgZ(36,"div",24),e.YNc(37,It,4,1,"button",21),e.YNc(38,Lt,1,1,"input",25),e.YNc(39,Mt,4,1,"div",18),e.qZA(),e.TgZ(40,"div",26),e.YNc(41,Rt,7,5,"div",27),e.qZA()()()()),2&n){let r;e.xp6(1),e.Q6J("formGroup",a.form),e.xp6(5),e.hij(" New ",a.service.capabilities.download&&a.service.capabilities.upload?"Transfer":a.service.capabilities.upload?"Upload":"Download"," "),e.xp6(6),e.hij("",a.showBucketSize$.value?"hide":"show"," size"),e.xp6(2),e.Q6J("dataSource",a.dataSource),e.xp6(3),e.Q6J("cdkRowDefColumns",a.displayedColumns),e.xp6(1),e.Q6J("ngIf",e.lcZ(19,21,a.selectedBucket$)),e.xp6(4),e.hij("Local ",a.service.localEntities&&a.service.localEntities.length?"Entity":""," "),e.xp6(1),e.Q6J("ngStyle",!(a.service.localEntities&&a.service.localEntities.length)&&e.DdM(27,Y)),e.xp6(1),e.Q6J("ngForOf",a.service.localEntities),e.xp6(1),e.Q6J("ngIf",e.lcZ(26,23,a.breadcrumb$)),e.xp6(2),e.Q6J("ngClass",e.VKq(28,q,!a.service.capabilities.fileList)),e.xp6(1),e.Q6J("ngIf",e.lcZ(29,25,a.selectedBucket$)),e.xp6(3),e.Q6J("ngIf",a.service.localEntities&&a.service.localEntities.length),e.xp6(1),e.Q6J("value",null==(r=a.form.get("localFilenames"))?null:r.value),e.xp6(1),e.Q6J("ngIf",a.service.capabilities.upload),e.xp6(1),e.Q6J("ngIf",a.service.remoteEntities&&a.service.remoteEntities.length||a.service.capabilities.fileList),e.xp6(1),e.Q6J("ngIf",a.service.capabilities.fileList),e.xp6(2),e.Q6J("ngIf",a.service.capabilities.download),e.xp6(1),e.Q6J("ngIf",a.service.capabilities.download||a.service.capabilities.remotePath),e.xp6(1),e.Q6J("ngIf",a.service.remoteEntities&&a.service.remoteEntities.length),e.xp6(2),e.Q6J("ngForOf",a.service.transferOptions)}},dependencies:[_.mk,_.sg,_.O5,_.PC,g._Y,g.YN,g.Kr,g.Fj,g.Wl,g.EJ,g.JJ,g.JL,g.sg,g.u,w.Sq,w.O_,w.fo,P.ZT,U.Hw,m.BZ,m.ev,m.Gk,u.LI,u.O_,u.t1,Ge.O,pt,_.Ov,u.id,u.bP],styles:[".mat-mdc-dialog-container{border-radius:0;position:relative}.transfer-files[_ngcontent-%COMP%]{height:100%}.close-button[_ngcontent-%COMP%]{float:right;padding:0;min-width:0;line-height:normal;vertical-align:bottom}.close-button[_ngcontent-%COMP%]:hover{opacity:70%;transform:scale(.95)}.ya-form[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column}.grid-container[_ngcontent-%COMP%]{display:grid;grid-auto-flow:column;grid-template-rows:[header] min-content [tables] auto [footer] min-content [options-footer] min-content;grid-template-columns:[buckets] 140px [local] auto [remote] auto;column-gap:8px;flex:1;min-height:0}.header[_ngcontent-%COMP%]{grid-row:header;position:relative;overflow:hidden}.table-wrapper[_ngcontent-%COMP%]{grid-row:tables;overflow:auto;border:1px solid #d3d3d3}.footer[_ngcontent-%COMP%]{grid-row:footer;margin-top:8px;display:flex;flex-wrap:wrap;align-items:flex-start;justify-content:stretch;gap:8px;height:-moz-fit-content;height:fit-content}.options-footer[_ngcontent-%COMP%]{grid-row:options-footer;grid-column:local / span 2;margin-top:8px;display:flex;flex-wrap:wrap;align-items:flex-start;justify-content:stretch;gap:8px;height:-moz-fit-content;height:fit-content}.buckets-column[_ngcontent-%COMP%]{grid-column:buckets}.local-column[_ngcontent-%COMP%]{grid-column:local}.remote-column[_ngcontent-%COMP%]{grid-column:remote}.buckets-column.header[_ngcontent-%COMP%] > label[_ngcontent-%COMP%]{position:absolute;bottom:0;line-height:24px}.buckets-column.header[_ngcontent-%COMP%] > label[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]{float:right;font-weight:initial;color:#707070;-webkit-user-select:none;user-select:none;cursor:pointer}.buckets-column.header[_ngcontent-%COMP%] > label[_ngcontent-%COMP%] > a[_ngcontent-%COMP%]:hover{text-decoration:underline}.buckets-column[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{cursor:pointer;-webkit-user-select:none;user-select:none;display:flex;column-gap:10px;flex-wrap:wrap;justify-content:space-between}.local-column.table-wrapper.no-filelist[_ngcontent-%COMP%]{grid-column:local / span 2}.local-column.footer[_ngcontent-%COMP%]{flex-wrap:wrap-reverse;align-items:flex-end}.remote-column.header.no-filelist[_ngcontent-%COMP%] > ya-breadcrumb-trail[_ngcontent-%COMP%]{visibility:hidden}label.table-caption[_ngcontent-%COMP%]{margin:0;bottom:0}label.table-caption[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{display:inline-block;width:auto;margin:0 4px}ya-breadcrumb-trail[_ngcontent-%COMP%]{display:inline-block}.lastFileListTime[_ngcontent-%COMP%]{min-width:0;padding:0;font-size:12px;line-height:24px;float:right}.lastFileListTime[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{font-size:16px;width:16px;height:16px;vertical-align:sub}.lastFileListTime[_ngcontent-%COMP%]:hover   .mat-icon[_ngcontent-%COMP%]{transform:rotate(360deg);transition:transform .3s ease-in-out}.footer[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .options-footer[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .footer[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], .options-footer[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{margin:2px 0 0}.footer[_ngcontent-%COMP%] > button[_ngcontent-%COMP%], .footer[_ngcontent-%COMP%] > input[_ngcontent-%COMP%]{margin-top:7px;flex-shrink:1}.footer[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{flex-grow:1}.footer[_ngcontent-%COMP%] > input[_ngcontent-%COMP%]{flex-grow:5}table.ya-data-table[_ngcontent-%COMP%]{width:100%}.ya-data-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border:none}.checkbox-label[_ngcontent-%COMP%]{font-weight:unset;font-size:unset;letter-spacing:unset;line-height:unset;color:unset;text-transform:unset;cursor:unset;position:unset;display:inline-block;margin:3px 0 0;-webkit-user-select:none;user-select:none}.checkbox-label[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin:0 3px 0 4px}"]})}return i})();var zt=o(6593),Gt=o(5394),Ht=o(2296),E=o(7988),$=o(4104),Xt=o(2755),Kt=o(1237);function Vt(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"button",6),e.NdJ("click",function(){const r=e.CHM(t).$implicit,l=e.oxw(2);return e.KtG(l.switchService(r))}),e._uU(1),e.qZA()}if(2&i){const t=s.$implicit;e.xp6(1),e.Oqu(t.name)}}function Wt(i,s){if(1&i&&(e.ynx(0),e.TgZ(1,"button",2),e._uU(2),e.ALo(3,"async"),e.qZA(),e.TgZ(4,"mat-menu",3,4),e.YNc(6,Vt,2,1,"button",5),e.qZA(),e.BQk()),2&i){const t=s.ngIf,n=e.MAs(5),a=e.oxw();let r;e.xp6(1),e.Q6J("matMenuTriggerFor",n),e.xp6(1),e.hij(" ",(null==(r=e.lcZ(3,3,a.service$))?null:r.name)||"select service"," \u25be "),e.xp6(4),e.Q6J("ngForOf",t)}}function ei(i,s){if(1&i){const t=e.EpF();e.ynx(0),e.TgZ(1,"button",7),e.NdJ("click",function(){e.CHM(t);const a=e.oxw().ngIf,r=e.oxw();return e.KtG(r.downloadFile(a))}),e.TgZ(2,"mat-icon"),e._uU(3),e.qZA(),e._uU(4),e.qZA(),e.BQk()}if(2&i){const t=e.oxw().ngIf;e.xp6(3),e.Oqu(t.capabilities.download&&t.capabilities.upload?"cloud":t.capabilities.upload?"cloud_upload":"cloud_download"),e.xp6(1),e.hij(" New ",t.capabilities.download&&t.capabilities.upload?"transfer":t.capabilities.upload?"upload":"download"," ")}}function ti(i,s){if(1&i&&(e.ynx(0),e.YNc(1,ei,5,2,"ng-container",0),e.BQk()),2&i){const t=s.ngIf,n=e.oxw();e.xp6(1),e.Q6J("ngIf",n.mayControlFileTransfers()&&(t.capabilities.download||t.capabilities.upload))}}function ii(i,s){if(1&i&&(e.ynx(0),e._uU(1),e.BQk()),2&i){const t=s.ngIf;e.xp6(1),e.hij("(",t,")")}}function ni(i,s){if(1&i&&(e.ynx(0),e._uU(1),e.BQk()),2&i){const t=s.ngIf;e.xp6(1),e.hij("(",t,")")}}function ai(i,s){if(1&i&&(e.ynx(0),e._uU(1),e.BQk()),2&i){const t=s.ngIf;e.xp6(1),e.hij("(",t,")")}}const I=function(i,s){return{c:i,service:s}},L=function(i){return{hasTransferType:i}};function si(i,s){if(1&i&&(e.ynx(0),e.TgZ(1,"nav",8)(2,"a",9,10),e._uU(4," ONGOING "),e.YNc(5,ii,2,1,"ng-container",0),e.ALo(6,"async"),e.qZA(),e.TgZ(7,"a",11,12),e._uU(9," FAILED "),e.YNc(10,ni,2,1,"ng-container",0),e.ALo(11,"async"),e.qZA(),e.TgZ(12,"a",13,14),e._uU(14," SUCCESSFUL "),e.YNc(15,ai,2,1,"ng-container",0),e.ALo(16,"async"),e.qZA()(),e.TgZ(17,"div",15)(18,"mat-tab-nav-panel",null,16),e._UZ(20,"router-outlet"),e.qZA()(),e.BQk()),2&i){const t=s.ngIf,n=e.MAs(3),a=e.MAs(8),r=e.MAs(13),l=e.MAs(19),f=e.oxw();e.xp6(1),e.Q6J("mat-stretch-tabs",!1)("tabPanel",l),e.xp6(1),e.Q6J("queryParams",e.WLB(20,I,f.yamcs.context,t.name))("active",n.isActive)("state",e.VKq(23,L,t.capabilities.hasTransferType)),e.xp6(3),e.Q6J("ngIf",e.lcZ(6,14,f.ongoingCount$)),e.xp6(2),e.Q6J("queryParams",e.WLB(25,I,f.yamcs.context,t.name))("active",a.isActive)("state",e.VKq(28,L,t.capabilities.hasTransferType)),e.xp6(3),e.Q6J("ngIf",e.lcZ(11,16,f.failedCount$)),e.xp6(2),e.Q6J("queryParams",e.WLB(30,I,f.yamcs.context,t.name))("active",r.isActive)("state",e.VKq(33,L,t.capabilities.hasTransferType)),e.xp6(3),e.Q6J("ngIf",e.lcZ(16,18,f.successfulCount$))}}function ri(i,s){1&i&&(e.TgZ(0,"ya-empty-message",17)(1,"p"),e._uU(2," This instance has no file transfer services configured. "),e.qZA()())}const li=function(){return["transferType"]},ci=function(){return[]};const oi=function(){return["transferType"]},ui=function(){return[]};const fi=[{path:"",canActivate:[Q.r,H._],canActivateChild:[Q.q],runGuardsAndResolvers:"always",component:X.K,children:[{path:"",component:(()=>{class i{constructor(t,n,a,r,l,f,h){this.yamcs=t,this.dialog=a,this.route=r,this.router=l,this.authService=h,this.services$=new d.X([]),this.service$=new d.X(null),this.ongoingTransfersById=new Map,this.failedTransfersById=new Map,this.successfulTransfersById=new Map,this.ongoingCount$=new d.X(0),this.failedCount$=new d.X(0),this.successfulCount$=new d.X(0),this.dirty=!1,n.setTitle("File transfer");const S=r.snapshot.queryParamMap.get("service");t.yamcsClient.getFileTransferServices(t.instance).then(C=>{this.services$.next(C.services);let T=null;for(const x of C.services)if(S===x.name){T=x;break}!T&&!S&&(T=C.services.length?C.services[0]:null),T&&this.switchService(T)}),this.syncSubscription=f.sync(()=>{this.dirty&&(this.ongoingCount$.next(this.ongoingTransfersById.size),this.failedCount$.next(this.failedTransfersById.size),this.successfulCount$.next(this.successfulTransfersById.size))})}switchService(t){this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParams:{service:t?.name||null},queryParamsHandling:"merge",state:{hasTransferType:t?.capabilities.hasTransferType}}),this.ongoingCount$.next(0),this.failedCount$.next(0),this.successfulCount$.next(0),this.ongoingTransfersById.clear(),this.failedTransfersById.clear(),this.successfulTransfersById.clear(),this.transferSubscription&&this.transferSubscription.cancel(),this.service$.next(t),t&&(this.transferSubscription=this.yamcs.yamcsClient.createTransferSubscription({instance:this.yamcs.instance,serviceName:t.name},n=>{switch(n.state){case"RUNNING":case"PAUSED":case"CANCELLING":case"QUEUED":this.ongoingTransfersById.set(n.id,n);break;case"FAILED":this.ongoingTransfersById.delete(n.id),this.failedTransfersById.set(n.id,n);break;case"COMPLETED":this.ongoingTransfersById.delete(n.id),this.successfulTransfersById.set(n.id,n)}this.dirty=!0}))}downloadFile(t){this.dialog.open(jt,{width:"70%",height:"100%",autoFocus:!1,position:{right:"0"},panelClass:"dialog-full-size",data:{service:t}})}mayControlFileTransfers(){return this.authService.getUser().hasSystemPrivilege("ControlFileTransfers")}ngOnDestroy(){this.syncSubscription?.unsubscribe(),this.transferSubscription?.cancel()}static#e=this.\u0275fac=function(n){return new(n||i)(e.Y36(u.C8),e.Y36(zt.Dx),e.Y36(P.uw),e.Y36(v.gz),e.Y36(v.F0),e.Y36(u.jF),e.Y36(Gt.e))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["ng-component"]],decls:11,vars:12,consts:[[4,"ngIf"],["headerTitle","File Transfer",4,"ngIf"],["mat-button","",3,"matMenuTriggerFor"],[1,"ya-menu"],["serviceMenu","matMenu"],["mat-menu-item","",3,"click",4,"ngFor","ngForOf"],["mat-menu-item","",3,"click"],["mat-button","","color","primary",3,"click"],["mat-tab-nav-bar","",1,"secondary",3,"mat-stretch-tabs","tabPanel"],["mat-tab-link","","routerLink","./ongoing-transfers","routerLinkActive","",3,"queryParams","active","state"],["rla","routerLinkActive"],["mat-tab-link","","routerLink","./failed-transfers","routerLinkActive","",3,"queryParams","active","state"],["rlb","routerLinkActive"],["mat-tab-link","","routerLink","./successful-transfers","routerLinkActive","",3,"queryParams","active","state"],["rlc","routerLinkActive"],[1,"outlet-wrapper"],["tabPanel",""],["headerTitle","File Transfer"]],template:function(n,a){1&n&&(e.TgZ(0,"app-instance-page")(1,"app-instance-toolbar"),e._uU(2," File transfer \xa0\xa0\xa0\xa0 "),e.YNc(3,Wt,7,5,"ng-container",0),e.ALo(4,"async"),e.YNc(5,ti,2,1,"ng-container",0),e.ALo(6,"async"),e.qZA(),e.YNc(7,si,21,35,"ng-container",0),e.ALo(8,"async"),e.YNc(9,ri,3,0,"ya-empty-message",1),e.ALo(10,"async"),e.qZA()),2&n&&(e.xp6(3),e.Q6J("ngIf",e.lcZ(4,4,a.services$)),e.xp6(2),e.Q6J("ngIf",e.lcZ(6,6,a.service$)),e.xp6(2),e.Q6J("ngIf",e.lcZ(8,8,a.service$)),e.xp6(2),e.Q6J("ngIf",!e.lcZ(10,10,a.services$).length))},dependencies:[_.sg,_.O5,v.lC,v.rH,v.Od,Ht.lW,U.Hw,E.VK,E.OP,E.p6,$.BU,$.sW,$.Nj,u.RR,Xt.a,Kt.k,_.Ov],styles:[".outlet-wrapper[_ngcontent-%COMP%]{overflow:auto;position:absolute;inset:49px 0 0}"],changeDetection:0})}return i})(),children:[{path:"",pathMatch:"full",redirectTo:"ongoing-transfers"},{path:"ongoing-transfers",component:(()=>{class i{constructor(t,n,a){this.yamcs=t,this.serviceName$=new d.X(null),this.dataSource=new m.by,this.transfersById=new Map,this.dirty=!1,this.hasTransferType=!1,this.hasTransferType=history.state.hasTransferType,this.storageClient=t.createStorageClient(),this.queryParamSubscription=n.queryParamMap.subscribe(r=>{const l=r.get("service");this.serviceName$.next(l),this.switchService(l)}),this.syncSubscription=a.sync(()=>{if(this.dirty){const r=[...this.transfersById.values()];r.sort((l,f)=>this.compareTransfers(l.transfer,f.transfer)),this.dataSource.data=r,this.dirty=!1}})}compareTransfers(t,n){if(t.state!=n.state){if("RUNNING"==t.state)return-1;if("RUNNING"==n.state)return 1}return(n.creationTime||n.startTime||"").localeCompare(t.creationTime||t.startTime||"")}switchService(t){this.dirty=!1,this.transfersById.clear(),this.dataSource.data=[],this.transferSubscription&&this.transferSubscription.cancel(),t&&(this.transferSubscription=this.yamcs.yamcsClient.createTransferSubscription({instance:this.yamcs.instance,serviceName:t},n=>{switch(n.state){case"RUNNING":case"PAUSED":case"CANCELLING":case"QUEUED":this.setOrUpdate(n);break;case"FAILED":case"COMPLETED":this.transfersById.delete(n.id)}this.dirty=!0}))}setOrUpdate(t){let n=this.transfersById.get(t.id);if(n)n.updateTransfer(t);else{const a=t.objectName?this.storageClient.getObjectURL(t.bucket,t.objectName):"";n=new D(t,a),this.transfersById.set(t.id,n)}}ngOnDestroy(){this.syncSubscription?.unsubscribe(),this.queryParamSubscription?.unsubscribe(),this.transferSubscription?.cancel()}static#e=this.\u0275fac=function(n){return new(n||i)(e.Y36(u.C8),e.Y36(v.gz),e.Y36(u.jF))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["ng-component"]],decls:3,vars:8,consts:[[1,"panel-content"],[3,"serviceName","dataSource","showActions","extraColumns"]],template:function(n,a){1&n&&(e.TgZ(0,"div",0),e._UZ(1,"app-file-transfer-table",1),e.ALo(2,"async"),e.qZA()),2&n&&(e.xp6(1),e.Q6J("serviceName",e.lcZ(2,4,a.serviceName$))("dataSource",a.dataSource)("showActions",!0)("extraColumns",a.hasTransferType?e.DdM(6,li):e.DdM(7,ci)))},dependencies:[k,_.Ov],encapsulation:2,changeDetection:0})}return i})()},{path:"failed-transfers",component:J},{path:"successful-transfers",component:(()=>{class i{constructor(t,n,a){this.yamcs=t,this.serviceName$=new d.X(null),this.dataSource=new m.by,this.transfersById=new Map,this.dirty=!1,this.hasTransferType=!1,this.hasTransferType=history.state.hasTransferType,this.storageClient=t.createStorageClient(),this.queryParamSubscription=n.queryParamMap.subscribe(r=>{const l=r.get("service");this.serviceName$.next(l),this.switchService(l)}),this.syncSubscription=a.sync(()=>{if(this.dirty){const r=[...this.transfersById.values()];r.sort((l,f)=>this.compareTransfers(l.transfer,f.transfer)),this.dataSource.data=r,this.dirty=!1}})}compareTransfers(t,n){return(n.creationTime||n.startTime||"").localeCompare(t.creationTime||t.startTime||"")}switchService(t){this.dirty=!1,this.transfersById.clear(),this.dataSource.data=[],this.transferSubscription&&this.transferSubscription.cancel(),t&&(this.transferSubscription=this.yamcs.yamcsClient.createTransferSubscription({instance:this.yamcs.instance,serviceName:t},n=>{"COMPLETED"===n.state&&this.setOrUpdate(n),this.dirty=!0}))}setOrUpdate(t){let n=this.transfersById.get(t.id);if(n)n.updateTransfer(t);else{const a=t.objectName?this.storageClient.getObjectURL(t.bucket,t.objectName):"";n=new D(t,a),this.transfersById.set(t.id,n)}}ngOnDestroy(){this.syncSubscription&&this.syncSubscription.unsubscribe(),this.queryParamSubscription&&this.queryParamSubscription.unsubscribe(),this.transferSubscription&&this.transferSubscription.cancel()}static#e=this.\u0275fac=function(n){return new(n||i)(e.Y36(u.C8),e.Y36(v.gz),e.Y36(u.jF))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["app-successful-transfers-tab"]],decls:3,vars:7,consts:[[1,"panel-content"],[3,"serviceName","dataSource","extraColumns"]],template:function(n,a){1&n&&(e.TgZ(0,"div",0),e._UZ(1,"app-file-transfer-table",1),e.ALo(2,"async"),e.qZA()),2&n&&(e.xp6(1),e.Q6J("serviceName",e.lcZ(2,3,a.serviceName$))("dataSource",a.dataSource)("extraColumns",a.hasTransferType?e.DdM(5,oi):e.DdM(6,ui)))},dependencies:[k,_.Ov],encapsulation:2,changeDetection:0})}return i})()}]}]}];let mi=(()=>{class i{static#e=this.\u0275fac=function(n){return new(n||i)};static#t=this.\u0275mod=e.oAB({type:i});static#i=this.\u0275inj=e.cJS({imports:[v.Bz.forChild(fi),v.Bz]})}return i})(),di=(()=>{class i{static#e=this.\u0275fac=function(n){return new(n||i)};static#t=this.\u0275mod=e.oAB({type:i});static#i=this.\u0275inj=e.cJS({imports:[G.m,mi]})}return i})()}}]);