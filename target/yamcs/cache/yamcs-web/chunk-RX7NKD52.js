import{a as pe}from"./chunk-2OT6OSOP.js";import{b as le,d as me,e as A,f as de}from"./chunk-FTOGDGWN.js";import{Aa as o,Bb as S,Bd as ee,Db as y,Eb as C,F as h,Ga as v,Hd as te,Jb as x,K as M,L as E,La as Y,Ma as U,Nb as b,Nd as ie,Od as ne,Qb as T,Rd as oe,Re as se,Ve as w,We as ce,X as s,Xe as I,Y as c,Yb as _,Yd as re,Ye as R,_a as $,aa as k,bc as q,ca as p,dc as H,e as F,ec as L,fe as ae,ga as G,ib as B,ka as i,la as n,ma as l,ob as O,oc as W,qa as V,qc as K,ra as u,sa as g,sc as z,tc as J,uc as Q,vc as X,wc as Z,za as j,zb as P}from"./chunk-YLFXKKOP.js";var ue=(()=>{let r=class r{constructor(t,e){this.dialogRef=t,this.form=e.group({executionTime:["",[S.required]],tags:[[],[]]})}schedule(){this.dialogRef.close(this.form.value)}};r.\u0275fac=function(e){return new(e||r)(c(K),c(_))},r.\u0275cmp=h({type:r,selectors:[["app-schedule-script-dialog"]],standalone:!0,features:[v],decls:26,vars:3,consts:[["mat-dialog-title",""],[1,"hint"],[1,"ya-form",3,"formGroup"],[1,"label"],["formControlName","executionTime",3,"showMillis"],[1,"half-break"],["dialogTitle","Timeline Tags"],["formControlName","tags"],["align","end"],[2,"flex","1 1 auto"],["mat-dialog-close","",1,"ya-button"],[1,"ya-button","primary",3,"click","disabled"]],template:function(e,a){e&1&&(i(0,"h2",0),o(1,"Run later"),n(),i(2,"mat-dialog-content")(3,"div",1)(4,"p"),o(5,"This script will be submitted to the Yamcs Timeline, for execution at a later time."),n()(),i(6,"form",2)(7,"div",3),o(8," Execution time"),l(9,"br")(10,"ya-date-time-input",4),n(),l(11,"hr",5),i(12,"div",3),o(13," Timeline tags "),i(14,"span",1),o(15,"(optional)"),n(),i(16,"ya-help",6),o(17," Tags allow to categorise items per band. Bands only show items for which one of the tags is matching. "),n(),l(18,"br")(19,"ya-tag-select",7),n()()(),i(20,"mat-dialog-actions",8),l(21,"div",9),i(22,"button",10),o(23,"CANCEL"),n(),i(24,"button",11),u("click",function(){return a.schedule()}),o(25,"SCHEDULE"),n()()),e&2&&(s(6),p("formGroup",a.form),s(4),p("showMillis",!0),s(14),p("disabled",!a.form.valid))},dependencies:[w,x,y,C,b,T,J,Q,Z,X,ee,ne,ae],encapsulation:2,changeDetection:0});let m=r;return m})();function be(m,r){if(m&1){let f=V();o(0," \xA0 "),l(1,"ya-icon-action",9),i(2,"mat-menu",10,0)(4,"button",11),u("click",function(){M(f);let e=g();return E(e.runScript())}),o(5,"Run now"),n(),i(6,"button",11),u("click",function(){M(f);let e=g();return E(e.openScheduleScriptDialog())}),o(7,"Run later..."),n()()}if(m&2){let f=j(3),t=g();s(),p("matMenuTriggerFor",t.form.valid?f:null)("padding",!1)("disabled",!t.form.valid),s(),p("overlapTrigger",!1)}}var fe=(()=>{let r=class r{constructor(t,e,a,d,he,ge,ve){this.yamcs=a,this.messageService=d,this.authService=he,this.router=ge,this.dialog=ve,this.scriptOptions$=new F([]),t.setTitle("Run a script"),this.form=e.group({script:["",[S.required]],args:[""]}),a.yamcsClient.getActivityScripts(this.yamcs.instance).then(D=>{for(let N of D.scripts||[])this.scriptOptions$.next([...this.scriptOptions$.value,{id:N,label:N}])}).catch(D=>d.showError(D))}runScript(){let t=this.createActivityDefinition();this.yamcs.yamcsClient.startActivity(this.yamcs.instance,t).then(e=>{this.authService.getUser().hasSystemPrivilege("ReadActivities")?this.router.navigateByUrl(`/activities/${e.id}?c=${this.yamcs.context}`):this.dialog.open(ie,{width:"500px",data:{icon:"done",closeText:"OK",content:`
                <p>The procedure has started executing.</p>
                <p>
                  Note that you do not have sufficient privileges
                  to follow up on submitted procedures.
                </p>
              `}}).afterClosed().subscribe(()=>this.form.reset())}).catch(e=>this.messageService.showError(e))}showSchedule(){let t=this.yamcs.connectionInfo$.value?.instance?.capabilities||[];return t.indexOf("timeline")!==-1&&t.indexOf("activities")!==-1&&this.authService.getUser().hasSystemPrivilege("ControlTimeline")}openScheduleScriptDialog(){this.dialog.open(ue,{width:"600px"}).afterClosed().subscribe(t=>{let e=this.form.value;if(t){let a={type:"ACTIVITY",duration:"0s",name:e.script,start:t.executionTime,tags:t.tags,activityDefinition:this.createActivityDefinition()};this.yamcs.yamcsClient.createTimelineItem(this.yamcs.instance,a).then(()=>{this.messageService.showInfo("Script scheduled"),this.router.navigateByUrl(`/activities?c=${this.yamcs.context}`)}).catch(d=>this.messageService.showError(d))}})}createActivityDefinition(){let t=this.form.value,e={type:"SCRIPT",args:{processor:this.yamcs.processor||null,script:t.script}};return t.args&&(e.args.args=t.args),e}};r.\u0275fac=function(e){return new(e||r)(c(B),c(_),c(se),c(re),c(ce),c(O),c(z))},r.\u0275cmp=h({type:r,selectors:[["ng-component"]],standalone:!0,features:[v],decls:23,vars:6,consts:[["sendMenu","matMenu"],[1,"form-content","ya-form"],["novalidate","","autocomplete","off",3,"formGroup"],[1,"label"],[1,"hint"],["formControlName","script",3,"options"],["type","text","formControlName","args"],[2,"flex","1 1 auto"],["type","submit",1,"ya-button","primary",3,"click","disabled"],["icon","arrow_drop_down",2,"line-height","12px",3,"matMenuTriggerFor","padding","disabled"],[1,"ya-menu",3,"overlapTrigger"],["mat-menu-item","",3,"click"]],template:function(e,a){e&1&&(i(0,"app-instance-page")(1,"app-instance-toolbar"),o(2," Run a script "),n(),i(3,"div",1)(4,"form",2)(5,"div",3),o(6," Script "),i(7,"span",4),o(8,"(required)"),n(),l(9,"br")(10,"ya-select",5),Y(11,"async"),n(),l(12,"br"),i(13,"div",3),o(14," Script arguments "),l(15,"input",6),n()(),i(16,"p"),o(17,"\xA0"),n(),i(18,"mat-toolbar"),l(19,"span",7),i(20,"button",8),u("click",function(){return a.runScript()}),o(21," Run "),n(),k(22,be,8,4),n()()()),e&2&&(s(4),p("formGroup",a.form),s(6),p("options",U(11,4,a.scriptOptions$)),s(10),p("disabled",!a.form.valid),s(2),G(a.showSchedule()?22:-1))},dependencies:[me,le,w,$,x,P,y,C,b,T,H,q,L,W,oe,te],encapsulation:2,changeDetection:0});let m=r;return m})();var qe=[{path:"",canActivate:[I,A],canActivateChild:[R],runGuardsAndResolvers:"always",component:de,children:[{path:"script",pathMatch:"full",component:fe},{path:"ext",canActivate:[I,A],canActivateChild:[R],runGuardsAndResolvers:"always",children:[{path:":extension",component:pe}]}]}];export{qe as ROUTES};
