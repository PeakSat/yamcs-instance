import{b as Xt,d as Zt,e as te,f as ne}from"./chunk-FTOGDGWN.js";import{$d as nt,Aa as a,B as ct,Ba as N,Bb as P,Bd as U,C as ft,Ca as F,Db as V,Eb as $,Ed as Wt,F as T,Fc as Rt,Fd as Ht,Ga as I,Gb as J,Gc as Nt,Hc as Ft,Hd as q,Ib as x,Ic as At,Jb as B,Jc as Pt,K as w,L as M,La as C,Ma as _,Nb as j,Qb as G,Qd as Yt,Rd as zt,Re as W,Sc as Vt,Ue as Kt,Ve as D,We as ot,X as c,Xa as xt,Xc as $t,Xe as ee,Y as v,Yb as wt,Ye as ie,Zc as Bt,_a as A,_b as Mt,a as st,aa as u,b as lt,bd as jt,be as Qt,ca as d,dd as Gt,e as b,ea as R,fc as It,ga as S,ha as ht,hc as Dt,ia as vt,ib as Et,ja as Ct,ka as r,la as s,ma as m,mb as bt,mc as Ot,na as O,oa as k,ob as z,oc as kt,p as dt,qa as L,qc as K,ra as y,rc as X,sa as p,sc as Lt,tc as Z,te as Jt,uc as tt,vb as Tt,vc as et,vd as Ut,wa as _t,wc as it,xa as gt,ya as St,yd as f,z as ut,za as yt,zb as Q,zd as qt}from"./chunk-YLFXKKOP.js";var oe=(t,e)=>ft(Se).canActivate(t,e);var Se=(()=>{let e=class e{constructor(n,o){this.authService=n,this.router=o}canActivate(n,o){return this.authService.getUser().hasSystemPrivilege("ReadEvents")?!0:(this.router.navigate(["/403"],{queryParams:{page:o.url}}),!1)}canActivateChild(n,o){return this.canActivate(n,o)}};e.\u0275fac=function(o){return new(o||e)(ct(ot),ct(z))},e.\u0275prov=ut({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();var se=(()=>{let e=class e{constructor(n,o,l,g){this.dialogRef=n,this.yamcs=l,this.data=g,this.severityOptions=[{id:"INFO",label:"INFO"},{id:"WATCH",label:"WATCH"},{id:"WARNING",label:"WARNING"},{id:"DISTRESS",label:"DISTRESS"},{id:"CRITICAL",label:"CRITICAL"},{id:"SEVERE",label:"SEVERE"}],this.form=o.group({message:["",P.required],severity:"INFO",time:[f.toISOString(l.getMissionTime()),P.required]})}save(){this.yamcs.yamcsClient.createEvent(this.yamcs.instance,{message:this.form.value.message,severity:this.form.value.severity,time:f.toISOString(this.form.value.time)}).then(n=>this.dialogRef.close(n))}};e.\u0275fac=function(o){return new(o||e)(v(K),v(wt),v(W),v(X))},e.\u0275cmp=T({type:e,selectors:[["ng-component"]],standalone:!0,features:[I],decls:21,vars:3,consts:[["mat-dialog-title",""],[1,"ya-form",3,"formGroup"],["formControlName","message","rows","3"],["formControlName","severity",3,"options"],["formControlName","time","step","1"],["align","end"],["mat-dialog-close","",1,"ya-button"],[1,"ya-button","primary",3,"click","disabled"]],template:function(o,l){o&1&&(r(0,"h2",0),a(1,"Create event"),s(),r(2,"mat-dialog-content")(3,"form",1)(4,"label"),a(5," Message "),m(6,"textarea",2),s(),m(7,"br"),r(8,"label"),a(9," Severity"),m(10,"br")(11,"ya-select",3),s(),m(12,"br"),r(13,"label"),a(14," Event time "),m(15,"ya-date-time-input",4),s()()(),r(16,"mat-dialog-actions",5)(17,"button",6),a(18,"CANCEL"),s(),r(19,"button",7),y("click",function(){return l.save()}),a(20,"SAVE"),s()()),o&2&&(c(3),d("formGroup",l.form),c(8),d("options",l.severityOptions),c(8),d("disabled",!l.form.valid))},dependencies:[D,B,Q,V,$,j,G,Z,tt,it,et,U,q],encapsulation:2,changeDetection:0});let t=e;return t})();function ye(t,e){t&1&&a(0,` -
`)}function xe(t,e){if(t&1&&m(0,"ya-highlight",0),t&2){let i=p();d("text",i.summary)("term",i.highlight)}}function Ee(t,e){if(t&1&&m(0,"br")(1,"ya-highlight",0),t&2){let i=p(2);c(),d("text",i.detail)("term",i.highlight)}}function be(t,e){if(t&1){let i=L();r(0,"ya-icon-action",1),y("click",function(){w(i);let o=p();return M(o.toggleExpanded())}),s(),u(1,Ee,2,2),C(2,"async")}if(t&2){let i=p();c(),S(_(2,1,i.expanded$)?1:-1)}}var ce=(()=>{let e=class e{constructor(){this.expanded$=new b(!1)}ngOnInit(){if(this.message!==null&&this.message!==void 0){let n=this.message.indexOf(`
`);n===-1?this.summary=this.message:(this.summary=this.message.substring(0,n),n+1<this.message.length&&(this.detail=this.message.substring(n+1)))}}toggleExpanded(){this.expanded$.next(!this.expanded$.value)}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=T({type:e,selectors:[["app-event-message"]],inputs:{message:"message",highlight:"highlight"},standalone:!0,features:[I],decls:3,vars:3,consts:[[3,"text","term"],["icon","more_horiz",3,"click"]],template:function(o,l){o&1&&u(0,ye,1,0)(1,xe,1,2,"ya-highlight",0)(2,be,3,3),o&2&&(S(l.summary===null||l.summary===void 0?0:-1),c(),S(l.summary!==null&&l.summary!==void 0?1:-1),c(),S(l.detail?2:-1))},dependencies:[D,A,Yt,zt],encapsulation:2,changeDetection:0});let t=e;return t})();function Te(t,e){if(t&1&&m(0,"div",7),t&2){let i=p();R("grayscale",i.grayscale)}}function we(t,e){if(t&1&&m(0,"div",8),t&2){let i=p();R("grayscale",i.grayscale)}}function Me(t,e){if(t&1&&m(0,"div",9),t&2){let i=p();R("grayscale",i.grayscale)}}function Ie(t,e){if(t&1&&m(0,"div",10),t&2){let i=p();R("grayscale",i.grayscale)}}function De(t,e){if(t&1&&m(0,"div",11),t&2){let i=p();R("grayscale",i.grayscale)}}function Oe(t,e){if(t&1&&m(0,"div",12),t&2){let i=p();R("grayscale",i.grayscale)}}function ke(t,e){if(t&1&&m(0,"div",13),t&2){let i=p();R("grayscale",i.grayscale)}}var me=(()=>{let e=class e{constructor(){this.grayscale=!1}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=T({type:e,selectors:[["app-event-severity"]],inputs:{severity:"severity",grayscale:"grayscale"},standalone:!0,features:[I],decls:7,vars:1,consts:[[1,"info",3,"grayscale"],[1,"watch",3,"grayscale"],[1,"warning",3,"grayscale"],[1,"distress",3,"grayscale"],[1,"critical",3,"grayscale"],[1,"severe",3,"grayscale"],[1,"error",3,"grayscale"],[1,"info"],[1,"watch"],[1,"warning"],[1,"distress"],[1,"critical"],[1,"severe"],[1,"error"]],template:function(o,l){if(o&1&&u(0,Te,1,2,"div",0)(1,we,1,2,"div",1)(2,Me,1,2,"div",2)(3,Ie,1,2,"div",3)(4,De,1,2,"div",4)(5,Oe,1,2,"div",5)(6,ke,1,2,"div",6),o&2){let g;S((g=l.severity)==="INFO"?0:g==="WATCH"?1:g==="WARNING"?2:g==="DISTRESS"?3:g==="CRITICAL"?4:g==="SEVERE"?5:g==="ERROR"?6:-1)}},dependencies:[D],styles:['.info[_ngcontent-%COMP%], .watch[_ngcontent-%COMP%], .warning[_ngcontent-%COMP%], .distress[_ngcontent-%COMP%], .critical[_ngcontent-%COMP%], .severe[_ngcontent-%COMP%], .error[_ngcontent-%COMP%]{display:inline-block;height:5px;width:29px;position:relative;background-image:url("./media/level-sprite.png")}.info[_ngcontent-%COMP%]{background-position:0 0}.watch[_ngcontent-%COMP%]{background-position:0 -5px}.warning[_ngcontent-%COMP%]{background-position:0 -10px}.distress[_ngcontent-%COMP%]{background-position:0 -15px}.critical[_ngcontent-%COMP%]{background-position:0 -20px}.severe[_ngcontent-%COMP%], .error[_ngcontent-%COMP%]{background-position:0 -25px}.grayscale[_ngcontent-%COMP%]{filter:grayscale(100%);-webkit-filter:grayscale(100%)}@media print{.info[_ngcontent-%COMP%], .watch[_ngcontent-%COMP%], .warning[_ngcontent-%COMP%], .distress[_ngcontent-%COMP%], .critical[_ngcontent-%COMP%], .severe[_ngcontent-%COMP%], .error[_ngcontent-%COMP%]{-webkit-print-color-adjust:exact;print-color-adjust:exact}}'],changeDetection:0});let t=e;return t})();var pe=(()=>{let e=class e{constructor(n,o,l){this.dialogRef=n,this.yamcs=o,this.data=l,this.delimiterOptions=[{id:"COMMA",label:"Comma"},{id:"SEMICOLON",label:"Semicolon"},{id:"TAB",label:"Tab"}],this.downloadURL$=new b(null),this.form=new J({start:new x(null),stop:new x(null),severity:new x(null,P.required),q:new x(null),source:new x([]),delimiter:new x(null,P.required)}),this.form.setValue({start:l.start?f.toISOString(l.start):"",stop:l.stop?f.toISOString(l.stop):"",q:l.q||"",source:l.source,severity:l.severity,delimiter:"TAB"}),this.formChangeSubscription=this.form.valueChanges.subscribe(()=>{this.updateURL()}),this.updateURL()}closeDialog(){this.dialogRef.close(!0)}updateURL(){if(this.form.valid){let n={delimiter:this.form.value.delimiter,severity:this.form.value.severity};if(this.form.value.start&&(n.start=f.toISOString(this.form.value.start)),this.form.value.stop&&(n.stop=f.toISOString(this.form.value.stop)),this.form.value.q&&(n.q=this.form.value.q),this.form.value.source.length){let l=this.form.value.source;n.source=l}let o=this.yamcs.yamcsClient.getEventsDownloadURL(this.yamcs.instance,n);this.downloadURL$.next(o)}else this.downloadURL$.next(null)}ngOnDestroy(){this.formChangeSubscription?.unsubscribe()}};e.\u0275fac=function(o){return new(o||e)(v(K),v(W),v(X))},e.\u0275cmp=T({type:e,selectors:[["ng-component"]],standalone:!0,features:[I],decls:36,vars:9,consts:[["mat-dialog-title",""],[1,"ya-form"],[3,"formGroup"],["formControlName","start"],["formControlName","stop"],["formControlName","severity",3,"options"],["type","text","formControlName","q"],["formControlName","source","emptyOption","Any source",3,"options"],["formControlName","delimiter",3,"options"],["align","end"],["mat-dialog-close","",1,"ya-button"],[3,"click","link","primary","disabled"]],template:function(o,l){o&1&&(r(0,"h2",0),a(1,"Export events"),s(),r(2,"mat-dialog-content",1)(3,"form",2)(4,"label"),a(5," Start "),m(6,"ya-date-time-input",3),s(),m(7,"br"),r(8,"label"),a(9," Stop "),m(10,"ya-date-time-input",4),s(),m(11,"br"),r(12,"label"),a(13," Severity"),m(14,"br")(15,"ya-select",5),s(),m(16,"br"),r(17,"label"),a(18," Text filter "),m(19,"input",6),s(),m(20,"br"),r(21,"label"),a(22," Source"),m(23,"br")(24,"ya-multi-select",7),s(),m(25,"br"),r(26,"label"),a(27," CSV column delimiter"),m(28,"br")(29,"ya-select",8),s()()(),r(30,"mat-dialog-actions",9)(31,"button",10),a(32,"CANCEL"),s(),r(33,"ya-download-button",11),C(34,"async"),y("click",function(){return l.closeDialog()}),a(35," DOWNLOAD "),s()()),o&2&&(c(3),d("formGroup",l.form),c(12),d("options",l.data.severityOptions),c(9),d("options",l.data.sourceOptions),c(5),d("options",l.delimiterOptions),c(4),d("link",_(34,7,l.downloadURL$))("primary",!0)("disabled",!l.form.valid))},dependencies:[D,A,B,Q,V,$,j,G,Z,tt,it,et,U,Ht,nt,q],encapsulation:2});let t=e;return t})();var at=class{constructor(e){this.watermarkObserver=e,this.dirty=!1,this.archiveEvents=[],this.bufferSize=500,this.bufferWatermark=400,this.pointer=0,this.alreadyWarned=!1,this.realtimeBuffer=Array(this.bufferSize).fill(void 0)}addArchiveData(e){this.archiveEvents=this.archiveEvents.concat(e),this.dirty=!0}addRealtimeEvent(e){this.pointer<this.bufferSize&&(this.realtimeBuffer[this.pointer]=e,this.pointer>=this.bufferWatermark&&this.watermarkObserver&&!this.alreadyWarned&&(this.alreadyWarned=!0,this.watermarkObserver()),this.pointer=this.pointer+1),this.dirty=!0}reset(){this.archiveEvents=[],this.realtimeBuffer.fill(void 0),this.pointer=0,this.alreadyWarned=!1,this.dirty=!0}snapshot(){let e=this.realtimeBuffer.filter(n=>n!==void 0);return this.archiveEvents.concat(e).sort((n,o)=>{let l=-n.generationTime.localeCompare(o.generationTime);return l===0&&(l=-n.source.localeCompare(o.source)),l!==0?l:o.seqNumber-n.seqNumber})}compact(e){let i=this.snapshot();i.length=Math.min(e,i.length),this.reset(),this.archiveEvents=i,this.dirty=!0}};var rt=class extends Tt{constructor(e,i){super(),this.yamcs=e,this.pageSize=100,this.blockHasMore=!1,this.events$=new b([]),this.sources$=new b([]),this.loading$=new b(!1),this.streaming$=new b(!1),this.syncSubscription=i.sync(()=>{this.eventBuffer.dirty&&!this.loading$.getValue()&&(this.emitEvents(),this.eventBuffer.dirty=!1)}),this.eventBuffer=new at(()=>{this.blockHasMore=!0,this.eventBuffer.compact(500)})}connect(){return this.events$}emitEvents(){this.events$.next(this.eventBuffer.snapshot())}loadEvents(e){return this.loading$.next(!0),Promise.all([this.yamcs.yamcsClient.getEventSources(this.yamcs.instance),this.loadPage(lt(st({},e),{limit:this.pageSize+1}))]).then(i=>{let n=i[0],o=i[1];return this.loading$.next(!1),this.eventBuffer.reset(),this.blockHasMore=!1,this.eventBuffer.addArchiveData(o),this.sources$.next(n),this.emitEvents(),o})}hasMore(){return this.offscreenRecord!=null&&!this.blockHasMore}loadPage(e){return this.options=e,this.yamcs.yamcsClient.getEvents(this.yamcs.instance,e).then(i=>(i.length>this.pageSize?(i.splice(i.length-1,1),this.offscreenRecord=i[i.length-1]):this.offscreenRecord=null,i))}loadMoreData(e){this.offscreenRecord&&this.loadPage(lt(st({},e),{stop:this.offscreenRecord.generationTime,limit:this.pageSize+1})).then(i=>{this.eventBuffer.addArchiveData(i),this.emitEvents()})}startStreaming(){this.streaming$.next(!0),this.realtimeSubscription=this.yamcs.yamcsClient.createEventSubscription({instance:this.yamcs.instance},e=>{this.addEventSource(e),!this.loading$.getValue()&&this.matchesFilter(e)&&this.eventBuffer.addRealtimeEvent(e)})}addEventSource(e){if(e.source){for(let i of this.sources$.value)if(i===e.source)return;this.sources$.next([...this.sources$.value,e.source].sort((i,n)=>i.toLowerCase().localeCompare(n.toLocaleLowerCase())))}}matchesFilter(e){if(this.options){if(this.options.source&&e.source!==this.options.source||this.options.q&&e.message.indexOf(this.options.q)===-1)return!1;if(this.options.severity)switch(this.options.severity){case"SEVERE":case"ERROR":if(e.severity==="CRITICAL")return!1;case"CRITICAL":if(e.severity==="DISTRESS")return!1;case"DISTRESS":if(e.severity==="WARNING")return!1;case"WARNING":if(e.severity==="WATCH")return!1;case"WATCH":if(e.severity==="INFO")return!1}}return!0}stopStreaming(){this.realtimeSubscription?.cancel(),this.streaming$.next(!1)}disconnect(){this.stopStreaming(),this.syncSubscription?.unsubscribe(),this.events$.complete(),this.sources$.complete(),this.loading$.complete(),this.streaming$.complete()}};var Le=["intervalSelect"];function Re(t,e){if(t&1){let i=L();r(0,"button",6),y("click",function(){w(i);let o=p();return M(o.createEvent())}),r(1,"mat-icon"),a(2,"add_circle_outline"),s(),a(3," Create event "),s()}}function Ne(t,e){if(t&1){let i=L();r(0,"button",7),y("click",function(){w(i);let o=p();return M(o.stopStreaming())}),r(1,"mat-icon"),a(2,"pause"),s(),a(3," Stop streaming "),s()}}function Fe(t,e){if(t&1){let i=L();r(0,"button",6),y("click",function(){w(i);let o=p();return M(o.startStreaming())}),r(1,"mat-icon"),a(2,"play_arrow"),s(),a(3," Start streaming "),s()}}function Ae(t,e){if(t&1){let i=L();m(0,"ya-date-time-input",36)(1,"ya-date-time-input",37),r(2,"button",35),y("click",function(){w(i);let o=p(2);return M(o.applyCustomDates())}),a(3," Apply "),s()}if(t&2){let i=p(2);c(2),d("disabled",i.filterForm.invalid)}}function Pe(t,e){if(t&1){let i=L();r(0,"button",38),y("click",function(){w(i);let o=p(2);return M(o.jumpToNow())}),a(1,"Jump to now"),s()}}function Ve(t,e){t&1&&m(0,"ya-dots")}function $e(t,e){t&1&&(r(0,"div",18),a(1," Listening for events "),m(2,"ya-dots",39),s())}function Be(t,e){if(t&1&&(r(0,"span"),a(1," Showing events from "),r(2,"b"),a(3,"the last hour"),s(),a(4," ending at "),r(5,"b"),a(6),C(7,"datetime"),s(),a(8," (Mission Time) "),s()),t&2){let i=p(2);c(6),N(_(7,1,i.validStop))}}function je(t,e){if(t&1&&(r(0,"span"),a(1," Showing events from "),r(2,"b"),a(3,"the last 6 hours"),s(),a(4," ending at "),r(5,"b"),a(6),C(7,"datetime"),s(),a(8," (Mission Time) "),s()),t&2){let i=p(2);c(6),N(_(7,1,i.validStop))}}function Ge(t,e){if(t&1&&(r(0,"span"),a(1," Showing events from "),r(2,"b"),a(3,"the last 24 hours"),s(),a(4," ending at "),r(5,"b"),a(6),C(7,"datetime"),s(),a(8," (Mission Time) "),s()),t&2){let i=p(2);c(6),N(_(7,1,i.validStop))}}function Ue(t,e){t&1&&(r(0,"span"),a(1," Showing events from "),r(2,"b"),a(3,"all time"),s()())}function qe(t,e){if(t&1&&(r(0,"span"),a(1," Showing events from "),r(2,"b"),a(3),C(4,"datetime"),s(),a(5," to "),r(6,"b"),a(7),C(8,"datetime"),s(),a(9," (Mission Time) "),s()),t&2){let i=p(2);c(3),N(_(4,2,i.validStart)),c(4),N(_(8,4,i.validStop))}}function We(t,e){t&1&&(r(0,"th",40),a(1,"Severity"),s())}function He(t,e){if(t&1&&(r(0,"td",41),m(1,"app-event-severity",42),s()),t&2){let i=e.$implicit;c(),d("severity",i.severity)}}function Ye(t,e){t&1&&(r(0,"th",40),a(1,"Message"),s())}function ze(t,e){if(t&1&&(r(0,"td",43),m(1,"app-event-message",44),s()),t&2){let i=e.$implicit,n=p(2);c(),d("message",i.message)("highlight",n.filterForm.value.filter)}}function Qe(t,e){t&1&&(r(0,"th",40),a(1,"Type"),s())}function Je(t,e){if(t&1&&(r(0,"td",41),a(1),s()),t&2){let i=e.$implicit;c(),F(" ",i.type||"-"," ")}}function Ke(t,e){t&1&&(r(0,"th",40),a(1,"Source"),s())}function Xe(t,e){if(t&1&&(r(0,"td",41),a(1),s()),t&2){let i=e.$implicit;c(),F(" ",i.source||"-"," ")}}function Ze(t,e){t&1&&(r(0,"th",40),a(1,"Generation Time"),s())}function ti(t,e){if(t&1&&(r(0,"td",45),a(1),C(2,"datetime"),s()),t&2){let i=e.$implicit;c(),F(" ",_(2,1,i.generationTime)||"-"," ")}}function ei(t,e){t&1&&(r(0,"th",40),a(1,"Reception Time"),s())}function ii(t,e){if(t&1&&(r(0,"td",45),a(1),C(2,"datetime"),s()),t&2){let i=e.$implicit;c(),F(" ",_(2,1,i.receptionTime)||"-"," ")}}function ni(t,e){t&1&&(r(0,"th",40),a(1,"Sequence Number"),s())}function oi(t,e){if(t&1&&(r(0,"td",41),a(1),s()),t&2){let i,n=e.$implicit;c(),F(" ",(i=n.seqNumber)!==null&&i!==void 0?i:"-"," ")}}function ai(t,e){if(t&1&&(r(0,"th",40),a(1),s()),t&2){let i=p().$implicit;c(),N(i.label)}}function ri(t,e){if(t&1&&a(0),t&2){let i,n=p().$implicit,o=p().$implicit;F(" ",(i=n.extra[o.id])!==null&&i!==void 0?i:"-"," ")}}function si(t,e){t&1&&a(0," - ")}function li(t,e){if(t&1&&(r(0,"td",41),u(1,ri,1,1)(2,si,1,0),s()),t&2){let i=e.$implicit;c(),S(i.extra?1:2)}}function ci(t,e){if(t&1&&(O(0,32),u(1,ai,2,1,"th",22)(2,li,3,1,"td",23),k()),t&2){let i=e.$implicit;d("cdkColumnDef",i.id)}}function mi(t,e){t&1&&m(0,"tr",46)}function pi(t,e){if(t&1&&m(0,"tr",47),t&2){let i=e.$implicit;d("ngClass",i.severity)}}function di(t,e){if(t&1){let i=L();r(0,"div",5)(1,"form",8)(2,"div",9),m(3,"ya-search-filter",10)(4,"ya-column-chooser",11,0)(6,"div",12),r(7,"button",13),y("click",function(){w(i);let o=p();return M(o.exportEvents())}),r(8,"mat-icon"),a(9,"download"),s(),a(10," Export CSV "),s()(),r(11,"div",9),m(12,"ya-select",14)(13,"ya-multi-select",15),C(14,"async"),m(15,"ya-select",16,1),u(17,Ae,4,1)(18,Pe,2,0,"button",17)(19,Ve,1,0,"ya-dots"),C(20,"async"),u(21,$e,3,0,"div",18),C(22,"async"),s()(),r(23,"div",19),u(24,Be,9,3,"span")(25,je,9,3,"span")(26,Ge,9,3,"span")(27,Ue,4,0,"span")(28,qe,10,6,"span"),s(),r(29,"table",20),O(30,21),u(31,We,2,0,"th",22)(32,He,2,1,"td",23),k(),O(33,24),u(34,Ye,2,0,"th",22)(35,ze,2,2,"td",25),k(),O(36,26),u(37,Qe,2,0,"th",22)(38,Je,2,1,"td",23),k(),O(39,27),u(40,Ke,2,0,"th",22)(41,Xe,2,1,"td",23),k(),O(42,28),u(43,Ze,2,0,"th",22)(44,ti,3,3,"td",29),k(),O(45,30),u(46,ei,2,0,"th",22)(47,ii,3,3,"td",29),k(),O(48,31),u(49,ni,2,0,"th",22)(50,oi,2,1,"td",23),k(),vt(51,ci,3,1,"ng-container",32,ht),u(53,mi,1,0,"tr",33),C(54,"async"),u(55,pi,1,1,"tr",34),C(56,"async"),s(),r(57,"mat-toolbar"),m(58,"span",12),r(59,"button",35),y("click",function(){w(i);let o=p();return M(o.loadMoreData())}),a(60," Load More "),s(),m(61,"span",12),s()()}if(t&2){let i,n=yt(5),o=p();c(),d("formGroup",o.filterForm),c(3),d("columns",o.columns),c(8),d("options",o.severityOptions),c(),d("options",_(14,14,o.sourceOptions$)),c(2),d("options",o.intervalOptions),c(2),S(o.filterForm.value.interval==="CUSTOM"?17:-1),c(),S(o.filterForm.value.interval!=="CUSTOM"?18:-1),c(),S(_(20,16,o.dataSource.loading$)?19:-1),c(2),S(_(22,18,o.dataSource.streaming$)?21:-1),c(3),S((i=o.appliedInterval)==="PT1H"?24:i==="PT6H"?25:i==="P1D"?26:i==="NO_LIMIT"?27:i==="CUSTOM"?28:-1),c(5),d("dataSource",o.dataSource),c(22),Ct(o.extraColumns),c(2),d("cdkHeaderRowDef",_(54,20,n.displayedColumns$)),c(2),d("cdkRowDefColumns",_(56,22,n.displayedColumns$)),c(4),d("disabled",!o.dataSource.hasMore())}}var Y="PT1H",de=(()=>{let e=class e{constructor(n,o,l,g,ue,fe,he,ve){this.yamcs=n,this.authService=o,this.dialog=l,this.router=ue,this.route=fe,this.filterForm=new J({filter:new x,severity:new x("INFO"),source:new x([]),interval:new x(Y),customStart:new x(null),customStop:new x(null)}),this.columns=[{id:"severity",label:"Severity",visible:!0},{id:"gentime",label:"Generation time",alwaysVisible:!0},{id:"message",label:"Message",alwaysVisible:!0},{id:"source",label:"Source",visible:!0},{id:"type",label:"Type",visible:!0},{id:"rectime",label:"Reception time"},{id:"seqNumber",label:"Sequence number"}],this.extraColumns=[],this.severityOptions=[{id:"INFO",label:"Info level"},{id:"WATCH",label:"Watch level"},{id:"WARNING",label:"Warning level"},{id:"DISTRESS",label:"Distress level"},{id:"CRITICAL",label:"Critical level"},{id:"SEVERE",label:"Severe level"}],this.sourceOptions$=new b([]),this.intervalOptions=[{id:"PT1H",label:"Last hour"},{id:"PT6H",label:"Last 6 hours"},{id:"P1D",label:"Last 24 hours"},{id:"NO_LIMIT",label:"No limit"},{id:"CUSTOM",label:"Custom",group:!0}],this.downloadURL$=new b(null),this.severity="INFO",this.source=[],he.setTitle("Events");let pt=g.getConfig().events;if(pt){this.extraColumns=pt.extraColumns||[];for(let h of this.extraColumns)for(let E=0;E<this.columns.length;E++)if(this.columns[E].id===h.after){this.columns.splice(E+1,0,h);break}}n.yamcsClient.getEventSources(n.instance).then(h=>{for(let E of h)this.sourceOptions$.next([...this.sourceOptions$.value,{id:E,label:E}])}),this.dataSource=new rt(n,ve),this.dataSource.sources$.subscribe(h=>{this.sourceOptions$.next(h.map(E=>({id:E,label:E})))}),this.initializeOptions(),this.loadData(),this.filterForm.get("filter").valueChanges.pipe(dt(400)).forEach(h=>{this.filter=h,this.loadData()}),this.filterForm.get("severity").valueChanges.forEach(h=>{this.severity=h,this.loadData()}),this.filterForm.get("source").valueChanges.forEach(h=>{this.source=h,this.loadData()}),this.filterForm.get("interval").valueChanges.forEach(h=>{if(h==="CUSTOM"){let E=this.validStart||this.yamcs.getMissionTime(),Ce=this.validStop||this.yamcs.getMissionTime();this.filterForm.get("customStart").setValue(f.toISOString(E)),this.filterForm.get("customStop").setValue(f.toISOString(Ce))}else h==="NO_LIMIT"?(this.validStart=null,this.validStop=null,this.appliedInterval=h,this.loadData()):(this.validStop=n.getMissionTime(),this.validStart=f.subtractDuration(this.validStop,h),this.appliedInterval=h,this.loadData())})}initializeOptions(){let n=this.route.snapshot.queryParamMap;if(n.has("filter")&&(this.filter=n.get("filter")||"",this.filterForm.get("filter").setValue(this.filter)),n.has("severity")&&(this.severity=n.get("severity"),this.filterForm.get("severity").setValue(this.severity)),n.has("source")&&(this.source=n.getAll("source"),this.filterForm.get("source").setValue(this.source)),n.has("interval"))if(this.appliedInterval=n.get("interval"),this.filterForm.get("interval").setValue(this.appliedInterval),this.appliedInterval==="CUSTOM"){let o=n.get("customStart");this.filterForm.get("customStart").setValue(o),this.validStart=f.toDate(o);let l=n.get("customStop");this.filterForm.get("customStop").setValue(l),this.validStop=f.toDate(l)}else this.appliedInterval==="NO_LIMIT"?(this.validStart=null,this.validStop=null):(this.validStop=this.yamcs.getMissionTime(),this.validStart=f.subtractDuration(this.validStop,this.appliedInterval));else this.appliedInterval=Y,this.validStop=this.yamcs.getMissionTime(),this.validStart=f.subtractDuration(this.validStop,Y)}jumpToNow(){let n=this.filterForm.value.interval;n==="NO_LIMIT"?this.filterForm.get("interval").setValue(Y):n==="CUSTOM"?this.filterForm.get("interval").setValue(Y):(this.validStop=this.yamcs.getMissionTime(),this.validStart=f.subtractDuration(this.validStop,n),this.loadData())}startStreaming(){this.filterForm.get("interval").setValue("NO_LIMIT"),this.dataSource.startStreaming()}stopStreaming(){this.dataSource.stopStreaming()}applyCustomDates(){this.validStart=f.toDate(this.filterForm.value.customStart),this.validStop=f.toDate(this.filterForm.value.customStop),this.appliedInterval="CUSTOM",this.loadData()}loadData(){this.updateURL();let n={severity:this.severity};this.validStart&&(n.start=this.validStart.toISOString()),this.validStop&&(n.stop=this.validStop.toISOString()),this.filter&&(n.q=this.filter),this.source.length&&(n.source=this.source),this.dataSource.loadEvents(n)}loadMoreData(){let n={severity:this.severity};this.validStart&&(n.start=this.validStart.toISOString()),this.filter&&(n.q=this.filter),this.source.length&&(n.source=this.source),this.dataSource.loadMoreData(n)}updateURL(){this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParams:{filter:this.filter||null,severity:this.severity,source:this.source.length?this.source:null,interval:this.appliedInterval,customStart:this.appliedInterval==="CUSTOM"?this.filterForm.value.customStart:null,customStop:this.appliedInterval==="CUSTOM"?this.filterForm.value.customStop:null},queryParamsHandling:"merge"})}mayWriteEvents(){return this.authService.getUser().hasSystemPrivilege("WriteEvents")}createEvent(){this.dialog.open(se,{width:"400px"}).afterClosed().subscribe(o=>{o&&this.jumpToNow()})}exportEvents(){this.dialog.open(pe,{width:"400px",data:{severity:this.severity,severityOptions:this.severityOptions,start:this.validStart,stop:this.validStop,q:this.filter,source:this.source,sourceOptions:this.sourceOptions$.value}})}};e.\u0275fac=function(o){return new(o||e)(v(W),v(ot),v(Lt),v(qt),v(z),v(bt),v(Et),v(Kt))},e.\u0275cmp=T({type:e,selectors:[["ng-component"]],viewQuery:function(o,l){if(o&1&&_t(Le,5),o&2){let g;gt(g=St())&&(l.intervalSelect=g.first)}},standalone:!0,features:[I],decls:11,vars:5,consts:[["columnChooser",""],["intervalSelect",""],["mat-button","","color","primary"],["mat-button","","matTooltip","Pause streaming events","color","primary"],["mat-icon-button","","matTooltip","Jump to now","color","primary",3,"click"],[1,"panel-content"],["mat-button","","color","primary",3,"click"],["mat-button","","matTooltip","Pause streaming events","color","primary",3,"click"],[3,"formGroup"],[1,"filter-bar"],["formControlName","filter","placeholder","Filter by text search"],["preferenceKey","events",3,"columns"],[2,"flex","1 1 auto"],[1,"ya-button","primary",2,"margin-right","0",3,"click"],["formControlName","severity",3,"options"],["formControlName","source","emptyOption","Any source",3,"options"],["icon","access_time","formControlName","interval",3,"options"],[1,"ya-button"],[2,"text-align","right","flex","1 1 150px"],[1,"table-status"],["mat-table","",1,"ya-data-table","expand",3,"dataSource"],["cdkColumnDef","severity"],["mat-header-cell","",4,"cdkHeaderCellDef"],["mat-cell","",4,"cdkCellDef"],["cdkColumnDef","message"],["mat-cell","","class","mono message expand",4,"cdkCellDef"],["cdkColumnDef","type"],["cdkColumnDef","source"],["cdkColumnDef","gentime"],["mat-cell","","style","white-space: nowrap",4,"cdkCellDef"],["cdkColumnDef","rectime"],["cdkColumnDef","seqNumber"],[3,"cdkColumnDef"],["mat-header-row","",4,"cdkHeaderRowDef"],["mat-row","",3,"ngClass",4,"cdkRowDef","cdkRowDefColumns"],[1,"ya-button",3,"click","disabled"],["formControlName","customStart"],["formControlName","customStop"],[1,"ya-button",3,"click"],["fontSize","16px","color","#1b61b9"],["mat-header-cell",""],["mat-cell",""],[3,"severity"],["mat-cell","",1,"mono","message","expand"],[3,"message","highlight"],["mat-cell","",2,"white-space","nowrap"],["mat-header-row",""],["mat-row","",3,"ngClass"]],template:function(o,l){o&1&&(r(0,"app-instance-page")(1,"app-instance-toolbar"),a(2," Events \xA0\xA0\xA0 "),u(3,Re,4,0,"button",2)(4,Ne,4,0,"button",3),C(5,"async"),u(6,Fe,4,0,"button",2),r(7,"button",4),y("click",function(){return l.jumpToNow()}),r(8,"mat-icon"),a(9,"refresh"),s()()(),u(10,di,62,24,"div",5),s()),o&2&&(c(3),S(l.mayWriteEvents()?3:-1),c(),S(_(5,3,l.dataSource.streaming$)?4:6),c(6),S(l.dataSource?10:-1))},dependencies:[ce,me,Zt,Xt,D,xt,A,B,V,$,j,G,Pt,Rt,Nt,Ft,At,It,Dt,Mt,Vt,$t,Bt,jt,Gt,kt,Ot,Ut,U,Wt,nt,Qt,q,Jt],styles:[".table-status[_ngcontent-%COMP%]{background-color:var(--y-background-color);height:24px;line-height:24px;font-size:12px;padding-left:6px}.table-status[_ngcontent-%COMP%]   .message-zone[_ngcontent-%COMP%]{float:right;height:24px;line-height:24px;font-size:12px;padding-right:6px}.ya-data-table[_ngcontent-%COMP%]   td.mat-mdc-cell.message[_ngcontent-%COMP%]{white-space:pre-wrap}"],changeDetection:0});let t=e;return t})();var sn=[{path:"",canActivate:[ee,te],canActivateChild:[ie],runGuardsAndResolvers:"always",component:ne,children:[{path:"",pathMatch:"full",component:de,canActivate:[oe]}]}];export{sn as ROUTES};
