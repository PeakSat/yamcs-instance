import{a as jt}from"./chunk-QM2PL5Q2.js";import{a as vt}from"./chunk-2PCCNYKX.js";import{a as Ee}from"./chunk-EL7VJGKE.js";import"./chunk-LYLI3P7F.js";import{b as Ct,d as ht,e as Ae,f as De}from"./chunk-FTOGDGWN.js";import{Aa as r,Ba as j,Bd as Ot,Ca as C,Cd as _e,Da as $,Db as N,Dd as ue,Eb as O,F as E,Ga as I,Gb as it,Ha as Xt,Hd as W,Ia as L,Ib as H,Jb as P,K as g,L as y,La as x,Ld as fe,Ma as S,Md as Ce,Na as wt,Nb as R,Oa as Zt,Od as he,Qb as q,R as U,Re as M,Sc as at,Tc as ot,U as Jt,Uc as lt,Ue as ye,Ve as k,Wc as rt,We as Te,X as s,Xc as mt,Xe as be,Y as v,Yb as kt,Yd as ut,Ye as we,Zc as st,_a as Dt,_b as G,_c as ct,_d as ve,aa as p,ab as Et,ad as dt,bc as ae,bd as pt,be as xe,ca as _,da as Bt,dd as _t,e as B,ea as Ut,eb as Z,ed as Nt,fc as oe,ga as d,i as yt,ib as te,id as se,ie as ft,jd as ce,ka as a,kd as de,la as l,ma as f,mb as tt,mc as nt,md as pe,na as A,nb as ee,ne as Se,oa as b,ob as et,oc as le,p as Qt,pb as Y,pc as re,qa as D,qb as ie,qc as Mt,ra as T,rc as Vt,sa as c,sc as me,tc as Lt,te as z,uc as Ht,vb as ne,vc as Ft,wa as Tt,wc as $t,we as ge,xa as At,ya as bt,yd as w,za as St,zb as It}from"./chunk-YLFXKKOP.js";var Re=()=>({matrixParams:"exact",paths:"exact",queryParams:"ignored"}),Yt=t=>({c:t}),xt=(()=>{let i=class i{constructor(o){this.yamcs=o}};i.\u0275fac=function(n){return new(n||i)(v(M))},i.\u0275cmp=E({type:i,selectors:[["app-alarms-page-tabs"]],standalone:!0,features:[I],decls:13,vars:16,consts:[["rla","routerLinkActive"],["rlb","routerLinkActive"],["rlc","routerLinkActive"],["tabPanel",""],["mat-tab-nav-bar","",1,"secondary",3,"mat-stretch-tabs","tabPanel"],["mat-tab-link","","routerLink","/alarms","routerLinkActive","",3,"routerLinkActiveOptions","active","queryParams"],["mat-tab-link","","routerLink","/alarms/history","routerLinkActive","",3,"active","queryParams"],["mat-tab-link","","routerLink","/alarms/log","routerLinkActive","",3,"active","queryParams"]],template:function(n,m){if(n&1&&(a(0,"nav",4)(1,"a",5,0),r(3," Active "),l(),a(4,"a",6,1),r(6," History "),l(),a(7,"a",7,2),r(9," Action log "),l()(),a(10,"mat-tab-nav-panel",null,3),f(12,"router-outlet"),l()),n&2){let u=St(2),h=St(5),F=St(8),J=St(11);_("mat-stretch-tabs",!1)("tabPanel",J),s(),_("routerLinkActiveOptions",Xt(9,Re))("active",u.isActive)("queryParams",L(10,Yt,m.yamcs.context)),s(3),_("active",h.isActive)("queryParams",L(12,Yt,m.yamcs.context)),s(3),_("active",F.isActive)("queryParams",L(14,Yt,m.yamcs.context))}},dependencies:[k,ee,Y,ie,se,de,ce],styles:[".mat-mdc-tab-link[_ngcontent-%COMP%]{height:36px;min-width:0;font-size:13px}"],changeDetection:0});let t=i;return t})();var qe=["intervalSelect"];function Ge(t,i){if(t&1){let e=D();f(0,"ya-date-time-input",16)(1,"ya-date-time-input",17),a(2,"button",18),T("click",function(){g(e);let n=c();return y(n.applyCustomDates())}),r(3," Apply "),l()}if(t&2){let e=c();s(2),_("disabled",e.filterForm.invalid)}}function Be(t,i){if(t&1){let e=D();a(0,"button",19),T("click",function(){g(e);let n=c();return y(n.jumpToNow())}),r(1,"Jump to now"),l()}}function Ue(t,i){t&1&&(a(0,"th",20),r(1,"Time"),l())}function je(t,i){if(t&1&&(a(0,"td",21),r(1),x(2,"datetime"),l()),t&2){let e=i.$implicit;s(),j(S(2,1,e.time))}}function Ye(t,i){t&1&&(a(0,"th",20),r(1,"User"),l())}function We(t,i){if(t&1&&(a(0,"td",21),r(1),l()),t&2){let e=i.$implicit;s(),j(e.user||"-")}}function ze(t,i){t&1&&(a(0,"th",20),r(1,"Action"),l())}function Ke(t,i){if(t&1&&(a(0,"td",21),f(1,"span",22),x(2,"actionLogFormat"),l()),t&2){let e=i.$implicit;s(),_("innerHTML",S(2,1,e.summary)||"-",Jt)}}function Qe(t,i){t&1&&f(0,"th",23)}function Je(t,i){t&1&&f(0,"td",21)}function Xe(t,i){t&1&&f(0,"tr",24)}function Ze(t,i){t&1&&f(0,"tr",25)}var ke=(()=>{let i=class i{constructor(o,n,m,u){this.yamcs=o,this.messageService=n,this.router=m,this.route=u,this.filterForm=new it({filter:new H,interval:new H("NO_LIMIT"),customStart:new H(null),customStop:new H(null)}),this.displayedColumns=["time","user","summary","actions"],this.intervalOptions=[{id:"PT1H",label:"Last hour"},{id:"PT6H",label:"Last 6 hours"},{id:"P1D",label:"Last 24 hours"},{id:"NO_LIMIT",label:"No limit"},{id:"CUSTOM",label:"Custom",group:!0}],this.dataSource=new Nt,this.initializeOptions(),this.loadData(),this.filterForm.get("interval").valueChanges.forEach(h=>{if(h==="CUSTOM"){let F=new Date,J=this.validStart||F,V=this.validStop||F;this.filterForm.get("customStart").setValue(w.toISOString(J)),this.filterForm.get("customStop").setValue(w.toISOString(V))}else h==="NO_LIMIT"?(this.validStart=null,this.validStop=null,this.appliedInterval=h,this.loadData()):(this.validStop=new Date,this.validStart=w.subtractDuration(this.validStop,h),this.appliedInterval=h,this.loadData())})}initializeOptions(){let o=this.route.snapshot.queryParamMap;if(o.has("filter")&&(this.filter=o.get("filter")||"",this.filterForm.get("filter").setValue(this.filter)),o.has("interval"))if(this.appliedInterval=o.get("interval"),this.filterForm.get("interval").setValue(this.appliedInterval),this.appliedInterval==="CUSTOM"){let n=o.get("customStart");this.filterForm.get("customStart").setValue(n),this.validStart=w.toDate(n);let m=o.get("customStop");this.filterForm.get("customStop").setValue(m),this.validStop=w.toDate(m)}else this.appliedInterval==="NO_LIMIT"?(this.validStart=null,this.validStop=null):(this.validStop=new Date,this.validStart=w.subtractDuration(this.validStop,this.appliedInterval));else this.appliedInterval="NO_LIMIT",this.validStop=null,this.validStart=null}jumpToNow(){this.filterForm.get("interval").setValue("NO_LIMIT")}applyCustomDates(){this.validStart=w.toDate(this.filterForm.value.customStart),this.validStop=w.toDate(this.filterForm.value.customStop),this.appliedInterval="CUSTOM",this.loadData()}loadData(){this.updateURL();let o={service:"AlarmsApi"};this.validStart&&(o.start=this.validStart.toISOString()),this.validStop&&(o.stop=this.validStop.toISOString()),this.filter&&(o.q=this.filter),this.yamcs.yamcsClient.getAuditRecords(this.yamcs.instance,o).then(n=>this.dataSource.data=n.records||[]).catch(n=>this.messageService.showError(n))}updateURL(){this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParams:{filter:this.filter||null,interval:this.appliedInterval,customStart:this.appliedInterval==="CUSTOM"?this.filterForm.value.customStart:null,customStop:this.appliedInterval==="CUSTOM"?this.filterForm.value.customStop:null},queryParamsHandling:"merge"})}};i.\u0275fac=function(n){return new(n||i)(v(M),v(ut),v(et),v(tt))},i.\u0275cmp=E({type:i,selectors:[["app-alarms-action-log-tab"]],viewQuery:function(n,m){if(n&1&&Tt(qe,5),n&2){let u;At(u=bt())&&(m.intervalSelect=u.first)}},standalone:!0,features:[I],decls:26,vars:7,consts:[["intervalSelect",""],[1,"panel-content"],[2,"margin-top","16px",3,"formGroup"],[1,"filter-bar"],["icon","access_time","formControlName","interval",3,"options"],[1,"ya-button"],["mat-table","",1,"ya-data-table","expand",3,"dataSource"],["matColumnDef","time"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","user"],["matColumnDef","summary"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["formControlName","customStart"],["formControlName","customStop"],[1,"ya-button",3,"click","disabled"],[1,"ya-button",3,"click"],["mat-header-cell",""],["mat-cell",""],[3,"innerHTML"],["mat-header-cell","",1,"expand"],["mat-header-row",""],["mat-row",""]],template:function(n,m){n&1&&(a(0,"app-instance-page")(1,"app-instance-toolbar"),r(2," Alarms "),l(),a(3,"div",1),f(4,"app-alarms-page-tabs"),a(5,"form",2)(6,"div",3),f(7,"ya-select",4,0),p(9,Ge,4,1)(10,Be,2,0,"button",5),l()(),a(11,"table",6),A(12,7),p(13,Ue,2,0,"th",8)(14,je,3,3,"td",9),b(),A(15,10),p(16,Ye,2,0,"th",8)(17,We,2,1,"td",9),b(),A(18,11),p(19,ze,2,0,"th",8)(20,Ke,3,3,"td",9),b(),A(21,12),p(22,Qe,1,0,"th",13)(23,Je,1,0,"td",9),b(),p(24,Xe,1,0,"tr",14)(25,Ze,1,0,"tr",15),l()()()),n&2&&(s(5),_("formGroup",m.filterForm),s(2),_("options",m.intervalOptions),s(2),d(m.filterForm.value.interval==="CUSTOM"?9:-1),s(),d(m.filterForm.value.interval!=="CUSTOM"?10:-1),s(),_("dataSource",m.dataSource),s(13),_("matHeaderRowDef",m.displayedColumns),s(),_("matRowDefColumns",m.displayedColumns))},dependencies:[xt,ht,Ct,k,P,N,O,R,q,at,lt,ct,rt,ot,dt,mt,st,pt,_t,Ot,W,Se,z],encapsulation:2,changeDetection:0});let t=i;return t})();var ti=["intervalSelect"],Wt=t=>({c:t});function ei(t,i){if(t&1){let e=D();f(0,"ya-date-time-input",10)(1,"ya-date-time-input",11),a(2,"button",12),T("click",function(){g(e);let n=c();return y(n.applyCustomDates())}),r(3," Apply "),l()}if(t&2){let e=c();s(2),_("disabled",e.filterForm.invalid)}}function ii(t,i){if(t&1){let e=D();a(0,"button",13),T("click",function(){g(e);let n=c();return y(n.jumpToNow())}),r(1,"Jump to now"),l()}}function ni(t,i){t&1&&(a(0,"th",31),r(1,"Severity"),l())}function ai(t,i){if(t&1&&(a(0,"td",32),f(1,"app-alarm-level",33),l()),t&2){let e=i.$implicit;s(),_("level",e.severity)("grayscale",!0)}}function oi(t,i){t&1&&(a(0,"th",31),r(1,"Alarm type"),l())}function li(t,i){t&1&&(a(0,"mat-icon",34),r(1,"event_note"),l())}function ri(t,i){t&1&&(a(0,"mat-icon",34),r(1,"toll"),l())}function mi(t,i){if(t&1&&(a(0,"td",32),p(1,li,2,0,"mat-icon",34)(2,ri,2,0,"mat-icon",34),r(3),x(4,"titlecase"),l()),t&2){let e=i.$implicit;s(),d(e.type==="EVENT"?1:-1),s(),d(e.type==="PARAMETER"?2:-1),s(),C(" ",S(4,3,e.type||"-")," ")}}function si(t,i){t&1&&(a(0,"th",31),r(1,"Start"),l())}function ci(t,i){if(t&1&&(a(0,"td",32),r(1),x(2,"datetime"),l()),t&2){let e=i.$implicit;s(),j(S(2,1,e.triggerTime)||"-")}}function di(t,i){t&1&&(a(0,"th",31),r(1,"Stop"),l())}function pi(t,i){if(t&1&&(a(0,"td",32),r(1),x(2,"datetime"),l()),t&2){let e=i.$implicit;s(),C(" ",S(2,1,e.updateTime)||"-"," ")}}function _i(t,i){t&1&&(a(0,"th",31),r(1,"Trip value"),l())}function ui(t,i){t&1&&(a(0,"span"),r(1,"\u2193"),l())}function fi(t,i){t&1&&(a(0,"span"),r(1,"\u2191"),l())}function Ci(t,i){if(t&1&&(r(0),x(1,"value"),p(2,ui,2,0,"span")(3,fi,2,0,"span")),t&2){let e=i;C(" ",S(1,3,e.triggerValue.engValue)," "),s(2),d(e.triggerValue.rangeCondition==="LOW"?2:-1),s(),d(e.triggerValue.rangeCondition==="HIGH"?3:-1)}}function hi(t,i){t&1&&r(0),t&2&&C(" ",i.triggerEvent.message||"-"," ")}function vi(t,i){if(t&1&&(a(0,"td",35),p(1,Ci,4,5)(2,hi,1,1),l()),t&2){let e,o,n=i.$implicit;s(),d((e=n.parameterDetail)?1:-1,e),s(),d((o=n.eventDetail)?2:-1,o)}}function xi(t,i){t&1&&(a(0,"th",31),r(1,"Alarm name"),l())}function Si(t,i){if(t&1&&(a(0,"a",36),r(1),l()),t&2){let e=c(2).$implicit,o=c(2);_("routerLink","/telemetry/parameters"+e.id.namespace+"/"+e.id.name)("queryParams",L(4,Wt,o.yamcs.context)),s(),$(" ",e.id.namespace,"/",e.id.name," ")}}function gi(t,i){if(t&1&&r(0),t&2){let e=c(2).$implicit;$(" ",e.id.namespace,"/",e.id.name," ")}}function yi(t,i){if(t&1&&p(0,Si,2,6,"a",36)(1,gi,1,2),t&2){let e=c().$implicit;d(e.parameterDetail?0:1)}}function Ti(t,i){if(t&1&&(a(0,"a",36),r(1),l()),t&2){let e=c(2).$implicit,o=c(2);_("routerLink","/telemetry/parameters"+e.id.namespace)("queryParams",L(3,Wt,o.yamcs.context)),s(),C(" ",e.id.namespace," ")}}function Ai(t,i){if(t&1&&r(0),t&2){let e=c(2).$implicit;C(" ",e.id.namespace," ")}}function bi(t,i){if(t&1&&p(0,Ti,2,5,"a",36)(1,Ai,1,1),t&2){let e=c().$implicit;d(e.parameterDetail?0:1)}}function wi(t,i){if(t&1&&(a(0,"a",36),r(1),l()),t&2){let e=c(2).$implicit,o=c(2);_("routerLink","/telemetry/parameters"+e.id.name)("queryParams",L(3,Wt,o.yamcs.context)),s(),C(" ",e.id.name," ")}}function Di(t,i){if(t&1&&r(0),t&2){let e=c(2).$implicit;C(" ",e.id.name," ")}}function Ei(t,i){if(t&1&&p(0,wi,2,5,"a",36)(1,Di,1,1),t&2){let e=c().$implicit;d(e.parameterDetail?0:1)}}function Ii(t,i){if(t&1&&(a(0,"td",32),p(1,yi,2,1)(2,bi,2,1)(3,Ei,2,1),l()),t&2){let e=i.$implicit;s(),d(e.id.namespace&&e.id.name?1:-1),s(),d(e.id.namespace&&!e.id.name?2:-1),s(),d(!e.id.namespace&&e.id.name?3:-1)}}function ki(t,i){t&1&&(a(0,"th",31),r(1,"Duration"),l())}function Mi(t,i){if(t&1&&(r(0),x(1,"duration")),t&2){let e=c().$implicit,o=c(2);C(" ",S(1,1,o.durationFor(e))||"-"," ")}}function Vi(t,i){if(t&1&&(a(0,"mat-icon",37),r(1,"comment"),l()),t&2){let e=c(2).$implicit;_("matTooltip",e.clearInfo==null?null:e.clearInfo.clearMessage)}}function Li(t,i){if(t&1&&(r(0),p(1,Vi,2,1,"mat-icon",37)),t&2){let e=c().$implicit;C(" (cleared by ",e.clearInfo==null?null:e.clearInfo.clearedBy,") "),s(),d(e.clearInfo!=null&&e.clearInfo.clearMessage?1:-1)}}function Hi(t,i){if(t&1&&(a(0,"td",32),p(1,Mi,2,3)(2,Li,2,2),l()),t&2){let e=i.$implicit;s(),d(e.updateTime?1:-1),s(),d(e.clearInfo!=null&&e.clearInfo.clearedBy?2:-1)}}function Fi(t,i){t&1&&(a(0,"th",38),r(1,"Violations"),l())}function $i(t,i){if(t&1&&(r(0),x(1,"number"),x(2,"number")),t&2){let e=c().$implicit;$(" ",S(1,2,e.violations)," (",wt(2,4,e.violations/e.count*100,"1.2-2"),"%) ")}}function Ni(t,i){t&1&&r(0," - ")}function Oi(t,i){if(t&1&&(a(0,"td",39),p(1,$i,3,7)(2,Ni,1,0),l()),t&2){let e=i.$implicit;s(),d(e.violations?1:2)}}function Pi(t,i){t&1&&f(0,"th",40)}function Ri(t,i){if(t&1){let e=D();a(0,"ya-text-action",43),T("click",function(){g(e);let n=c().$implicit,m=c(2);return y(m.showChart(n))}),r(1," SHOW CHART "),l()}}function qi(t,i){if(t&1){let e=D();a(0,"ya-text-action",44),T("click",function(){g(e);let n=c().$implicit,m=c(2);return y(m.showData(n))}),r(1," SHOW DATA "),l()}}function Gi(t,i){if(t&1&&(a(0,"td",32),p(1,Ri,2,0,"ya-text-action",41)(2,qi,2,0,"ya-text-action",42),l()),t&2){let e=i.$implicit;s(),d(e.parameterDetail?1:-1),s(),d(e.parameterDetail?2:-1)}}function Bi(t,i){t&1&&f(0,"tr",45)}function Ui(t,i){t&1&&f(0,"tr",46)}function ji(t,i){if(t&1&&(a(0,"table",7),A(1,14),p(2,ni,2,0,"th",15)(3,ai,2,2,"td",16),b(),A(4,17),p(5,oi,2,0,"th",15)(6,mi,5,5,"td",16),b(),A(7,18),p(8,si,2,0,"th",15)(9,ci,3,3,"td",16),b(),A(10,19),p(11,di,2,0,"th",15)(12,pi,3,3,"td",16),b(),A(13,20),p(14,_i,2,0,"th",15)(15,vi,3,2,"td",21),b(),A(16,22),p(17,xi,2,0,"th",15)(18,Ii,4,3,"td",16),b(),A(19,23),p(20,ki,2,0,"th",15)(21,Hi,3,2,"td",16),b(),A(22,24),p(23,Fi,2,0,"th",25)(24,Oi,3,1,"td",26),b(),A(25,27),p(26,Pi,1,0,"th",28)(27,Gi,3,2,"td",16),b(),p(28,Bi,1,0,"tr",29)(29,Ui,1,0,"tr",30),l()),t&2){let e=c();_("dataSource",e.dataSource),s(28),_("matHeaderRowDef",e.displayedColumns),s(),_("matRowDefColumns",e.displayedColumns)}}var Ve=(()=>{let i=class i{constructor(o,n,m,u){this.yamcs=o,this.router=n,this.route=m,this.messageService=u,this.filterForm=new it({interval:new H("NO_LIMIT"),customStart:new H(null),customStop:new H(null)}),this.displayedColumns=["severity","start","stop","duration","alarm","type","triggerValue","violations","actions"],this.intervalOptions=[{id:"PT1H",label:"Last hour"},{id:"PT6H",label:"Last 6 hours"},{id:"P1D",label:"Last 24 hours"},{id:"NO_LIMIT",label:"No limit"},{id:"CUSTOM",label:"Custom",group:!0}],this.dataSource=new Nt,this.initializeOptions(),this.loadData(),this.filterForm.get("interval").valueChanges.forEach(h=>{if(h==="CUSTOM"){let F=new Date,J=this.validStart||F,V=this.validStop||F;this.filterForm.get("customStart").setValue(w.toISOString(J)),this.filterForm.get("customStop").setValue(w.toISOString(V))}else h==="NO_LIMIT"?(this.validStart=null,this.validStop=null,this.appliedInterval=h,this.loadData()):(this.validStop=new Date,this.validStart=w.subtractDuration(this.validStop,h),this.appliedInterval=h,this.loadData())})}initializeOptions(){let o=this.route.snapshot.queryParamMap;if(o.has("interval"))if(this.appliedInterval=o.get("interval"),this.filterForm.get("interval").setValue(this.appliedInterval),this.appliedInterval==="CUSTOM"){let n=o.get("customStart");this.filterForm.get("customStart").setValue(n),this.validStart=w.toDate(n);let m=o.get("customStop");this.filterForm.get("customStop").setValue(m),this.validStop=w.toDate(m)}else this.appliedInterval==="NO_LIMIT"?(this.validStart=null,this.validStop=null):(this.validStop=new Date,this.validStart=w.subtractDuration(this.validStop,this.appliedInterval));else this.appliedInterval="NO_LIMIT",this.validStop=null,this.validStart=null}jumpToNow(){this.filterForm.get("interval").setValue("NO_LIMIT")}applyCustomDates(){this.validStart=w.toDate(this.filterForm.value.customStart),this.validStop=w.toDate(this.filterForm.value.customStop),this.appliedInterval="CUSTOM",this.loadData()}loadData(o){this.updateURL();let n={};this.validStart&&(n.start=this.validStart.toISOString()),this.validStop&&(n.stop=this.validStop.toISOString()),this.yamcs.yamcsClient.getAlarms(this.yamcs.instance,n).then(m=>this.dataSource.data=m).catch(m=>this.messageService.showError(m))}updateURL(){this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParams:{interval:this.appliedInterval,customStart:this.appliedInterval==="CUSTOM"?this.filterForm.value.customStart:null,customStop:this.appliedInterval==="CUSTOM"?this.filterForm.value.customStop:null},queryParamsHandling:"merge"})}durationFor(o){if(o.updateTime)return w.toDate(o.updateTime).getTime()-w.toDate(o.triggerTime).getTime()}showChart(o){let n=o.triggerTime,m=o.updateTime||o.clearInfo?.clearTime,u,h;m?(u=n,h=m):(u=n,h=jt(w.toDate(n),1).toISOString()),this.router.navigate(["/telemetry/parameters"+o.parameterDetail?.triggerValue.id.name,"-","chart"],{queryParams:{c:this.yamcs.context,interval:"CUSTOM",customStart:u,customStop:h}})}showData(o){let n=o.triggerTime,m=o.updateTime||o.clearInfo?.clearTime,u,h;m?(u=n,h=m):(u=n,h=jt(w.toDate(n),1).toISOString()),this.router.navigate(["/telemetry/parameters"+o.parameterDetail?.triggerValue.id.name,"-","data"],{queryParams:{c:this.yamcs.context,interval:"CUSTOM",customStart:u,customStop:h}})}};i.\u0275fac=function(n){return new(n||i)(v(M),v(et),v(tt),v(ut))},i.\u0275cmp=E({type:i,selectors:[["ng-component"]],viewQuery:function(n,m){if(n&1&&Tt(ti,5),n&2){let u;At(u=bt())&&(m.intervalSelect=u.first)}},standalone:!0,features:[I],decls:18,vars:6,consts:[["intervalSelect",""],[1,"table-wrapper"],[1,"panel-content"],[2,"margin-top","16px",3,"formGroup"],[1,"filter-bar"],["icon","access_time","formControlName","interval",3,"options"],[1,"ya-button"],["mat-table","",1,"ya-data-table","expand",3,"dataSource"],[2,"flex","1 1 auto"],[1,"ya-button",3,"disabled"],["formControlName","customStart"],["formControlName","customStop"],[1,"ya-button",3,"click","disabled"],[1,"ya-button",3,"click"],["matColumnDef","severity"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","type"],["matColumnDef","start"],["matColumnDef","stop"],["matColumnDef","triggerValue"],["mat-cell","","class","wrap200",4,"matCellDef"],["matColumnDef","alarm"],["matColumnDef","duration"],["matColumnDef","violations"],["mat-header-cell","","style","text-align: right",4,"matHeaderCellDef"],["mat-cell","","style","text-align: right",4,"matCellDef"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],[3,"level","grayscale"],[2,"vertical-align","middle"],["mat-cell","",1,"wrap200"],[3,"routerLink","queryParams"],[3,"matTooltip"],["mat-header-cell","",2,"text-align","right"],["mat-cell","",2,"text-align","right"],["mat-header-cell","",1,"expand"],["icon","show_chart"],["icon","view_headline"],["icon","show_chart",3,"click"],["icon","view_headline",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(n,m){n&1&&(a(0,"app-instance-page")(1,"app-instance-toolbar"),r(2,"Alarms"),l(),a(3,"div",1)(4,"div",2),f(5,"app-alarms-page-tabs"),a(6,"form",3)(7,"div",4),f(8,"ya-select",5,0),p(10,ei,4,1)(11,ii,2,0,"button",6),l()(),p(12,ji,30,3,"table",7),a(13,"mat-toolbar"),f(14,"span",8),a(15,"button",9),r(16,"Load More"),l(),f(17,"span",8),l()()()()),n&2&&(s(6),_("formGroup",m.filterForm),s(2),_("options",m.intervalOptions),s(2),d(m.filterForm.value.interval==="CUSTOM"?10:-1),s(),d(m.filterForm.value.interval!=="CUSTOM"?11:-1),s(),d(m.dataSource?12:-1),s(3),_("disabled",!0))},dependencies:[vt,xt,ht,Ct,k,Z,Et,P,N,O,R,q,Y,G,at,lt,ct,rt,ot,dt,mt,st,pt,_t,le,nt,Ot,W,Ce,z,ge,ft],encapsulation:2,changeDetection:0});let t=i;return t})();function Yi(t,i){if(t&1&&r(0),t&2){let e=c(2);C(" /",e.data.alarms[0].id.name," ")}}function Wi(t,i){if(t&1&&(r(0),p(1,Yi,1,1)),t&2){let e=c();C(" ",e.data.alarms[0].id.namespace," "),s(),d(e.data.alarms[0].id.name?1:-1)}}function zi(t,i){if(t&1&&r(0),t&2){let e=c();C(" ",e.data.alarms.length," selected alarms. ")}}var He=(()=>{let i=class i{constructor(o,n,m,u){this.dialogRef=o,this.yamcs=m,this.data=u,this.formGroup=n.group({comment:void 0})}async acknowledge(){let o=this.data.alarms,n=this.formGroup.get("comment").value;for(let m of o){let u={};n&&(u.comment=n);let h=m.id.namespace+(m.id.name?"/"+m.id.name:"");this.yamcs.yamcsClient.acknowledgeAlarm(this.yamcs.instance,this.yamcs.processor,h,m.seqNum,u)}this.dialogRef.close()}};i.\u0275fac=function(n){return new(n||i)(v(Mt),v(kt),v(M),v(Vt))},i.\u0275cmp=E({type:i,selectors:[["app-acknowledge-alarm-dialog"]],standalone:!0,features:[I],decls:15,vars:4,consts:[["mat-dialog-title",""],[1,"ya-form",3,"formGroup"],["formControlName","comment","rows","5",2,"resize","none"],["align","end"],["mat-dialog-close","",1,"ya-button"],[1,"ya-button","primary",3,"click","disabled"]],template:function(n,m){n&1&&(a(0,"h2",0),r(1,"Acknowledge"),l(),a(2,"mat-dialog-content")(3,"p"),p(4,Wi,2,2)(5,zi,1,1),l(),a(6,"form",1)(7,"label"),r(8," Comment "),f(9,"textarea",2),l()()(),a(10,"mat-dialog-actions",3)(11,"button",4),r(12,"CANCEL"),l(),a(13,"button",5),T("click",function(){return m.acknowledge()}),r(14," OK "),l()()),n&2&&(s(4),d(m.data.alarms.length===1?4:-1),s(),d(m.data.alarms.length!==1?5:-1),s(),_("formGroup",m.formGroup),s(7),_("disabled",!m.formGroup.valid))},dependencies:[k,P,It,N,O,R,q,Lt,Ht,$t,Ft],encapsulation:2,changeDetection:0});let t=i;return t})();var Ki=t=>({c:t});function Qi(t,i){if(t&1&&(a(0,"div",0),r(1,"Parameter"),l(),a(2,"div",1)(3,"a",4),r(4),l()()),t&2){let e=c();s(3),_("routerLink","/telemetry/parameters/"+e.alarm.id.namespace+"/"+e.alarm.id.name)("queryParams",L(4,Ki,e.yamcs.context)),s(),$(" ",e.alarm.id.namespace,"/",e.alarm.id.name," ")}}function Ji(t,i){if(t&1&&r(0),t&2){let e=c(2);$(" ",e.alarm.id.namespace,"/",e.alarm.id.name," ")}}function Xi(t,i){if(t&1&&r(0),t&2){let e=c(2);C(" ",e.alarm.id.namespace," ")}}function Zi(t,i){if(t&1&&(a(0,"div",0),r(1,"Event"),l(),a(2,"div",1),p(3,Ji,1,2)(4,Xi,1,1),l()),t&2){let e=c();s(3),d(e.alarm.id.name?3:4)}}function tn(t,i){t&1&&(a(0,"span"),r(1,"\u2193"),l())}function en(t,i){t&1&&(a(0,"span"),r(1,"\u2191"),l())}function nn(t,i){t&1&&(a(0,"span"),r(1,"\u2193"),l())}function an(t,i){t&1&&(a(0,"span"),r(1,"\u2191"),l())}function on(t,i){if(t&1&&(f(0,"br")(1,"mat-divider"),a(2,"div",0),r(3,"Trigger value"),l(),a(4,"div",1),f(5,"app-alarm-level",5),r(6),x(7,"value"),p(8,tn,2,0,"span")(9,en,2,0,"span"),l(),f(10,"br")(11,"mat-divider"),a(12,"div",0),r(13,"Live value"),l(),a(14,"div",1)(15,"ya-expirable",6),f(16,"app-alarm-level",5),r(17),x(18,"value"),p(19,nn,2,0,"span")(20,an,2,0,"span"),l()()),t&2){let e=i,o=c();s(5),_("level",o.alarm.severity)("grayscale",!0),s(),C(" \xA0",S(7,11,e.triggerValue.engValue)," "),s(2),d(e.triggerValue.rangeCondition==="LOW"?8:-1),s(),d(e.triggerValue.rangeCondition==="HIGH"?9:-1),s(6),_("pval",e.currentValue),s(),_("level",e.currentValue.monitoringResult)("grayscale",!0),s(),C(" \xA0",S(18,13,e.currentValue.engValue)," "),s(2),d(e.currentValue.rangeCondition==="LOW"?19:-1),s(),d(e.currentValue.rangeCondition==="HIGH"?20:-1)}}function ln(t,i){t&1&&(f(0,"br")(1,"mat-divider"),a(2,"div",0),r(3,"Trigger event"),l(),a(4,"div",1),r(5),l()),t&2&&(s(5),C(" ",i.triggerEvent.message," "))}function rn(t,i){if(t&1&&(a(0,"blockquote",7),r(1),l()),t&2){let e=c(2);s(),C(" ",e.alarm.acknowledgeInfo.acknowledgeMessage," ")}}function mn(t,i){if(t&1&&(f(0,"br")(1,"mat-divider"),a(2,"div",0),r(3),l(),a(4,"div",1),r(5),x(6,"datetime"),p(7,rn,2,1,"blockquote",7),l()),t&2){let e=c();s(3),C("Acknowledged by ",e.alarm.acknowledgeInfo.acknowledgedBy,""),s(2),C(" On ",S(6,3,e.alarm.acknowledgeInfo.acknowledgeTime)," "),s(2),d(e.alarm.acknowledgeInfo.acknowledgeMessage?7:-1)}}function sn(t,i){if(t&1&&(a(0,"blockquote",7),r(1),l()),t&2){let e=c(2);s(),C(" ",e.alarm.shelveInfo.shelveMessage," ")}}function cn(t,i){if(t&1&&(a(0,"div",0),r(1,"Shelve Expiration"),l(),a(2,"div",1),r(3),x(4,"datetime"),l()),t&2){let e=c(2);s(3),C(" ",S(4,1,e.alarm.shelveInfo.shelveExpiration)," ")}}function dn(t,i){if(t&1&&(f(0,"br")(1,"mat-divider"),a(2,"div",0),r(3),l(),a(4,"div",1),r(5),x(6,"datetime"),p(7,sn,2,1,"blockquote",7),l(),p(8,cn,5,3)),t&2){let e=c();s(3),C("Shelved by ",e.alarm.shelveInfo.shelvedBy,""),s(2),C(" On ",S(6,4,e.alarm.shelveInfo.shelveTime)," "),s(2),d(e.alarm.shelveInfo.shelveMessage?7:-1),s(),d(e.alarm.shelveInfo.shelveExpiration?8:-1)}}function pn(t,i){if(t&1){let e=D();a(0,"button",9),T("click",function(){g(e);let n=c(2);return y(n.acknowledgeAlarm.emit(n.alarm))}),a(1,"mat-icon"),r(2,"notifications_off"),l(),r(3," ACKNOWLEDGE "),l()}}function _n(t,i){if(t&1){let e=D();a(0,"button",9),T("click",function(){g(e);let n=c(2);return y(n.shelveAlarm.emit(n.alarm))}),a(1,"mat-icon"),r(2,"timer"),l(),r(3," SHELVE "),l()}}function un(t,i){if(t&1){let e=D();a(0,"button",9),T("click",function(){g(e);let n=c(2);return y(n.unshelveAlarm.emit(n.alarm))}),a(1,"mat-icon"),r(2,"timer_off"),l(),r(3," UNSHELVE "),l()}}function fn(t,i){if(t&1){let e=D();a(0,"div",3),p(1,pn,4,0,"button",8)(2,_n,4,0,"button",8)(3,un,4,0,"button",8),a(4,"button",9),T("click",function(){g(e);let n=c();return y(n.clearAlarm.emit(n.alarm))}),a(5,"mat-icon"),r(6,"clear_all"),l(),r(7," CLEAR "),l()()}if(t&2){let e=c();s(),d(!e.alarm.shelveInfo&&!e.alarm.acknowledged?1:-1),s(),d(e.alarm.shelveInfo?-1:2),s(),d(e.alarm.shelveInfo?3:-1)}}var Fe=(()=>{let i=class i{constructor(o){this.yamcs=o,this.mayControl=!1,this.acknowledgeAlarm=new U,this.shelveAlarm=new U,this.unshelveAlarm=new U,this.clearAlarm=new U}};i.\u0275fac=function(n){return new(n||i)(v(M))},i.\u0275cmp=E({type:i,selectors:[["app-alarm-detail"]],inputs:{alarm:"alarm",mayControl:"mayControl"},outputs:{acknowledgeAlarm:"acknowledgeAlarm",shelveAlarm:"shelveAlarm",unshelveAlarm:"unshelveAlarm",clearAlarm:"clearAlarm"},standalone:!0,features:[I],decls:17,vars:12,consts:[[1,"block-title"],[1,"block"],[3,"level"],[1,"action-bar"],[1,"ya-link",3,"routerLink","queryParams"],[3,"level","grayscale"],[3,"pval"],[2,"border-left","4px solid #eee","padding-left","1em","font-style","italic"],[1,"ya-button"],[1,"ya-button",3,"click"]],template:function(n,m){if(n&1&&(p(0,Qi,5,6)(1,Zi,5,1),a(2,"div",0),r(3,"Severity"),l(),a(4,"div",1),f(5,"app-alarm-level",2),r(6),l(),a(7,"div",0),r(8,"Violations"),l(),a(9,"div",1),r(10),x(11,"number"),l(),p(12,on,21,15)(13,ln,6,1)(14,mn,8,5)(15,dn,9,6)(16,fn,8,3,"div",3)),n&2){let u,h;d(m.alarm.type==="PARAMETER"?0:-1),s(),d(m.alarm.type==="EVENT"?1:-1),s(4),_("level",m.alarm.severity),s(),C(" ",m.alarm.severity,`
`),s(4),C(" ",S(11,10,m.alarm.violations),`
`),s(2),d((u=m.alarm.parameterDetail)?12:-1,u),s(),d((h=m.alarm.eventDetail)?13:-1,h),s(),d(m.alarm.acknowledgeInfo?14:-1),s(),d(m.alarm.shelveInfo?15:-1),s(),d(m.mayControl?16:-1)}},dependencies:[vt,k,Z,Y,G,re,fe,z,ft],encapsulation:2,changeDetection:0});let t=i;return t})();function Cn(t,i){t&1&&(a(0,"mat-icon",0),r(1,"timer"),l())}function hn(t,i){t&1&&(a(0,"mat-icon",1),r(1,"check_circle"),l())}function vn(t,i){if(t&1&&(a(0,"mat-icon",5),x(1,"async"),r(2," notifications "),l()),t&2){let e=c(2);Bt("visibility",S(1,2,e.visibility$)?"visible":"hidden")}}function xn(t,i){t&1&&(a(0,"mat-icon",3),r(1,"check_circle_outline"),l())}function Sn(t,i){if(t&1&&(a(0,"mat-icon",6),x(1,"async"),r(2," notifications_none "),l()),t&2){let e=c(2);Bt("visibility",S(1,2,e.visibility$)?"visible":"hidden")}}function gn(t,i){if(t&1&&p(0,hn,2,0,"mat-icon",1)(1,vn,3,4,"mat-icon",2)(2,xn,2,0,"mat-icon",3)(3,Sn,3,4,"mat-icon",4),t&2){let e=c();d(!e.alarm.processOK&&e.alarm.acknowledged?0:-1),s(),d(!e.alarm.processOK&&!e.alarm.acknowledged?1:-1),s(),d(e.alarm.processOK&&e.alarm.acknowledged?2:-1),s(),d(e.alarm.processOK&&!e.alarm.acknowledged?3:-1)}}var $e=(()=>{let i=class i{constructor(o){this.visibility$=new B(!0),this.syncSubscription=o.syncFast(()=>{this.visibility$.next(!this.visibility$.value)})}ngOnDestroy(){this.syncSubscription?.unsubscribe()}};i.\u0275fac=function(n){return new(n||i)(v(ye))},i.\u0275cmp=E({type:i,selectors:[["app-alarm-state-icon"]],inputs:{alarm:"alarm"},standalone:!0,features:[I],decls:2,vars:1,consts:[["matTooltip","Shelved"],["matTooltip","Active, acknowledged"],["matTooltip","Active, unacknowledged",3,"visibility"],["matTooltip","RTN, acknowledged"],["matTooltip","RTN, unacknowledged",3,"visibility"],["matTooltip","Active, unacknowledged"],["matTooltip","RTN, unacknowledged"]],template:function(n,m){n&1&&p(0,Cn,2,0,"mat-icon",0)(1,gn,4,4),n&2&&d(m.alarm.shelveInfo?0:1)},dependencies:[k,Dt,G,nt],encapsulation:2});let t=i;return t})();var zt=t=>({c:t});function yn(t,i){t&1&&(a(0,"th",20),r(1,"Alarm type"),l())}function Tn(t,i){t&1&&(a(0,"mat-icon",22),r(1,"event_note"),l())}function An(t,i){t&1&&(a(0,"mat-icon",22),r(1,"toll"),l())}function bn(t,i){if(t&1&&(a(0,"td",21),p(1,Tn,2,0,"mat-icon",22)(2,An,2,0,"mat-icon",22),r(3),x(4,"titlecase"),l()),t&2){let e=i.$implicit;s(),d(e.type==="EVENT"?1:-1),s(),d(e.type==="PARAMETER"?2:-1),s(),C(" ",S(4,3,e.type||"-")," ")}}function wn(t,i){t&1&&(a(0,"th",20),r(1,"Alarm name"),l())}function Dn(t,i){if(t&1&&(a(0,"a",23),r(1),l()),t&2){let e=c(2).$implicit,o=c();_("routerLink","/telemetry/parameters"+e.id.namespace+"/"+e.id.name)("queryParams",L(4,zt,o.yamcs.context)),s(),$(" ",e.id.namespace,"/",e.id.name," ")}}function En(t,i){if(t&1&&r(0),t&2){let e=c(2).$implicit;$(" ",e.id.namespace,"/",e.id.name," ")}}function In(t,i){if(t&1&&p(0,Dn,2,6,"a",23)(1,En,1,2),t&2){let e=c().$implicit;d(e.parameterDetail?0:1)}}function kn(t,i){if(t&1&&(a(0,"a",23),r(1),l()),t&2){let e=c(2).$implicit,o=c();_("routerLink","/telemetry/parameters"+e.id.namespace)("queryParams",L(3,zt,o.yamcs.context)),s(),C(" ",e.id.namespace," ")}}function Mn(t,i){if(t&1&&r(0),t&2){let e=c(2).$implicit;C(" ",e.id.namespace," ")}}function Vn(t,i){if(t&1&&p(0,kn,2,5,"a",23)(1,Mn,1,1),t&2){let e=c().$implicit;d(e.parameterDetail?0:1)}}function Ln(t,i){if(t&1&&(a(0,"a",23),r(1),l()),t&2){let e=c(2).$implicit,o=c();_("routerLink","/telemetry/parameters"+e.id.name)("queryParams",L(3,zt,o.yamcs.context)),s(),C(" ",e.id.name," ")}}function Hn(t,i){if(t&1&&r(0),t&2){let e=c(2).$implicit;C(" ",e.id.name," ")}}function Fn(t,i){if(t&1&&p(0,Ln,2,5,"a",23)(1,Hn,1,1),t&2){let e=c().$implicit;d(e.parameterDetail?0:1)}}function $n(t,i){if(t&1&&(a(0,"td",21),p(1,In,2,1)(2,Vn,2,1)(3,Fn,2,1),l()),t&2){let e=i.$implicit;s(),d(e.id.namespace&&e.id.name?1:-1),s(),d(e.id.namespace&&!e.id.name?2:-1),s(),d(!e.id.namespace&&e.id.name?3:-1)}}function Nn(t,i){t&1&&(a(0,"th",24),r(1,"State"),l())}function On(t,i){if(t&1&&(a(0,"td",25),f(1,"app-alarm-state-icon",26),l()),t&2){let e=i.$implicit;s(),_("alarm",e)}}function Pn(t,i){t&1&&(a(0,"th",20),r(1,"Alarm time"),l())}function Rn(t,i){if(t&1&&(a(0,"td",21)(1,"span",27),x(2,"datetime"),f(3,"app-ago",28),l()()),t&2){let e=i.$implicit;s(),_("matTooltip",S(2,2,e.triggerTime)),s(2),_("time",e.triggerTime)}}function qn(t,i){t&1&&(a(0,"th",24),r(1,"Severity"),l())}function Gn(t,i){if(t&1&&(a(0,"td",25),f(1,"app-alarm-level",29),l()),t&2){let e=i.$implicit;s(),_("level",e.severity)}}function Bn(t,i){t&1&&(a(0,"th",20),r(1,"Trip value"),l())}function Un(t,i){t&1&&(a(0,"span"),r(1,"\u2193"),l())}function jn(t,i){t&1&&(a(0,"span"),r(1,"\u2191"),l())}function Yn(t,i){if(t&1&&(r(0),x(1,"value"),p(2,Un,2,0,"span")(3,jn,2,0,"span")),t&2){let e=i;C(" ",S(1,3,e.triggerValue.engValue)," "),s(2),d(e.triggerValue.rangeCondition==="LOW"?2:-1),s(),d(e.triggerValue.rangeCondition==="HIGH"?3:-1)}}function Wn(t,i){t&1&&r(0),t&2&&C(" ",i.triggerEvent.message||"-"," ")}function zn(t,i){if(t&1&&(a(0,"td",30),p(1,Yn,4,5)(2,Wn,1,1),l()),t&2){let e,o,n=i.$implicit;s(),d((e=n.parameterDetail)?1:-1,e),s(),d((o=n.eventDetail)?2:-1,o)}}function Kn(t,i){t&1&&(a(0,"th",20),r(1,"Live value"),l())}function Qn(t,i){t&1&&(a(0,"span"),r(1,"\u2193"),l())}function Jn(t,i){t&1&&(a(0,"span"),r(1,"\u2191"),l())}function Xn(t,i){if(t&1&&(r(0),x(1,"value"),p(2,Qn,2,0,"span")(3,Jn,2,0,"span")),t&2){let e=i;C(" ",S(1,3,e.currentValue.engValue)," "),s(2),d(e.currentValue.rangeCondition==="LOW"?2:-1),s(),d(e.currentValue.rangeCondition==="HIGH"?3:-1)}}function Zn(t,i){t&1&&r(0),t&2&&C(" ",i.triggerEvent.message||"-"," ")}function ta(t,i){if(t&1&&(a(0,"td",30),p(1,Xn,4,5)(2,Zn,1,1),l()),t&2){let e,o,n=i.$implicit;s(),d((e=n.parameterDetail)?1:-1,e),s(),d((o=n.eventDetail)?2:-1,o)}}function ea(t,i){t&1&&(a(0,"th",20),r(1,"Violations"),l())}function ia(t,i){if(t&1&&(a(0,"td",31),r(1),x(2,"number"),x(3,"number"),l()),t&2){let e=i.$implicit;s(),$(" ",S(2,2,e.violations)," (",wt(3,4,e.violations/e.count*100,"1.2-2"),"%) ")}}function na(t,i){t&1&&f(0,"th",32)}function aa(t,i){if(t&1){let e=D();a(0,"ya-more")(1,"button",33),T("click",function(){g(e);let n=c().$implicit,m=c();return y(m.acknowledgeAlarm.emit(n))}),r(2," Acknowledge... "),l(),a(3,"button",33),T("click",function(){g(e);let n=c().$implicit,m=c();return y(m.shelveAlarm.emit(n))}),r(4," Shelve... "),l(),a(5,"button",33),T("click",function(){g(e);let n=c().$implicit,m=c();return y(m.unshelveAlarm.emit(n))}),r(6," Unshelve "),l()()}if(t&2){let e=c().$implicit;s(),_("disabled",e.shelveInfo||e.acknowledged),s(2),_("disabled",e.shelveInfo),s(2),_("disabled",!e.shelveInfo)}}function oa(t,i){if(t&1&&(a(0,"td",21),p(1,aa,7,3,"ya-more"),l()),t&2){let e=c();s(),d(e.mayControl?1:-1)}}function la(t,i){t&1&&f(0,"tr",34)}function ra(t,i){if(t&1){let e=D();a(0,"tr",35),T("click",function(){let n=g(e).$implicit,m=c();return y(m.toggleOne(n))}),l()}if(t&2){let e=i.$implicit,o=c();Ut("selected",o.selection.isSelected(e))("hide",o.hideAlarm(e))}}function ma(t,i){t&1&&r(0,"-")}var Ne=(()=>{let i=class i{constructor(o){this.yamcs=o,this.displayedColumns=["state","severity","time","alarm","type","trip_value","live_value","actions"],this.view="standard",this.mayControl=!1,this.acknowledgeAlarm=new U,this.shelveAlarm=new U,this.unshelveAlarm=new U,this.tableTrackerFn=(n,m)=>`${m.triggerTime}__${m.id.namespace}__${m.id.name}__${m.seqNum}`}toggleOne(o){(!this.selection.isSelected(o)||this.selection.selected.length>1)&&this.selection.clear(),this.selection.toggle(o)}hideAlarm(o){if(this.view==="standard")return!!o.shelveInfo;if(this.view==="all")return!1;if(this.view==="unacknowledged")return!!o.shelveInfo||o.acknowledged;if(this.view==="acknowledged")return!!o.shelveInfo||!o.acknowledged;if(this.view==="shelved")return!o.shelveInfo}};i.\u0275fac=function(n){return new(n||i)(v(M))},i.\u0275cmp=E({type:i,selectors:[["app-alarms-table"]],inputs:{dataSource:"dataSource",selection:"selection",view:"view",mayControl:"mayControl"},outputs:{acknowledgeAlarm:"acknowledgeAlarm",shelveAlarm:"shelveAlarm",unshelveAlarm:"unshelveAlarm"},standalone:!0,features:[I],decls:32,vars:6,consts:[["dash",""],["mat-table","",1,"ya-data-table","expand",3,"dataSource","trackBy"],["matColumnDef","type"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","alarm"],["matColumnDef","state"],["mat-header-cell","","class","status",4,"matHeaderCellDef"],["mat-cell","","class","status",4,"matCellDef"],["matColumnDef","time"],["matColumnDef","severity"],["matColumnDef","trip_value"],["mat-cell","","class","wrap200",4,"matCellDef"],["matColumnDef","live_value"],["matColumnDef","violations"],["mat-cell","","style","text-align: right",4,"matCellDef"],["matColumnDef","actions"],["mat-header-cell","","style","width: 100%",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"selected","hide","click",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],[2,"vertical-align","middle"],[3,"routerLink","queryParams"],["mat-header-cell","",1,"status"],["mat-cell","",1,"status"],[3,"alarm"],[3,"matTooltip"],[3,"time"],[3,"level"],["mat-cell","",1,"wrap200"],["mat-cell","",2,"text-align","right"],["mat-header-cell","",2,"width","100%"],["mat-menu-item","",3,"click","disabled"],["mat-header-row",""],["mat-row","",3,"click"]],template:function(n,m){n&1&&(a(0,"table",1),A(1,2),p(2,yn,2,0,"th",3)(3,bn,5,5,"td",4),b(),A(4,5),p(5,wn,2,0,"th",3)(6,$n,4,3,"td",4),b(),A(7,6),p(8,Nn,2,0,"th",7)(9,On,2,1,"td",8),b(),A(10,9),p(11,Pn,2,0,"th",3)(12,Rn,4,4,"td",4),b(),A(13,10),p(14,qn,2,0,"th",7)(15,Gn,2,1,"td",8),b(),A(16,11),p(17,Bn,2,0,"th",3)(18,zn,3,2,"td",12),b(),A(19,13),p(20,Kn,2,0,"th",3)(21,ta,3,2,"td",12),b(),A(22,14),p(23,ea,2,0,"th",3)(24,ia,4,7,"td",15),b(),A(25,16),p(26,na,1,0,"th",17)(27,oa,2,1,"td",4),b(),p(28,la,1,0,"tr",18)(29,ra,1,4,"tr",19),l(),p(30,ma,1,0,"ng-template",null,0,Zt)),n&2&&(Ut("hide",m.dataSource.isEmpty()),_("dataSource",m.dataSource)("trackBy",m.tableTrackerFn),s(28),_("matHeaderRowDef",m.displayedColumns),s(),_("matRowDefColumns",m.displayedColumns))},dependencies:[Ee,vt,$e,k,Z,Et,Y,G,ae,at,lt,ct,rt,ot,dt,mt,st,pt,_t,nt,ve,z,ft],styles:[".hide[_ngcontent-%COMP%]{display:none}"]});let t=i;return t})();var Gt=class extends ne{constructor(i){super(),this.yamcs=i,this.alarms$=new B([]),this.filteredAlarms$=new B([]),this.loading$=new B(!1),this.alarmsByName={},this.filter=null,this.unacknowledgedAlarms$=this.alarms$.pipe(yt(e=>e.filter(o=>!o.shelveInfo&&!o.acknowledged))),this.acknowledgedAlarms$=this.alarms$.pipe(yt(e=>e.filter(o=>!o.shelveInfo&&o.acknowledged))),this.shelvedAlarms$=this.alarms$.pipe(yt(e=>e.filter(o=>!!o.shelveInfo)))}connect(){return this.filteredAlarms$}setFilter(i){this.filter=i||null}loadAlarms(){this.loading$.next(!0),this.yamcs.yamcsClient.getActiveAlarms(this.yamcs.instance,this.yamcs.processor).then(i=>{this.loading$.next(!1);for(let e of i)this.processAlarm(e);this.updateSubject()}),this.alarmSubscription=this.yamcs.yamcsClient.createAlarmSubscription({instance:this.yamcs.instance,processor:this.yamcs.processor},i=>{this.processAlarm(i),this.updateSubject()})}updateSubject(){let e=[...Object.values(this.alarmsByName).sort((o,n)=>{let m=o.acknowledged===n.acknowledged?0:o.acknowledged?1:-1;if(m===0){let u=this.getNumericSeverity(o.severity),h=this.getNumericSeverity(n.severity);m=u===h?0:u<h?1:-1}if(m===0){let u=o.id.namespace+"/"+o.id.name,h=n.id.namespace+"/"+n.id.name;m=u.localeCompare(h)}return m})];if(this.alarms$.next(e),this.filter){let o=e.filter(n=>(n.id.namespace+"/"+n.id.name).toLowerCase().indexOf(this.filter)!==-1);this.filteredAlarms$.next(o)}else this.filteredAlarms$.next(e)}getNumericSeverity(i){switch(i){case"WATCH":return 0;case"WARNING":return 1;case"DISTRESS":return 2;case"CRITICAL":return 3;case"SEVERE":return 4;default:return 5}}disconnect(){this.alarms$.complete(),this.filteredAlarms$.complete(),this.loading$.complete(),this.alarmSubscription&&this.alarmSubscription.cancel()}isEmpty(){return!this.filteredAlarms$.getValue().length}processAlarm(i){let e=i.id.namespace+"/"+i.id.name;i.processOK&&!i.triggered&&i.acknowledged?delete this.alarmsByName[e]:this.alarmsByName[e]=i}};function sa(t,i){if(t&1&&r(0),t&2){let e=c(2);C(" /",e.data.alarms[0].id.name," ")}}function ca(t,i){if(t&1&&(r(0),p(1,sa,1,1)),t&2){let e=c();C(" ",e.data.alarms[0].id.namespace," "),s(),d(e.data.alarms[0].id.name?1:-1)}}function da(t,i){if(t&1&&r(0),t&2){let e=c();C(" ",e.data.alarms.length," selected alarms. ")}}var Oe=(()=>{let i=class i{constructor(o,n,m,u){this.dialogRef=o,this.yamcs=m,this.data=u,this.durationOptions=[{id:"PT15M",label:"15 minutes"},{id:"PT30M",label:"30 minutes"},{id:"PT1H",label:"1 hour"},{id:"PT2H",label:"2 hours"},{id:"P1D",label:"1 day"},{id:"UNLIMITED",label:"unlimited"}],this.formGroup=n.group({duration:"PT2H",comment:void 0})}async shelve(){let o=this.data.alarms,n=this.formGroup.get("comment").value,m=null;if(this.formGroup.get("duration").value!=="UNLIMITED"){let u=this.formGroup.get("duration").value;m=w.convertDurationToMillis(u)}for(let u of o){let h={};n&&(h.comment=n),m&&(h.shelveDuration=m);let F=u.id.namespace+(u.id.name?"/"+u.id.name:"");this.yamcs.yamcsClient.shelveAlarm(this.yamcs.instance,this.yamcs.processor,F,u.seqNum,h)}this.dialogRef.close()}};i.\u0275fac=function(n){return new(n||i)(v(Mt),v(kt),v(M),v(Vt))},i.\u0275cmp=E({type:i,selectors:[["app-shelve-alarm-dialog"]],standalone:!0,features:[I],decls:20,vars:5,consts:[["mat-dialog-title",""],[1,"ya-form",3,"formGroup"],["formControlName","duration",3,"options"],["formControlName","comment","rows","5",2,"resize","none"],["align","end"],["mat-dialog-close","",1,"ya-button"],[1,"ya-button","primary",3,"click","disabled"]],template:function(n,m){n&1&&(a(0,"h2",0),r(1,"Shelve"),l(),a(2,"mat-dialog-content")(3,"p"),p(4,ca,2,2)(5,da,1,1),l(),a(6,"form",1)(7,"label"),r(8," Duration"),f(9,"br")(10,"ya-select",2),l(),f(11,"br"),a(12,"label"),r(13," Comment "),f(14,"textarea",3),l()()(),a(15,"mat-dialog-actions",4)(16,"button",5),r(17,"CANCEL"),l(),a(18,"button",6),T("click",function(){return m.shelve()}),r(19,"OK"),l()()),n&2&&(s(4),d(m.data.alarms.length===1?4:-1),s(),d(m.data.alarms.length!==1?5:-1),s(),_("formGroup",m.formGroup),s(4),_("options",m.durationOptions),s(8),_("disabled",!m.formGroup.valid))},dependencies:[k,P,It,N,O,R,q,Lt,Ht,$t,Ft,W],encapsulation:2,changeDetection:0});let t=i;return t})();function pa(t,i){if(t&1){let e=D();a(0,"button",6),T("click",function(){g(e);let n=c();return y(n.acknowledgeAlarms(n.selection.selected))}),a(1,"mat-icon"),r(2,"notifications_off"),l(),r(3," Acknowledge "),l()}if(t&2){let e=c();_("disabled",!e.selection.hasValue())}}function _a(t,i){if(t&1){let e=D();a(0,"button",6),T("click",function(){g(e);let n=c();return y(n.shelveAlarms(n.selection.selected))}),a(1,"mat-icon"),r(2,"timer"),l(),r(3," Shelve "),l()}if(t&2){let e=c();_("disabled",!e.selection.hasValue())}}function ua(t,i){if(t&1){let e=D();a(0,"ya-detail-toolbar"),r(1," Alarm Detail "),l(),a(2,"div",7)(3,"app-alarm-detail",8),T("acknowledgeAlarm",function(n){g(e);let m=c();return y(m.acknowledgeAlarms([n]))})("shelveAlarm",function(n){g(e);let m=c();return y(m.shelveAlarms([n]))})("unshelveAlarm",function(n){g(e);let m=c();return y(m.unshelveAlarms([n]))})("clearAlarm",function(n){g(e);let m=c();return y(m.clearAlarms([n]))}),l()()}if(t&2){let e=c();s(3),_("alarm",i)("mayControl",e.mayControlAlarms())}}function fa(t,i){t&1&&(a(0,"ya-detail-toolbar"),r(1," Select an alarm "),l())}function Ca(t,i){if(t&1){let e=D();a(0,"div",5),f(1,"app-alarms-page-tabs"),a(2,"dl",9)(3,"dt"),r(4,"Unacknowledged alarms:"),l(),a(5,"dd")(6,"strong"),r(7),x(8,"async"),l()(),a(9,"dt"),r(10,"Acknowledged alarms:"),l(),a(11,"dd")(12,"strong"),r(13),x(14,"async"),l()(),a(15,"dt"),r(16,"Shelved alarms:"),l(),a(17,"dd")(18,"strong"),r(19),x(20,"async"),l()()(),a(21,"form",10)(22,"div",11),f(23,"ya-search-filter",12)(24,"ya-select",13),l()(),a(25,"app-alarms-table",14),x(26,"async"),T("acknowledgeAlarm",function(n){g(e);let m=c();return y(m.acknowledgeAlarms([n]))})("shelveAlarm",function(n){g(e);let m=c();return y(m.shelveAlarms([n]))})("unshelveAlarm",function(n){g(e);let m=c();return y(m.unshelveAlarms([n]))}),l()()}if(t&2){let e,o,n,m=c();s(7),j((e=S(8,9,m.dataSource.unacknowledgedAlarms$))==null?null:e.length),s(6),j((o=S(14,11,m.dataSource.acknowledgedAlarms$))==null?null:o.length),s(6),j((n=S(20,13,m.dataSource.shelvedAlarms$))==null?null:n.length),s(2),_("formGroup",m.filterForm),s(3),_("options",m.viewOptions),s(),_("dataSource",m.dataSource)("selection",m.selection)("view",S(26,15,m.view$))("mayControl",m.mayControlAlarms())}}var Pe=(()=>{let i=class i{constructor(o,n,m,u,h,F,J){this.yamcs=o,this.route=n,this.router=m,this.dialog=h,this.authService=F,this.messageService=J,this.filterForm=new it({filter:new H,view:new H("standard")}),this.detailAlarm$=new B(null),this.selection=new pe((V,X)=>`${X.triggerTime}__${X.id.namespace}__${X.id.name}__${X.seqNum}`,!1,[]),this.viewOptions=[{id:"standard",label:"Standard view (ack & unack)"},{id:"unacknowledged",label:"Unacknowledged alarms"},{id:"acknowledged",label:"Acknowledged alarms"},{id:"shelved",label:"Shelved alarms"},{id:"all",label:"All alarms"}],this.view$=new B("standard"),u.setTitle("Alarms"),this.selectionSubscription=this.selection.changed.subscribe(()=>{let V=this.selection.selected;V.length===1?this.detailAlarm$.next(V[0]):this.detailAlarm$.next(null)}),this.dataSource=new Gt(this.yamcs),this.dataSource.loadAlarms(),this.alarmsSubscription=this.dataSource.alarms$.subscribe(V=>{this.selection.matchNewValues(V);let X=this.detailAlarm$.value;if(X){for(let Kt of V)if(this.isSameAlarm(Kt,X)){this.detailAlarm$.next(Kt);break}}}),this.initializeOptions(),this.filterForm.get("filter").valueChanges.pipe(Qt(400)).forEach(V=>{this.filter=V,this.updateURL(),this.dataSource.setFilter(V)}),this.filterForm.get("view").valueChanges.forEach(V=>{this.view$.next(V),this.updateURL(),this.selection.clear()})}initializeOptions(){let o=this.route.snapshot.queryParamMap;if(o.has("filter")&&(this.filter=o.get("filter")||"",this.filterForm.get("filter").setValue(this.filter)),o.has("view")){let n=o.get("view");this.view$.next(n),this.filterForm.get("view").setValue(n)}}isSameAlarm(o,n){return o.seqNum===n.seqNum&&o.id.namespace===n.id.namespace&&o.id.name===n.id.name&&o.triggerTime===n.triggerTime}acknowledgeAlarms(o){this.dialog.open(He,{width:"400px",data:{alarms:o}}).afterClosed().subscribe(()=>this.selection.clear())}shelveAlarms(o){this.dialog.open(Oe,{width:"400px",data:{alarms:o}}).afterClosed().subscribe(()=>this.selection.clear())}unshelveAlarms(o){for(let n of o){let m=n.id.namespace+(n.id.name?"/"+n.id.name:"");this.yamcs.yamcsClient.unshelveAlarm(this.yamcs.instance,this.yamcs.processor,m,n.seqNum).then(()=>this.selection.clear()).catch(u=>this.messageService.showError(u))}}clearAlarms(o){for(let n of o){let m=n.id.namespace+(n.id.name?"/"+n.id.name:"");this.yamcs.yamcsClient.clearAlarm(this.yamcs.instance,this.yamcs.processor,m,n.seqNum,{})}}mayControlAlarms(){return this.authService.getUser().hasSystemPrivilege("ControlAlarms")}updateURL(){this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParams:{filter:this.filter||null,view:this.view$.value||null},queryParamsHandling:"merge"})}ngOnDestroy(){this.selectionSubscription?.unsubscribe(),this.alarmsSubscription?.unsubscribe()}};i.\u0275fac=function(n){return new(n||i)(v(M),v(tt),v(et),v(te),v(me),v(Te),v(ut))},i.\u0275cmp=E({type:i,selectors:[["ng-component"]],standalone:!0,features:[I],decls:45,vars:6,consts:[[1,"ya-data-table"],["width","1"],[1,"icon16",2,"vertical-align","middle"],["mat-button","","color","primary",3,"disabled"],[1,"table-wrapper"],[1,"panel-content"],["mat-button","","color","primary",3,"click","disabled"],[2,"padding","0 16px"],[3,"acknowledgeAlarm","shelveAlarm","unshelveAlarm","clearAlarm","alarm","mayControl"],[1,"dl-horizontal"],[3,"formGroup"],[1,"filter-bar"],["formControlName","filter","placeholder","Filter by text search"],["formControlName","view",3,"options"],[3,"acknowledgeAlarm","shelveAlarm","unshelveAlarm","dataSource","selection","view","mayControl"]],template:function(n,m){if(n&1&&(a(0,"app-instance-page")(1,"app-instance-toolbar"),r(2," Alarms "),a(3,"ya-help"),r(4," An alarm can be in these states: "),a(5,"table",0)(6,"tr")(7,"td",1)(8,"mat-icon",2),r(9,"notifications"),l()(),a(10,"td"),r(11,"The alarm is unacknowledged and the cause of the alarm still exists."),l()(),a(12,"tr")(13,"td")(14,"mat-icon",2),r(15,"notifications_none"),l()(),a(16,"td"),r(17," The alarm is unacknowledged and the cause that generated the alarm no longer exists. "),l()(),a(18,"tr")(19,"td")(20,"mat-icon",2),r(21,"check_circle"),l()(),a(22,"td"),r(23,"The alarm is acknowledged and the cause of the alarm still exists."),l()(),a(24,"tr")(25,"td")(26,"mat-icon",2),r(27,"check_circle_outline"),l()(),a(28,"td"),r(29," The alarm is acknowledged and the cause that generated the alarm no longer exists. "),l()(),a(30,"tr")(31,"td")(32,"mat-icon",2),r(33,"timer"),l()(),a(34,"td"),r(35,"The alarm was shelved."),l()()()(),r(36," \xA0\xA0\xA0 "),p(37,pa,4,1,"button",3)(38,_a,4,1,"button",3),l(),a(39,"ya-detail-pane"),p(40,ua,4,2),x(41,"async"),p(42,fa,2,0,"ya-detail-toolbar"),l(),a(43,"div",4),p(44,Ca,27,17,"div",5),l()()),n&2){let u;s(37),d(m.mayControlAlarms()?37:-1),s(),d(m.mayControlAlarms()?38:-1),s(2),d((u=S(41,4,m.detailAlarm$))?40:42,u),s(4),d(m.dataSource?44:-1)}},dependencies:[Fe,xt,Ne,ht,Ct,k,Dt,P,N,O,R,q,oe,G,_e,ue,he,xe,W],styles:[".detail[_ngcontent-%COMP%]{background-color:#fcfcfc;float:right;height:100%;width:450px;overflow:auto;border-left:1px solid #d3d3d3;box-sizing:border-box}.table-wrapper[_ngcontent-%COMP%]{position:relative;overflow:auto;height:100%}mat-row[_ngcontent-%COMP%]{cursor:pointer}mat-row[_ngcontent-%COMP%]:hover{background:#fafafa}"],changeDetection:0});let t=i;return t})();var Oo=[{path:"",canActivate:[be,Ae],canActivateChild:[we],runGuardsAndResolvers:"always",component:De,children:[{path:"",pathMatch:"full",component:Pe},{path:"history",component:Ve},{path:"log",component:ke}]}];export{Oo as ROUTES};
