"use strict";(self.webpackChunkwebapp=self.webpackChunkwebapp||[]).push([[568],{9568:(ht,w,u)=>{u.r(w),u.d(w,{StorageModule:()=>_t});var M=u(4421),p=u(1896),O=u(1293),Q=u(9969),e=u(5879),d=u(6516),_=u(6814);let $=(()=>{class a{static#e=this.\u0275fac=function(n){return new(n||a)};static#t=this.\u0275cmp=e.Xpm({type:a,selectors:[["ng-component"]],decls:5,vars:4,consts:[["messageBar",""],[1,"mat-typography","storage-page-content"]],template:function(n,o){if(1&n&&(e._UZ(0,"ya-message-bar",null,0),e.TgZ(2,"div",1),e.ALo(3,"async"),e._UZ(4,"router-outlet"),e.qZA()),2&n){const i=e.MAs(1);e.xp6(2),e.ekj("message-bar-visible",e.lcZ(3,2,i.show$))}},dependencies:[p.lC,d.pc,_.Ov],styles:[".storage-page-content[_ngcontent-%COMP%]{position:absolute;inset:48px 0 0;background-color:#f7f7f7}.storage-page-content.message-bar-visible[_ngcontent-%COMP%]{top:112px}mat-toolbar[_ngcontent-%COMP%]{background-color:#fcfcfc;border-bottom:1px solid #d3d3d3;box-sizing:content-box;color:#000000a7}"],changeDetection:0})}return a})();var B=u(5861),U=u(8337),g=u(9538),b=u(5619),L=u(2181),F=u(9378),m=u(6223),r=u(7700);let z=(()=>{class a{constructor(t,n,o,i){this.dialogRef=t,this.data=i,this.storageClient=o.createStorageClient(),this.form=n.group({name:["",m.kI.required]})}save(){let{path:t,bucket:n}=this.data;t.startsWith("/")&&(t=t.substring(1));const o=this.form.value.name;this.storageClient.uploadObject(n,t?`${t}/${o}/`:`${o}/`,new Blob).then(()=>this.dialogRef.close(!0))}static#e=this.\u0275fac=function(n){return new(n||a)(e.Y36(r.so),e.Y36(m.QS),e.Y36(d.C8),e.Y36(r.WI))};static#t=this.\u0275cmp=e.Xpm({type:a,selectors:[["app-create-bucket-folder-dialog"]],decls:12,vars:2,consts:[["mat-dialog-title",""],[1,"mat-typography"],[1,"ya-form",3,"formGroup"],["type","text","formControlName","name","pattern","\\w[\\w\\s\\.\\-\\(\\)\\[\\]]*"],["align","end"],["mat-dialog-close","",1,"ya-button"],[1,"ya-button","primary",3,"disabled","click"]],template:function(n,o){1&n&&(e.TgZ(0,"h2",0),e._uU(1,"Create folder"),e.qZA(),e.TgZ(2,"mat-dialog-content",1)(3,"form",2)(4,"label"),e._uU(5," Folder name "),e._UZ(6,"input",3),e.qZA()()(),e.TgZ(7,"mat-dialog-actions",4)(8,"button",5),e._uU(9,"CANCEL"),e.qZA(),e.TgZ(10,"button",6),e.NdJ("click",function(){return o.save()}),e._uU(11,"CREATE"),e.qZA()()),2&n&&(e.xp6(3),e.Q6J("formGroup",o.form),e.xp6(7),e.Q6J("disabled",!o.form.valid))},dependencies:[m._Y,m.Fj,m.JJ,m.JL,m.c5,m.sg,m.u,r.ZT,r.uh,r.xY,r.H8],encapsulation:2,changeDetection:0})}return a})(),I=(()=>{class a{constructor(t,n,o,i,s){this.dialogRef=t,this.data=s,this.storageClient=o.createStorageClient();const l=i.transform(this.data.name);this.filenameForm=n.group({name:[l,[m.kI.required]]})}rename(){var t=this;return(0,B.Z)(function*(){let n;const o=t.data.name.lastIndexOf("/");-1!==o&&(n=t.data.name.substring(0,o+1));const s=yield(yield t.storageClient.getObject(t.data.bucket,t.data.name)).blob(),l=(n||"")+t.filenameForm.get("name").value;yield t.storageClient.uploadObject(t.data.bucket,l,s),yield t.storageClient.deleteObject(t.data.bucket,t.data.name),t.dialogRef.close(l)})()}static#e=this.\u0275fac=function(n){return new(n||a)(e.Y36(r.so),e.Y36(m.QS),e.Y36(d.C8),e.Y36(d.XB),e.Y36(r.WI))};static#t=this.\u0275cmp=e.Xpm({type:a,selectors:[["app-rename-object-dialog"]],decls:13,vars:4,consts:[["mat-dialog-title",""],[1,"mat-typography"],[1,"ya-form",3,"formGroup"],["type","text","formControlName","name"],["filename",""],["align","end"],["mat-dialog-close","",1,"ya-button"],[1,"ya-button","primary",3,"disabled","click"]],template:function(n,o){if(1&n&&(e.TgZ(0,"h2",0),e._uU(1,"Rename file"),e.qZA(),e.TgZ(2,"mat-dialog-content",1)(3,"form",2)(4,"label"),e._uU(5," Name "),e._UZ(6,"input",3,4),e.qZA()()(),e.TgZ(8,"mat-dialog-actions",5)(9,"button",6),e._uU(10,"CANCEL"),e.qZA(),e.TgZ(11,"button",7),e.NdJ("click",function(){return o.rename()}),e._uU(12,"RENAME"),e.qZA()()),2&n){let i;e.xp6(3),e.Q6J("formGroup",o.filenameForm),e.xp6(1),e.ekj("invalid",null==(i=o.filenameForm.get("name"))?null:i.invalid),e.xp6(7),e.Q6J("disabled",!o.filenameForm.valid)}},dependencies:[m._Y,m.Fj,m.JJ,m.JL,m.sg,m.u,r.ZT,r.uh,r.xY,r.H8],encapsulation:2})}return a})();var R=u(3620),k=u(2296),x=u(617),H=u(2596);const E=["tableWrapper"];function G(a,c){1&a&&(e.ynx(0),e._uU(1," Finished "),e.BQk())}function W(a,c){if(1&a&&(e.ynx(0),e.TgZ(1,"mat-icon",10),e._uU(2,"error"),e.qZA(),e._uU(3," Failed "),e.BQk()),2&a){const t=e.oxw().$implicit;e.xp6(1),e.Q6J("matTooltip",t.err)}}function V(a,c){1&a&&e._UZ(0,"ya-dots")}function X(a,c){if(1&a&&(e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td",8),e.YNc(4,G,2,0,"ng-container",9),e.YNc(5,W,4,1,"ng-container",9),e.YNc(6,V,1,0,"ya-dots",9),e.qZA()()),2&a){const t=c.$implicit;e.ekj("failed",t.err),e.xp6(2),e.Oqu(t.filename),e.xp6(2),e.Q6J("ngIf",t.complete&&!t.err),e.xp6(1),e.Q6J("ngIf",t.complete&&t.err),e.xp6(1),e.Q6J("ngIf",!t.complete)}}let K=(()=>{class a{constructor(t,n){this.data=n,this.uploads$=n.uploads$.pipe((0,R.b)(500))}static#e=this.\u0275fac=function(n){return new(n||a)(e.Y36(r.so),e.Y36(r.WI))};static#t=this.\u0275cmp=e.Xpm({type:a,selectors:[["app-upload-progress-dialog"]],viewQuery:function(n,o){if(1&n&&e.Gf(E,7),2&n){let i;e.iGM(i=e.CRH())&&(o.tableWrapper=i.first)}},decls:12,vars:3,consts:[["mat-dialog-title",""],[2,"float","right"],["mat-icon-button","","mat-dialog-close",""],[1,"mat-typography"],[1,"table-wrapper"],["tableWrapper",""],[2,"font-size","small","width","100%"],[3,"failed",4,"ngFor","ngForOf"],[2,"width","100px","text-align","center"],[4,"ngIf"],[1,"icon14",2,"vertical-align","middle",3,"matTooltip"]],template:function(n,o){1&n&&(e.TgZ(0,"h3",0)(1,"div",1)(2,"button",2)(3,"mat-icon"),e._uU(4,"close"),e.qZA()()(),e._uU(5," Uploads\n"),e.qZA(),e.TgZ(6,"mat-dialog-content",3)(7,"div",4,5)(9,"table",6),e.YNc(10,X,7,6,"tr",7),e.ALo(11,"async"),e.qZA()()()),2&n&&(e.xp6(10),e.Q6J("ngForOf",e.lcZ(11,1,o.uploads$)))},dependencies:[_.sg,_.O5,k.RK,r.ZT,r.uh,r.xY,x.Hw,H.gM,d.Zy,_.Ov],styles:["tr.failed[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{color:red}h3.mat-mdc-dialog-title[_ngcontent-%COMP%]{background-color:#24292e;color:#fff;margin:0;padding-left:5px;font-size:16px;line-height:40px}table[_ngcontent-%COMP%]{border-collapse:collapse}.table-wrapper[_ngcontent-%COMP%]{height:150px;overflow-y:scroll;overflow-x:hidden;padding:5px}"],changeDetection:0})}return a})();function ee(a,c){if(1&a&&(e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA()()),2&a){const t=c.$implicit;let n;e.xp6(2),e.Oqu(t.key),e.xp6(2),e.Oqu(null!==(n=t.value)&&void 0!==n?n:"-")}}let te=(()=>{class a{constructor(t,n){this.dialogRef=t,this.data=n}static#e=this.\u0275fac=function(n){return new(n||a)(e.Y36(r.so),e.Y36(r.WI))};static#t=this.\u0275cmp=e.Xpm({type:a,selectors:[["app-view-object-metadata-dialog"]],decls:14,vars:3,consts:[["mat-dialog-title",""],[1,"mat-typography"],["yaDataTable","",1,"expand"],["width","1"],[4,"ngFor","ngForOf"],["align","end"],["mat-dialog-close","",1,"ya-button"]],template:function(n,o){1&n&&(e.TgZ(0,"h2",0),e._uU(1,"Object Metadata"),e.qZA(),e.TgZ(2,"mat-dialog-content",1)(3,"table",2)(4,"tr")(5,"th",3),e._uU(6,"Key"),e.qZA(),e.TgZ(7,"th"),e._uU(8,"Value"),e.qZA()(),e.YNc(9,ee,5,2,"tr",4),e.ALo(10,"keyvalue"),e.qZA()(),e.TgZ(11,"mat-dialog-actions",5)(12,"button",6),e._uU(13,"CLOSE"),e.qZA()()),2&n&&(e.xp6(9),e.Q6J("ngForOf",e.lcZ(10,1,o.data.metadata)))},dependencies:[_.sg,d.Gj,r.ZT,r.uh,r.xY,r.H8,_.Nd],encapsulation:2})}return a})();var T=u(6593),h=u(4643),ae=u(6385),j=u(7988),v=u(2651),y=u(4104);const ne=function(a){return["/storage/buckets",a,"objects"]},oe=function(a){return["/storage/buckets",a,"properties"]};let q=(()=>{class a{constructor(t){this.yamcs=t}static#e=this.\u0275fac=function(n){return new(n||a)(e.Y36(d.C8))};static#t=this.\u0275cmp=e.Xpm({type:a,selectors:[["app-bucket-page-tabs"]],inputs:{bucket:"bucket"},decls:10,vars:10,consts:[["mat-tab-nav-bar","",1,"secondary",3,"mat-stretch-tabs","tabPanel"],["mat-tab-link","","routerLinkActive","",3,"routerLink","active"],["rla","routerLinkActive"],["rlb","routerLinkActive"],["tabPanel",""]],template:function(n,o){if(1&n&&(e.TgZ(0,"nav",0)(1,"a",1,2),e._uU(3," Objects "),e.qZA(),e.TgZ(4,"a",1,3),e._uU(6," Properties "),e.qZA()(),e.TgZ(7,"mat-tab-nav-panel",null,4),e._UZ(9,"router-outlet"),e.qZA()),2&n){const i=e.MAs(2),s=e.MAs(5),l=e.MAs(8);e.Q6J("mat-stretch-tabs",!1)("tabPanel",l),e.xp6(1),e.Q6J("routerLink",e.VKq(6,ne,o.bucket))("active",i.isActive),e.xp6(3),e.Q6J("routerLink",e.VKq(8,oe,o.bucket))("active",s.isActive)}},dependencies:[p.lC,p.rH,p.Od,y.BU,y.sW,y.Nj],styles:[".mat-mdc-tab-link[_ngcontent-%COMP%]{height:36px;min-width:0;font-size:13px}"],changeDetection:0})}return a})();const ie=[[["app-storage-toolbar"]],[["ya-detail-pane"]],"*"],ce=["app-storage-toolbar","ya-detail-pane","*"];let A=(()=>{class a{constructor(){this.noscroll=!1}static#e=this.\u0275fac=function(n){return new(n||a)};static#t=this.\u0275cmp=e.Xpm({type:a,selectors:[["app-storage-page"]],inputs:{noscroll:"noscroll"},ngContentSelectors:ce,decls:4,vars:2,consts:[[1,"page-content"]],template:function(n,o){1&n&&(e.F$t(ie),e.Hsn(0),e.TgZ(1,"div",0),e.Hsn(2,1),e.Hsn(3,2),e.qZA()),2&n&&(e.xp6(1),e.Udp("overflow",o.noscroll?"hidden":"auto"))},styles:[".page-content[_ngcontent-%COMP%]{position:absolute;inset:49px 0 0;overflow:auto}"],changeDetection:0})}return a})();var D=u(1274);const se=["*"];let P=(()=>{class a{static#e=this.\u0275fac=function(n){return new(n||a)};static#t=this.\u0275cmp=e.Xpm({type:a,selectors:[["app-storage-toolbar"]],ngContentSelectors:se,decls:4,vars:0,consts:[[1,"top"],[2,"flex","1 1 auto"]],template:function(n,o){1&n&&(e.F$t(),e.TgZ(0,"mat-toolbar",0)(1,"mat-toolbar-row"),e.Hsn(2),e._UZ(3,"span",1),e.qZA()())},dependencies:[D.Ye,D.rD],styles:["mat-toolbar[_ngcontent-%COMP%]{border-bottom:1px solid rgba(0,0,0,.1);background-color:#f7f7f7;box-sizing:content-box}mat-toolbar-row[_ngcontent-%COMP%]{padding-left:24px}.hide[_ngcontent-%COMP%]{visibility:hidden}.toolbar-text[_ngcontent-%COMP%]{font-size:12px}"],changeDetection:0})}return a})();const le=["droparea"],re=["uploader"];function ue(a,c){1&a&&(e.TgZ(0,"mat-icon"),e._uU(1,"image_not_supported"),e.qZA())}function de(a,c){1&a&&(e.TgZ(0,"mat-icon"),e._uU(1,"image"),e.qZA())}function me(a,c){if(1&a&&(e.ynx(0),e._UZ(1,"img",19),e.BQk()),2&a){const t=e.oxw();e.xp6(1),e.Q6J("src",t.selection.selected[0].objectUrl,e.LSH)}}function ge(a,c){1&a&&(e.TgZ(0,"div",20)(1,"mat-icon"),e._uU(2,"arrow_back"),e.qZA(),e.TgZ(3,"p"),e._uU(4," Select an image to make it appear here "),e.qZA()())}function pe(a,c){if(1&a&&e._UZ(0,"ya-breadcrumb",23),2&a){const t=c.$implicit;e.Q6J("link",t.route)("label",t.name)}}const _e=function(){return["/storage/buckets"]},he=function(a){return["/storage/buckets",a,"objects"]};function fe(a,c){if(1&a&&(e.TgZ(0,"div",21)(1,"ya-breadcrumb-trail"),e._UZ(2,"ya-breadcrumb",22)(3,"ya-breadcrumb",23),e.YNc(4,pe,1,2,"ya-breadcrumb",24),e.qZA()()),2&a){const t=c.ngIf,n=e.oxw();e.xp6(2),e.Q6J("link",e.DdM(4,_e)),e.xp6(1),e.Q6J("link",e.VKq(5,he,n.name))("label",n.name),e.xp6(1),e.Q6J("ngForOf",t)}}function be(a,c){if(1&a){const t=e.EpF();e.TgZ(0,"th",39)(1,"input",40),e.NdJ("change",function(o){e.CHM(t);const i=e.oxw(2);return e.KtG(o?i.masterToggle():null)}),e.qZA()()}if(2&a){const t=e.oxw(2);e.xp6(1),e.Q6J("checked",t.selection.hasValue()&&t.isAllSelected())}}function ke(a,c){if(1&a){const t=e.EpF();e.TgZ(0,"td",41)(1,"input",42),e.NdJ("click",function(o){return o.stopPropagation()})("change",function(o){const s=e.CHM(t).$implicit,l=e.oxw(2);return e.KtG(o?l.selection.toggle(s):null)}),e.qZA()()}if(2&a){const t=c.$implicit,n=e.oxw(2);e.xp6(1),e.Q6J("checked",n.selection.isSelected(t))}}function xe(a,c){1&a&&(e.TgZ(0,"th",43),e._uU(1,"Name"),e.qZA())}function Ze(a,c){if(1&a&&(e.ynx(0),e.TgZ(1,"mat-icon",45),e._uU(2,"folder"),e.qZA(),e.TgZ(3,"a",46),e.NdJ("click",function(n){return n.stopPropagation()}),e._uU(4),e.ALo(5,"filename"),e.qZA(),e.BQk()),2&a){const t=e.oxw().$implicit,n=e.oxw(2);e.xp6(3),e.Q6J("routerLink","/storage/buckets/"+n.name+"/objects/"+t.name),e.xp6(1),e.hij("",e.lcZ(5,2,t.name)," ")}}function Te(a,c){if(1&a&&(e.ynx(0),e.TgZ(1,"mat-icon",45),e._uU(2,"description"),e.qZA(),e.TgZ(3,"a",47),e.NdJ("click",function(n){return n.stopPropagation()}),e._uU(4),e.ALo(5,"filename"),e.qZA(),e.BQk()),2&a){const t=e.oxw().$implicit;e.xp6(3),e.Q6J("href",t.objectUrl,e.LSH),e.xp6(1),e.hij("",e.lcZ(5,2,t.name)," ")}}function ve(a,c){if(1&a&&(e.TgZ(0,"td",44),e.YNc(1,Ze,6,4,"ng-container",5),e.YNc(2,Te,6,4,"ng-container",5),e.qZA()),2&a){const t=c.$implicit;e.xp6(1),e.Q6J("ngIf",t.folder),e.xp6(1),e.Q6J("ngIf",!t.folder)}}function ye(a,c){1&a&&(e.TgZ(0,"th",43),e._uU(1,"Date modified"),e.qZA())}function Ae(a,c){if(1&a&&(e.TgZ(0,"td",44),e._uU(1),e.ALo(2,"datetime"),e.qZA()),2&a){const t=c.$implicit;e.xp6(1),e.hij(" ",e.lcZ(2,1,t.modified)||"-"," ")}}function Pe(a,c){1&a&&(e.TgZ(0,"th",43),e._uU(1,"Size"),e.qZA())}function Ce(a,c){if(1&a&&(e.TgZ(0,"td",44),e._uU(1),e.ALo(2,"formatBytes"),e.qZA()),2&a){const t=c.$implicit;e.xp6(1),e.hij(" ",e.lcZ(2,1,t.size)||"-"," ")}}function we(a,c){1&a&&e._UZ(0,"th",48)}function Oe(a,c){if(1&a){const t=e.EpF();e.TgZ(0,"ya-more")(1,"button",49),e.NdJ("click",function(){e.CHM(t);const o=e.oxw().$implicit,i=e.oxw(2);return e.KtG(i.renameFile(o))}),e._uU(2," Rename "),e.qZA(),e.TgZ(3,"a",50),e._uU(4," Download "),e.qZA(),e._UZ(5,"mat-divider"),e.TgZ(6,"button",51),e.NdJ("click",function(){e.CHM(t);const o=e.oxw().$implicit,i=e.oxw(2);return e.KtG(i.openViewMetadataDialog(o))}),e._uU(7," View metadata "),e.qZA(),e._UZ(8,"mat-divider"),e.TgZ(9,"button",49),e.NdJ("click",function(){e.CHM(t);const o=e.oxw().$implicit,i=e.oxw(2);return e.KtG(i.deleteFile(o))}),e._uU(10," Delete "),e.qZA()()}if(2&a){const t=e.oxw().$implicit;e.xp6(3),e.Q6J("href",t.objectUrl,e.LSH),e.xp6(3),e.Q6J("disabled",!t.metadata)}}function Be(a,c){if(1&a&&(e.TgZ(0,"td",44),e.YNc(1,Oe,11,2,"ya-more",5),e.qZA()),2&a){const t=c.$implicit;e.xp6(1),e.Q6J("ngIf",!t.folder)}}function Ue(a,c){1&a&&e._UZ(0,"tr",52)}function je(a,c){if(1&a){const t=e.EpF();e.TgZ(0,"tr",53),e.NdJ("click",function(){const i=e.CHM(t).$implicit,s=e.oxw(2);return e.KtG(s.toggleOne(i))}),e.qZA()}if(2&a){const t=c.$implicit,n=e.oxw(2);e.ekj("selected",n.selection.isSelected(t))}}function qe(a,c){if(1&a&&(e.TgZ(0,"table",25),e.ynx(1,26),e.YNc(2,be,2,1,"th",27),e.YNc(3,ke,2,1,"td",28),e.BQk(),e.ynx(4,29),e.YNc(5,xe,2,0,"th",30),e.YNc(6,ve,3,2,"td",31),e.BQk(),e.ynx(7,32),e.YNc(8,ye,2,0,"th",30),e.YNc(9,Ae,3,3,"td",31),e.BQk(),e.ynx(10,33),e.YNc(11,Pe,2,0,"th",30),e.YNc(12,Ce,3,3,"td",31),e.BQk(),e.ynx(13,34),e.YNc(14,we,1,0,"th",35),e.YNc(15,Be,2,1,"td",36),e.BQk(),e.YNc(16,Ue,1,0,"tr",37),e.YNc(17,je,1,2,"tr",38),e.qZA()),2&a){const t=e.oxw();e.Q6J("dataSource",t.dataSource),e.xp6(16),e.Q6J("cdkHeaderRowDef",t.displayedColumns),e.xp6(1),e.Q6J("cdkRowDefColumns",t.displayedColumns)}}function De(a,c){1&a&&(e.TgZ(0,"ya-empty-message"),e._uU(1,"Empty directory."),e.qZA())}let S=(()=>{class a{constructor(t,n,o,i,s){this.dialog=t,this.route=o,this.breadcrumb$=new b.X([]),this.dragActive$=new b.X(!1),this.showPreview$=new b.X(!1),this.previewWidth$=new b.X(600),this.displayedColumns=["select","name","size","modified","actions"],this.dataSource=new g.by([]),this.selection=new U.Ov(!0,[]),this.uploads$=new b.X([]),this.progressDialogOpen=!1,this.name=o.snapshot.parent.parent.paramMap.get("name"),s.setTitle(this.name),this.storageClient=i.createStorageClient(),this.loadCurrentFolder(),this.routerSubscription=n.events.pipe((0,L.h)(l=>l instanceof p.m2)).subscribe(()=>{this.loadCurrentFolder()})}loadCurrentFolder(){const t={delimiter:"/"},n=this.route.snapshot.url;n.length&&(t.prefix=n.map(o=>o.path).join("/")+"/"),this.storageClient.listObjects(this.name,t).then(o=>{this.updateBrowsePath(),this.changedir(o)})}changedir(t){this.selection.clear();const n=[];for(const o of t.prefixes||[])n.push({folder:!0,name:o});for(const o of t.objects||[])o.name.endsWith("/")||n.push({folder:!1,name:o.name,modified:o.created,size:o.size,objectUrl:this.storageClient.getObjectURL(this.name,o.name),metadata:o.metadata});this.dataSource.data=n}isAllSelected(){const n=this.dataSource.filteredData.length;return this.selection.selected.length===n&&n>0}masterToggle(){this.isAllSelected()?this.selection.clear():this.dataSource.filteredData.forEach(t=>this.selection.select(t))}toggleOne(t){(!this.selection.isSelected(t)||this.selection.selected.length>1)&&this.selection.clear(),this.selection.toggle(t)}createFolder(){this.dialog.open(z,{width:"400px",data:{bucket:this.name,path:this.getCurrentPath()}}).afterClosed().subscribe({next:()=>this.loadCurrentFolder()})}uploadObjects(){let t=this.getCurrentPath();t.startsWith("/")&&(t=t.substring(1));const n=this.uploaderEl.nativeElement.files,o=[];for(const i in n)if(!isNaN(parseInt(i,10))){const s=n[i],Z=this.storageClient.uploadObject(this.name,t?t+"/"+s.name:s.name,s);o.push({filename:s.name,promise:Z})}o.length&&this.showUploadProgress().then(()=>{for(const i of o)this.trackUpload(i);this.settlePromises(o.map(i=>i.promise)).then(()=>{this.loadCurrentFolder()})})}settlePromises(t){return Promise.all(t.map(n=>n.then(o=>({state:"fullfilled",value:o}),o=>({state:"rejected",value:o}))))}trackUpload(t){t.promise.then(()=>{t.complete=!0,this.uploads$.next([...this.uploads$.value])}).catch(n=>{n.response.json().then(o=>{t.complete=!0,t.err=o.msg,this.uploads$.next([...this.uploads$.value])}).catch(()=>{t.complete=!0,t.err=n.statusText,this.uploads$.next([...this.uploads$.value])})}),this.uploads$.next([...this.uploads$.value,t])}getCurrentPath(){let t="";for(const n of this.route.snapshot.url)t+="/"+n.path;return t||"/"}togglePreview(){this.showPreview$.next(!this.showPreview$.value)}deleteSelectedObjects(){const t=[],n=[];for(const o of this.selection.selected)o.folder?n.push(this.storageClient.listObjects(this.name,{prefix:o.name}).then(i=>{t.push(...(i.objects||[]).map(l=>l.name))})):t.push(o.name);Promise.all(n).then(()=>{if(confirm(`You are about to delete ${t.length} files. Are you sure you want to continue?`)){const o=[];for(const i of t)o.push(this.storageClient.deleteObject(this.name,i));Promise.all(o).then(()=>{this.loadCurrentFolder()})}})}renameFile(t){this.dialog.open(I,{data:{bucket:this.name,name:t.name},width:"400px"}).afterClosed().subscribe(o=>{o&&this.loadCurrentFolder()})}deleteFile(t){confirm(`Are you sure you want to delete ${t.name}?`)&&this.storageClient.deleteObject(this.name,t.name).then(()=>{this.loadCurrentFolder()})}openViewMetadataDialog(t){this.dialog.open(te,{width:"600px",data:{metadata:t.metadata||{}}})}dragEnter(t){return this.dragActive$.next(!0),t.preventDefault(),t.stopPropagation(),!1}dragOver(t){return t.preventDefault(),t.stopPropagation(),!1}dragLeave(t){return this.dragActive$.next(!1),t.preventDefault(),t.stopPropagation(),!1}drop(t){const n=t.dataTransfer||{};if(n){let o=this.getCurrentPath().substring(1);""!==o&&(o+="/"),F.v(n).then(i=>{if(i.length){const s=[];this.showUploadProgress().then(()=>{for(const l of i){const Z=this.storageClient.uploadObject(this.name,o+l._fullPath,l);this.trackUpload({filename:l._fullPath,promise:Z}),s.push(Z)}this.settlePromises(s).then(()=>{this.loadCurrentFolder()})})}})}return this.dragActive$.next(!1),t.preventDefault(),t.stopPropagation(),!1}updateBrowsePath(){const t=[];let n="";for(const o of this.route.snapshot.url)n+="/"+o.path,t.push({name:o.path,route:`/storage/buckets/${this.name}/objects`+n});return this.breadcrumb$.next(t),n||"/"}isImage(t){if(t.folder)return!1;const n=t.name.toLocaleLowerCase();return n.endsWith(".png")||n.endsWith(".gif")||n.endsWith(".jpg")||n.endsWith("jpeg")||n.endsWith("bmp")||n.endsWith("svg")||n.endsWith("ico")}showUploadProgress(){var t=this;return(0,B.Z)(function*(){if(!t.progressDialogOpen)return t.dialogRef=t.dialog.open(K,{position:{bottom:"10px",right:"10px"},width:"500px",data:{uploads$:t.uploads$},hasBackdrop:!1,autoFocus:!1,panelClass:["progress-dialog","mat-elevation-z2"]}),t.dialogRef.afterOpened().subscribe(()=>t.progressDialogOpen=!0),t.dialogRef.afterClosed().subscribe(()=>{t.uploads$.next([]),t.progressDialogOpen=!1}),new Promise((n,o)=>{t.dialogRef.afterOpened().subscribe(()=>{n(!0)},i=>{o(i)})})})()}resizeMouseDown(t){let n=t.clientX;const o=this.previewWidth$.value,i=l=>{null!==n&&this.previewWidth$.next(Math.max(400,o-(l.clientX-n)))},s=l=>{n=null,document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",s)};document.addEventListener("mousemove",i),document.addEventListener("mouseup",s)}ngOnDestroy(){this.routerSubscription&&this.routerSubscription.unsubscribe(),this.dialogRef&&this.dialogRef.close()}static#e=this.\u0275fac=function(n){return new(n||a)(e.Y36(r.uw),e.Y36(p.F0),e.Y36(p.gz),e.Y36(d.C8),e.Y36(T.Dx))};static#t=this.\u0275cmp=e.Xpm({type:a,selectors:[["ng-component"]],viewQuery:function(n,o){if(1&n&&(e.Gf(le,7),e.Gf(re,5)),2&n){let i;e.iGM(i=e.CRH())&&(o.dropArea=i.first),e.iGM(i=e.CRH())&&(o.uploaderEl=i.first)}},decls:47,vars:33,consts:[["mat-icon-button","","routerLink","/storage/buckets","color","primary"],["mat-button","","color","primary",3,"click"],["type","file","hidden","","multiple","",3,"change"],["uploader",""],["mat-button","","color","primary",3,"disabled","click"],[4,"ngIf"],[1,"droparea",3,"dragenter"],["droparea",""],[1,"droparea-overlay",3,"dragover","dragleave","drop"],[3,"autosize"],["mode","side","position","end",2,"text-align","center",3,"opened","disableClose"],[1,"resize-handle",3,"mousedown"],[4,"ngIf","ngIfElse"],["placeholder",""],[1,"panel-content"],[3,"bucket"],["style","margin-top: 16px",4,"ngIf"],["mat-table","","class","ya-data-table expand",3,"dataSource",4,"ngIf","ngIfElse"],["empty",""],[3,"src"],[2,"margin-top","4em","color","#fff"],[2,"margin-top","16px"],["label","Buckets",3,"link"],[3,"link","label"],[3,"link","label",4,"ngFor","ngForOf"],["mat-table","",1,"ya-data-table","expand",3,"dataSource"],["cdkColumnDef","select"],["mat-header-cell","","class","checkbox",4,"cdkHeaderCellDef"],["mat-cell","","class","checkbox",4,"cdkCellDef"],["cdkColumnDef","name"],["mat-header-cell","",4,"cdkHeaderCellDef"],["mat-cell","",4,"cdkCellDef"],["cdkColumnDef","modified"],["cdkColumnDef","size"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-header-row","",4,"cdkHeaderRowDef"],["mat-row","",3,"selected","click",4,"cdkRowDef","cdkRowDefColumns"],["mat-header-cell","",1,"checkbox"],["type","checkbox",3,"checked","change"],["mat-cell","",1,"checkbox"],["type","checkbox",3,"checked","click","change"],["mat-header-cell",""],["mat-cell",""],[1,"icon12",2,"vertical-align","middle","margin-right","7px"],[3,"routerLink","click"],["download","",3,"href","click"],["mat-header-cell","",1,"expand"],["mat-menu-item","",3,"click"],["mat-menu-item","","download","",3,"href"],["mat-menu-item","",3,"disabled","click"],["mat-header-row",""],["mat-row","",3,"click"]],template:function(n,o){if(1&n){const i=e.EpF();e.TgZ(0,"app-storage-page")(1,"app-storage-toolbar")(2,"a",0)(3,"mat-icon"),e._uU(4,"arrow_back"),e.qZA()(),e._uU(5),e.TgZ(6,"button",1),e.NdJ("click",function(){e.CHM(i);const l=e.MAs(11);return e.KtG(l.click())}),e.TgZ(7,"mat-icon"),e._uU(8,"file_upload"),e.qZA(),e._uU(9," Upload files "),e.TgZ(10,"input",2,3),e.NdJ("change",function(){return o.uploadObjects()}),e.qZA()(),e.TgZ(12,"button",1),e.NdJ("click",function(){return o.createFolder()}),e.TgZ(13,"mat-icon"),e._uU(14,"create_new_folder"),e.qZA(),e._uU(15," Create folder "),e.qZA(),e.TgZ(16,"button",4),e.NdJ("click",function(){return o.deleteSelectedObjects()}),e.TgZ(17,"mat-icon"),e._uU(18,"delete"),e.qZA(),e._uU(19," Delete "),e.qZA(),e.TgZ(20,"button",1),e.NdJ("click",function(){return o.togglePreview()}),e.YNc(21,ue,2,0,"mat-icon",5),e.ALo(22,"async"),e.YNc(23,de,2,0,"mat-icon",5),e.ALo(24,"async"),e._uU(25," Preview panel "),e.qZA()(),e.TgZ(26,"div",6,7),e.NdJ("dragenter",function(l){return o.dragEnter(l)}),e.ALo(28,"async"),e.TgZ(29,"div",8),e.NdJ("dragover",function(l){return o.dragOver(l)})("dragleave",function(l){return o.dragLeave(l)})("drop",function(l){return o.drop(l)}),e.ALo(30,"async"),e.qZA(),e.TgZ(31,"mat-sidenav-container",9)(32,"mat-sidenav",10),e.ALo(33,"async"),e.ALo(34,"async"),e.TgZ(35,"div",11),e.NdJ("mousedown",function(l){return o.resizeMouseDown(l)}),e.qZA(),e.YNc(36,me,2,1,"ng-container",12),e.YNc(37,ge,5,0,"ng-template",null,13,e.W1O),e.qZA(),e.TgZ(39,"mat-sidenav-content")(40,"div",14),e._UZ(41,"app-bucket-page-tabs",15),e.YNc(42,fe,5,7,"div",16),e.ALo(43,"async"),e.YNc(44,qe,18,3,"table",17),e.YNc(45,De,2,0,"ng-template",null,18,e.W1O),e.qZA()()()()()}if(2&n){const i=e.MAs(38),s=e.MAs(46);e.xp6(5),e.hij(" ",o.name," \xa0\xa0\xa0 "),e.xp6(11),e.Q6J("disabled",!o.selection.hasValue()),e.xp6(5),e.Q6J("ngIf",e.lcZ(22,19,o.showPreview$)),e.xp6(2),e.Q6J("ngIf",!e.lcZ(24,21,o.showPreview$)),e.xp6(3),e.ekj("active",e.lcZ(28,23,o.dragActive$)),e.xp6(3),e.ekj("hide",!e.lcZ(30,25,o.dragActive$)),e.xp6(2),e.Q6J("autosize",!0),e.xp6(1),e.Udp("width",e.lcZ(33,27,o.previewWidth$)+"px"),e.Q6J("opened",e.lcZ(34,29,o.showPreview$))("disableClose",!1),e.xp6(4),e.Q6J("ngIf",1===o.selection.selected.length&&o.isImage(o.selection.selected[0]))("ngIfElse",i),e.xp6(5),e.Q6J("bucket",o.name),e.xp6(1),e.Q6J("ngIf",e.lcZ(43,31,o.breadcrumb$)),e.xp6(2),e.Q6J("ngIf",o.dataSource&&o.dataSource.data.length)("ngIfElse",s)}},dependencies:[_.sg,_.O5,p.rH,h.Sq,h.O_,h.D5,h.fo,h.s$,k.lW,k.o6,x.Hw,ae.d,j.OP,v.JX,v.TM,v.Rh,g.BZ,g.fO,g.w1,g.Dz,g.ge,g.ev,g.XQ,g.Gk,d.LI,d.O_,d.RR,d.cQ,q,A,P,_.Ov,d.id,d.XB,d.bP],styles:["mat-toolbar[_ngcontent-%COMP%]{border-bottom:1px solid #d3d3d3;background-color:#fff;box-sizing:content-box;color:#000000a7}mat-toolbar-row[_ngcontent-%COMP%]{padding-left:24px}.droparea[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;overflow:auto;user-select:none;-webkit-user-select:none;-moz-user-select:none;-khtml-user-select:none}.droparea-overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;box-sizing:border-box;background:rgba(27,97,185,.1);border:1px solid rgba(27,97,185,1);z-index:10;user-select:none;-webkit-user-select:none;-moz-user-select:none;-khtml-user-select:none}  .progress-dialog .mat-mdc-dialog-container{box-shadow:none;padding:0;overflow:hidden}  .progress-dialog .mat-mdc-dialog-content{overflow:hidden}.mat-sidenav-container[_ngcontent-%COMP%]{height:100%;width:100%;background-color:inherit}.mat-sidenav-container[_ngcontent-%COMP%]   .mat-sidenav[_ngcontent-%COMP%]{background-color:#000}.mat-sidenav[_ngcontent-%COMP%]   .mat-drawer-inner-container[_ngcontent-%COMP%]{overflow:hidden!important}.resize-handle[_ngcontent-%COMP%]{position:absolute;background-color:#000;top:0;left:0;width:20px;bottom:0;cursor:ew-resize;user-select:none;-webkit-user-select:none;-moz-user-select:none;-khtml-user-select:none}.mat-sidenav-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{margin:2em;max-width:calc(100% - 5em);max-height:calc(100% - 5em)}"],changeDetection:0})}return a})(),Y=(()=>{class a{static#e=this.\u0275fac=function(n){return new(n||a)};static#t=this.\u0275cmp=e.Xpm({type:a,selectors:[["ng-component"]],decls:1,vars:0,template:function(n,o){1&n&&e._UZ(0,"router-outlet")},dependencies:[p.lC],encapsulation:2,changeDetection:0})}return a})();function Se(a,c){if(1&a&&(e.ynx(0),e.TgZ(1,"dt"),e._uU(2,"Directory"),e.qZA(),e.TgZ(3,"dd"),e._uU(4),e.qZA(),e.BQk()),2&a){const t=e.oxw().ngIf;e.xp6(4),e.Oqu(t.directory)}}function Ye(a,c){if(1&a&&(e.TgZ(0,"div",4)(1,"dl",5)(2,"dt"),e._uU(3,"Created"),e.qZA(),e.TgZ(4,"dd"),e._uU(5),e.ALo(6,"nvl"),e.ALo(7,"datetime"),e.qZA(),e.TgZ(8,"dt"),e._uU(9,"Storage engine"),e.qZA(),e.TgZ(10,"dd"),e._uU(11),e.qZA(),e.YNc(12,Se,5,1,"ng-container",6),e.qZA(),e.TgZ(13,"h3"),e._uU(14,"Bucket size"),e.qZA(),e.TgZ(15,"dl",5)(16,"dt"),e._uU(17,"Limit"),e.qZA(),e.TgZ(18,"dd"),e._uU(19),e.ALo(20,"nvl"),e.ALo(21,"formatBytes"),e.qZA(),e.TgZ(22,"dt"),e._uU(23,"Used"),e.qZA(),e.TgZ(24,"dd"),e._uU(25),e.ALo(26,"nvl"),e.ALo(27,"formatBytes"),e.qZA(),e.TgZ(28,"dt"),e._uU(29,"Available"),e.qZA(),e.TgZ(30,"dd"),e._uU(31),e.ALo(32,"formatBytes"),e.qZA()(),e.TgZ(33,"h3"),e._uU(34,"Object count"),e.qZA(),e.TgZ(35,"dl",5)(36,"dt"),e._uU(37,"Limit"),e.qZA(),e.TgZ(38,"dd"),e._uU(39),e.ALo(40,"nvl"),e.qZA(),e.TgZ(41,"dt"),e._uU(42,"Used"),e.qZA(),e.TgZ(43,"dd"),e._uU(44),e.ALo(45,"nvl"),e.qZA(),e.TgZ(46,"dt"),e._uU(47,"Available"),e.qZA(),e.TgZ(48,"dd"),e._uU(49),e.qZA()()()),2&a){const t=c.ngIf,n=e.oxw();e.xp6(5),e.Oqu(e.xi3(6,9,e.lcZ(7,12,t.created),"-")),e.xp6(6),e.Oqu(t.directory?"File System":"RocksDB"),e.xp6(1),e.Q6J("ngIf",t.directory),e.xp6(7),e.Oqu(e.xi3(20,14,e.lcZ(21,17,t.maxSize),"-")),e.xp6(6),e.Oqu(e.xi3(26,19,e.lcZ(27,22,t.size),"-")),e.xp6(6),e.Oqu(e.lcZ(32,24,n.zeroOrMore(t.maxSize-t.size))),e.xp6(8),e.Oqu(e.xi3(40,26,t.maxObjects,"-")),e.xp6(5),e.Oqu(e.xi3(45,29,t.numObjects,"-")),e.xp6(5),e.Oqu(n.zeroOrMore(t.maxObjects-t.numObjects))}}let J=(()=>{class a{constructor(t,n,o){this.bucket$=new b.X(null),this.name=t.snapshot.parent.paramMap.get("name"),o.setTitle(this.name+": Properties"),this.storageClient=n.createStorageClient(),this.storageClient.getBucket(this.name).then(i=>{this.bucket$.next(i)})}bucketSizePercentage(t,n=!1){var o=100*t.size/t.maxSize;return n?Math.min(100,o):o}objectCountPercentage(t,n=!1){var o=100*t.numObjects/t.maxObjects;return n?Math.min(100,o):o}zeroOrMore(t){return Math.max(0,t)}static#e=this.\u0275fac=function(n){return new(n||a)(e.Y36(p.gz),e.Y36(d.C8),e.Y36(T.Dx))};static#t=this.\u0275cmp=e.Xpm({type:a,selectors:[["ng-component"]],decls:10,vars:5,consts:[["mat-icon-button","","routerLink","/storage/buckets","color","primary"],[1,"panel-content"],[3,"bucket"],["class","small","style","margin-top: 16px",4,"ngIf"],[1,"small",2,"margin-top","16px"],[1,"dl-horizontal"],[4,"ngIf"]],template:function(n,o){1&n&&(e.TgZ(0,"app-storage-page")(1,"app-storage-toolbar")(2,"a",0)(3,"mat-icon"),e._uU(4,"arrow_back"),e.qZA()(),e._uU(5),e.qZA(),e.TgZ(6,"div",1),e._UZ(7,"app-bucket-page-tabs",2),e.YNc(8,Ye,50,32,"div",3),e.ALo(9,"async"),e.qZA()()),2&n&&(e.xp6(5),e.hij(" ",o.name," "),e.xp6(2),e.Q6J("bucket",o.name),e.xp6(1),e.Q6J("ngIf",e.lcZ(9,3,o.bucket$)))},dependencies:[_.O5,p.rH,k.o6,x.Hw,q,A,P,_.Ov,d.id,d.bP,d.mc],styles:[".progress[_ngcontent-%COMP%]{display:inline-block;width:100px;position:relative;text-align:center;margin-right:5px;background-color:#eee;border:1px solid rgba(0,0,0,.1)}.fill[_ngcontent-%COMP%]{position:absolute;top:0;bottom:0;left:0;width:30%;background-color:#009e87;background:linear-gradient(to bottom,#009e87,#bce3dd 50%,#009e87)}.label[_ngcontent-%COMP%]{position:absolute;inset:0;margin:0 auto}"],changeDetection:0})}return a})();var C=u(3566);let Je=(()=>{class a{constructor(t,n,o,i,s){this.dialogRef=t,this.data=i,this.messageService=s,this.storageClient=o.createStorageClient(),this.form=n.group({name:["",m.kI.required]})}save(){this.storageClient.createBucket({name:this.form.value.name}).then(()=>this.dialogRef.close(!0)).catch(t=>{this.dialogRef.close(!1),this.messageService.showError(t)})}static#e=this.\u0275fac=function(n){return new(n||a)(e.Y36(r.so),e.Y36(m.QS),e.Y36(d.C8),e.Y36(r.WI),e.Y36(d.ez))};static#t=this.\u0275cmp=e.Xpm({type:a,selectors:[["app-create-bucket-dialog"]],decls:12,vars:2,consts:[["mat-dialog-title",""],[1,"mat-typography"],[1,"ya-form",3,"formGroup"],["type","text","formControlName","name"],["align","end"],["mat-dialog-close","",1,"ya-button"],[1,"ya-button","primary",3,"disabled","click"]],template:function(n,o){1&n&&(e.TgZ(0,"h2",0),e._uU(1,"Create bucket"),e.qZA(),e.TgZ(2,"mat-dialog-content",1)(3,"form",2)(4,"label"),e._uU(5," Bucket name "),e._UZ(6,"input",3),e.qZA()()(),e.TgZ(7,"mat-dialog-actions",4)(8,"button",5),e._uU(9,"CANCEL"),e.qZA(),e.TgZ(10,"button",6),e.NdJ("click",function(){return o.save()}),e._uU(11,"SAVE"),e.qZA()()),2&n&&(e.xp6(3),e.Q6J("formGroup",o.form),e.xp6(7),e.Q6J("disabled",!o.form.valid))},dependencies:[m._Y,m.Fj,m.JJ,m.JL,m.sg,m.u,r.ZT,r.uh,r.xY,r.H8],encapsulation:2})}return a})();var Ne=u(5394);function Me(a,c){if(1&a){const t=e.EpF();e.TgZ(0,"button",26),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.createBucket())}),e.TgZ(1,"mat-icon"),e._uU(2,"add_circle_outline"),e.qZA(),e._uU(3," Create bucket "),e.qZA()}}function Qe(a,c){if(1&a){const t=e.EpF();e.TgZ(0,"button",27),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.deleteSelectedBuckets())}),e.TgZ(1,"mat-icon"),e._uU(2,"delete"),e.qZA(),e._uU(3," Delete "),e.qZA()}if(2&a){const t=e.oxw();e.Q6J("disabled",!t.selection.hasValue())}}function $e(a,c){if(1&a){const t=e.EpF();e.TgZ(0,"input",30),e.NdJ("change",function(o){e.CHM(t);const i=e.oxw(2);return e.KtG(o?i.masterToggle():null)}),e.qZA()}if(2&a){const t=e.oxw(2);e.Q6J("checked",t.selection.hasValue()&&t.isAllSelected())}}function Le(a,c){if(1&a&&(e.TgZ(0,"th",28),e.YNc(1,$e,1,1,"input",29),e.qZA()),2&a){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.mayManageBuckets())}}function Fe(a,c){if(1&a){const t=e.EpF();e.TgZ(0,"input",33),e.NdJ("click",function(o){return o.stopPropagation()})("change",function(o){e.CHM(t);const i=e.oxw().$implicit,s=e.oxw();return e.KtG(o?s.selection.toggle(i):null)}),e.qZA()}if(2&a){const t=e.oxw().$implicit,n=e.oxw();e.Q6J("checked",n.selection.isSelected(t))}}function ze(a,c){if(1&a&&(e.TgZ(0,"td",31),e.YNc(1,Fe,1,1,"input",32),e.qZA()),2&a){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.mayManageBuckets())}}function Ie(a,c){1&a&&(e.TgZ(0,"th",34),e._uU(1,"Bucket"),e.qZA())}const Re=function(a){return[a]};function He(a,c){if(1&a&&(e.TgZ(0,"td",35)(1,"mat-icon",36),e._uU(2,"shopping_basket"),e.qZA(),e.TgZ(3,"a",37),e.NdJ("click",function(n){return n.stopPropagation()}),e._uU(4),e.qZA()()),2&a){const t=c.$implicit;e.xp6(3),e.Q6J("routerLink",e.VKq(2,Re,t.name)),e.xp6(1),e.Oqu(t.name)}}function Ee(a,c){1&a&&(e.TgZ(0,"th",34),e._uU(1,"Created"),e.qZA())}function Ge(a,c){if(1&a&&(e.TgZ(0,"td",35),e._uU(1),e.ALo(2,"nvl"),e.ALo(3,"datetime"),e.qZA()),2&a){const t=c.$implicit;e.xp6(1),e.Oqu(e.xi3(2,1,e.lcZ(3,4,t.created),"-"))}}function We(a,c){1&a&&(e.TgZ(0,"th",38),e._uU(1,"Used"),e.qZA())}function Ve(a,c){if(1&a&&(e.TgZ(0,"td",39),e._uU(1),e.ALo(2,"nvl"),e.ALo(3,"formatBytes"),e.qZA()),2&a){const t=c.$implicit;e.xp6(1),e.Oqu(e.xi3(2,1,e.lcZ(3,4,t.size),"-"))}}function Xe(a,c){1&a&&(e.TgZ(0,"th",38),e._uU(1,"Available"),e.qZA())}function Ke(a,c){if(1&a&&(e.TgZ(0,"td",39),e._uU(1),e.ALo(2,"nvl"),e.ALo(3,"formatBytes"),e.qZA()),2&a){const t=c.$implicit,n=e.oxw();e.xp6(1),e.hij(" ",e.xi3(2,1,e.lcZ(3,4,n.zeroOrMore(t.maxSize-t.size)),"-")," ")}}function et(a,c){1&a&&(e.TgZ(0,"th",40),e._uU(1,"Capacity"),e.qZA())}function tt(a,c){if(1&a&&(e.TgZ(0,"td",35),e._UZ(1,"ya-progress",41),e.qZA()),2&a){const t=c.$implicit;e.xp6(1),e.Q6J("value",t.size)("total",t.maxSize)}}function at(a,c){1&a&&(e.TgZ(0,"th",38),e._uU(1,"Objects"),e.qZA())}function nt(a,c){if(1&a&&(e.TgZ(0,"td",39),e._uU(1),e.ALo(2,"nvl"),e.ALo(3,"number"),e.qZA()),2&a){const t=c.$implicit;e.xp6(1),e.hij(" ",e.xi3(2,1,e.lcZ(3,4,t.numObjects),"-")," ")}}function ot(a,c){1&a&&(e.TgZ(0,"th",38),e._uU(1,"Avail. objects"),e.qZA())}function it(a,c){if(1&a&&(e.TgZ(0,"td",39),e._uU(1),e.ALo(2,"nvl"),e.ALo(3,"number"),e.qZA()),2&a){const t=c.$implicit,n=e.oxw();e.xp6(1),e.hij(" ",e.xi3(2,1,e.lcZ(3,4,n.zeroOrMore(t.maxObjects-t.numObjects)),"-")," ")}}function ct(a,c){1&a&&(e.TgZ(0,"th",40),e._uU(1,"%objects"),e.qZA())}function st(a,c){if(1&a&&(e.TgZ(0,"td",35),e._UZ(1,"ya-progress",41),e.qZA()),2&a){const t=c.$implicit;e.xp6(1),e.Q6J("value",t.numObjects)("total",t.maxObjects)}}function lt(a,c){1&a&&e._UZ(0,"th",42)}function rt(a,c){if(1&a){const t=e.EpF();e.TgZ(0,"ya-more")(1,"button",44),e.NdJ("click",function(){e.CHM(t);const o=e.oxw().$implicit,i=e.oxw();return e.KtG(i.deleteBucket(o))}),e._uU(2," Delete bucket "),e.qZA()()}}function ut(a,c){if(1&a&&(e.TgZ(0,"td",35),e.YNc(1,rt,3,0,"ya-more",43),e.qZA()),2&a){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.mayManageBuckets())}}function dt(a,c){1&a&&e._UZ(0,"tr",45)}function mt(a,c){if(1&a){const t=e.EpF();e.TgZ(0,"tr",46),e.NdJ("click",function(){const i=e.CHM(t).$implicit,s=e.oxw();return e.KtG(s.toggleOne(i))}),e.qZA()}if(2&a){const t=c.$implicit,n=e.oxw();e.ekj("selected",n.selection.isSelected(t))}}const gt=[{path:"",canActivate:[O.r,Q.h],canActivateChild:[O.q],runGuardsAndResolvers:"always",component:$,children:[{path:"",pathMatch:"full",redirectTo:"buckets"},{path:"buckets",children:[{path:"",pathMatch:"full",component:(()=>{class a{constructor(t,n,o,i,s,l,f){this.yamcs=t,this.dialog=n,this.router=o,this.route=i,this.messageService=s,this.authService=l,this.filterControl=new m.p4,this.displayedColumns=["select","name","created","size","avail","capacity","numObjects","availObjects","pctObjects","actions"],this.dataSource=new g.by,this.selection=new U.Ov(!0,[]),f.setTitle("Buckets"),this.storageClient=this.yamcs.createStorageClient(),this.initializeOptions(),this.refreshView()}ngAfterViewInit(){this.dataSource.sort=this.sort}initializeOptions(){const t=this.route.snapshot.queryParamMap;t.has("filter")&&(this.filterControl.setValue(t.get("filter")),this.dataSource.filter=t.get("filter").toLowerCase()),this.filterControl.valueChanges.subscribe(()=>{this.updateURL(),this.dataSource.filter=(this.filterControl.value||"").toLowerCase();for(const o of this.selection.selected)-1===this.dataSource.filteredData.indexOf(o)&&this.selection.deselect(o)})}isAllSelected(){const n=this.dataSource.filteredData.length;return this.selection.selected.length===n&&n>0}masterToggle(){this.isAllSelected()?this.selection.clear():this.dataSource.filteredData.forEach(t=>this.selection.select(t))}toggleOne(t){(!this.selection.isSelected(t)||this.selection.selected.length>1)&&this.selection.clear(),this.selection.toggle(t)}createBucket(){this.dialog.open(Je,{width:"400px"}).afterClosed().subscribe(n=>{n&&this.refreshView()})}zeroOrMore(t){return Math.max(0,t)}mayManageBuckets(){return this.authService.getUser().hasSystemPrivilege("ManageAnyBucket")}deleteSelectedBuckets(){if(confirm("Are you sure you want to delete the selected buckets?")){const t=[];for(const n of this.selection.selected){const o=this.storageClient.deleteBucket(n.name);t.push(o)}Promise.all(t).then(()=>{this.selection.clear(),this.refreshView()})}}deleteBucket(t){confirm(`Are you sure you want to delete the bucket ${t.name}?`)&&this.storageClient.deleteBucket(t.name).then(()=>{this.selection.clear(),this.refreshView()}).catch(n=>this.messageService.showError(n))}selectNext(){const t=this.dataSource.filteredData;let n=0;if(this.selection.hasValue()){const o=this.selection.selected[this.selection.selected.length-1];-1!==t.indexOf(o)&&(n=Math.min(t.indexOf(o)+1,t.length-1))}this.selection.clear(),this.selection.select(t[n])}selectPrevious(){const t=this.dataSource.filteredData;let n=0;if(this.selection.hasValue()){const o=this.selection.selected[0];-1!==t.indexOf(o)&&(n=Math.max(t.indexOf(o)-1,0))}this.selection.clear(),this.selection.select(t[n])}applySelection(){this.selection.hasValue()&&1===this.selection.selected.length&&this.router.navigate(["/buckets",this.selection.selected[0].name])}refreshView(){this.updateURL(),this.storageClient.getBuckets().then(t=>{this.dataSource.data=t}).catch(t=>this.messageService.showError(t))}updateURL(){this.router.navigate([],{replaceUrl:!0,relativeTo:this.route,queryParams:{filter:this.filterControl.value||null},queryParamsHandling:"merge"})}static#e=this.\u0275fac=function(n){return new(n||a)(e.Y36(d.C8),e.Y36(r.uw),e.Y36(p.F0),e.Y36(p.gz),e.Y36(d.ez),e.Y36(Ne.e),e.Y36(T.Dx))};static#t=this.\u0275cmp=e.Xpm({type:a,selectors:[["ng-component"]],viewQuery:function(n,o){if(1&n&&e.Gf(C.YE,7),2&n){let i;e.iGM(i=e.CRH())&&(o.sort=i.first)}},decls:41,vars:6,consts:[["mat-button","","color","primary",3,"click",4,"ngIf"],["mat-button","","color","primary",3,"disabled","click",4,"ngIf"],[1,"panel-content"],[1,"filter-bar"],["placeholder","Filter buckets",3,"formControl","onArrowDown","onArrowUp","onEnter"],["mat-table","","matSort","","matSortActive","name","matSortDirection","asc","matSortDisableClear","",1,"ya-data-table","expand",3,"dataSource"],["cdkColumnDef","select"],["mat-header-cell","","class","checkbox",4,"cdkHeaderCellDef"],["mat-cell","","class","checkbox",4,"cdkCellDef"],["matColumnDef","name"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","created"],["matColumnDef","size"],["mat-header-cell","","mat-sort-header","","style","text-align: right",4,"matHeaderCellDef"],["mat-cell","","style","text-align: right",4,"matCellDef"],["matColumnDef","avail"],["matColumnDef","capacity"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","numObjects"],["matColumnDef","availObjects"],["matColumnDef","pctObjects"],["matColumnDef","actions"],["mat-header-cell","","class","expand",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",3,"selected","click",4,"matRowDef","matRowDefColumns"],["mat-button","","color","primary",3,"click"],["mat-button","","color","primary",3,"disabled","click"],["mat-header-cell","",1,"checkbox"],["type","checkbox",3,"checked","change",4,"ngIf"],["type","checkbox",3,"checked","change"],["mat-cell","",1,"checkbox"],["type","checkbox",3,"checked","click","change",4,"ngIf"],["type","checkbox",3,"checked","click","change"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],[1,"icon12",2,"vertical-align","middle","margin-right","7px"],[3,"routerLink","click"],["mat-header-cell","","mat-sort-header","",2,"text-align","right"],["mat-cell","",2,"text-align","right"],["mat-header-cell",""],[3,"value","total"],["mat-header-cell","",1,"expand"],[4,"ngIf"],["mat-menu-item","",3,"click"],["mat-header-row",""],["mat-row","",3,"click"]],template:function(n,o){1&n&&(e.TgZ(0,"app-storage-page")(1,"app-storage-toolbar"),e._uU(2," Storage \xa0\xa0\xa0 "),e.YNc(3,Me,4,0,"button",0),e.YNc(4,Qe,4,1,"button",1),e.qZA(),e.TgZ(5,"div",2)(6,"div",3)(7,"ya-search-filter",4),e.NdJ("onArrowDown",function(){return o.selectNext()})("onArrowUp",function(){return o.selectPrevious()})("onEnter",function(){return o.applySelection()}),e.qZA()(),e.TgZ(8,"table",5),e.ynx(9,6),e.YNc(10,Le,2,1,"th",7),e.YNc(11,ze,2,1,"td",8),e.BQk(),e.ynx(12,9),e.YNc(13,Ie,2,0,"th",10),e.YNc(14,He,5,4,"td",11),e.BQk(),e.ynx(15,12),e.YNc(16,Ee,2,0,"th",10),e.YNc(17,Ge,4,6,"td",11),e.BQk(),e.ynx(18,13),e.YNc(19,We,2,0,"th",14),e.YNc(20,Ve,4,6,"td",15),e.BQk(),e.ynx(21,16),e.YNc(22,Xe,2,0,"th",14),e.YNc(23,Ke,4,6,"td",15),e.BQk(),e.ynx(24,17),e.YNc(25,et,2,0,"th",18),e.YNc(26,tt,2,2,"td",11),e.BQk(),e.ynx(27,19),e.YNc(28,at,2,0,"th",14),e.YNc(29,nt,4,6,"td",15),e.BQk(),e.ynx(30,20),e.YNc(31,ot,2,0,"th",14),e.YNc(32,it,4,6,"td",15),e.BQk(),e.ynx(33,21),e.YNc(34,ct,2,0,"th",18),e.YNc(35,st,2,2,"td",11),e.BQk(),e.ynx(36,22),e.YNc(37,lt,1,0,"th",23),e.YNc(38,ut,2,1,"td",11),e.BQk(),e.YNc(39,dt,1,0,"tr",24),e.YNc(40,mt,1,2,"tr",25),e.qZA()()()),2&n&&(e.xp6(3),e.Q6J("ngIf",o.mayManageBuckets()),e.xp6(1),e.Q6J("ngIf",o.mayManageBuckets()),e.xp6(3),e.Q6J("formControl",o.filterControl),e.xp6(1),e.Q6J("dataSource",o.dataSource),e.xp6(31),e.Q6J("matHeaderRowDef",o.displayedColumns),e.xp6(1),e.Q6J("matRowDefColumns",o.displayedColumns))},dependencies:[_.O5,m.JJ,m.oH,p.rH,h.O_,h.D5,h.fo,k.lW,x.Hw,j.OP,C.YE,C.nU,g.BZ,g.fO,g.as,g.w1,g.Dz,g.nj,g.ge,g.ev,g.XQ,g.Gk,d.cQ,d.t1,d.cF,A,P,_.JJ,d.id,d.bP,d.mc],encapsulation:2,changeDetection:0})}return a})(),data:{hasSidebar:!1}},{path:":name",children:[{path:"",pathMatch:"full",redirectTo:"objects"},{path:"objects",component:Y,children:[{path:"**",component:S,data:{hasSidebar:!1}}]},{path:"properties",component:J,data:{hasSidebar:!1}}]}]}]}];let pt=(()=>{class a{static#e=this.\u0275fac=function(n){return new(n||a)};static#t=this.\u0275mod=e.oAB({type:a});static#a=this.\u0275inj=e.cJS({imports:[p.Bz.forChild(gt),p.Bz]})}return a})(),_t=(()=>{class a{static#e=this.\u0275fac=function(n){return new(n||a)};static#t=this.\u0275mod=e.oAB({type:a});static#a=this.\u0275inj=e.cJS({imports:[M.m,pt]})}return a})()}}]);